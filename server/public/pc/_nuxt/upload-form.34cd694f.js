import{_ as ie}from"./index.vue.83bf2a64.js";import{d as le,au as ne,z as ae,c as A,aG as re,bC as de,r as S,cy as ce,D as fe,k as f,I as E,s as u,m as o,q as r,Z as t,cZ as ue,v as C,t as h,l as _,K as J,J as T,Y as me,aI as pe,a0 as j,L as V,cX as ve,dv as D,dw as _e,c$ as xe,G as z,y as he,ay as ge,ba as be,cY as Ae,_ as De}from"./entry.556496e9.js";import{E as we}from"./index.a390bc0e.js";import{_ as ye}from"./index.2280f26b.js";/* empty css                   */import{h as Re}from"./digital_human.299b9036.js";import{DigitalHumanModelVersionEnum as l}from"./index.d52c6f2c.js";import{commonUploadLimit as w,uploadLimit as n}from"./index.3c6cab0f.js";import"./index.eaed1e2d.js";import"./index.65c6aa54.js";import"./cloneDeep.3021ea2e.js";/* empty css                  *//* empty css                    *//* empty css                  */const ke=""+new URL("video_upload_temp.93159d03.png",import.meta.url).href,Ne=""+new URL("video_upload_error_temp.d2a965d5.png",import.meta.url).href,Se=""+new URL("example.4bdca056.mp4",import.meta.url).href,Ce={class:"rounded-[24px] flex overflow-hidden container"},Me={class:"absolute top-2 right-2"},Ee={class:"w-[400px] bg-[#101010] py-[30px] px-[20px] flex-shrink-0"},Te={class:"flex items-center gap-x-2 mt-4"},Ve={class:"text-lg text-white font-bold"},ze={class:"mt-[15px]"},Pe={class:"flex gap-4"},Ue={class:"flex flex-col gap-y-[6px]"},$e={class:"text-[#ffffffcc] flex-shrink-0"},He={class:"text-[#ffffff4d]"},Ie={class:"mt-2"},Le={class:"flex items-center gap-x-2 mt-4"},Be={class:"flex-1 p-[30px] text-base"},Ge={class:"flex items-center gap-x-3"},Je={class:"text-white"},je={class:"flex flex-col gap-y-1"},Fe=["onClick"],Ye=["src"],qe={class:"text-white font-bold"},Ke={class:"flex items-center gap-x-1 rounded-full bg-[#ffffff08] p-1 mt-5"},Ze={class:"rounded-xl grow min-h-0 mt-4"},Oe={class:"w-full rounded-lg h-[256px] bg-app-bg-1"},Xe={key:0,class:"flex flex-col items-center justify-center h-full"},Qe={class:"w-12 h-12 rounded-xl flex items-center justify-center border border-dashed border-[#ffffff1a] hover:border-[#ffffff33] cursor-pointer"},We={key:1,class:"w-full h-full relative"},eo={class:"absolute top-0 left-0 w-full h-full"},oo=["src"],to={class:"w-[45%] mx-auto h-full flex flex-col items-center justify-center rounded-lg relative overflow-hidden"},so=["src"],io={class:"absolute top-2 right-2 z-[11]"},lo={class:"mt-4 flex justify-center"},F=".mp4,.mov",no=le({__name:"upload-form",emits:["create","close","playVideo"],setup(ao,{expose:Y,emit:q}){const g=q,K=ne(),x=ae(),M=A(()=>{const{channel:i}=K.getDigitalHumanConfig;return i&&i.length>0?i.filter(e=>e.status==1&&(l.CHANJING==e.id||l.STANDARD==e.id)):[]}),s=re({model_version:l.STANDARD,anchor_name:de().format("YYYYMMDDHHmmss").substring(2),width:"",height:"",pic:"",url:""}),Z=A(()=>{var i,e,d,a,m;return{[l.STANDARD]:(i=x.getTokenByScene(D.HUMAN_AVATAR))==null?void 0:i.score,[l.SUPER]:(e=x.getTokenByScene(D.HUMAN_AVATAR_PRO))==null?void 0:e.score,[l.ADVANCED]:(d=x.getTokenByScene(D.HUMAN_AVATAR_ADVANCED))==null?void 0:d.score,[l.ELITE]:(a=x.getTokenByScene(D.HUMAN_AVATAR_ELITE))==null?void 0:a.score,[l.CHANJING]:(m=x.getTokenByScene(D.HUMAN_AVATAR_CHANJING))==null?void 0:m.score}[s.model_version]}),P=A(()=>{var i;return(i=M.value.find(e=>e.id==s.model_version))==null?void 0:i.name}),U={resolution:`${w.minResolution}P-${w.maxResolution}P`,fileSize:w.size,videoMinDuration:w.videoMinDuration,videoMaxDuration:w.videoMaxDuration},y={[l.STANDARD]:{resolution:`${n[l.STANDARD].minResolution}P-${n[l.STANDARD].maxResolution}P`,fileSize:n[l.STANDARD].size,videoMinDuration:n[l.STANDARD].videoMinDuration,videoMaxDuration:n[l.STANDARD].videoMaxDuration},[l.SUPER]:{resolution:`${n[l.SUPER].minResolution}P-${n[l.SUPER].maxResolution}P`,fileSize:n[l.SUPER].size,videoMinDuration:n[l.SUPER].videoMinDuration,videoMaxDuration:n[l.SUPER].videoMaxDuration},[l.ADVANCED]:U,[l.ELITE]:U,[l.CHANJING]:{resolution:`${n[l.CHANJING].minResolution}P-${n[l.CHANJING].maxResolution}P`,fileSize:n[l.CHANJING].size,videoMinDuration:n[l.CHANJING].videoMinDuration,videoMaxDuration:n[l.CHANJING].videoMaxDuration}},O=A(()=>{var i,e,d,a;return[{name:"录制视频",value:"视频全程只能有一个人物，嘴型不得遮挡，不得多人出镜"},{name:"文件大小",value:`文件≤${(i=y[s.model_version])==null?void 0:i.fileSize}MB，${(e=y[s.model_version])==null?void 0:e.videoMinDuration}秒-${(d=y[s.model_version])==null?void 0:d.videoMaxDuration}秒`},{name:"文件格式",value:F},{name:"视频帧率",value:"15fps≤帧率≤60fps"},{name:"视频要求",value:`清晰度必须为${(a=y[s.model_version])==null?void 0:a.resolution}`},{name:"声音要求",value:"视频内音频需要清晰、响亮且无嘈杂背景音等干扰"},{name:"录制框架",value:"视频应为人物正面出镜的近景画面，避免大角度侧脸或人脸过小"}]}),R=S(!1),$=A(()=>s.url&&s.anchor_name),X=i=>{const{data:{uri:e}}=i;s.url=e,Q(e)},p=S(!1),Q=async i=>{p.value=!0;const{file:e,width:d,height:a}=await _e(i);s.width=d,s.height=a,e?xe({file:e}).then(m=>{s.pic=m.uri,p.value=!1}):p.value=!1},H=i=>{s.url="",s.pic="",R.value=!1,i&&(s.model_version=i)},W=async()=>{const{model_version:i,gender:e,pic:d,url:a,width:m,height:b}=s;if(!a){z.msgError("请上传视频");return}if(v.value==1)g("create",{modelType:v.value,formData:s}),k();else if(v.value==2)try{await Re({name:s.anchor_name,gender:e,url:a,pic:d,width:m,height:b,model_version:i}),x.getUser(),z.msgSuccess("克隆成功"),g("create",{modelType:v.value,formData:s}),k()}catch(N){z.msgError(N||"克隆失败")}},{lockFn:I,isLock:L}=ce(W),B=S(),v=S(1),ee=async i=>{var e;v.value=i,(e=B.value)==null||e.open()},k=()=>{g("close")},oe=async()=>{g("playVideo",Se)};return fe(()=>M.value,i=>{i&&i.length&&(s.model_version=i[0].id)},{deep:!0,immediate:!0}),Y({open:ee}),(i,e)=>{const d=ie,a=he,m=we,b=ge,N=be,te=ye,se=Ae;return f(),E(ve,{ref_key:"uploadPopRef",ref:B,width:"778px",class:"digital-human-upload-popup",style:{padding:"0","background-color":"var(--app-bg-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,"append-to-body":!1,onClose:k},{default:u(()=>[o("div",Ce,[o("div",Me,[o("div",{class:"w-6 h-6",onClick:k},[r(d,{theme:t(ue).DARK},null,8,["theme"])])]),o("div",Ee,[e[7]||(e[7]=o("div",{class:"title-text"},[C(" 上传视频 "),o("br"),C(" 同步创建形象并生成内容 ")],-1)),o("div",Te,[r(a,{name:"local-icon-success_fill",color:"var(--color-primary)",size:18}),o("span",Ve,"视频要求（"+h(t(P))+"）",1)]),o("div",ze,[o("div",Pe,[e[4]||(e[4]=o("div",{class:"flex-shrink-0"},[o("img",{src:ke,class:"w-[134px]"})],-1)),o("div",Ue,[(f(!0),_(T,null,J(t(O),(c,G)=>(f(),_("div",{key:G,class:"text-[10px]"},[o("span",$e,h(c.name),1),e[3]||(e[3]=o("span",{class:"text-[#ffffff4d]"},"·",-1)),o("span",He,h(c.value),1)]))),128))])]),o("div",Ie,[o("div",Le,[r(a,{name:"local-icon-error_fill",color:"#ffffff",size:18}),e[5]||(e[5]=o("span",{class:"text-lg text-white font-bold"},"错误示例",-1))]),e[6]||(e[6]=o("img",{src:Ne,class:"mt-[15px]"},null,-1))])])]),o("div",Be,[e[14]||(e[14]=o("div",{class:"text-[#ffffff80]"},"请上传一段视频，作为驱动数字人的 底版视频",-1)),o("div",{class:"cursor-pointer text-white mt-[10px] inline-block",onClick:oe}," 查看教程示例 "),r(m,{visible:t(R),"popper-class":"!w-[318px] !p-2 !bg-app-bg-2 !border-[--app-border-color-1] !rounded-xl",teleported:"","show-arrow":!1},{reference:u(()=>[o("div",{class:"mt-[15px] border border-[var(--app-border-color-1)] bg-app-bg-1 rounded-lg h-[48px] flex items-center justify-between px-3 cursor-pointer",onClick:e[0]||(e[0]=c=>R.value=!t(R))},[e[8]||(e[8]=o("div",{class:"text-[#ffffff80]"},"模型选择",-1)),o("div",Ge,[o("div",Je,h(t(P)),1),r(a,{name:"local-icon-up_down",size:20,color:"#ffffff0d"})])])]),default:u(()=>[o("div",null,[o("div",je,[(f(!0),_(T,null,J(t(M),c=>(f(),_("div",{key:c.id,class:me(["flex items-center h-11 rounded-md hover:bg-app-bg-1 border border-[transparent] hover:border-[var(--app-border-color-1)] gap-x-3 px-3 cursor-pointer",{"bg-app-bg-1 border-[var(--app-border-color-1)]":t(s).model_version==c.id}]),onClick:G=>H(c.id)},[o("img",{src:c.icon,class:"w-5 h-5"},null,8,Ye),o("div",qe,h(c.name),1)],10,Fe))),128))])])]),_:1},8,["visible"]),o("div",Ke,[r(a,{name:"local-icon-tips",size:16}),e[9]||(e[9]=o("div",{class:"text-[#ffffff4d] text-xs"},"注意：切换模型版本，需要重新上传视频及相关内容。",-1))]),o("div",Ze,[r(te,{class:"w-full h-full",type:"video",drag:"","show-progress":"",limit:1,"show-file-list":!1,"max-size":t(n)[t(s).model_version].size,"min-duration":t(n)[t(s).model_version].videoMinDuration,"max-duration":t(n)[t(s).model_version].videoMaxDuration,"video-min-width":t(n)[t(s).model_version].minResolution,"video-max-width":t(n)[t(s).model_version].maxResolution,"video-min-height":t(n)[t(s).model_version].minResolution,"video-max-height":t(n)[t(s).model_version].maxResolution,accept:F,onSuccess:X},{default:u(()=>[o("div",Oe,[t(s).url?pe((f(),_("div",We,[t(p)?V("",!0):(f(),_(T,{key:0},[o("div",eo,[o("img",{src:t(s).pic,class:"w-full h-full rounded-lg object-cover filter blur-sm"},null,8,oo)]),o("div",to,[o("img",{src:t(s).pic,class:"w-full h-full rounded-lg object-cover"},null,8,so),o("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer",onClick:e[1]||(e[1]=j(c=>g("playVideo",t(s).url),["stop"]))},[r(a,{name:"local-icon-play",size:50,color:"#ffffff"})])]),o("div",io,[r(N,{content:"删除"},{default:u(()=>[r(b,{circle:"",color:"#ffffff0f",onClick:e[2]||(e[2]=j(c=>H(),["stop"]))},{default:u(()=>[r(a,{name:"el-icon-Delete",size:14,color:"#ffffff"})]),_:1})]),_:1})])],64))])),[[se,t(p)]]):(f(),_("div",Xe,[o("div",Qe,[r(a,{name:"el-icon-Plus",color:"#ffffff"})]),e[10]||(e[10]=o("div",{class:"gap-2 mt-[15px] flex flex-col"},[o("span",{class:"text-white"},"点击此开始上传视频"),o("span",{class:"text-xs text-[#ffffff80]"},"支持拖拽上传")],-1)),e[11]||(e[11]=o("div",{class:"absolute bottom-2 left-0 w-full text-center text-[#ffffff80] text-[10px]"}," 为保证形象的复刻效果，推荐阅读左侧要求后录制上传 ",-1))]))])]),_:1},8,["max-size","min-duration","max-duration","video-min-width","video-max-width","video-min-height","video-max-height"])]),o("div",lo,[t(v)==2?(f(),E(N,{key:0,placement:"top"},{content:u(()=>[o("div",null,"扣除算力："+h(t(Z)||0),1)]),default:u(()=>[r(b,{type:"primary",class:"w-full !h-[50px] !rounded-full",loading:t(L)||t(p),disabled:!t($),onClick:t(I)},{default:u(()=>[...e[12]||(e[12]=[C(" 立即克隆 ",-1)])]),_:1},8,["loading","disabled","onClick"])]),_:1})):V("",!0),t(v)==1?(f(),E(b,{key:1,type:"primary",class:"w-full !h-[50px] !rounded-full",loading:t(L)||t(p),disabled:!t($),onClick:t(I)},{default:u(()=>[...e[13]||(e[13]=[C(" 立即创建 ",-1)])]),_:1},8,["loading","disabled","onClick"])):V("",!0)])])])]),_:1},512)}}});const wo=De(no,[["__scopeId","data-v-d95c9e25"]]);export{wo as default};
