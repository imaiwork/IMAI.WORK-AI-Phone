import{d as me,a as ve,r as u,dO as v,A as fe,cy as _e,G as g,k as C,l as ge,m as t,t as L,Z as l,dn as ye,dp as xe,q as o,s as r,aI as he,I as A,v as k,bM as Ee,L as W,J as Ce,el as f,e9 as ke,ai as be,y as Ae,ay as De,av as we,cX as Ne,cY as Re,u as Te}from"./entry.556496e9.js";import{E as $e,a as Ue}from"./index.e8affe9d.js";import{E as Ie}from"./index.ef7246b4.js";import{E as Pe}from"./index.a390bc0e.js";import{_ as Oe}from"./index.vue.ba665940.js";import{_ as Ve}from"./index.vue.83bf2a64.js";/* empty css                        *//* empty css               *//* empty css                   *//* empty css                 *//* empty css                     */import{u as Se}from"./usePaging.cb2ddca4.js";import{u as Fe}from"./useDeviceWs.7882efc1.js";import{u as Le,E as D}from"./useAddDeviceAccount.99a35854.js";import{h as Be,l as je,m as He}from"./device.b8ac970d.js";import{_ as Xe}from"./device-add.vue.3b59af5e.js";import{_ as Ge}from"./device-progress.vue.babc0f8f.js";import"./index.4bb9b943.js";import"./_baseIteratee.4a27397d.js";import"./debounce.0430f44a.js";import"./toNumber.844d22bd.js";import"./raf.a745d528.js";import"./index.899f58ef.js";import"./strings.09a7c832.js";import"./clamp.b3f2460d.js";import"./index.c754b099.js";import"./useWebSocket.111ad540.js";import"./service.557e9b35.js";import"./usePolling.fc11778b.js";const Me=""+new URL("device.5646dcc8.svg",import.meta.url).href,Ke={class:"h-full p-4 flex flex-col"},Ye={class:"rounded-[20px] flex items-center gap-3 px-[30px]",style:{background:`linear-gradient(152deg, rgba(0, 101, 251, 0.88) -42.44%, rgba(255, 255, 255, 0) 12.19%)
                    rgb(255, 255, 255)`}},qe={class:"text-[#000000cc]"},We={class:"grow min-h-0 bg-white rounded-[20px] mt-4 flex flex-col"},ze={class:"h-[88px] px-5 flex items-center justify-between"},Je={class:"flex items-center gap-x-2"},Ze={class:"text-lg font-bold"},Qe={class:"grow min-h-0"},et={class:"flex items-center justify-center gap-x-1"},tt=["onClick"],st={class:"flex flex-col gap-2"},ot=["onClick"],nt=["onClick"],lt={class:"flex items-center justify-center"},at=["onClick"],it={class:"flex items-center justify-center"},rt=["onClick"],ct={class:"flex items-center justify-center"},dt=["onClick"],ut={class:"flex items-center justify-center"},pt=["onClick"],mt={class:"flex items-center justify-center h-full"},vt={class:"flex justify-end p-4"},ft={class:"-my-4"},_t={class:"mt-2"},gt={class:"mt-6 flex justify-center text-white"},qt=me({__name:"index",setup(yt){const z=ve(),J=Te(),{pager:y,getLists:p}=Se({fetchFun:Be}),m=u([{name:"微信",type:v.WECHAT,status:0},{name:"小红书",type:v.XHS,status:0},{name:"抖音",type:v.DOUYIN,status:0},{name:"快手",type:v.KUAISHOU,status:0}]),w=u([]),B=u(),b=u(!1),N=u(!1),j=u(""),R=u(""),P=fe(),T=u({device_code:"",device_name:""}),{isConnected:H,onEvent:Z,send:Q}=Fe(),{showAddDevice:O,addDeviceLoading:ee,progressValue:X,refreshAccount:V,eventAction:x,handleRefreshAccount:G,handleBatchUpdateAccount:te}=Le({send:Q,onEvent:Z,onSuccess:s=>{var n,d;const{msg:e,type:a}=s;switch(a){case f.ADD_DEVICE:case f.DEVICE_ONLINE:p();break;case f.GET_USER_INFO:if(x.value==="batchUpdateAccount"){const c=m.value.find(h=>h.status===1);c&&(c.status=2),!m.value.some(h=>w.value.includes(h.type)&&(h.status===0||h.status===1))?(S.value="",N.value=!1,$.value=null,b.value=!1,p()):I()}else N.value=!1,b.value=!1,p();break;case f.APP_EXEC:case f.OPEN_APP:case f.OPEN_PERSON_CENTER:case f.GET_ACCOUNT_INFO:case f.DATA_SEND:case f.GET_ACCOUNT_INFO_COMPLETE:if(x.value==D.BatchUpdateAccount){const c=(n=m.value.find(_=>_.status==1))==null?void 0:n.name;R.value=`${c} ${e}`}else R.value=`${(d=m.value.find(c=>c.type==F.value))==null?void 0:d.name} ${e}`;break}},onError:s=>{const{code:e,error:a,content:n,type:d}=s;if(n.ode==ke.DEVICE_OFFLINE&&(g.msgError(a),p()),(x.value===D.UpdateAccount||x.value===D.AddAccount||x.value===D.AddDevice)&&(N.value=!0,j.value=a,X.value=0),x.value===D.BatchUpdateAccount){const c=m.value.find(_=>_.status===1);c&&(R.value=a,g.msgError(a),c.status=3,I())}}}),S=u(""),F=u(),{isLock:se,lockFn:oe}=_e(async()=>{try{await je(T.value),g.msgSuccess("更新成功"),M(),p()}catch(s){g.msgError(s||"更新失败")}}),ne=s=>{var e;(e=P.value)==null||e.open(),T.value={device_code:s.device_code,device_name:s.device_name}},M=()=>{var s;(s=P.value)==null||s.close()},le=()=>{if(!H.value){g.msgError("连接失败，请检查网络连接");return}N.value=!1,x.value==D.BatchUpdateAccount?I():G($.value,F.value)},$=u(null),U=(s,e)=>{$.value=s.device_code,V.value=s.accounts,b.value=!0,F.value=e,G($.value,e)},K=s=>{var a;S.value=s,V.value=((a=y.lists.find(n=>n.device_code==s))==null?void 0:a.accounts)||[],V.value.length==0?w.value=m.value.map(n=>n.type):w.value=m.value.filter(n=>n.status==0).map(n=>n.type),m.value.forEach(n=>{w.value.includes(n.type)&&(n.status=0)}),b.value=!0,I()},I=()=>{const s=m.value.find(e=>w.value.includes(e.type)&&e.status===0);s&&(s.status=1,ae(s.type))},ae=s=>{te({device_code:S.value,type:s})},Y=s=>{const{accounts:e,device_code:a,device_model:n,id:d}=s,c=e.find(_=>_.type==v.XHS);c?z.push({path:`/device/${d}`,query:{account:c.account,device_code:a,device_model:n}}):U(s,v.XHS)},q=async()=>{var s;if(!H.value){g.msgError("连接失败，请检查网络连接");return}O.value=!0,await be(),(s=B.value)==null||s.open()},ie=s=>{J.$confirm({message:"确定删除该设备吗？",onConfirm:async()=>{try{await He({id:s.id,device_code:s.device_code}),g.msgSuccess("删除设备成功"),p()}catch(e){g.msgError(e||"删除失败")}}})};return p(),(s,e)=>{const a=Ae,n=De,d=$e,c=Ie,_=Pe,h=Ue,re=Oe,ce=Ve,de=we,ue=Ne,pe=Re;return C(),ge(Ce,null,[t("div",Ke,[t("div",Ye,[e[7]||(e[7]=t("img",{src:Me,class:"w-11 mt-7"},null,-1)),t("div",null,[t("div",qe,L(l(ye)[l(xe).DEVICE]),1),e[6]||(e[6]=t("div",{class:"text-[#00000080]"}," 一键绑定跨平台设备，激活智能流程引擎，全链路接管部门任务，让团队拥有数字化中枢管家。 ",-1))])]),t("div",We,[t("div",ze,[t("div",Je,[t("span",Ze,"设备总数量："+L(l(y).count)+"台",1),o(n,{text:"",onClick:e[0]||(e[0]=i=>l(p)())},{default:r(()=>[o(a,{name:"el-icon-Refresh"}),e[8]||(e[8]=t("span",{class:"text-[#86909C]"},"刷新",-1))]),_:1})]),t("div",null,[o(n,{type:"primary",class:"!rounded-full !h-10",onClick:q},{default:r(()=>[o(a,{name:"local-icon-add_circle"}),e[9]||(e[9]=t("span",{class:"ml-2"},"添加设备",-1))]),_:1})])]),t("div",Qe,[he((C(),A(h,{data:l(y).lists,height:"100%",stripe:"","row-style":{height:"60px"},"header-cell-style":{height:"63px"}},{empty:r(()=>[t("div",mt,[e[20]||(e[20]=k(" 还没有设备，",-1)),o(n,{type:"primary",link:"",onClick:q},{default:r(()=>[...e[19]||(e[19]=[k("点击添加设备",-1)])]),_:1})])]),default:r(()=>[o(d,{prop:"device_name",label:"设备名称","show-overflow-tooltip":""},{default:r(({row:i})=>[t("div",et,[o(n,{type:"primary",link:"",onClick:E=>Y(i)},{default:r(()=>[k(L(i.device_name),1)]),_:2},1032,["onClick"]),t("span",{class:"cursor-pointer leading-[0]",onClick:E=>ne(i)},[o(a,{name:"el-icon-Edit",color:"var(--color-primary)"})],8,tt)])]),_:1}),o(d,{prop:"device_model",label:"设备型号","show-overflow-tooltip":""}),o(d,{prop:"sdk_version",label:"当前SDK版本","show-overflow-tooltip":""}),o(d,{prop:"device_code",label:"设备码","show-overflow-tooltip":""}),o(d,{label:"设备状态"},{default:r(({row:i})=>[i.status==1?(C(),A(c,{key:0,type:"success","disable-transitions":!0},{default:r(()=>[...e[10]||(e[10]=[k("在线",-1)])]),_:1})):i.status==2?(C(),A(c,{key:1,type:"primary","disable-transitions":!0},{default:r(()=>[...e[11]||(e[11]=[k("工作中",-1)])]),_:1})):(C(),A(c,{key:2,type:"danger","disable-transitions":!0},{default:r(()=>[...e[12]||(e[12]=[k("离线",-1)])]),_:1}))]),_:1}),o(d,{prop:"create_time",label:"绑定时间",width:"180","show-overflow-tooltip":""}),o(d,{prop:"name",label:"操作",width:"100",fixed:"right"},{default:r(({row:i})=>[o(_,{"show-arrow":!1,"popper-class":"!w-[130px] !min-w-[130px] !p-[6px] !rounded-xl"},{reference:r(()=>[o(n,{link:""},{default:r(()=>[o(a,{name:"el-icon-MoreFilled"})]),_:1})]),default:r(()=>[t("div",st,[t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>Y(i)},[o(a,{name:"el-icon-User"}),e[13]||(e[13]=t("span",null,"账号详情",-1))],8,ot),t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>U(i,l(v).XHS)},[t("span",lt,[o(a,{name:"el-icon-Refresh"})]),e[14]||(e[14]=t("span",null,"更新小红书",-1))],8,nt),t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>U(i,l(v).DOUYIN)},[t("span",it,[o(a,{name:"el-icon-Refresh"})]),e[15]||(e[15]=t("span",null,"更新抖音",-1))],8,at),t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>U(i,l(v).KUAISHOU)},[t("span",ct,[o(a,{name:"el-icon-Refresh"})]),e[16]||(e[16]=t("span",null,"更新快手",-1))],8,rt),t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>K(i.device_code)},[t("span",ut,[o(a,{name:"el-icon-Refresh"})]),e[17]||(e[17]=t("span",null,"一键更新账号",-1))],8,dt),t("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:E=>ie(i)},[o(a,{name:"el-icon-Delete"}),e[18]||(e[18]=t("span",null,"删除",-1))],8,pt)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[pe,l(y).loading]])]),t("div",vt,[o(re,{modelValue:l(y),"onUpdate:modelValue":e[1]||(e[1]=i=>Ee(y)?y.value=i:null),onChange:l(p)},null,8,["modelValue","onChange"])])])]),l(O)?(C(),A(Xe,{key:0,ref_key:"addDeviceRef",ref:B,"bind-loading":l(ee),onClose:e[2]||(e[2]=i=>O.value=!1),onConfirm:l(p),"onUpdate:account":K},null,8,["bind-loading","onConfirm"])):W("",!0),l(b)?(C(),A(Ge,{key:1,"progress-value":l(X),"progress-error":l(N),"progress-error-msg":l(j),step:l(R),onClose:e[3]||(e[3]=i=>b.value=!1),onRetry:le},null,8,["progress-value","progress-error","progress-error-msg","step"])):W("",!0),o(ue,{ref_key:"editPopupRef",ref:P,"append-to-body":"","show-close":!1,"cancel-button-text":"","confirm-button-text":""},{default:r(()=>[t("div",ft,[t("div",{class:"absolute top-2 right-2 w-6 h-6",onClick:M},[o(ce,{"icon-size":12})]),e[22]||(e[22]=t("div",{class:"text-2xl font-bold"},"重命名",-1)),t("div",_t,[o(de,{modelValue:l(T).device_name,"onUpdate:modelValue":e[4]||(e[4]=i=>l(T).device_name=i),placeholder:"请输入名称",class:"!h-11",clearable:"",maxlength:"50"},null,8,["modelValue"])]),t("div",gt,[o(n,{type:"primary",round:"",class:"!h-[50px] shadow-[0px_6px_12px_0px_rgba(0,101,251,0.20)] w-[70%] !rounded-full",loading:l(se),onClick:e[5]||(e[5]=i=>l(oe)())},{default:r(()=>[...e[21]||(e[21]=[k(" 确定 ",-1)])]),_:1},8,["loading"])])])]),_:1},512)],64)}}});export{qt as default};
