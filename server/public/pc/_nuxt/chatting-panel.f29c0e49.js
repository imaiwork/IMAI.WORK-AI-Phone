import{E as M}from"./el-switch.89c5d79b.js";import{d as q,z as G,aF as W,r as Z,k as r,l as c,m as n,t as y,Z as e,q as i,L as v,s as p,I as J,G as Q,aH as X,y as Y,au as ee,ax as te,_ as oe}from"./entry.062f432e.js";import{_ as ne}from"./index.cd458299.js";import{E as se}from"./index.24c52925.js";import{E as ie,a as le}from"./index.a6d01468.js";/* empty css                   *//* empty css                  *//* empty css               *//* empty css                     */import re from"./chatting.16ebb5ba.js";import{ContentTypeEnum as l}from"./index.cf59f1a8.js";import{l as ce}from"./lodash.8dd77b40.js";import{_ as ae}from"./emoji.vue.7aab2083.js";import pe from"./useHandle.1586da0e.js";import"./index.cf337782.js";import"./index.d50bd4d3.js";import"./cloneDeep.fcebcf93.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.9217f5dd.js";import"./index.a7371e30.js";import"./strings.21d5dbba.js";import"./_baseIteratee.64c51a6a.js";import"./toNumber.c46fba7d.js";import"./clamp.ae7e1fa1.js";import"./index.27037b00.js";import"./el-empty.f71775a4.js";import"./chat-msg-item.vue.b702a25c.js";import"./el-image.95dc6784.js";import"./el-image-viewer.78bb4aee.js";import"./throttle.78a6b94c.js";import"./debounce.ea0eb2e3.js";import"./el-avatar.7274e511.js";import"./chat-content.360be580.js";import"./index.vue.5e1ffdab.js";import"./useAudio.8abbeb33.js";import"./mini-program-card.vue.b34d25cf.js";import"./person_wechat.703f63bb.js";import"./vue-virtual-scroller.esm.fd8a86fd.js";/* empty css                             */const de={class:"w-full h-full bg-white flex flex-col"},me={class:"h-[58px] flex-shrink-0 flex items-center px-4 justify-between border-b border-[#E5E5E5]"},ue={key:0,class:"flex items-center gap-x-2"},fe={class:"grow min-h-0 bg-[#F3F3F3] relative"},_e={key:0,class:"absolute w-full bottom-2"},he={class:"rounded-full bg-white px-2 py-1 cursor-pointer flex items-center gap-x-2 text-xs shadow-lighter"},ve={class:"rotate-90"},xe={class:"text-[#07C160]"},ge={key:1,class:"w-full flex justify-center"},ye={class:"h-[250px] flex-shrink-0 border-t border-[#E5E5E5] flex flex-col py-2 px-4 relative"},ke={class:"flex items-center justify-between"},Ee={class:"flex items-center gap-x-2"},we={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer leading-[0]"},Te={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer"},be={key:0},Ce={class:"grow min-h-0 mt-2"},Ie={key:1,class:"flex justify-center h-full"},Se=["src"],Ve={key:2,class:"flex justify-center h-full"},je=["src"],ze={key:3,class:"flex justify-center h-full"},Pe={class:"flex justify-end mt-1"},Be={key:0,class:"absolute top-[60px] right-2 z-[1000]"},Fe=q({__name:"chatting-panel",emits:["contentPost","top"],setup(Ue,{expose:j,emit:z}){const k=z,{newMsg:x,currentWechat:Ne,currentFriend:d,wechatAiInfo:Ae,friendInfo:m,chattingRef:u,disabledScroll:g,updateUserInfo:E,triggerHandleEvent:De}=pe(),P=G(),{isLogin:B,toggleShowLogin:F}=P,t=W({contentType:l.Text,content:"",file:{}}),U=Z("image/png,image/jpeg,video/mp4,audio/mp3,audio/mp4,.zip"),N=o=>{const{raw:s,response:{data:_}}=o,a=s.type;a.includes("image")?t.contentType=l.Picture:a.includes("video")?t.contentType=l.Video:t.contentType=l.File,t.file.uri=_.uri,t.file.name=_.name},A=async o=>{await E({open_ai:o?1:0}),o||(m.value.takeover_mode=0,w(0))},w=o=>{E({takeover_mode:o})},D=o=>{t.contentType=l.Text},R=o=>{if(!(o.shiftKey&&o.keyCode===13)){if(!B){F();return}if(o.keyCode===13)return T(),o.preventDefault()}},T=()=>{if(t.contentType==l.Text&&t.content.replace(/(^\s*)|(\s*$)/g,"")==""){Q.msgError("输入为空！");return}k("contentPost",ce.cloneDeep(t)),X(()=>{g.value=!1,f()})},$=(o,s=!1)=>{s?t.content+=o:t.content=o,t.contentType=l.Text,t.file={}},b=()=>{t.content="",t.contentType=l.Text,t.file={}},f=()=>{var o;g.value=!1,x.value=0,(o=u.value)==null||o.scrollToBottom()};return j({cleanInput:b,setInputContent:$,scrollToBottom:f,scrollToItem:o=>{var s;(s=u.value)==null||s.scrollToItem(o)},initScroll:()=>{var o;(o=u.value)==null||o.initScroll()}}),(o,s)=>{var S,V;const _=M,a=Y,H=ne,L=se,C=ie,O=le,K=ee,I=te;return r(),c("div",de,[n("div",me,[n("div",null,y((S=e(d))==null?void 0:S.ShowName),1),e(d).UserName&&!e(d).isRoom?(r(),c("div",ue,[s[3]||(s[3]=n("span",null,"AI功能",-1)),i(_,{"model-value":e(m).open_ai==1,onChange:A},null,8,["model-value"])])):v("",!0)]),n("div",fe,[i(re,{ref_key:"chattingRef",ref:u,onTop:s[0]||(s[0]=h=>k("top"))},null,512),e(g)?(r(),c("div",_e,[e(x)>0?(r(),c("div",{key:0,class:"flex justify-end mr-2",onClick:f},[n("div",he,[n("div",ve,[i(a,{name:"el-icon-DArrowRight",color:"#07C160",size:12})]),n("span",xe,y(e(x))+" 条新消息",1)])])):(r(),c("div",ge,[n("div",{class:"shadow-lighter bg-white rounded-full px-2 py-1 text-xs cursor-pointer",onClick:f}," 回到底部 ")]))])):v("",!0)]),n("div",ye,[n("div",ke,[n("div",Ee,[i(H,{type:"file",accept:e(U),"show-file-list":!1,"max-size":10,"show-progress":"",onChange:N},{default:p(()=>[n("div",we,[i(a,{name:"local-icon-file",size:24})])]),_:1},8,["accept"]),i(L,{placement:"top",width:"466",trigger:"click","show-arrow":!1,"popper-style":{padding:0}},{reference:p(()=>[n("div",Te,[i(a,{name:"local-icon-phiz",size:24})])]),default:p(()=>[n("div",null,[i(ae)])]),_:1})]),(V=e(d))!=null&&V.UserName&&!e(d).isRoom?(r(),c("div",be,[i(O,{modelValue:e(m).takeover_mode,"onUpdate:modelValue":s[1]||(s[1]=h=>e(m).takeover_mode=h),class:"!w-[120px]",disabled:!e(m).open_ai,onChange:w},{default:p(()=>[i(C,{value:1,label:"AI接管"}),i(C,{value:0,label:"人工介入"})]),_:1},8,["modelValue","disabled"])])):v("",!0)]),n("div",Ce,[e(t).contentType==e(l).Text?(r(),J(K,{key:0,modelValue:e(t).content,"onUpdate:modelValue":s[2]||(s[2]=h=>e(t).content=h),type:"textarea",resize:"none",rows:6,onInput:D,onKeydown:R},null,8,["modelValue"])):e(t).contentType==e(l).Picture?(r(),c("div",Ie,[n("img",{src:e(t).file.uri,class:"h-full"},null,8,Se)])):e(t).contentType==e(l).Video?(r(),c("div",Ve,[n("video",{src:e(t).file.uri,controls:"",class:"h-full"},null,8,je)])):(r(),c("div",ze,[n("div",null,y(e(t).file.name),1)]))]),n("div",Pe,[i(I,{color:"#E9E9E9",onClick:T},{default:p(()=>[...s[4]||(s[4]=[n("span",{class:"text-[#07C160] font-bold"},"发送（Enter）",-1)])]),_:1})]),e(t).contentType!=e(l).Text?(r(),c("div",Be,[i(I,{type:"danger",onClick:b},{default:p(()=>[i(a,{name:"el-icon-Delete"})]),_:1})])):v("",!0)])])}}});const St=oe(Fe,[["__scopeId","data-v-34f90cae"]]);export{St as default};
