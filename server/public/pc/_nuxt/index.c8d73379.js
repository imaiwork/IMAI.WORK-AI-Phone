import{N as Y,O as ue,P as de,Q as A,S as v,T as E,U as W,d as D,V as ke,W as N,X as K,r as ce,c as G,k as y,I as L,s as P,l as T,J as Ee,K as $e,Y as m,Z as t,$ as pe,H as R,L as g,m as q,a0 as B,q as F,a1 as O,a2 as Ce,t as Z,a3 as Re,a4 as Pe,a5 as we,a6 as Fe,a7 as Te,a8 as Se,a9 as Ue,aa as H,ab as Le,A as J,ac as x,ad as De,ae as _e,af as Oe,ag as Be,D as ee,ah as je,ai as qe,b as Ne,aj as Ae,ak as Ke,al as te,am as se,an as He}from"./entry.9c858de7.js";import{E as Me}from"./index.3f0b5ea1.js";import{c as ae}from"./cloneDeep.051307f4.js";const fe=Symbol("uploadContextKey"),ze="ElUpload";class Ie extends Error{constructor(r,s,d,i){super(r),this.name="UploadAjaxError",this.status=s,this.method=d,this.url=i}}function oe(o,r,s){let d;return s.response?d=`${s.response.error||s.response}`:s.responseText?d=`${s.responseText}`:d=`fail to ${r.method} ${o} ${s.status}`,new Ie(d,s.status,r.method,o)}function Ve(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Xe=o=>{typeof XMLHttpRequest>"u"&&Y(ze,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=o.action;r.upload&&r.upload.addEventListener("progress",u=>{const p=u;p.percent=u.total>0?u.loaded/u.total*100:0,o.onProgress(p)});const d=new FormData;if(o.data)for(const[u,p]of Object.entries(o.data))ue(p)&&p.length?d.append(u,...p):d.append(u,p);d.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(s,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(s,o,r));o.onSuccess(Ve(r))}),r.open(o.method,s,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const i=o.headers||{};if(i instanceof Headers)i.forEach((u,p)=>r.setRequestHeader(p,u));else for(const[u,p]of Object.entries(i))de(p)||r.setRequestHeader(u,String(p));return r.send(d),r},ve=["text","picture","picture-card"];let We=1;const Q=()=>Date.now()+We++,me=A({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:v([Object,Function,Promise]),default:()=>W({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:v(Array),default:()=>W([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:v(Function),default:Xe},disabled:{type:Boolean,default:void 0},limit:Number}),Ge=A({...me,beforeUpload:{type:v(Function),default:E},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:E},onChange:{type:v(Function),default:E},onPreview:{type:v(Function),default:E},onSuccess:{type:v(Function),default:E},onProgress:{type:v(Function),default:E},onError:{type:v(Function),default:E},onExceed:{type:v(Function),default:E},crossorigin:{type:v(String)}}),Je=A({files:{type:v(Array),default:()=>W([])},disabled:{type:Boolean,default:void 0},handlePreview:{type:v(Function),default:E},listType:{type:String,values:ve,default:"text"},crossorigin:{type:v(String)}}),Qe={remove:o=>!!o},Ye=D({name:"ElUploadList"}),Ze=D({...Ye,props:Je,emits:Qe,setup(o,{emit:r}){const s=o,{t:d}=ke(),i=N("upload"),u=N("icon"),p=N("list"),b=K(),k=ce(!1),h=G(()=>[i.b("list"),i.bm("list",s.listType),i.is("disabled",b.value)]),$=c=>{r("remove",c)};return(c,S)=>(y(),L(Ue,{tag:"ul",class:m(t(h)),name:t(p).b()},{default:P(()=>[(y(!0),T(Ee,null,$e(c.files,(f,n)=>(y(),T("li",{key:f.uid||f.name,class:m([t(i).be("list","item"),t(i).is(f.status),{focusing:k.value}]),tabindex:t(b)?void 0:0,"aria-disabled":t(b),role:"button",onKeydown:pe(e=>!t(b)&&$(f),["delete"]),onFocus:e=>k.value=!0,onBlur:e=>k.value=!1,onClick:e=>k.value=!1},[R(c.$slots,"default",{file:f,index:n},()=>[c.listType==="picture"||f.status!=="uploading"&&c.listType==="picture-card"?(y(),T("img",{key:0,class:m(t(i).be("list","item-thumbnail")),src:f.url,crossorigin:c.crossorigin,alt:""},null,10,["src","crossorigin"])):g("v-if",!0),f.status==="uploading"||c.listType!=="picture-card"?(y(),T("div",{key:1,class:m(t(i).be("list","item-info"))},[q("a",{class:m(t(i).be("list","item-name")),onClick:B(e=>c.handlePreview(f),["prevent"])},[F(t(O),{class:m(t(u).m("document"))},{default:P(()=>[F(t(Ce))]),_:1},8,["class"]),q("span",{class:m(t(i).be("list","item-file-name")),title:f.name},Z(f.name),11,["title"])],10,["onClick"]),f.status==="uploading"?(y(),L(t(Me),{key:0,type:c.listType==="picture-card"?"circle":"line","stroke-width":c.listType==="picture-card"?6:2,percentage:Number(f.percentage),style:Re(c.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)):g("v-if",!0),q("label",{class:m(t(i).be("list","item-status-label"))},[c.listType==="text"?(y(),L(t(O),{key:0,class:m([t(u).m("upload-success"),t(u).m("circle-check")])},{default:P(()=>[F(t(Pe))]),_:1},8,["class"])):["picture-card","picture"].includes(c.listType)?(y(),L(t(O),{key:1,class:m([t(u).m("upload-success"),t(u).m("check")])},{default:P(()=>[F(t(we))]),_:1},8,["class"])):g("v-if",!0)],2),t(b)?g("v-if",!0):(y(),L(t(O),{key:2,class:m(t(u).m("close")),onClick:e=>$(f)},{default:P(()=>[F(t(Fe))]),_:2},1032,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),t(b)?g("v-if",!0):(y(),T("i",{key:3,class:m(t(u).m("close-tip"))},Z(t(d)("el.upload.deleteTip")),3)),c.listType==="picture-card"?(y(),T("span",{key:4,class:m(t(i).be("list","item-actions"))},[q("span",{class:m(t(i).be("list","item-preview")),onClick:e=>c.handlePreview(f)},[F(t(O),{class:m(t(u).m("zoom-in"))},{default:P(()=>[F(t(Te))]),_:1},8,["class"])],10,["onClick"]),t(b)?g("v-if",!0):(y(),T("span",{key:0,class:m(t(i).be("list","item-delete")),onClick:e=>$(f)},[F(t(O),{class:m(t(u).m("delete"))},{default:P(()=>[F(t(Se))]),_:1},8,["class"])],10,["onClick"]))],2)):g("v-if",!0)])],42,["tabindex","aria-disabled","onKeydown","onFocus","onBlur","onClick"]))),128)),R(c.$slots,"append")]),_:3},8,["class","name"]))}});var ne=H(Ze,[["__file","upload-list.vue"]]);const xe=A({disabled:{type:Boolean,default:void 0}}),et={file:o=>ue(o)},ye="ElUploadDrag",tt=D({name:ye}),st=D({...tt,props:xe,emits:et,setup(o,{emit:r}){Le(fe)||Y(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=N("upload"),i=ce(!1),u=K(),p=h=>{if(u.value)return;i.value=!1,h.stopPropagation();const $=Array.from(h.dataTransfer.files),c=h.dataTransfer.items||[];$.forEach((S,f)=>{var n;const e=c[f],a=(n=e==null?void 0:e.webkitGetAsEntry)==null?void 0:n.call(e);a&&(S.isDirectory=a.isDirectory)}),r("file",$)},b=()=>{u.value||(i.value=!0)},k=h=>{h.currentTarget.contains(h.relatedTarget)||(i.value=!1)};return(h,$)=>(y(),T("div",{class:m([t(d).b("dragger"),t(d).is("dragover",i.value)]),onDrop:B(p,["prevent"]),onDragover:B(b,["prevent"]),onDragleave:B(k,["prevent"])},[R(h.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var at=H(st,[["__file","upload-dragger.vue"]]);const ot=A({...me,beforeUpload:{type:v(Function),default:E},onRemove:{type:v(Function),default:E},onStart:{type:v(Function),default:E},onSuccess:{type:v(Function),default:E},onProgress:{type:v(Function),default:E},onError:{type:v(Function),default:E},onExceed:{type:v(Function),default:E}}),nt=D({name:"ElUploadContent",inheritAttrs:!1}),lt=D({...nt,props:ot,setup(o,{expose:r}){const s=o,d=N("upload"),i=K(),u=J({}),p=J(),b=e=>{if(e.length===0)return;const{autoUpload:a,limit:l,fileList:C,multiple:w,onStart:U,onExceed:M}=s;if(l&&C.length+e.length>l){M(e,C);return}w||(e=e.slice(0,1));for(const z of e){const j=z;j.uid=Q(),U(j),a&&k(j)}},k=async e=>{if(p.value.value="",!s.beforeUpload)return $(e);let a,l={};try{const w=s.data,U=s.beforeUpload(e);l=x(s.data)?ae(s.data):s.data,a=await U,x(s.data)&&De(w,l)&&(l=ae(s.data))}catch{a=!1}if(a===!1){s.onRemove(e);return}let C=e;a instanceof Blob&&(a instanceof File?C=a:C=new File([a],e.name,{type:e.type})),$(Object.assign(C,{uid:e.uid}),l)},h=async(e,a)=>Oe(e)?e(a):e,$=async(e,a)=>{const{headers:l,data:C,method:w,withCredentials:U,name:M,action:z,onProgress:j,onSuccess:ge,onError:be,httpRequest:he}=s;try{a=await h(a??C,e)}catch{s.onRemove(e);return}const{uid:I}=e,V={headers:l||{},withCredentials:U,file:e,data:a,method:w,filename:M,action:z,onProgress:_=>{j(_,e)},onSuccess:_=>{ge(_,e),delete u.value[I]},onError:_=>{be(_,e),delete u.value[I]}},X=he(V);u.value[I]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},c=e=>{const a=e.target.files;a&&b(Array.from(a))},S=()=>{i.value||(p.value.value="",p.value.click())},f=()=>{S()};return r({abort:e=>{_e(u.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,C])=>{C instanceof XMLHttpRequest&&C.abort(),delete u.value[l]})},upload:k}),(e,a)=>(y(),T("div",{class:m([t(d).b(),t(d).m(e.listType),t(d).is("drag",e.drag),t(d).is("disabled",t(i))]),tabindex:t(i)?void 0:0,"aria-disabled":t(i),role:"button",onClick:S,onKeydown:pe(B(f,["self"]),["enter","space"])},[e.drag?(y(),L(at,{key:0,disabled:t(i),onFile:b},{default:P(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:p,class:m(t(d).e("input")),name:e.name,disabled:t(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:c,onClick:B(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","aria-disabled","onKeydown"]))}});var le=H(lt,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},rt=(o,r)=>{const s=Be(o,"fileList",void 0,{passive:!0}),d=n=>s.value.find(e=>e.uid===n.uid);function i(n){var e;(e=r.value)==null||e.abort(n)}function u(n=["ready","uploading","success","fail"]){s.value=s.value.filter(e=>!n.includes(e.status))}function p(n){s.value=s.value.filter(e=>e.uid!==n.uid)}const b=n=>{qe(()=>o.onChange(n,s.value))},k=(n,e)=>{const a=d(e);a&&(console.error(n),a.status="fail",p(a),o.onError(n,a,s.value),b(a))},h=(n,e)=>{const a=d(e);a&&(o.onProgress(n,a,s.value),a.status="uploading",a.percentage=Math.round(n.percent))},$=(n,e)=>{const a=d(e);a&&(a.status="success",a.response=n,o.onSuccess(n,a,s.value),b(a))},c=n=>{de(n.uid)&&(n.uid=Q());const e={name:n.name,percentage:0,status:"ready",size:n.size,raw:n,uid:n.uid};if(o.listType==="picture-card"||o.listType==="picture")try{e.url=URL.createObjectURL(n)}catch(a){je(re,a.message),o.onError(a,e,s.value)}s.value=[...s.value,e],b(e)},S=async n=>{const e=n instanceof File?d(n):n;e||Y(re,"file to be removed not found");const a=l=>{i(l),p(l),o.onRemove(l,s.value),ie(l)};o.beforeRemove?await o.beforeRemove(e,s.value)!==!1&&a(e):a(e)};function f(){s.value.filter(({status:n})=>n==="ready").forEach(({raw:n})=>{var e;return n&&((e=r.value)==null?void 0:e.upload(n))})}return ee(()=>o.listType,n=>{n!=="picture-card"&&n!=="picture"||(s.value=s.value.map(e=>{const{raw:a,url:l}=e;if(!l&&a)try{e.url=URL.createObjectURL(a)}catch(C){o.onError(C,e,s.value)}return e}))}),ee(s,n=>{for(const e of n)e.uid||(e.uid=Q()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:i,clearFiles:u,handleError:k,handleProgress:h,handleStart:c,handleSuccess:$,handleRemove:S,submit:f,revokeFileObjectURL:ie}},it=D({name:"ElUpload"}),ut=D({...it,props:Ge,setup(o,{expose:r}){const s=o,d=K(),i=J(),{abort:u,submit:p,clearFiles:b,uploadFiles:k,handleStart:h,handleError:$,handleRemove:c,handleSuccess:S,handleProgress:f,revokeFileObjectURL:n}=rt(s,i),e=G(()=>s.listType==="picture-card"),a=G(()=>({...s,fileList:k.value,onStart:h,onProgress:f,onSuccess:S,onError:$,onRemove:c}));return Ne(()=>{k.value.forEach(n)}),Ae(fe,{accept:Ke(s,"accept")}),r({abort:u,submit:p,clearFiles:b,handleStart:h,handleRemove:c}),(l,C)=>(y(),T("div",null,[t(e)&&l.showFileList?(y(),L(ne,{key:0,disabled:t(d),"list-type":l.listType,files:t(k),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(c)},te({append:P(()=>[F(le,se({ref_key:"uploadRef",ref:i},t(a)),{default:P(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:P(({file:w,index:U})=>[R(l.$slots,"file",{file:w,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0),!t(e)||t(e)&&!l.showFileList?(y(),L(le,se({key:1,ref_key:"uploadRef",ref:i},t(a)),{default:P(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0),l.$slots.trigger?R(l.$slots,"default",{key:2}):g("v-if",!0),R(l.$slots,"tip"),!t(e)&&l.showFileList?(y(),L(ne,{key:3,disabled:t(d),"list-type":l.listType,files:t(k),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(c)},te({_:2},[l.$slots.file?{name:"default",fn:P(({file:w,index:U})=>[R(l.$slots,"file",{file:w,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0)]))}});var dt=H(ut,[["__file","upload.vue"]]);const vt=He(dt);export{vt as E,Q as g};
