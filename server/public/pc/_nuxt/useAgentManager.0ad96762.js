import{bP as w,a as k,r as p,aG as q,o as L,cA as P,cB as x,G as E,z as I,u as O}from"./entry.556496e9.js";import{u as D}from"./usePaging.cb2ddca4.js";import{a as S,z as F,A as M,k as R}from"./agent.4a5bb123.js";import{AgentTypeEnum as o,CozeTypeEnum as C}from"./index.11e2700c.js";function $(){const r=w(),T=k(),G=O(),c=r.query.agent_id,d=r.query.coze_id,s=Number(r.query.type),f=p({}),u=p(!0),n=p(null),N=async()=>{const a={[o.AGENT]:M,[o.COZE_AGENT]:R,[o.COZE_FLOW]:R};a[s]&&(f.value=await a[s]({id:c}))},_=q({page_no:1,page_size:20}),{pager:i,getLists:y,resetPage:A}=D({fetchFun:async a=>{let e;return s===o.AGENT?(e=await P({...a,robot_id:c,chat_type:9006}),e.lists=e.lists.map(t=>({id:t.task_id,title:t.message,...t}))):(e=await S({...a,bot_id:d,type:s===o.COZE_AGENT?C.AGENT:C.FLOW}),e.lists=e.lists.map(t=>({id:t.conversation_id,title:t.content||t.message,...t}))),e},params:_,isScroll:!0}),z=()=>{i.isLoad&&!i.loading&&(_.page_no++,y())},v=a=>{const e=s==o.AGENT?"task_id":"conversation_id";!a[e]||n.value==a[e]||(n.value=a[e])},h=()=>{n.value&&(n.value=null)},b=a=>{const{id:e,conversation_id:t}=a||{},g=s===o.AGENT?e:t;G.$confirm({message:e?"确定要删除该对话吗？":"确定要清除所有对话吗？",onConfirm:async()=>{try{s===o.AGENT?await x({robot_id:c,task_id:e,chat_type:9006}):await F({bot_id:d,conversation_id:t||"0"}),E.msgSuccess("删除成功");const l=i.lists.findIndex(m=>s===o.AGENT?m.id==e:m.conversation_id==t);l!==-1&&i.lists.splice(l,1),(!g||g==n.value)&&(h(),g||A())}catch(l){E.msgError(l||"删除失败")}}})};return L(async()=>{if(!I().isLogin){T.replace("/agent");return}u.value=!0;try{await N(),await y(),n.value=r.query.conversation_id||r.query.task_id||null,!n.value&&i.lists.length>0&&v(i.lists[0])}finally{u.value=!1}}),{agentId:c,cozeId:d,agentType:s,detail:f,loading:u,chatRecordPager:i,currentRecordId:n,loadRecordMore:z,resetChatRecordPager:A,handleSelectRecord:v,handleCreateRecord:h,handleDeleteRecord:b}}export{$ as useAgentManager};
