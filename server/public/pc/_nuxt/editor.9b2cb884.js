import{d as G,bP as L,a as R,z as U,aH as $,dv as H,aG as O,A as g,cy as Y,G as b,ds as Z,ai as h,o as J,k as f,l as _,m as o,q as s,s as n,v as y,Z as l,aw as M,Y as K,L as Q,ay as W,av as X,az as ee,_ as te}from"./entry.45b56a4a.js";import{_ as le}from"./index.ed54afdc.js";import{m as oe,a as se}from"./mind_map.667e7a11.js";import{u as ae}from"./useMindMap.c2b34ad4.js";import{m as ne}from"./common.1373bb04.js";import{ScenePromptEnum as E}from"./chatEnum.1c450e0f.js";import{E as re}from"./index.515d6243.js";import"./index.3864ff87.js";import"./index.937f4495.js";import"./katex.824cf536.js";const ie={class:"flex h-full w-full flex-col items-center"},de={class:"relative flex w-full grow overflow-hidden"},pe={class:"absolute right-2 top-2 z-[888]"},ue={class:"w-[350px] flex-shrink-0 justify-center min-h-0 bg-white pt-4"},me={class:"h-full grow"},ce={class:"flex h-full flex-col px-5 pt-2 gap-y-4"},fe={class:"flex items-center justify-between gap-x-2"},_e={class:"grow w-3/5 p-4 justify-center lg:border-l border-token-border-medium overflow-hidden relative"},ye={class:"flex-grow pb-5 h-full"},ve={class:"grow overflow-hidden relative"},we={key:0,class:"absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center bg-white z-[88888]"},xe=G({__name:"editor",setup(ke){var x;const d=L(),C=R(),p=U(),{userTokens:I}=$(p),V=(x=p.getTokenByScene(H.MIND_MAP))==null?void 0:x.score,t=O({id:"",reply:"",ask:"",prompt_id:E.AI_MIND_MAP}),v=g(null),w=g(null),{markmap:i,toolbarContainer:z,isFullscreen:N,mindMapInit:P,mindMapFit:S,mindMapExportAsPNG:A}=ae(),F=async()=>{t.reply=ne,i.value&&i.value.destroy(),await h(),m()},j=()=>{A(v.value)},{lockFn:B,isLock:u}=Y(async()=>{if(I.value<=V.value){b.msgPowerInsufficient();return}i.value&&i.value.destroy();try{const a=t.id?await oe({id:t.id,message:t.ask}):await Z({message:t.ask,prompt_id:E.AI_MIND_MAP});t.reply=a.reply,t.id=a.id,C.replace({path:d.path,query:{id:a.id}}),p.getUser(),m()}catch(a){b.msgError(a||"发生错误")}}),D=async()=>{const a=await se({id:d.query.id});Object.keys(t).forEach(e=>{t[e]=a[e]}),m()},m=async()=>{P(w.value),await h(),S(t.reply.replace(/```markdown/g,"").replace(/```/g,""))};return J(()=>{d.query.id&&D()}),(a,e)=>{const c=W,k=X,T=ee,q=le;return f(),_("div",ie,[o("div",de,[o("div",pe,[s(c,{type:"primary",round:"",class:"flex w-full items-center justify-center gap-1.5",disabled:l(u)||!l(t).reply,onClick:e[0]||(e[0]=r=>j())},{default:n(()=>[...e[5]||(e[5]=[y(" 导出思维导图 ",-1)])]),_:1},8,["disabled"])]),o("div",ue,[o("div",me,[s(l(re),null,{default:n(()=>[o("div",ce,[s(T,{model:l(t),"label-position":"top"},{default:n(()=>[s(l(M),{label:"输入内容即可生成思维导图"},{default:n(()=>[s(k,{modelValue:l(t).ask,"onUpdate:modelValue":e[1]||(e[1]=r=>l(t).ask=r),type:"textarea",rows:15,resize:"none",placeholder:""},null,8,["modelValue"]),s(c,{class:"w-full !h-10 mt-4",round:"",type:"primary",disabled:!l(t).ask,loading:l(u),onClick:e[2]||(e[2]=r=>l(B)())},{default:n(()=>[...e[6]||(e[6]=[y("立即生成 ",-1)])]),_:1},8,["disabled","loading"])]),_:1}),s(l(M),null,{label:n(()=>[o("div",fe,[e[8]||(e[8]=o("span",null,"内容大纲",-1)),s(c,{type:"primary",link:"",onClick:e[3]||(e[3]=r=>F())},{default:n(()=>[...e[7]||(e[7]=[y("试试示例",-1)])]),_:1})])]),default:n(()=>[s(k,{modelValue:l(t).reply,"onUpdate:modelValue":e[4]||(e[4]=r=>l(t).reply=r),type:"textarea",disabled:"",rows:25,resize:"none",placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1})])]),o("div",_e,[o("div",ye,[o("div",{class:K(["h-full flex flex-col gap-y-2",{"fixed top-0 left-0 w-full z-[8888] bg-white":l(N)}])},[o("div",ve,[o("div",{ref_key:"toolbarContainer",ref:z},null,512),o("div",{ref_key:"mindMapContainer",ref:v,class:"w-full h-full"},[(f(),_("svg",{ref_key:"mindMapSvg",ref:w,class:"w-full h-full"},null,512))],512)])],2)]),l(u)?(f(),_("div",we,[s(q),e[9]||(e[9]=o("div",{class:"text-sm text-gray-500 mt-10"},"正在生成思维导图...",-1))])):Q("",!0)])])])}}});const Pe=te(xe,[["__scopeId","data-v-84cc7960"]]);export{Pe as default};
