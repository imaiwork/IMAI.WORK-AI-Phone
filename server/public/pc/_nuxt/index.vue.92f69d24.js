import{d as Z,bP as H,aG as Q,r as x,o as W,k as o,l as u,Z as l,m as n,q as a,s,$ as X,v as r,aI as ee,I as _,t as p,Y as te,L as c,bC as U,bM as ae,J as se,bO as Y,ai as le,G as B,ay as oe,av as ne,y as ie,ba as re,aw as de,cY as ue,u as ce}from"./entry.556496e9.js";import{E as me}from"./index.4bb9b943.js";import{E as pe,a as fe}from"./index.e8affe9d.js";import{E as _e,a as ve}from"./index.899f58ef.js";import{a as ye,_ as he}from"./detail.vue.0ef2c902.js";import{_ as be}from"./index.vue.ba665940.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 */import{u as ge}from"./usePaging.cb2ddca4.js";import{d as ke,a as D,e as xe}from"./sph.d6d2831a.js";import{SidebarTypeEnum as $}from"./index.22c5df69.js";import Ee from"./create-panel.c6f9d49e.js";import{_ as Ce}from"./edit.vue.ef71445d.js";const we={key:0,class:"h-full flex flex-col bg-app-bg-2 rounded-[20px]"},Te={class:"flex-shrink-0 px-[14px]"},$e={class:"flex items-center justify-end h-[88px]"},Se={class:"flex items-center gap-[14px]"},Ve={class:"grow min-h-0 overflow-hidden flex flex-col"},Ue={class:"grow min-h-0"},Ye=["onClick"],Be={class:"text-white"},De={class:"flex items-center justify-center gap-2"},Ie={key:1},Me={key:2},Oe={key:3},Re={key:4},je={key:5},Pe={class:"flex justify-end items-center"},ze={class:"leading-6"},Ae={class:"flex justify-center p-4"},ot=Z({__name:"index",setup(Fe){const{query:k}=H(),I=ce(),E=Q({name:"",page_size:20,status:""}),{pager:v,getLists:d,resetPage:M}=ge({fetchFun:ke,params:E}),C=x(!1),w=x(),y=x(k.is_create=="1"&&parseInt(k.type)==$.AUTO_GET_CUSTOMER),S=()=>{y.value=!0,Y({is_create:1})},O=async f=>{C.value=!0,await le(),w.value.open(),w.value.setFormData(f)},h=x(k.is_detail=="1"&&parseInt(k.type)==$.AUTO_GET_CUSTOMER),R=f=>{h.value=!0,Y({is_detail:1,id:f.id})},j=async f=>{I.$confirm({message:"是否删除该任务？",theme:"dark",onConfirm:async()=>{try{await xe({id:f}),B.msgSuccess("删除成功"),d()}catch(t){B.msgError(t||"删除失败")}}})},V=()=>{y.value=!1,h.value=!1,window.history.replaceState("","",`?type=${$.AUTO_GET_CUSTOMER}`),d()};return W(()=>{!y.value&&!h.value&&d()}),(f,t)=>{const m=oe,P=ne,T=ie,z=re,A=me,i=pe,b=_e,F=ve,G=de,N=ye,L=fe,q=be,K=ue;return o(),u(se,null,[!l(y)&&!l(h)?(o(),u("div",we,[n("div",Te,[a(A,null,{default:s(()=>[n("div",$e,[n("div",Se,[a(P,{modelValue:l(E).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(E).name=e),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入任务名称",clearable:"",onClear:t[2]||(t[2]=e=>l(d)()),onKeydown:t[3]||(t[3]=X(e=>l(d)(),["enter"]))},{append:s(()=>[a(m,{text:"",onClick:t[0]||(t[0]=e=>l(d)())},{default:s(()=>[...t[8]||(t[8]=[r(" 搜索 ",-1)])]),_:1})]),_:1},8,["modelValue"]),a(m,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:s(()=>[a(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[9]||(t[9]=n("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1}),n("div",null,[a(z,{content:"刷新"},{default:s(()=>[a(m,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:t[4]||(t[4]=e=>l(M)())})]),_:1})])])])]),_:1})]),n("div",Ve,[n("div",Ue,[ee((o(),_(L,{height:"100%",data:l(v).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:s(()=>[n("div",ze,[a(m,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:s(()=>[a(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[13]||(t[13]=n("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1})])]),default:s(()=>[a(i,{prop:"name",label:"任务名称",width:"240",fixed:"left"},{default:s(({row:e})=>[n("div",{class:"flex items-center justify-center gap-2 cursor-pointer",onClick:g=>O(e)},[n("div",Be,p(e.name),1),a(T,{name:"local-icon-edit",color:"#ffffff"})],8,Ye)]),_:1}),a(i,{label:"任务类型",width:"120"},{default:s(({row:e})=>[r(p(e.auto_type==0?"手动":"24h任务"),1)]),_:1}),a(i,{label:"线索词","min-width":"200","show-overflow-tooltip":""},{default:s(({row:e})=>[r(p(e.keywords.join("；")),1)]),_:1}),a(i,{prop:"crawl_number",label:"已获线索数",width:"120"}),a(i,{label:"任务状态",width:"120"},{default:s(({row:e})=>[n("div",De,[e.status!=0?(o(),u("div",{key:0,class:te(["w-[6px] h-[6px] rounded-full",{"bg-primary":e.status==1,"bg-info":e.status==2,"bg-success":e.status==3,"bg-warning":e.status==4}])},null,2)):c("",!0),e.status==0?(o(),u("div",Ie,"未执行")):e.status==1?(o(),u("div",Me,"进行中")):e.status==2?(o(),u("div",Oe,"已暂停")):e.status==3?(o(),u("div",Re,"已完成")):e.status==4?(o(),u("div",je,"已结束")):c("",!0)])]),_:1}),a(i,{label:"开始时间",width:"120"},{default:s(({row:e})=>[r(p(l(U)(e.start_time).format("YYYY-MM-DD")),1)]),_:1}),a(i,{label:"结束时间",width:"120"},{default:s(({row:e})=>[r(p(l(U)(e.end_time).format("YYYY-MM-DD")),1)]),_:1}),a(i,{label:"当前执行进度","min-width":"120"},{default:s(({row:e})=>[r(p(e.number_of_implemented_keywords||0)+" / "+p(e.implementation_keywords_number||0),1)]),_:1}),a(i,{prop:"create_time",label:"创建时间",width:"180"}),a(i,{label:"操作",width:"180",fixed:"right",align:"right"},{default:s(({row:e})=>[n("div",Pe,[e.status!=0?(o(),_(N,{key:0,class:"mx-3",params:{task_id:e.id},"fetch-fun":l(D),"export-fun":l(D)},{trigger:s(()=>[a(m,{class:"!border-app-border-2",color:"#181818",size:"small"},{default:s(()=>[...t[10]||(t[10]=[r("导出",-1)])]),_:1})]),"form-item":s(({formData:g})=>[a(G,{label:"线索有效性："},{default:s(()=>[a(F,{modelValue:g.status,"onUpdate:modelValue":J=>g.status=J,class:"!w-[260px] !h-10",placeholder:"请选择",filterable:"",clearable:"","empty-values":[void 0,null],"show-arrow":!1},{default:s(()=>[a(b,{label:"全部",value:""}),a(b,{label:"未校验",value:"0"}),a(b,{label:"已通过校验",value:"1"}),a(b,{label:"未通过校验",value:"2"}),a(b,{label:"待执行",value:"4"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["params","fetch-fun","export-fun"])):c("",!0),a(m,{class:"!border-app-border-2",color:"#181818",size:"small",onClick:g=>R(e)},{default:s(()=>[...t[11]||(t[11]=[r("详情",-1)])]),_:1},8,["onClick"]),e.auto_type==0?(o(),_(m,{key:1,type:"danger",link:"",size:"small",onClick:g=>j(e.id)},{default:s(()=>[...t[12]||(t[12]=[r(" 删除",-1)])]),_:1},8,["onClick"])):c("",!0)])]),_:1})]),_:1},8,["data"])),[[K,l(v).loading]])]),n("div",Ae,[a(q,{modelValue:l(v),"onUpdate:modelValue":t[5]||(t[5]=e=>ae(v)?v.value=e:null),layout:"prev, pager, next",onChange:l(d)},null,8,["modelValue","onChange"])])]),l(C)?(o(),_(Ce,{key:0,ref_key:"editPopupRef",ref:w,onClose:t[6]||(t[6]=e=>C.value=!1),onSuccess:t[7]||(t[7]=e=>l(d)())},null,512)):c("",!0)])):c("",!0),l(y)?(o(),_(Ee,{key:1,onBack:V})):c("",!0),l(h)?(o(),_(he,{key:2,ref:"detailRef",onBack:V},null,512)):c("",!0)],64)}}});export{ot as _};
