import{g as ae,E as se}from"./index.b44dd729.js";import{E as oe}from"./index.b617bec7.js";import{d as ie,z as re,A as ne,r as L,B as P,C as H,c as O,D as le,E as de,F as ue,R as j,G as i,_ as ce,k as y,l as I,q as W,s as _,H as me,I as fe,m as A,J as pe,K as ge,t as ve,L as he,M as ye}from"./entry.8705b591.js";/* empty css                  *//* empty css                    *//* empty css                  */const be=ie({components:{},props:{action:{type:String,default:""},type:{type:String,default:"image"},drag:{type:Boolean,default:!1},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},listType:{type:String,default:"picture"},showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},maxSize:{type:Number,default:1/0},minSize:{type:Number,default:0},ratioSize:{type:Array,default:()=>[0,0]},imageResolution:{type:Array,default:()=>[4096,4096]},videoMaxWidth:{type:Number,default:1/0},videoMinWidth:{type:Number,default:0},videoMaxHeight:{type:Number,default:1/0},videoMinHeight:{type:Number,default:0},minDuration:{type:Number,default:0},maxDuration:{type:Number,default:1/0}},emits:["change","error","remove","success","on-progress"],setup(e,{emit:r,expose:V}){const M=re(),c=ne(),b=L(e.action||`${P()}${H()}/upload/${e.type}`),E=O(()=>({token:M.token,version:de()})),f=L(!1),l=L([]),m=async t=>{const{type:s,ratioSize:o,imageResolution:g,videoMaxWidth:p,videoMinWidth:w,videoMaxHeight:B,videoMinHeight:U,minDuration:v,maxDuration:h,minSize:N,maxSize:k}=e,z=t.size/1024/1024,Y=()=>z<N?(i.msgError(`上传文件大小不能小于 ${N} MB`),!1):z>k?(i.msgError(`上传文件大小不能大于 ${k} MB`),!1):!0,Z=async()=>new Promise(u=>{const a=new Image;a.onload=()=>{const n=a.height<=g[0]&&a.width<=g[1],d=x(a.width,a.height);n?d||i.msgError(`上传图片尺寸不能大于 ${o[0]}*${o[1]}`):i.msgError(`上传图片分辨率不能大于 ${g[0]}*${g[1]}`),u(n&&d)},a.src=URL.createObjectURL(t)}),x=(u,a)=>{if(o[0]<=0||o[1]<=0)return!0;if(typeof u!="number"||typeof a!="number"||u<=0||a<=0)return!1;const n=u/a,d=o[0],S=o[1];return n>=d&&n<=S},ee=async()=>v<=0||h<=0?!0:new Promise(u=>{const a=new Audio(URL.createObjectURL(t));a.addEventListener("loadedmetadata",()=>{const n=a.duration,d=n>=v&&n<=h;d||i.msgError(`上传音频时长不能小于${v}秒或大于${h}秒`),u(d)})}),te=async()=>p<=0||w<=0?!0:new Promise(u=>{const a=document.createElement("video");a.src=URL.createObjectURL(t),a.muted=!0,a.playsInline=!0,a.preload="auto",a.crossOrigin="anonymous",a.addEventListener("loadedmetadata",()=>{const{videoWidth:n,videoHeight:d,duration:S}=a,R=Math.floor(S),C=n>=w&&n<=p,D=d>=U&&d<=B,F=R>=v&&R<=h;D||i.msgError(`上传视频高度不能小于${U}或大于${B}`),C||i.msgError(`上传视频宽度不能小于${w}或大于${p}`),F||i.msgError(`上传视频时长不能小于${v}秒或大于${h}秒`),u(D&&C&&F)})});if(!Y())return!1;switch(s){case"image":return await Z();case"audio":return await ee();case"video":return await te();default:return!0}},$=(t,s,o)=>{f.value=!0,l.value=ue(o),r("on-progress",t.percent)},T=(t,s,o)=>{o.every(p=>p.status=="success")&&(f.value=!1),r("change",s),t.code==j.SUCCESS&&(i.msgSuccess(t.msg||"上传成功"),r("success",t)),t.code==j.FAIL&&(l.value.splice(l.value.findIndex(p=>p.raw.uid==s.raw.uid),1),i.msgError(t.msg||"上传失败"))},q=(t,s)=>{var o;i.msgError(`${s.name}文件上传失败`),(o=c.value)==null||o.abort(s),f.value=!1,r("change",s),r("error",s)},G=t=>{if(e.limit===1){c.value.clearFiles();const s=t[0];s.uid=ae(),c.value.handleStart(s),c.value.submit()}else i.msgError(`文件数量上限为${e.limit}个，请重新上传`)},J=t=>{l.value=l.value.filter(s=>s.uid!==t.uid),r("remove",t)},K=()=>{var t;(t=c.value)==null||t.clearFiles(),f.value=!1},X=()=>{var t;(t=c.value)==null||t.clearFiles(),l.value=[]},Q=O(()=>{if(e.accept)return e.accept;switch(e.type){case"image":return".jpg,.png,.gif,.jpeg";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";case"audio":return".mp3,.wav";default:return"*"}});return le(()=>e.type,t=>{b.value=`${P()}${H()}/upload/${t}`}),V({setFileList:t=>{l.value=t}}),{uploadRefs:c,action:b,headers:E,visible:f,fileList:l,getAccept:Q,clearFile:X,beforeUpload:m,handleProgress:$,handleSuccess:T,handleError:q,handleExceed:G,handleRemove:J,handleClose:K}}}),Ee={class:"upload"},$e={class:"file-list p-4"},we={class:"flex-1"};function Se(e,r,V,M,c,b){const E=se,f=oe,l=ye;return y(),I("div",Ee,[W(E,{"file-list":e.fileList,"onUpdate:fileList":r[0]||(r[0]=m=>e.fileList=m),class:"w-[inherit] upload-wrap",ref:"uploadRefs",drag:e.drag,action:e.action,multiple:e.multiple,limit:e.limit,disabled:e.disabled,"show-file-list":e.showFileList,"list-type":e.listType,headers:e.headers,data:e.data,"before-upload":e.beforeUpload,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,"on-error":e.handleError,"on-remove":e.handleRemove,accept:e.getAccept},{default:_(()=>[me(e.$slots,"default",{},void 0,!0)]),_:3},8,["file-list","drag","action","multiple","limit","disabled","show-file-list","list-type","headers","data","before-upload","on-progress","on-success","on-exceed","on-error","on-remove","accept"]),e.showProgress&&e.fileList.length?(y(),fe(l,{key:0,modelValue:e.visible,"onUpdate:modelValue":r[1]||(r[1]=m=>e.visible=m),title:"上传进度","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"500px",modal:!1,onClose:e.handleClose},{default:_(()=>[A("div",$e,[(y(!0),I(pe,null,ge(e.fileList,(m,$)=>(y(),I("div",{key:$,class:"mb-5"},[A("div",null,ve(m.name),1),A("div",we,[W(f,{percentage:parseInt(m.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","onClose"])):he("",!0)])}const Be=ce(be,[["render",Se],["__scopeId","data-v-64fabb39"]]);export{Be as _};
