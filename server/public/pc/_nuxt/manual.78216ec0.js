import{E as Ee,a as be}from"./el-tabs.8ece84b9.js";import{d as Ce,r as c,aG as Z,c as Q,cy as Se,G as f,o as Ve,k as d,l as h,m as n,q as s,Z as l,aI as j,s as i,bM as M,v as $,Y as Pe,t as R,J as K,I as E,L as z,$ as Fe,K as Le,ai as O,ay as $e,av as Re,y as ze,cX as Ie,cY as Ue,u as Be,_ as We}from"./entry.556496e9.js";import{a as Ne,E as Ae}from"./index.e8affe9d.js";import{_ as De}from"./index.vue.ba665940.js";import{E as je,a as Me}from"./index.899f58ef.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                     */import{u as ee}from"./usePaging.cb2ddca4.js";import{t as Ke,a8 as Oe,i as Ge,a9 as He,z as Ye,aa as qe,ab as Je}from"./person_wechat.703f63bb.js";import{s as Xe,a as Ze}from"./vue-virtual-scroller.esm.de24faef.js";/* empty css                             */import{_ as Qe}from"./edit.vue.6fbd4f6d.js";import{_ as ea}from"./sidebar-panel.vue.323cb489.js";import"./raf.a745d528.js";import"./strings.09a7c832.js";import"./clamp.b3f2460d.js";import"./toNumber.844d22bd.js";import"./index.74b3694e.js";import"./index.4bb9b943.js";import"./_baseIteratee.4a27397d.js";import"./debounce.0430f44a.js";import"./index.ef7246b4.js";import"./index.c754b099.js";const aa={class:"h-full flex"},ta={class:"w-[320px] flex-shrink-0 rounded-xl bg-white flex overflow-hidden"},la={class:"w-[94px] flex-shrink-0"},sa={class:"flex-1 flex flex-col overflow-hidden"},na={class:"flex-shrink-0"},oa={class:"flex justify-center"},ia={class:"grow min-h-0 w-full"},ra=["onClick"],ca={key:0},da={key:0,class:"text-ellipsis overflow-hidden whitespace-nowrap"},ua=["onClick"],pa={class:"flex-shrink-0 p-3 flex flex-col gap-2 items-center"},_a={class:"text-[#9E9E9E] text-xs mr-2"},fa={class:"grow min-h-0 bg-white ml-4 rounded-xl overflow-hidden"},ga={class:"flex flex-col h-full"},ma={class:"flex-shrink-0"},va={class:"h-[70px] flex items-center justify-between gap-x-2 px-4"},ha={class:"grow min-h-0"},wa=["src"],ya={class:"p-4 flex justify-end"},xa=Ce({__name:"manual",setup(ka){const ae=Be(),I=c("tag"),G=c([]),v=c({}),C=Z({page_no:1,page_size:15,wechat_id:""}),{pager:u,getLists:te,resetPage:S}=ee({fetchFun:Ke,params:C,isScroll:!0}),o=c([]),b=c(null),w=c(!1),p=Z({tag_ids:"",friend_nickname:"",wechat_id:""}),{pager:y,getLists:H,resetPage:T}=ee({fetchFun:Oe,params:p}),g=c(),m=c([]),x=c([]),U=c(!1),B=c(),Y=c(),le=Q(()=>u.lists.filter(a=>a.id!==0)),se=Q(()=>o.value.length==1&&o.value[0]==b.value),ne=async()=>{var a,e;await oe(),C.wechat_id=(a=v.value)==null?void 0:a.wechat_id,await q(),p.wechat_id=(e=v.value)==null?void 0:e.wechat_id,H()},oe=async()=>{try{const{lists:a}=await Ye({page_size:999});G.value=a,v.value=a.find(e=>e.wechat_status==1)}catch{f.msgError("获取微信列表失败")}},q=async()=>{if(await S(),u.lists.length>0){const a=u.lists[0].id;b.value=a,o.value=[a]}else b.value=null,o.value=[]},ie=()=>{var a;m.value=[],(a=g.value)==null||a.clearSelection(),O(()=>{y.lists.forEach(e=>{var r;(r=g.value)==null||r.toggleRowSelection(e)})})},re=async a=>{var e;v.value=a,C.wechat_id=a.wechat_id,p.tag_ids="",p.wechat_id=a.wechat_id,p.friend_nickname="",o.value=[],m.value=[],w.value=!1,(e=g.value)==null||e.clearSelection(),await q(),T()},ce=async a=>{var r;if(w.value)return;if((r=g.value)==null||r.clearSelection(),a==0){o.value=[0],m.value=[],p.tag_ids="",T();return}o.value=o.value.filter(k=>k!==0);const e=o.value.indexOf(a);e>-1?o.value.length>1&&o.value.splice(e,1):o.value.push(a),p.tag_ids=o.value.join(","),await T()},de=()=>{o.value=[b.value],p.friend_nickname=""},ue=a=>{if(u.isLoad||u.loading)return;const{scrollHeight:e,clientHeight:r,scrollTop:k}=a.target;e-r-k<1&&(C.page_no++,te())},pe=async()=>{var a,e;U.value=!0,await O(),(a=B.value)==null||a.open(),(e=B.value)==null||e.setFormData({wechat_id:v.value.wechat_id})},_e=async a=>{await ae.$confirm({message:"确定要删除该标签吗？",onConfirm:async()=>{try{await qe({id:a}),u.lists=u.lists.filter(e=>e.id!==a),await T(),ie(),u.lists.length==1&&(o.value=[b.value]),f.msgSuccess("删除成功")}catch(e){f.msgError(e)}}})},fe=async a=>{if(!a.tag_name.trim()){f.msgWarning("标签名不能为空"),S();return}try{await Je({id:a.id,tag_name:a.tag_name}),f.msgSuccess("修改成功")}catch(e){f.msgError(e)}},W=async()=>{var e,r;await T();const a=(e=g.value)==null?void 0:e.getSelectionRows();(r=g.value)==null||r.clearSelection(),a.forEach(k=>{var _;(_=g.value)==null||_.toggleRowSelection(k)})},ge=a=>{m.value=a},N=c(!1),V=c("add"),A=async(a,e)=>{var r;V.value=a,N.value=!0,await O(),(r=Y.value)==null||r.open(),e&&(m.value=[e])},J=()=>{N.value=!1,x.value=[]},{isLock:me,lockFn:ve}=Se(async()=>{var a;if(m.value.length===0)return f.msgWarning("请选择要分配标签的好友");if(x.value.length===0)return f.msgWarning("请选择要分配的标签");try{V.value=="add"?await Ge({tag_ids:x.value,friend_ids:m.value.map(e=>e.friend_id),wechat_id:v.value.wechat_id}):await He({tag_id:x.value,friend_id:m.value.map(e=>e.friend_id),wechat_id:v.value.wechat_id}),m.value=[],f.msgSuccess("保存成功"),(a=g.value)==null||a.clearSelection(),J(),S(),T()}catch(e){f.msgError(e)}});return Ve(async()=>{await ne()}),(a,e)=>{const r=Ee,k=be,_=$e,X=Re,P=ze,F=Ae,he=De,we=je,ye=Me,xe=Ie,D=Ue;return d(),h(K,null,[n("div",aa,[n("div",ta,[n("div",la,[s(ea,{"current-wechat":l(v),"wechat-list":l(G),"show-add-we-chat":!1,"onUpdate:currentWechat":re},null,8,["current-wechat","wechat-list"])]),j((d(),h("div",sa,[n("div",na,[s(k,{modelValue:l(I),"onUpdate:modelValue":e[0]||(e[0]=t=>M(I)?I.value=t:null)},{default:i(()=>[s(r,{label:"标签管理",name:"tag"})]),_:1},8,["modelValue"]),n("div",oa,[s(_,{type:"primary",link:"",onClick:de},{default:i(()=>[...e[8]||(e[8]=[$(" 取消已勾选的标签 ",-1)])]),_:1})])]),n("div",ia,[s(l(Ze),{class:"dynamic-scroller w-full h-full",items:l(u).lists,"min-item-size":37,onScroll:ue},{default:i(({item:t,index:ke,active:Te})=>[s(l(Xe),{class:"px-6 py-4 relative",item:t,active:Te,"size-dependencies":[t.tag_name]},{default:i(()=>[n("div",{class:Pe(["tag-item",[l(o).includes(t.id)?"border-[transparent] bg-primary text-white is-selected":"border-primary border-dashed text-primary"]]),onClick:L=>ce(t.id)},[t.id==0?(d(),h("div",ca,R(t.tag_name),1)):(d(),h(K,{key:1},[l(w)?(d(),E(X,{key:1,modelValue:t.tag_name,"onUpdate:modelValue":L=>t.tag_name=L,class:"w-full tag-input",autofocus:"",onBlur:L=>fe(t)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(d(),h("span",da,R(t.tag_name),1))],64)),n("span",null,"（"+R(t.friend_count)+"）",1)],10,ra),l(w)&&t.id!==0?(d(),h("div",{key:0,class:"absolute top-2 right-2 cursor-pointer",onClick:L=>_e(t.id)},[s(P,{name:"local-icon-close_circle_fill",color:"var(--el-color-error)",size:16})],8,ua)):z("",!0)]),_:2},1032,["item","active","size-dependencies"])]),_:1},8,["items"])]),n("div",pa,[s(_,{type:"primary",onClick:pe},{default:i(()=>[s(P,{name:"local-icon-add_box_fill",color:"#ffffff"}),e[9]||(e[9]=n("span",{class:"ml-2"},"添加标签",-1))]),_:1}),s(_,{link:"",color:"#9E9E9E",onClick:e[1]||(e[1]=t=>w.value=!l(w))},{default:i(()=>[n("span",_a,R(l(w)?"取消编辑":"编辑标签"),1),s(P,{name:"el-icon-Edit",color:"#9E9E9E"})]),_:1})])])),[[D,l(u).loading]])]),j((d(),h("div",fa,[n("div",ga,[n("div",ma,[n("div",va,[s(X,{modelValue:l(p).friend_nickname,"onUpdate:modelValue":e[2]||(e[2]=t=>l(p).friend_nickname=t),placeholder:"搜索",class:"!w-[200px] h-[32px]",clearable:"",onClear:W,onKeyup:Fe(W,["enter"])},{append:i(()=>[s(_,{onClick:W},{default:i(()=>[s(P,{name:"el-icon-Search"})]),_:1})]),_:1},8,["modelValue"]),n("div",null,[s(_,{type:"danger",onClick:e[3]||(e[3]=t=>A("remove"))},{default:i(()=>[...e[10]||(e[10]=[$(" 批量移除标签 ",-1)])]),_:1}),s(_,{type:"primary",onClick:e[4]||(e[4]=t=>A("add"))},{default:i(()=>[...e[11]||(e[11]=[$(" 批量新增标签 ",-1)])]),_:1})])])]),n("div",ha,[j((d(),E(l(Ne),{ref_key:"friendTableRef",ref:g,data:l(y).lists,stripe:"",height:"100%","row-key":"friend_id","row-style":{height:"60px"},"header-row-style":{height:"63px"},onSelectionChange:ge},{default:i(()=>[s(F,{type:"selection","reserve-selection":"",width:"55",fixed:"left"}),s(F,{prop:"friend_nickname",label:"微信名称"}),s(F,{prop:"friend_avatar",label:"头像"},{default:i(({row:t})=>[n("img",{src:t.friend_avatar,class:"w-8 h-8 rounded mx-auto"},null,8,wa)]),_:1}),l(se)?z("",!0):(d(),E(F,{key:0,label:"操作",width:"160"},{default:i(({row:t})=>[s(_,{type:"primary",link:"",onClick:ke=>A("remove",t)},{default:i(()=>[...e[12]||(e[12]=[$(" 从已选标签中移除 ",-1)])]),_:1},8,["onClick"])]),_:1}))]),_:1},8,["data"])),[[D,l(y).loading]])]),n("div",ya,[s(he,{modelValue:l(y),"onUpdate:modelValue":e[5]||(e[5]=t=>M(y)?y.value=t:null),onChange:l(H)},null,8,["modelValue","onChange"])])])])),[[D,l(y).loading]])]),l(U)?(d(),E(Qe,{key:0,ref_key:"editTagPopupRef",ref:B,onClose:e[6]||(e[6]=t=>U.value=!1),onSuccess:l(S)},null,8,["onSuccess"])):z("",!0),l(N)?(d(),E(xe,{key:1,title:l(V)=="add"?"分配标签":"移除标签",ref_key:"tagPopupRef",ref:Y,async:"","confirm-loading":l(me),onConfirm:l(ve),onClose:J},{default:i(()=>[n("div",null,[s(ye,{modelValue:l(x),"onUpdate:modelValue":e[7]||(e[7]=t=>M(x)?x.value=t:null),placeholder:l(V)=="add"?"请选择要分配标签":"请选择要移除标签",multiple:"",filterable:""},{default:i(()=>[(d(!0),h(K,null,Le(l(le),t=>(d(),E(we,{key:t.id,label:t.tag_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),_:1},8,["title","confirm-loading","onConfirm"])):z("",!0)],64)}}});const Ya=We(xa,[["__scopeId","data-v-a3a310dd"]]);export{Ya as default};
