import{E as ae,a as re}from"./el-tabs.a314917a.js";import{d as ce,z as de,aH as pe,c as ue,r as w,aG as me,A as B,bb as fe,k as a,l as r,m as o,q as c,s as f,J as y,K as E,Z as l,bM as ve,L as p,v as U,t as g,a0 as V,aI as H,Y as _e,I as he,e0 as ye,bC as ge,c$ as xe,ai as M,G as N,av as we,y as be,ay as ke,cY as Ee,_ as Ve}from"./entry.563c232b.js";import{E as Ce}from"./index.c6e60302.js";import{_ as Re}from"./index.875ea2c9.js";import{E as Ie}from"./index.9ed38239.js";import{E as je}from"./el-image.3350cb2d.js";import{_ as Le}from"./index.vue.ff9e1552.js";/* empty css                   *//* empty css                     */import"./el-image-viewer.164b39e3.js";import{_ as Pe,a as Te}from"./arrow_down.70a5466c.js";import{s as ze}from"./dom.7f5b5a10.js";import{_ as $e}from"./emoji.vue.9a2b4a73.js";import Be from"./useHandle.d90d73aa.js";import{HandleEventEnum as Ue}from"./index.cf59f1a8.js";import"./raf.af29001c.js";import"./strings.0730af8d.js";import"./clamp.43011008.js";import"./toNumber.590accd9.js";import"./index.bd937a87.js";import"./index.aabb37e8.js";import"./index.477a7d18.js";import"./cloneDeep.3c027ec4.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./throttle.4081a158.js";import"./debounce.cf3b8bee.js";import"./person_wechat.703f63bb.js";const He={class:"h-full flex gap-4 w-full"},Me={class:"grow min-h-0 flex flex-col"},Ne={class:"mt-2"},Se={key:0,class:"relative"},Ye={class:"absolute bottom-2 w-full px-2 flex items-center justify-between"},Ae={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer"},De={key:1,class:"w-full"},Oe={class:"h-[202px] border border-dashed border-[#dcdfe6] rounded-lg w-full flex flex-col items-center justify-center hover:border-primary"},Fe={class:"text-[#8A8A8A] mt-4"},Ge={key:1,class:"h-full w-full flex justify-center relative"},qe=["src"],Je={class:"absolute right-2 top-2"},Ke={class:"flex justify-center mt-4"},We={class:"grow min-h-0"},Ze={class:"px-4"},Qe={class:"material-list mt-4 flex flex-col gap-y-4"},Xe={class:"text-white flex items-center gap-x-4 flex-1 w-0"},et={class:"flex-shrink-0"},tt={key:0,class:"text-ellipsis overflow-hidden whitespace-nowrap"},ot=["src"],st={class:"text-ellipsis overflow-hidden whitespace-nowrap"},lt={class:"flex items-center gap-x-2 flex-shrink-0"},nt=["onClick"],it={class:"move-icon cursor-move leading-[0]"},at={key:0,class:"w-[400px] flex-shrink-0"},rt={class:"phone-preview bg-[#f7f7f7] p-10"},ct={class:"py-14 px-5 flex flex-col gap-y-2"},dt={class:"flex-shrink-0"},pt=["src"],ut={key:0,class:"bg-white p-2 rounded-lg"},mt={key:1,class:"w-[120px] h-[120px]"},ft={key:2,class:"w-[120px] h-[120px] relative"},vt=["onClick"],_t=ce({__name:"add-content-v2",props:{modelValue:{},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(C,{expose:S,emit:Y}){const A=C,D=Y,O=de(),{userInfo:F}=pe(O),u=ue({get(){return A.modelValue},set(t){D("update:modelValue",t)}}),d=w(0),b=[{id:0,key:"text",name:"文本",error_tips:"请输入文本内容"},{id:1,key:"image",name:"图片",error_tips:"请上传图片"}],i=me({text:"",image:{},video:{},miniProgram:{},link:{}}),G=[{selector:".material-list",options:{animation:150,handle:".move-icon",onEnd:({newIndex:t,oldIndex:e})=>{const n=u.value,h=n.splice(e,1)[0];n.splice(t,0,h),u.value=[],M(()=>{u.value=n})}}}],{onHandleEvent:q}=Be();q("action",t=>{var n;const{type:e}=t;switch(e){case Ue.ChooseEmoji:i.text=ze((n=L.value)==null?void 0:n.textarea,t.emoji)}});const J=t=>{P()},K=t=>{var e;return((e=b.find(n=>n.id===t))==null?void 0:e.name)+"消息"},W=t=>{const{uri:e,name:n}=t.data||{};d.value===1?(_.value=!1,i.image={uri:e,name:n}):(i.video={uri:e,name:n,pic:""},Z(e))},_=w(!0),Z=t=>{const e=document.createElement("video"),n=document.createElement("canvas"),h=n.getContext("2d");e.src=t,e.muted=!0,e.playsInline=!0,e.preload="auto",e.crossOrigin="anonymous",e.addEventListener("loadedmetadata",async()=>{const v=e.videoWidth/e.videoHeight;n.width=443,n.height=n.width/v,e.currentTime=.1}),e.addEventListener("seeked",async()=>{try{h.drawImage(e,0,0,n.width,n.height);const v=await ye(n.toDataURL("image/png"),`${ge().format("YYYYMMDDHHmmss")}.png`);xe({file:v}).then(m=>{i.video.pic=m.uri,_.value=!1}),URL.revokeObjectURL(e.src)}catch(v){console.log("error",v),_.value=!1}}),e.addEventListener("error",()=>{_.value=!1})},k=w(!1),R=B(),I=w(""),j=async t=>{var e;I.value=t,k.value=!0,await M(),(e=R.value)==null||e.open()},Q=()=>{console.log("openMaterialLibrary")},L=B(),X=()=>{var e;const t=b.find(n=>n.id===d.value);if(i[t==null?void 0:t.key]===""){N.msgError(t==null?void 0:t.error_tips);return}u.value=[...u.value,{type:d.value,name:(e=i[t==null?void 0:t.key])==null?void 0:e.name,content:d.value==0?i.text:i.image.uri}],P()},P=()=>{Object.keys(i).forEach(t=>{i[t]=""})},ee=async t=>{await N.confirm("确定删除该素材吗？"),u.value.splice(t,1)};return S({open}),(t,e)=>{const n=ae,h=re,v=we,m=be,te=Ce,T=ke,oe=Re,z=Ie,$=je,se=Le,le=Ee,ne=fe("draggable");return a(),r(y,null,[o("div",He,[o("div",Me,[o("div",null,[c(h,{modelValue:l(d),"onUpdate:modelValue":e[0]||(e[0]=s=>ve(d)?d.value=s:null),onTabClick:J},{default:f(()=>[(a(),r(y,null,E(b,s=>c(n,{key:s.id,label:s.name,name:s.id},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),o("div",Ne,[l(d)===0?(a(),r("div",Se,[c(v,{modelValue:l(i).text,"onUpdate:modelValue":e[1]||(e[1]=s=>l(i).text=s),ref_key:"textInputRef",ref:L,type:"textarea",autosize:{minRows:7},placeholder:"点击输入您要发送的文本内容"},null,8,["modelValue"]),o("div",Ye,[c(te,{placement:"bottom",width:"466",trigger:"click","show-arrow":!1,"popper-style":{padding:0}},{reference:f(()=>[o("div",Ae,[c(m,{name:"local-icon-phiz",size:24})])]),default:f(()=>[o("div",null,[c($e)])]),_:1}),p("",!0)])])):p("",!0),[1,2].includes(l(d))?(a(),r("div",De,[c(oe,{class:"h-full w-full","show-file-list":!1,"show-progress":"",type:l(d)==1?"image":"video",onSuccess:W},{default:f(()=>[o("div",Oe,[(l(d)===1?!l(i).image.uri:!l(i).video.uri)?(a(),r(y,{key:0},[e[6]||(e[6]=o("img",{src:Pe,class:"w-8"},null,-1)),o("div",Fe,[U(" 点击上传"+g(l(d)===1?"图片":"视频")+"，或点击此",1),o("span",{class:"text-primary cursor-pointer hover:underline",onClick:V(Q,["stop"])},"从素材库选择")])],64)):H((a(),r("div",Ge,[l(_)?p("",!0):(a(),r("img",{key:0,src:l(d)===1?l(i).image.uri:l(i).video.pic,class:"h-full rounded-lg object-cover"},null,8,qe)),l(i).video.uri?(a(),r("div",{key:1,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer z-30",onClick:e[2]||(e[2]=V(s=>j(l(i).video.uri),["stop"]))},[c(m,{name:"local-icon-play",size:50,color:"var(--color-primary)"})])):p("",!0),o("div",Je,[c(T,{onClick:e[3]||(e[3]=V(s=>l(d)===1?l(i).image={}:l(i).video={},["stop"]))},{default:f(()=>[c(m,{name:"el-icon-Delete"})]),_:1})])])),[[le,l(_)]])])]),_:1},8,["type"])])):p("",!0),o("div",Ke,[c(T,{type:"primary",onClick:X},{default:f(()=>[...e[7]||(e[7]=[U(" 添加信息内容 ",-1)])]),_:1})])]),e[8]||(e[8]=o("div",{class:"mt-8"},[o("div",{class:"flex justify-center"},[o("img",{src:Te,class:"w-[25px]"})])],-1))]),o("div",We,[c(z,null,{default:f(()=>[H((a(),r("div",Ze,[o("div",Qe,[(a(!0),r(y,null,E(l(u),(s,x)=>(a(),r("div",{key:x,class:"px-4 py-2 rounded-lg bg-[#2E2E2E] flex justify-between items-center"},[o("div",Xe,[o("div",et,"【"+g(K(s.type))+"】",1),o("div",{class:_e(["flex-shrink-0",{"flex-1 w-0":s.type===0}])},[s.type===0?(a(),r("div",tt,g(s.content),1)):p("",!0),[1,2].includes(s.type)?(a(),r("img",{key:1,src:s.content,class:"w-6 h-6 rounded-lg object-cover"},null,8,ot)):p("",!0)],2),o("div",st,g(s.content.name),1)]),o("div",lt,[o("div",{class:"leading-[0] cursor-pointer",onClick:ie=>ee(x)},[c(m,{name:"el-icon-Delete",color:"#ffffff",size:20})],8,nt),o("div",it,[c(m,{name:"el-icon-Rank",color:"#ffffff",size:20})])])]))),128))])])),[[ne,G]])]),_:1})])]),C.showPreview?(a(),r("div",at,[o("div",rt,[c(z,null,{default:f(()=>[o("div",ct,[(a(!0),r(y,null,E(l(u),(s,x)=>(a(),r("div",{key:x,class:"flex gap-x-2"},[o("div",dt,[o("img",{src:l(F).avatar,class:"w-8 h-8"},null,8,pt)]),s.type===0?(a(),r("div",ut,g(s.content),1)):p("",!0),s.type===1?(a(),r("div",mt,[c($,{src:s.content,"preview-src-list":[s.content],fit:"cover",class:"w-full h-full"},null,8,["src","preview-src-list"])])):p("",!0),s.type===2?(a(),r("div",ft,[c($,{src:s.content.video.pic,"preview-src-list":[s.content.video.uri],fit:"cover",class:"w-full h-full"},null,8,["src","preview-src-list"]),o("div",{class:"absolute top-0 left-0 w-full h-full flex items-center justify-center bg-[rgba(0,0,0,0.5)] cursor-pointer",onClick:ie=>j(s.content.video.uri)},[c(m,{name:"local-icon-play",size:50,color:"#ffffff"})],8,vt)])):p("",!0)]))),128))])]),_:1})])])):p("",!0)]),l(k)?(a(),he(se,{key:0,ref_key:"videoPreviewPlayerRef",ref:R,"video-url":l(I),onClose:e[4]||(e[4]=s=>k.value=!1)},null,8,["video-url"])):p("",!0)],64)}}});const Gt=Ve(_t,[["__scopeId","data-v-f1b2b537"]]);export{Gt as default};
