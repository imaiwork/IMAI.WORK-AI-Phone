import{Q as te,S,b1 as le,d9 as ne,ap as oe,b6 as se,d as M,b0 as D,a_ as K,bC as B,W as ae,r as z,X as ie,V as re,c as T,k as y,I as N,s as p,Z as o,a1 as ue,Y as Q,ar as de,L as F,l as C,J as X,K as Y,aa as me,an as pe,aG as ce,cy as fe,o as ve,m as n,q as s,v as b,bM as _e,u as ge,G as w,bK as be,d0 as ye,y as xe,ba as ke,d1 as Ve,av as Ee,cL as we,cM as Se,ay as Te,_ as Ce}from"./entry.45b56a4a.js";import{E as Ie}from"./el-switch.a318a2b8.js";import{c as he}from"./customParseFormat.7701a253.js";import{a as q}from"./index.def52f2a.js";import{E as Ue}from"./index.515d6243.js";/* empty css                     *//* empty css               *//* empty css                  */import{s as $e,t as Ne}from"./agent.4a5bb123.js";import"./index.386b5c03.js";import"./strings.2a3b34b9.js";import"./_baseIteratee.2c25c469.js";import"./toNumber.7157a344.js";import"./clamp.2ad9aed4.js";import"./index.1bb131e0.js";const Be=te({format:{type:String,default:"HH:mm"},modelValue:{type:S(String)},disabled:{type:Boolean,default:void 0},editable:{type:Boolean,default:!0},effect:{type:S(String),default:"light"},clearable:{type:Boolean,default:!0},size:le,placeholder:String,start:{type:String,default:"09:00"},end:{type:String,default:"18:00"},step:{type:String,default:"00:30"},minTime:{type:S(String)},maxTime:{type:S(String)},includeEndTime:Boolean,name:String,prefixIcon:{type:S([String,Object]),default:()=>ne},clearIcon:{type:S([String,Object]),default:()=>oe},popperClass:{type:String,default:""},popperStyle:{type:S([String,Object])},...se}),V=_=>{const x=(_||"").split(":");if(x.length>=2){let a=Number.parseInt(x[0],10);const l=Number.parseInt(x[1],10),u=_.toUpperCase();return u.includes("AM")&&a===12?a=0:u.includes("PM")&&a!==12&&(a+=12),{hours:a,minutes:l}}return null},G=(_,x)=>{const a=V(_);if(!a)return-1;const l=V(x);if(!l)return-1;const u=a.minutes+a.hours*60,f=l.minutes+l.hours*60;return u===f?0:u>f?1:-1},J=_=>`${_}`.padStart(2,"0"),I=_=>`${J(_.hours)}:${J(_.minutes)}`,ze=(_,x)=>{const a=V(_);if(!a)return"";const l=V(x);if(!l)return"";const u={hours:a.hours,minutes:a.minutes};return u.minutes+=l.minutes,u.hours+=l.hours,u.hours+=Math.floor(u.minutes/60),u.minutes=u.minutes%60,I(u)},Fe=M({name:"ElTimeSelect"}),He=M({...Fe,props:Be,emits:[D,"blur","focus","clear",K],setup(_,{expose:x}){const a=_;B.extend(he);const{Option:l}=q,u=ae("input"),f=z(),h=ie(),{lang:U}=re(),H=T(()=>a.modelValue),W=T(()=>{const t=V(a.start);return t?I(t):null}),E=T(()=>{const t=V(a.end);return t?I(t):null}),j=T(()=>{const t=V(a.step);return t?I(t):null}),L=T(()=>{const t=V(a.minTime||"");return t?I(t):null}),O=T(()=>{const t=V(a.maxTime||"");return t?I(t):null}),d=T(()=>{var t;const i=[],c=(v,g)=>{i.push({value:v,disabled:G(g,L.value||"-1:-1")<=0||G(g,O.value||"100:100")>=0})};if(a.start&&a.end&&a.step){let v=W.value,g;for(;v&&E.value&&G(v,E.value)<=0;)g=B(v,"HH:mm").locale(U.value).format(a.format),c(g,v),v=ze(v,j.value);if(a.includeEndTime&&E.value&&((t=i[i.length-1])==null?void 0:t.value)!==E.value){const k=B(E.value,"HH:mm").locale(U.value).format(a.format);c(k,E.value)}}return i});return x({blur:()=>{var t,i;(i=(t=f.value)==null?void 0:t.blur)==null||i.call(t)},focus:()=>{var t,i;(i=(t=f.value)==null?void 0:t.focus)==null||i.call(t)}}),(t,i)=>(y(),N(o(q),{ref_key:"select",ref:f,"model-value":o(H),disabled:o(h),clearable:t.clearable,"clear-icon":t.clearIcon,size:t.size,effect:t.effect,placeholder:t.placeholder,"default-first-option":"",filterable:t.editable,"empty-values":t.emptyValues,"value-on-clear":t.valueOnClear,"popper-class":t.popperClass,"popper-style":t.popperStyle,"onUpdate:modelValue":c=>t.$emit(o(K),c),onChange:c=>t.$emit(o(D),c),onBlur:c=>t.$emit("blur",c),onFocus:c=>t.$emit("focus",c),onClear:()=>t.$emit("clear")},{prefix:p(()=>[t.prefixIcon?(y(),N(o(ue),{key:0,class:Q(o(u).e("prefix-icon"))},{default:p(()=>[(y(),N(de(t.prefixIcon)))]),_:1},8,["class"])):F("v-if",!0)]),default:p(()=>[(y(!0),C(X,null,Y(o(d),c=>(y(),N(o(l),{key:c.value,label:c.value,value:c.value,disabled:c.disabled},null,8,["label","value","disabled"]))),128))]),_:1},8,["model-value","disabled","clearable","clear-icon","size","effect","placeholder","filterable","empty-values","value-on-clear","popper-class","popper-style","onUpdate:modelValue","onChange","onBlur","onFocus","onClear"]))}});var We=me(He,[["__file","time-select.vue"]]);const je=pe(We);const Le={class:"h-full flex flex-col py-6"},Oe={class:"grow min-h-0"},Re={class:"px-[30px] flex flex-col gap-4"},Ge={class:"flex flex-col"},Me={class:"mt-2"},Pe={class:"flex items-center gap-2"},Ae={class:"flex items-center gap-2"},De={class:"flex flex-col"},Ke={class:"mt-2"},qe={class:"flex flex-col"},Je={class:"mt-2"},Qe={key:0,class:"mt-2"},Xe={class:"flex flex-col"},Ye={class:"mt-2"},Ze={key:0,class:"mt-2"},et={class:"flex flex-col"},tt={class:"flex items-center justify-between gap-2"},lt={class:"flex flex-col"},nt={class:"flex items-center justify-between gap-2"},ot={key:0,class:"mt-2"},st={class:"flex flex-wrap items-center gap-3 mt-3"},at=["onClick"],it={class:"mt-3"},rt={class:"flex items-center justify-center mt-4"},ut=M({__name:"index",props:{agentId:{}},emits:["close"],setup(_,{emit:x}){const a=_,l=ce({multiple_type:0,number_chat_rounds:3,voice_enable:0,image_enable:0,image_reply:"",stop_enable:0,stop_keywords:"",paragraph_enable:0,working_enable:0,non_working_reply:"",working_time:{1:[],2:[],3:[],4:[],5:[],6:[],7:[]}}),u=z([]),f=z([]),h=z([]),U=()=>{f.value.length===0?f.value.push({start_time:"09:00",end_time:"09:15"}):f.value.push({start_time:f.value.at(-1).end_time,end_time:B(f.value.at(-1).end_time,"HH:mm").add(15,"minute").format("HH:mm")})},H=d=>{ge().$confirm({title:"提示",message:"确定删除该时间段吗？",onConfirm:()=>{f.value.splice(d,1)}})},W=async()=>{if(l.image_enable==1&&!l.image_reply){w.msgWarning("请输入图片消息回复内容");return}if(l.stop_enable==1&&!l.stop_keywords){w.msgWarning("请输入停止回复关键词");return}if(l.working_enable==1){if(u.value.length===0){w.msgWarning("请选择接管日期");return}if(f.value.length===0){w.msgWarning("请设置接管时间");return}const{valid:d,indexes:e,errorType:m}=E(f.value);if(!d){h.value=e,w.msgWarning(m);return}if(!l.non_working_reply){w.msgWarning("请输入在接管时间外的自动回复内容");return}const t=f.value.map(i=>`${i.start_time}-${i.end_time}`);Object.keys(l.working_time).forEach(i=>{u.value.includes(Number(i))?l.working_time[i]=t:l.working_time[i]=[]})}try{await $e({...l,robot_id:a.agentId}),w.msgSuccess("保存成功")}catch(d){w.msgError(d||"保存失败")}};function E(d){const e=m=>{const[t,i]=(m||"").split(":").map(Number);return t*60+i};for(let m=0;m<d.length;m++){const t=d[m];if(!t||t.start_time==null||t.start_time===""||t.end_time==null||t.end_time==="")return{valid:!1,errorType:"选择时间不能为空",indexes:[m]};const i=e(t.start_time),c=e(t.end_time);if(i>=c)return{valid:!1,errorType:"选择时间冲突",indexes:[m]};if(m>0){const v=d[m-1],g=e(v.end_time);if(i<g)return{valid:!1,errorType:"选择时间冲突",indexes:[m-1,m]}}}return{valid:!0,indexes:[]}}const{lockFn:j,isLock:L}=fe(W),O=async()=>{try{const d=await Ne({id:a.agentId});d&&be(d,l),d.working_time&&Object.keys(d.working_time).forEach(e=>{d.working_time[e].length>0&&(u.value.push(Number(e)),f.value=d.working_time[e].map(m=>({start_time:m.split("-")[0],end_time:m.split("-")[1]})))})}catch(d){console.error("获取回复策略失败:",d)}};return ve(()=>{O()}),(d,e)=>{const m=ye,t=xe,i=ke,c=Ve,v=Ie,g=Ee,k=we,Z=Se,P=je,A=Te,ee=Ue;return y(),C("div",Le,[n("div",Oe,[s(ee,null,{default:p(()=>[n("div",Re,[n("div",Ge,[e[13]||(e[13]=n("div",null,"短时间内多条信息回复策略",-1)),n("div",Me,[s(c,{modelValue:o(l).multiple_type,"onUpdate:modelValue":e[0]||(e[0]=r=>o(l).multiple_type=r)},{default:p(()=>[s(m,{value:0},{default:p(()=>[...e[10]||(e[10]=[b("逐条回复",-1)])]),_:1}),s(m,{value:1},{default:p(()=>[s(i,{content:"当用户在两分钟以外，没有继续发送消息，则将多条信息合并回复"},{default:p(()=>[n("div",Pe,[e[11]||(e[11]=n("span",null,"合并回复",-1)),s(t,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1}),s(m,{value:2},{default:p(()=>[s(i,{content:"当用户在两分钟以外，没有继续发送消息，只回复最后一条信息"},{default:p(()=>[n("div",Ae,[e[12]||(e[12]=n("span",null," 只回复最后一条 ",-1)),s(t,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),n("div",De,[e[14]||(e[14]=n("div",null,"语音消息回复策略（目前只支持微信）",-1)),n("div",Ke,[s(v,{modelValue:o(l).voice_enable,"onUpdate:modelValue":e[1]||(e[1]=r=>o(l).voice_enable=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),n("div",qe,[e[15]||(e[15]=n("div",null,"智能体被调用时，接收到图片进行固定回复",-1)),n("div",Je,[s(v,{modelValue:o(l).image_enable,"onUpdate:modelValue":e[2]||(e[2]=r=>o(l).image_enable=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).image_enable==1?(y(),C("div",Qe,[s(g,{modelValue:o(l).image_reply,"onUpdate:modelValue":e[3]||(e[3]=r=>o(l).image_reply=r),type:"textarea",placeholder:"点击输入您要回复的内容",resize:"none",rows:4},null,8,["modelValue"])])):F("",!0)]),n("div",Xe,[e[16]||(e[16]=n("div",{class:""},"智能体被调用时，接收到某些信息后停止对该条信息进行回复",-1)),n("div",Ye,[s(v,{modelValue:o(l).stop_enable,"onUpdate:modelValue":e[4]||(e[4]=r=>o(l).stop_enable=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).stop_enable==1?(y(),C("div",Ze,[s(g,{modelValue:o(l).stop_keywords,"onUpdate:modelValue":e[5]||(e[5]=r=>o(l).stop_keywords=r),type:"textarea",placeholder:"点击输入您要检测的词语",resize:"none",rows:4},null,8,["modelValue"])])):F("",!0)]),n("div",et,[e[18]||(e[18]=n("div",null,[n("div",null,"分段回复")],-1)),n("div",tt,[e[17]||(e[17]=n("div",{class:"text-xs"}," 用户在聊天界面看到的 AI 回复 不是一次性的大段话，而是按段落逐条展示 ",-1)),s(v,{modelValue:o(l).paragraph_enable,"onUpdate:modelValue":e[6]||(e[6]=r=>o(l).paragraph_enable=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),n("div",lt,[e[30]||(e[30]=n("div",null,"接管时间(AI回复)",-1)),n("div",nt,[e[19]||(e[19]=n("div",{class:"text-xs text-error"},[b(" 提醒：用户可以设置 AI 在指定的时间段内接管对话，超出接管时间的消息，则会自动发送用户预先设定的固定回复。"),n("span",{class:"font-bold"},"（一小时内仅剩生效一次）")],-1)),s(v,{modelValue:o(l).working_enable,"onUpdate:modelValue":e[7]||(e[7]=r=>o(l).working_enable=r),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).working_enable==1?(y(),C("div",ot,[s(Z,{modelValue:o(u),"onUpdate:modelValue":e[8]||(e[8]=r=>_e(u)?u.value=r:null)},{default:p(()=>[s(k,{value:1},{default:p(()=>[...e[20]||(e[20]=[b("周一",-1)])]),_:1}),s(k,{value:2},{default:p(()=>[...e[21]||(e[21]=[b("周二",-1)])]),_:1}),s(k,{value:3},{default:p(()=>[...e[22]||(e[22]=[b("周三",-1)])]),_:1}),s(k,{value:4},{default:p(()=>[...e[23]||(e[23]=[b("周四",-1)])]),_:1}),s(k,{value:5},{default:p(()=>[...e[24]||(e[24]=[b("周五",-1)])]),_:1}),s(k,{value:6},{default:p(()=>[...e[25]||(e[25]=[b("周六",-1)])]),_:1}),s(k,{value:7},{default:p(()=>[...e[26]||(e[26]=[b("周日",-1)])]),_:1})]),_:1},8,["modelValue"]),n("div",st,[(y(!0),C(X,null,Y(o(f),(r,R)=>(y(),C("div",{key:R},[n("div",{class:Q(["time-select-wrapper",{"!border-error":o(h).includes(R)}])},[s(P,{modelValue:r.start_time,"onUpdate:modelValue":$=>r.start_time=$,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","max-time":r.end_time},null,8,["modelValue","onUpdate:modelValue","max-time"]),e[27]||(e[27]=n("div",{class:""},"至",-1)),s(P,{modelValue:r.end_time,"onUpdate:modelValue":$=>r.end_time=$,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","min-time":r.start_time},null,8,["modelValue","onUpdate:modelValue","min-time"]),n("div",{class:"ml-2 w-4 h-4 flex-shrink-0 bg-app-bg-1 rounded-full flex items-center justify-center cursor-pointer",onClick:$=>H(R)},[s(t,{name:"el-icon-Close",color:"#ffffff",size:10})],8,at)],2)]))),128)),s(A,{type:"primary",size:"small",onClick:U},{default:p(()=>[...e[28]||(e[28]=[b("新增时间段",-1)])]),_:1})]),n("div",it,[e[29]||(e[29]=n("div",{class:"mb-3"},"固定回复内容",-1)),s(g,{modelValue:o(l).non_working_reply,"onUpdate:modelValue":e[9]||(e[9]=r=>o(l).non_working_reply=r),type:"textarea",placeholder:"请输入在接管时间外的自动回复内容",resize:"none",rows:5},null,8,["modelValue"])])])):F("",!0)])])]),_:1})]),n("div",rt,[s(A,{type:"primary",class:"w-[318px] !rounded-full !h-[50px]",loading:o(L),onClick:o(j)},{default:p(()=>[...e[31]||(e[31]=[b(" 保存 ",-1)])]),_:1},8,["loading","onClick"])])])}}});const St=Ce(ut,[["__scopeId","data-v-6aa2388d"]]);export{St as default};
