import{aG as H,r as n,c as R,cA as T,cB as B,G as m}from"./entry.45b56a4a.js";import{useChatStore as z}from"./chat.f4618dc3.js";import{useChatManager as E}from"./useChatManager.de61dcd6.js";import{useChatEventBus as G}from"./useChatEventBus.2cbae9d6.js";function A(){const a=z(),{taskId:u,fetchChatHistory:v,resetScroll:g,stopStream:d,chatScrollToBottom:C}=E(),{onHistoryRefresh:p}=G(),o=H({page_no:1,page_size:40}),l=n(!0),s=n(!1),c=n(!1),t=n([]),i=R(()=>u.value),f=async()=>{s.value=!0;try{const{lists:e,count:r}=await T(o);c.value=!(e.length<(o.page_size||r)),t.value=t.value.concat(e)}finally{s.value=!1,l.value=!1}},h=e=>{u.value&&(a.clearChat(),a.resetRoute())},S=async e=>{i.value!==e&&(await d(),a.clearChat(),a.setTaskId(e),await v(),g(),C())},y=async e=>{try{t.value=t.value.filter(r=>r.task_id!==e),await B({task_id:e}),m.msgSuccess("删除成功"),i.value===e&&h()}catch(r){m.msgError(r)}},_=()=>{a.chatContentList.length},k=async()=>{!c.value||s.value||(o.page_no++,f())},w=()=>{o.page_no=1,t.value=[],c.value=!1,s.value=!1};return p(e=>{t.value.unshift({message:e.message,create_time:e.createTime,task_id:e.taskId,update_time:e.createTime})}),{chatHistory:t,currentSessionId:i,isRefreshing:l,isLoading:s,isFinished:c,fetchChatRecord:f,createNewSession:h,switchToSession:S,deleteSession:y,saveCurrentSession:_,loadHistory:k,reset:w}}export{A as useChatHistory};
