import{Q as ye,S as ee,U as xe,aV as ae,d as oe,cj as te,ck as Ne,cl as Te,V as Ee,W as ze,cm as Le,r as k,cn as Oe,c as g,co as Re,A as Ye,cp as Se,D as W,ai as $e,o as Ve,bh as C,k as R,I as se,s as d,q as r,bi as Xe,m as p,Y as i,Z as a,a3 as ne,cq as Me,a0 as Ae,L as x,a1 as b,a6 as De,l as Z,J as Pe,cr as Be,cs as Fe,H as X,v as He,t as qe,ct as We,a7 as Ze,ar as Ke,cu as je,cv as Ge,cw as Je,aa as Qe,aY as Ue,aZ as N,cx as ea,an as aa}from"./entry.45b56a4a.js";import{t as M}from"./throttle.ab15e8bc.js";const ta=ye({urlList:{type:ee(Array),default:()=>xe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ee(String)}}),sa={close:()=>!0,error:w=>w instanceof Event,switch:w=>ae(w),rotate:w=>ae(w)},na=oe({name:"ElImageViewer"}),oa=oe({...na,props:ta,emits:sa,setup(w,{expose:le,emit:T}){var K;const l=w,E={CONTAIN:{name:"contain",icon:te(Ne)},ORIGINAL:{name:"original",icon:te(Te)}};let A;const{t:re}=Ee(),o=ze("image-viewer"),{nextZIndex:ce}=Le(),z=k(),j=k(),G=Oe(),D=g(()=>{const{scale:e,minScale:n,maxScale:s}=l;return Re(e,n,s)}),_=k(!0),L=k(!1),P=k(!1),u=k(l.initialIndex),Y=Ye(E.CONTAIN),t=k({scale:D.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ie=k((K=l.zIndex)!=null?K:ce());Se(P,{ns:o});const ue=g(()=>{const{urlList:e}=l;return e.length<=1}),J=g(()=>u.value===0),Q=g(()=>u.value===l.urlList.length-1),S=g(()=>l.urlList[u.value]),fe=g(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!l.infinite&&J.value)]),de=g(()=>[o.e("btn"),o.e("next"),o.is("disabled",!l.infinite&&Q.value)]),ve=g(()=>{const{scale:e,deg:n,offsetX:s,offsetY:f,enableTransition:v}=t.value;let c=s/e,m=f/e;const y=n*Math.PI/180,I=Math.cos(y),O=Math.sin(y);c=c*I+m*O,m=m*I-s/e*O;const q={transform:`scale(${e}) rotate(${n}deg) translate(${c}px, ${m}px)`,transition:v?"transform .3s":""};return Y.value.name===E.CONTAIN.name&&(q.maxWidth=q.maxHeight="100%"),q}),me=g(()=>`${u.value+1} / ${l.urlList.length}`);function $(){ge(),A==null||A(),P.value=!1,T("close")}function pe(){const e=M(s=>{switch(Ue(s)){case N.esc:l.closeOnPressEscape&&$();break;case N.space:B();break;case N.left:F();break;case N.up:h("zoomIn");break;case N.right:H();break;case N.down:h("zoomOut");break}}),n=M(s=>{const f=s.deltaY||s.deltaX;h(f<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});G.run(()=>{C(document,"keydown",e),C(z,"wheel",n)})}function ge(){G.stop()}function he(){_.value=!1}function ke(e){L.value=!0,_.value=!1,T("error",e),e.target.alt=re("el.image.error")}function be(e){if(_.value||e.button!==0||!z.value)return;t.value.enableTransition=!1;const{offsetX:n,offsetY:s}=t.value,f=e.pageX,v=e.pageY,c=M(I=>{t.value={...t.value,offsetX:n+I.pageX-f,offsetY:s+I.pageY-v}}),m=C(document,"mousemove",c),y=C(document,"mouseup",()=>{m(),y()});e.preventDefault()}function we(e){if(_.value||!z.value||e.touches.length!==1)return;t.value.enableTransition=!1;const{offsetX:n,offsetY:s}=t.value,{pageX:f,pageY:v}=e.touches[0],c=M(I=>{const O=I.touches[0];t.value={...t.value,offsetX:n+O.pageX-f,offsetY:s+O.pageY-v}}),m=C(document,"touchmove",c),y=C(document,"touchend",()=>{m(),y()});e.preventDefault()}function U(){t.value={scale:D.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function B(){if(_.value||L.value)return;const e=ea(E),n=Object.values(E),s=Y.value.name,v=(n.findIndex(c=>c.name===s)+1)%e.length;Y.value=E[e[v]],U()}function V(e){L.value=!1;const n=l.urlList.length;u.value=(e+n)%n}function F(){J.value&&!l.infinite||V(u.value-1)}function H(){Q.value&&!l.infinite||V(u.value+1)}function h(e,n={}){if(_.value||L.value)return;const{minScale:s,maxScale:f}=l,{zoomRate:v,rotateDeg:c,enableTransition:m}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":t.value.scale>s&&(t.value.scale=Number.parseFloat((t.value.scale/v).toFixed(3)));break;case"zoomIn":t.value.scale<f&&(t.value.scale=Number.parseFloat((t.value.scale*v).toFixed(3)));break;case"clockwise":t.value.deg+=c,T("rotate",t.value.deg);break;case"anticlockwise":t.value.deg-=c,T("rotate",t.value.deg);break}t.value.enableTransition=m}function _e(e){var n;((n=e.detail)==null?void 0:n.focusReason)==="pointer"&&e.preventDefault()}function Ie(){l.closeOnPressEscape&&$()}function Ce(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return W(()=>D.value,e=>{t.value.scale=e}),W(S,()=>{$e(()=>{const e=j.value;e!=null&&e.complete||(_.value=!0)})}),W(u,e=>{U(),T("switch",e)}),Ve(()=>{P.value=!0,pe(),A=C("wheel",Ce,{passive:!1})}),le({setActiveItem:V}),(e,n)=>(R(),se(a(Je),{to:"body",disabled:!e.teleported},{default:d(()=>[r(Xe,{name:"viewer-fade",appear:""},{default:d(()=>[p("div",{ref_key:"wrapper",ref:z,tabindex:-1,class:i(a(o).e("wrapper")),style:ne({zIndex:ie.value})},[r(a(Me),{loop:"",trapped:"","focus-trap-el":z.value,"focus-start-el":"container",onFocusoutPrevented:_e,onReleaseRequested:Ie},{default:d(()=>[p("div",{class:i(a(o).e("mask")),onClick:Ae(s=>e.hideOnClickModal&&$(),["self"])},null,10,["onClick"]),x(" CLOSE "),p("span",{class:i([a(o).e("btn"),a(o).e("close")]),onClick:$},[r(a(b),null,{default:d(()=>[r(a(De))]),_:1})],2),x(" ARROW "),a(ue)?x("v-if",!0):(R(),Z(Pe,{key:0},[p("span",{class:i(a(fe)),onClick:F},[r(a(b),null,{default:d(()=>[r(a(Be))]),_:1})],2),p("span",{class:i(a(de)),onClick:H},[r(a(b),null,{default:d(()=>[r(a(Fe))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(R(),Z("div",{key:1,class:i([a(o).e("btn"),a(o).e("progress")])},[X(e.$slots,"progress",{activeIndex:u.value,total:e.urlList.length},()=>[He(qe(a(me)),1)])],2)):x("v-if",!0),x(" ACTIONS "),p("div",{class:i([a(o).e("btn"),a(o).e("actions")])},[p("div",{class:i(a(o).e("actions__inner"))},[X(e.$slots,"toolbar",{actions:h,prev:F,next:H,reset:B,activeIndex:u.value,setActiveItem:V},()=>[r(a(b),{onClick:s=>h("zoomOut")},{default:d(()=>[r(a(We))]),_:1},8,["onClick"]),r(a(b),{onClick:s=>h("zoomIn")},{default:d(()=>[r(a(Ze))]),_:1},8,["onClick"]),p("i",{class:i(a(o).e("actions__divider"))},null,2),r(a(b),{onClick:B},{default:d(()=>[(R(),se(Ke(a(Y).icon)))]),_:1}),p("i",{class:i(a(o).e("actions__divider"))},null,2),r(a(b),{onClick:s=>h("anticlockwise")},{default:d(()=>[r(a(je))]),_:1},8,["onClick"]),r(a(b),{onClick:s=>h("clockwise")},{default:d(()=>[r(a(Ge))]),_:1},8,["onClick"])])],2)],2),x(" CANVAS "),p("div",{class:i(a(o).e("canvas"))},[L.value&&e.$slots["viewer-error"]?X(e.$slots,"viewer-error",{key:0,activeIndex:u.value,src:a(S)}):(R(),Z("img",{ref_key:"imgRef",ref:j,key:a(S),src:a(S),style:ne(a(ve)),class:i(a(o).e("img")),crossorigin:e.crossorigin,onLoad:he,onError:ke,onMousedown:be,onTouchstart:we},null,46,["src","crossorigin"]))],2),X(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var la=Qe(oa,[["__file","image-viewer.vue"]]);const ia=aa(la);export{ia as E};
