import{E as F,a as G}from"./el-tabs.5286b06f.js";import{d as I,bP as $,r as u,cj as a,aG as K,A as P,c as j,dm as M,cy as U,D as H,o as J,k as p,l as _,m,q as d,s as f,J as Z,K as O,I as v,Z as i,bM as b,v as C,L as E,ar as Q,t as W,ai as X,bK as Y,G as V,y as tt,ay as et,_ as ot}from"./entry.8705b591.js";import{A as it,B as rt,C as mt}from"./agent.4a5bb123.js";import{KnbTypeEnum as k}from"./index.5bd136e1.js";import{ModeTypeEnum as nt}from"./index.11e2700c.js";import{_ as at}from"./index.vue.8782da3d.js";import st from"./index.4308941d.js";import pt from"./index.25a4eb52.js";import lt from"./index.146d10e1.js";import dt from"./index.911a8876.js";import ct from"./index.576e4850.js";import _t from"./index.d67bb4f7.js";import{_ as ut}from"./index.vue.6798e18a.js";import"./raf.11208e2e.js";import"./strings.05ad2423.js";import"./clamp.2d199c02.js";import"./toNumber.9701a4c1.js";import"./index.554f7908.js";import"./index.4557d148.js";import"./index.b44dd729.js";import"./index.b617bec7.js";import"./cloneDeep.699e051d.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.7002e1fb.js";import"./index.d5b2ab73.js";import"./index.d9a24f65.js";import"./_baseIteratee.889eaccd.js";import"./index.f9213b2f.js";/* empty css                  *//* empty css               *//* empty css                     */import"./common.1728c92e.js";import"./agent_bg.ea73c8d5.js";import"./agent-logo.c28160a6.js";import"./el-slider.a8a2e45a.js";import"./el-input-number.1be09075.js";import"./index.506eb19c.js";import"./debounce.4efe57e2.js";import"./el-switch.e7de3b12.js";import"./knowledge_base.519704cc.js";import"./index.66741974.js";import"./index.158d282d.js";import"./el-empty.a2e85def.js";/* empty css                        *//* empty css                 */import"./menu-edit.a5e13f46.js";import"./index.vue.3f013733.js";import"./el-image.1d071b41.js";import"./el-image-viewer.98cbed9e.js";import"./throttle.2aefc6f7.js";import"./web.vue.85a97dbb.js";import"./index.656bf02e.js";import"./index.vue.c79afe88.js";/* empty css                   */import"./useCopy.0e54031a.js";import"./usePaging.0c251ebb.js";import"./create-popup.vue.1273d58c.js";import"./usage-setting.vue.55226fc2.js";import"./poster-setting.vue.328b56a9.js";import"./vue-qr.d8b38f44.js";import"./js.vue.fc9c9a72.js";import"./code-view.vue.6864f5bb.js";import"./index.vue.030f2d17.js";import"./index.3864ff87.js";import"./katex.21fbbe07.js";import"./gzh.vue.ef6c7722.js";import"./gzh-config.vue.35144573.js";import"./api.vue.25b8d3d7.js";import"./call-code.vue.8323b3c0.js";import"./el-collapse.4c50d571.js";import"./index.2be79eb2.js";import"./keywords-edit.vue.d9258e41.js";import"./add-content.be1a3b43.js";import"./el-alert.787fd274.js";import"./index.vue.a44fb124.js";import"./index.vue.f28f8d8c.js";import"./arrow_down.70a5466c.js";import"./dom.7f5b5a10.js";import"./index.cf59f1a8.js";import"./emoji.vue.7b2a2c2d.js";import"./useHandle.727f0a04.js";import"./person_wechat.703f63bb.js";import"./mini-program-card.vue.1b3fb3a1.js";import"./material-picker.vue.1500e13c.js";import"./index.vue.ae829252.js";import"./sidebar.dbf9f474.js";import"./useMaterial.620c90d2.js";import"./container.2a22fc41.js";import"./upload.42060dd8.js";import"./preview.vue.9d7f1717.js";import"./link-card.vue.b31b34fe.js";import"./file-card.vue.d1c72cc2.js";import"./workflow-edit.vue.67150d29.js";import"./import-data.vue.d2dfde95.js";import"./el-steps.0431c45a.js";import"./customParseFormat.cc1515cd.js";import"./chatting.15fc6d72.js";import"./cloneDeep.cb5e23a7.js";import"./chat.68e7292d.js";import"./useChatManager.5d5aef4e.js";import"./useChatEventBus.d6647ad1.js";const ft={class:"h-full flex flex-col p-4"},bt={class:"bg-white rounded-[20px] px-[50px]"},kt={class:"grow min-h-0 bg-white rounded-[20px] mt-4 flex"},yt={class:"flex-1 flex flex-col w-full"},gt={class:"px-[14px] h-[72px] flex items-center justify-between flex-shrink-0 border-b-[1px] border-[#0000000d]"},xt={key:0},ht={class:"grow min-h-0"},wt={key:0,class:"w-[400px] flex flex-col border-l-[1px] border-[#0000000d]"},vt={class:"h-[72px] flex items-center gap-x-2 justify-between flex-shrink-0 border-b-[1px] border-[#0000000d] px-5"},Ct={class:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap"},Et={class:"grow min-h-0"},Vt=I({__name:"edit",emits:["back"],setup(Nt,{emit:N}){const R=N,A=$(),l=Number(A.query.id),s=u("base"),y=u([{label:"人设",name:"base",component:a(at)},{label:"知识库",name:"knb",component:a(st)},{label:"拟人化",name:"humanize",component:a(pt)},{label:"界面配置",name:"interface",component:a(lt)},{label:"发布",name:"publish",component:a(dt)},{label:"技能",name:"skill",component:a(ct)},{label:"调用设置",name:"call",component:a(_t)}]),t=K({id:l,kb_type:k.RAG,kb_ids:"",icons:"",image:"",bg_image:"",name:"",intro:"",model_id:"",model_sub_id:"",roles_prompt:"",search_mode:"similar",search_tokens:3e3,search_similar:.4,ranking_status:0,ranking_score:.5,context_num:3,is_public:0,is_enable:1,optimize_ask:0,optimize_m_id:"",optimize_s_id:"",search_empty_type:1,search_empty_text:"",top_p:.9,temperature:.6,presence_penalty:.2,frequency_penalty:.2,logprobs:0,top_logprobs:10,welcome_introducer:"",copyright:"",menus:[],flow_status:0,flow_config:{workflow_id:"",bot_id:"",app_id:"",api_token:""},threshold:.5,mode_type:nt.BALANCE,max_tokens:4096}),g=u(),x=P(),S=j(()=>{var o;return(o=y.value.find(e=>e.name===s.value))==null?void 0:o.component}),T=async()=>{var o;await X(),(o=x.value)==null||o.startNewChat()},B=async()=>{if(l)try{const o=await it({id:l});Y(o,t),t.kb_type==k.RAG&&o.kb_ids.length>0&&(t.kb_ids=o.kb_ids[0]),t.presence_penalty=Number(t.presence_penalty),t.frequency_penalty=Number(t.frequency_penalty),t.top_p=Number(t.top_p),t.temperature=Number(t.temperature)}catch(o){console.error("获取智能体详情失败:",o)}},h=async o=>{var e,c;try{await((c=(e=g.value)==null?void 0:e.validate)==null?void 0:c.call(e));const n={...t,kb_ids:t.kb_type==k.RAG&&typeof t.kb_ids=="string"?[t.kb_ids]:t.kb_ids};t.id?await rt(n):await mt(n),o||V.msgSuccess(`${t.id?"编辑":"添加"}成功`)}catch(n){o||V.msgError(typeof n=="string"?n:"请填写相关信息")}},D=M(()=>h(!0),300),{lockFn:L,isLock:q}=U(()=>h(!1));return H(t,()=>{D()},{deep:!0}),J(()=>{B()}),(o,e)=>{const c=F,n=G,z=tt,w=et;return p(),_("div",ft,[m("div",bt,[d(n,{modelValue:i(s),"onUpdate:modelValue":e[0]||(e[0]=r=>b(s)?s.value=r:null)},{default:f(()=>[(p(!0),_(Z,null,O(i(y),r=>(p(),v(c,{key:r.name,label:r.label,name:r.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),m("div",kt,[m("div",yt,[m("div",gt,[m("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[1]||(e[1]=r=>R("back"))},[d(z,{name:"el-icon-ArrowLeft"}),e[4]||(e[4]=m("div",null,"返回",-1))]),["skill","publish","call"].includes(i(s))?E("",!0):(p(),_("div",xt,[d(w,{type:"primary",class:"!rounded-full !w-[68px]",loading:i(q),onClick:i(L)},{default:f(()=>[...e[5]||(e[5]=[C(" 保存 ",-1)])]),_:1},8,["loading","onClick"])]))]),m("div",ht,[(p(),v(Q(i(S)),{ref_key:"formRef",ref:g,modelValue:i(t),"onUpdate:modelValue":e[2]||(e[2]=r=>b(t)?t.value=r:null),"agent-id":i(l)},null,8,["modelValue","agent-id"]))])]),["publish"].includes(i(s))?E("",!0):(p(),_("div",wt,[m("div",vt,[m("div",Ct,W(i(t).name),1),d(w,{onClick:T},{default:f(()=>[...e[6]||(e[6]=[C("新建对话",-1)])]),_:1})]),m("div",Et,[d(ut,{ref_key:"chatRef",ref:x,modelValue:i(t),"onUpdate:modelValue":e[3]||(e[3]=r=>b(t)?t.value=r:null),"agent-id":i(l)},null,8,["modelValue","agent-id"])])]))])])}}});const Co=ot(Vt,[["__scopeId","data-v-b7f90599"]]);export{Co as default};
