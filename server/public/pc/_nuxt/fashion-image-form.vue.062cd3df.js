import{_ as ae}from"./index.vue.83bf2a64.js";import{d as ne,aG as re,r as h,aW as ie,G as v,k as f,l as _,m as o,q as l,s as r,Z as a,J as g,a0 as F,cZ as ce,t as fe,K as M,L as b,I as U,v as C,Y as pe,u as me,y as ue,aw as de,ay as _e,az as ge}from"./entry.556496e9.js";import{_ as he}from"./index.2280f26b.js";import{E as ve,a as xe}from"./el-tabs.8ece84b9.js";import{E as we}from"./el-image.2c371257.js";import{E as ye}from"./index.4bb9b943.js";import{E as Ee}from"./el-image-viewer.97d3022d.js";/* empty css                     */import{u as be}from"./useDictOptions.8bb858a6.js";import{a as Ce,c as ke,d as Se}from"./drawing.7058a163.js";import{FashionImageTypeEnum as p}from"./index.fb0aa6a9.js";import{_ as V}from"./case-image-v2.vue.4bd299e5.js";const Ie={class:"h-full flex flex-col"},Le={class:"h-[164px] w-full flex flex-col items-center justify-center leading-[1.5] relative"},Re=["src"],De=["onClick"],Pe={class:"type-tabs"},Te={class:"grow min-h-0"},ze={class:"p-4"},Oe={class:"w-full"},Fe={class:"w-full"},Me={class:"w-full"},Ue={class:"flex justify-between gap-2"},Ve={class:"w-full h-[420px]"},We={class:"grid grid-cols-3 gap-2"},$e={class:"h-[127px] w-full flex-col rounded-md flex items-center justify-center bg-app-bg-3"},je=["onClick"],Be={class:"absolute top-0 left-0 w-full h-full invisible group-hover:visible bg-[var(--el-overlay-color-lighter)] flex items-center justify-center"},He=["onClick"],Ne={class:"fixed right-4 top-[93px] z-[22]"},W=".jpg,.jpeg,.png",$=10,ls=ne({__name:"fashion-image-form",emits:["update:formData","generatePrompt"],setup(Ae,{expose:j,emit:B}){const H=B,k=[{label:"上下装",value:p.UPPER_LOWER_CLOTHES},{label:"连衣裙",value:p.DRESS}],e=re({type:p.UPPER_LOWER_CLOTHES,dress:"",upper_clothes:"",lower_clothes:"",persons:[],img_count:0}),S=[1/3,3],I=[4096,4096],N=(t,s)=>{const n=t.data.uri;if(e.type==p.DRESS){e.upper_clothes=n,e.lower_clothes=e.upper_clothes;return}e[s]=n},{optionsData:u}=be({modelList:{api:Ce,params:{case_type:4,page_size:999},transformData:t=>t.lists.map(s=>({...s,result_image:s.result_image}))}}),A=t=>{const s=t.data.uri;u.modelList.unshift({result_image:s}),ke({result_image:s})},G=t=>{e.persons.includes(t)?e.persons=[]:e.persons=[t],e.img_count=e.persons.length},K=t=>{me().$confirm({title:"提示",message:"确定删除该模特吗？",theme:"dark",onConfirm:async()=>{const s=u.modelList[t];if(s.user_id)try{await Se({id:s.id}),v.msgSuccess("删除成功"),u.modelList.splice(t,1),e.persons.splice(t,1)}catch{v.msgError("删除失败")}}})},w=h(!1),L=h(0),R=h([]),Z=t=>{w.value=!0,L.value=t,R.value=u.modelList.map(s=>s.result_image)},D=h(),q=()=>{D.value.open()},J=t=>{const{data:s}=t,n=s.result_image,c=u.modelList.find(d=>d.result_image==n);if(c){e.persons=[n],e.persons.includes(n)||e.persons.push(n);return}u.modelList.unshift(c),e.persons=[n]},P=h(),Y=()=>{P.value.open()},Q=t=>{var c,d;const{case_type:s,data:n}=t;s==0&&(e.upper_clothes=(c=n.params)==null?void 0:c.images[0],e.lower_clothes=(d=n.params)==null?void 0:d.images[1],e.type=p.UPPER_LOWER_CLOTHES),s==1&&(e.dress=n.result_image,e.upper_clothes=e.dress,e.lower_clothes=e.dress,e.type=p.DRESS)};let T;const X={setup(t,{slots:s}){return()=>{T=s.default}}},y=t=>T(t);return ie(()=>{H("update:formData",e)}),j({getFormData:()=>{var t;return{params:{upper_clothes:e.upper_clothes,lower_clothes:e.lower_clothes,persons:e.persons,img_count:e.persons.length},type:e.type,type_name:(t=k.find(s=>s.value==e.type))==null?void 0:t.label}},validateForm:()=>new Promise((t,s)=>{if(!e.upper_clothes){v.msgWarning("请上传上衣"),s(!1);return}if(e.type==p.UPPER_LOWER_CLOTHES&&!e.lower_clothes){v.msgWarning("请上传下装"),s(!1);return}if(e.persons.length==0){v.msgWarning("请选择模特"),s(!1);return}t(!0)})}),(t,s)=>{const n=ae,c=ue,d=he,ee=ve,se=xe,x=de,E=_e,te=we,z=ye,oe=ge,le=Ee;return f(),_(g,null,[o("div",Ie,[l(X,null,{default:r(({type:i})=>[l(d,{class:"w-full h-full","show-progress":"",drag:"","show-file-list":!1,accept:W,"ratio-size":[S[0],S[1]],"image-resolution":[I[0],I[1]],"max-size":$,onSuccess:m=>N(m,i)},{default:r(()=>[o("div",Le,[a(e)[i]?(f(),_(g,{key:0},[o("img",{src:a(e)[i],class:"w-full h-full object-contain"},null,8,Re),o("div",{class:"absolute top-1 right-1 cursor-pointer w-6 h-6",onClick:F(m=>a(e)[i]="",["stop"])},[l(n,{theme:a(ce).DARK},null,8,["theme"])],8,De),s[2]||(s[2]=o("div",{class:"absolute bottom-3 cursor-pointer px-[10px] text-white rounded-full border border-[#ffffff1a] bg-[#ffffff4d] shadow-[0px_6px_12px_0px_rgba(0,0,0,0.24)] h-[28px] flex items-center justify-center"}," 更换图片 ",-1))],64)):(f(),_(g,{key:1},[l(c,{name:"local-icon-file_add",size:28,color:"#ffffff"}),s[3]||(s[3]=o("div",{class:"text-xs text-white mt-3"},"点此上传图片 支持拖拽上传",-1)),o("div",{class:"text-xs text-[#ffffff4d] mt-3 mx-[50px]"}," 单个文件不超过"+fe($)+"MB，（宽/高）范围：[1/3, 3]，请勿上传gif格式图片 ")],64))])]),_:2},1032,["ratio-size","image-resolution","onSuccess"])]),_:1}),o("div",Pe,[l(se,{modelValue:a(e).type,"onUpdate:modelValue":s[0]||(s[0]=i=>a(e).type=i)},{default:r(()=>[(f(),_(g,null,M(k,(i,m)=>l(ee,{name:i.value,label:i.label,key:m},null,8,["name","label"])),64))]),_:1},8,["modelValue"])]),o("div",Te,[l(z,null,{default:r(()=>[o("div",ze,[l(oe,{model:a(e),"label-position":"top"},{default:r(()=>[a(e).type==a(p).UPPER_LOWER_CLOTHES?(f(),_(g,{key:0},[l(x,{label:"上衣部分"},{default:r(()=>[o("div",Oe,[l(y,{type:"upper_clothes"})])]),_:1}),l(x,{label:"下装部分"},{default:r(()=>[o("div",Fe,[l(y,{type:"lower_clothes"})])]),_:1})],64)):b("",!0),a(e).type==a(p).DRESS?(f(),U(x,{key:1,label:"连衣裙部分"},{default:r(()=>[o("div",Me,[l(y,{type:"upper_clothes"})])]),_:1})):b("",!0),l(x,null,{label:r(()=>[o("div",Ue,[s[5]||(s[5]=o("div",null,[o("div",{class:"text-white"},"模特类型"),o("div",{class:"text-[#ffffff4d] text-[11px]"},"提示：上传模特请选择模特类型图片")],-1)),l(E,{type:"primary",size:"small",onClick:q},{default:r(()=>[...s[4]||(s[4]=[C("更多模特",-1)])]),_:1})])]),default:r(()=>[o("div",Ve,[l(z,null,{default:r(()=>[o("div",We,[l(d,{drag:"","show-progress":"","show-file-list":!1,accept:W,onSuccess:A},{default:r(()=>[o("div",$e,[l(c,{name:"local-icon-file_add",size:28,color:"#ffffff"}),s[6]||(s[6]=o("span",{class:"mt-2 text-[11px] text-[#ffffff80]"},"点击添加模特",-1))])]),_:1}),(f(!0),_(g,null,M(a(u).modelList,(i,m)=>(f(),_("div",{key:m,class:pe(["relative h-[130px] w-full flex-col rounded-md flex items-center justify-center bg-app-bg-3 overflow-hidden border-[2px] border-[#ffffff33] cursor-pointer group",a(e).persons.includes(i.result_image)?"border-primary":""]),onClick:O=>G(i.result_image)},[l(te,{src:i.result_image,class:"w-full h-full",fit:"cover"},null,8,["src"]),o("div",Be,[o("div",{class:"cursor-pointer absolute top-0 right-0",onClick:F(O=>Z(m),["stop"])},[l(c,{name:"local-icon-fullscreen",size:32})],8,He),l(E,{color:"#FF3C26",class:"w-[68px] !h-7 !rounded-full",onClick:O=>K(m)},{default:r(()=>[...s[7]||(s[7]=[C("删除",-1)])]),_:1},8,["onClick"])])],10,je))),128))])]),_:1})])]),_:1})]),_:1},8,["model"])])]),_:1})])]),o("div",Ne,[l(E,{type:"primary",class:"!rounded-full w-[100px] !h-10",onClick:Y},{default:r(()=>[...s[8]||(s[8]=[C(" 优秀案例 ",-1)])]),_:1})]),a(w)?(f(),U(le,{key:0,"initial-index":a(L),"url-list":a(R),onClose:s[1]||(s[1]=i=>w.value=!1)},null,8,["initial-index","url-list"])):b("",!0),l(V,{ref_key:"caseImageRef",ref:P,type:"fashion",onChoose:Q},null,512),l(V,{ref_key:"modelImageRef",ref:D,type:"model",onChoose:J},null,512)],64)}}});export{ls as _};
