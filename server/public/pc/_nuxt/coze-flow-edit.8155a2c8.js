import{d as re,au as de,c as ue,A as y,aG as ie,ak as B,cy as pe,G as g,bb as me,k as f,I as v,s as o,m as d,q as t,a3 as ce,Z as n,v as c,aI as j,l as A,K as L,J as N,c_ as fe,c$ as _e,ai as ge,bK as be,cb as G,y as ve,av as xe,aw as ye,d0 as Ve,d1 as he,ay as Ee,az as ke,cX as we,_ as ze}from"./entry.563c232b.js";import{_ as Ce}from"./index.875ea2c9.js";import{E as Ue,a as Fe}from"./index.8c66fba0.js";import{E as Ie,a as Re}from"./index.b6452ee7.js";import{E as Se}from"./index.9ed38239.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 */import{i as Te,j as De,k as Oe}from"./agent.4a5bb123.js";import{FormFieldTypeEnum as J,CozeTypeEnum as qe}from"./index.11e2700c.js";import{_ as W}from"./coze_bg.d341cb9c.js";import $e from"./agent-logo.4383f5f8.js";import"./index.aabb37e8.js";import"./index.477a7d18.js";import"./cloneDeep.3c027ec4.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./_baseIteratee.4589a236.js";import"./debounce.cf3b8bee.js";import"./toNumber.590accd9.js";import"./raf.af29001c.js";import"./index.941331c1.js";import"./strings.0730af8d.js";import"./clamp.43011008.js";import"./index.be457d98.js";const Be={class:"mt-10"},je={class:"mt-[25px]"},Ae={class:"p-8"},Le={class:"flex w-full gap-x-4"},Ne={class:"w-[351px] flex-shrink-0 pt-6"},Ge={class:"flex-1"},Je={class:"pt-6"},We={class:"absolute right-0 -top-[35px]"},Ke={class:"w-full border border-[var(--el-border-color)] rounded-lg"},Pe={class:"move-icon cursor-move"},Xe={class:"flex items-center justify-between w-full"},Ye={class:"mt-3 w-full border border-[var(--el-border-color)] rounded-lg"},Ze={class:"move-icon cursor-move"},He={class:"flex justify-center mt-4"},Me=re({name:"CozeFlowEdit",__name:"coze-flow-edit",emits:["close","success"],setup(Qe,{expose:K,emit:P}){const E=P,X=de(),Y=ue(()=>{const{shop_logo:s}=X.getWebsiteConfig||{};return s}),V=y(),h=y(),k=y(),w=y(),z=Object.values(J),C=()=>({id:"",name:"",type:qe.FLOW,introduced:"",bg_image:"",coze_id:"",stream:0,avatar:Y.value,permissions:0,output_key:"",outputs:[],inputs:[]}),a=ie(C()),Z={name:[{required:!0,message:"请输入智能体名称"}],introduced:[{required:!0,message:"请输入智能体介绍"}],coze_id:[{required:!0,message:"请输入Coze智能体ID"}],avatar:[{required:!0,message:"请上传智能体logo"}],inputs:[{required:!0,message:"请配置输入参数"}],outputs:[{required:!0,message:"请配置输出参数"}],output_key:[{required:!0,message:"请输入Output_key，按顺序用英文;隔开"}]},H=s=>{const{uri:e}=s.data;a.bg_image=e},M=async()=>{try{const s=await fe(W,"coze_bg.png"),{uri:e}=await _e({file:s});a.bg_image=e}catch(s){console.error("默认背景上传失败:",s)}},U=s=>[{selector:"tbody",options:{animation:150,handle:".move-icon",onEnd:({newIndex:e,oldIndex:m})=>{const i=s.value,u=i.splice(m,1)[0];i.splice(e,0,u),s.value=[...i]}}}],Q=U(B(a,"inputs")),ee=U(B(a,"outputs")),F=(s,e,m={})=>{const i={name:"",type:J.INPUT,fields:"",value:"",...m};s.push(i),ge(()=>{const u=e==="inputs"?k.value:w.value;u==null||u.setScrollTop(s.length*50)})},I=(s,e)=>{s.splice(e,1)},R=(s,e)=>{if(s.some(i=>!i.name||!i.fields))return g.msgError(`请填写完整的${e}参数`),!1;const m=s.map(i=>i.fields);return new Set(m).size!==m.length?(g.msgError(`${e}的字段名称不能重复`),!1):!0},{lockFn:te,isLock:le}=pe(async()=>{var s;if(!a.avatar)return g.msgError("请上传智能体头像");if(await((s=h.value)==null?void 0:s.validate()),!!R(a.inputs,"输入配置")&&R(a.outputs,"输出配置")){a.bg_image||await M();try{await(a.id?Te:De)(a),g.msgSuccess(`${a.id?"编辑":"添加"}成功`),S(),E("success")}catch(e){g.msgError(e)}}}),oe=async()=>{var s;Object.assign(a,C()),(s=h.value)==null||s.clearValidate(),V.value.open()},S=()=>{E("close"),V.value.close()};return K({open:oe,getDetail:async s=>{try{const e=await Oe({id:s});be(e,a),a.outputs=G(e.outputs)?JSON.parse(e.outputs):[],a.inputs=G(e.inputs)?JSON.parse(e.inputs):[]}catch{g.msgError("获取详情失败")}}}),(s,e)=>{const m=ve,i=Ce,u=xe,_=ye,x=Ve,T=he,b=Ee,p=Ue,D=Ie,O=Re,q=Fe,ae=Se,se=ke,ne=we,$=me("draggable");return f(),v(ne,{ref_key:"popupRef",ref:V,async:"",width:"1068px","confirm-button-text":"","cancel-button-text":"","header-class":"!p-0","footer-class":"!p-0",style:{padding:"0"},"show-close":!1},{default:o(()=>[d("div",null,[d("div",{class:"absolute w-6 h-6 flex items-center justify-center rounded-full right-4 top-4 cursor-pointer bg-[#dfdfdf4d]",onClick:S},[t(m,{name:"el-icon-Close",color:"#8B9199"})]),d("div",{class:"w-full h-[235px] bg-cover bg-no-repeat rounded-tl-[20px] rounded-tr-[20px] flex flex-col justify-center items-center",style:ce({backgroundImage:`url(${n(a).bg_image||n(W)})`,backgroundPositionY:"-80px"})},[d("div",Be,[t($e,{modelValue:n(a).avatar,"onUpdate:modelValue":e[0]||(e[0]=l=>n(a).avatar=l)},null,8,["modelValue"])]),d("div",je,[t(i,{limit:1,"show-progress":"","show-file-list":!1,onSuccess:H},{default:o(()=>[...e[7]||(e[7]=[d("div",{class:"w-[72px] h-[29px] flex items-center justify-center rounded-[32px] bg-[#00000066] text-white"}," 更换背景 ",-1)])]),_:1})])],4),d("div",Ae,[e[17]||(e[17]=d("div",{class:"text-lg font-bold"},"新增Coze工作流",-1)),e[18]||(e[18]=d("div",{class:"text-xs text-[#0000004d] mt-2"},"快速搭建对话式智能体",-1)),t(se,{ref_key:"formRef",ref:h,model:n(a),rules:Z,"label-position":"top"},{default:o(()=>[d("div",Le,[d("div",Ne,[t(_,{label:"智能体名称",prop:"name"},{default:o(()=>[t(u,{modelValue:n(a).name,"onUpdate:modelValue":e[1]||(e[1]=l=>n(a).name=l),class:"!h-10",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),t(_,{label:"智能体介绍",prop:"introduced"},{default:o(()=>[t(u,{modelValue:n(a).introduced,"onUpdate:modelValue":e[2]||(e[2]=l=>n(a).introduced=l),type:"textarea",placeholder:"请输入智能体的说明",resize:"none",rows:6},null,8,["modelValue"])]),_:1}),t(_,{label:"Coze智能体ID",prop:"coze_id"},{default:o(()=>[t(u,{modelValue:n(a).coze_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n(a).coze_id=l),class:"!h-10",placeholder:"请输入Coze智能体ID"},null,8,["modelValue"])]),_:1}),t(_,{label:"输出方式",prop:"stream"},{default:o(()=>[t(T,{modelValue:n(a).stream,"onUpdate:modelValue":e[4]||(e[4]=l=>n(a).stream=l)},{default:o(()=>[t(x,{value:1,disabled:""},{default:o(()=>[...e[8]||(e[8]=[c("流式输出",-1)])]),_:1}),t(x,{value:0},{default:o(()=>[...e[9]||(e[9]=[c("直接返回",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),d("div",Ge,[t(ae,null,{default:o(()=>[d("div",Je,[t(_,{label:"输入配置（每个字段值不能重复）",prop:"inputs",class:"relative"},{default:o(()=>[d("div",We,[t(b,{type:"primary",size:"small",onClick:e[5]||(e[5]=l=>F(n(a).inputs,"inputs",{required:"true"}))},{default:o(()=>[...e[10]||(e[10]=[c(" 新增 ",-1)])]),_:1})]),d("div",Ke,[j((f(),v(q,{ref_key:"inputTableRef",ref:k,class:"inout-table",data:n(a).inputs,stripe:"","max-height":"200px","row-style":{height:"40px"},"header-cell-style":{height:"40px"}},{default:o(()=>[t(p,{width:"50px"},{default:o(()=>[d("div",Pe,[t(m,{name:"el-icon-Rank"})])]),_:1}),t(p,{label:"名称"},{default:o(({row:l})=>[t(u,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"类型"},{default:o(({row:l})=>[t(O,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,placeholder:"请选择"},{default:o(()=>[(f(!0),A(N,null,L(n(z),r=>(f(),v(D,{label:r,value:r,key:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"字段值"},{default:o(({row:l})=>[t(u,{modelValue:l.fields,"onUpdate:modelValue":r=>l.fields=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"是否必填"},{default:o(({row:l})=>[t(T,{modelValue:l.required,"onUpdate:modelValue":r=>l.required=r},{default:o(()=>[t(x,{value:"true"},{default:o(()=>[...e[11]||(e[11]=[c("是",-1)])]),_:1}),t(x,{value:"false"},{default:o(()=>[...e[12]||(e[12]=[c("否",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"操作",width:"80px"},{default:o(({$index:l})=>[t(b,{type:"danger",size:"small",onClick:r=>I(n(a).inputs,l)},{default:o(()=>[...e[13]||(e[13]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,n(Q)]])])]),_:1}),t(_,{label:"输出配置（每个字段值不能重复）",prop:"outputs",class:"relative"},{default:o(()=>[d("div",Xe,[t(b,{type:"primary",size:"small",onClick:e[6]||(e[6]=l=>F(n(a).outputs,"outputs"))},{default:o(()=>[...e[14]||(e[14]=[c(" 新增 ",-1)])]),_:1})]),d("div",Ye,[j((f(),v(q,{ref_key:"outputTableRef",ref:w,data:n(a).outputs,stripe:"","max-height":"200px","row-style":{height:"40px"},"header-cell-style":{height:"40px"}},{default:o(()=>[t(p,{width:"50px"},{default:o(()=>[d("div",Ze,[t(m,{name:"el-icon-Rank"})])]),_:1}),t(p,{label:"名称"},{default:o(({row:l})=>[t(u,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"类型"},{default:o(({row:l})=>[t(O,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,placeholder:"请选择"},{default:o(()=>[(f(!0),A(N,null,L(n(z),r=>(f(),v(D,{label:r,value:r,key:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"字段值"},{default:o(({row:l})=>[t(u,{modelValue:l.fields,"onUpdate:modelValue":r=>l.fields=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"操作",width:"80px"},{default:o(({$index:l})=>[t(b,{type:"danger",size:"small",onClick:r=>I(n(a).outputs,l)},{default:o(()=>[...e[15]||(e[15]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,n(ee)]])])]),_:1})])]),_:1})])])]),_:1},8,["model"]),d("div",He,[t(b,{color:"#000000",class:"!rounded-full !h-[50px] w-[310px] shadow-[0_6px_12px_0px_#0065FB33]",loading:n(le),onClick:n(te)},{default:o(()=>[...e[16]||(e[16]=[c(" 保存 ",-1)])]),_:1},8,["loading","onClick"])])])])]),_:1},512)}}});const Ft=ze(Me,[["__scopeId","data-v-289a359c"]]);export{Ft as default};
