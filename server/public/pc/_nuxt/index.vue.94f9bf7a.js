import{d as y,z as G,r as c,G as w,aG as E,bC as v,k as h,l as O,q as p,s as M,m as S,Z as l}from"./entry.9c858de7.js";import{o as x}from"./drawing.7058a163.js";import{drawTypeEnumMap as A,DrawTypeEnum as C}from"./index.fb0aa6a9.js";import I from"./useCreateForm.a5057b52.js";import T from"./useDrawingTask.4da036d9.js";import b from"./result-content.b77573f3.js";import{E as Y}from"./index.d2366752.js";const B={class:"h-full relative w-full"},j={class:"px-[10px]"},q=y({__name:"index",setup(z){let r;(s=>{s[s.GOODS_IMAGE=A[C.GOODS_IMAGE]]="GOODS_IMAGE"})(r||(r={}));const f=G(),{onEvent:_,setFormData:d}=I(),n=c([]),t=c(!1);_("update:formData",async s=>{var m;if(t.value){w.msgWarning("请等待上一次任务完成");return}t.value=!0;const{type_name:i,style_name:D,params:a}=s,e=E({date:v().format("YYYY-MM-DD HH:mm"),prompt:a.prompt,tags:[(m=a.resolution)==null?void 0:m.join("*"),i,D,a.template_name_zh],images:[],formData:s});n.value.unshift(e);try{e.images=new Array(parseInt(a.img_count)).fill({url:"",loading:!0,progress:0,status:0,error:!1});const{result:u}=await x(a),{processDrawingTask:o}=T({type:r.GOODS_IMAGE,task_id:u.task_id,dataLists:e.images});await o({callback:k=>{e.images=k}}),f.getUser()}catch{e.images=e.images.map(o=>({...o,loading:!1,progress:0,status:4,error:!0}))}finally{t.value=!1}});const g=s=>{d(s)};return(s,i)=>(h(),O("div",B,[p(l(Y),null,{default:M(()=>[S("div",j,[p(b,{"result-lists":l(n),"is-all-tasks-completed":l(t),onRetry:g},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{q as _};
