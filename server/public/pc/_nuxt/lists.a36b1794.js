import{d as U,aG as q,r as k,G as u,o as O,k as v,l as E,m as s,q as o,s as a,v as _,Z as d,dF as J,aI as K,I as T,bM as X,cX as Y,L as Z,J as z,ai as H,ay as Q,dG as ee,d1 as oe,y as te,av as se,cY as ae,u as ne,_ as le}from"./entry.45b56a4a.js";import{E as ie,a as de}from"./index.b74582d2.js";import{E as ce}from"./index.0b13dd01.js";import{E as re}from"./el-empty.2f864f77.js";import{_ as pe}from"./index.vue.96e940f8.js";/* empty css                        *//* empty css                        *//* empty css               *//* empty css                   *//* empty css                 *//* empty css                     */import{u as ue}from"./usePaging.9b885ff9.js";import{ac as me,ad as fe,I as ve}from"./person_wechat.703f63bb.js";import _e from"./useWeChatWs.60d07f69.js";import{MsgTypeEnum as n}from"./index.cf59f1a8.js";import"./index.515d6243.js";import"./_baseIteratee.2c25c469.js";import"./debounce.794d1e19.js";import"./toNumber.7157a344.js";import"./raf.d3c38821.js";import"./index.def52f2a.js";import"./index.386b5c03.js";import"./strings.2a3b34b9.js";import"./clamp.2ad9aed4.js";import"./index.1bb131e0.js";import"./useWebSocket.0fc12c13.js";const ge={class:"h-full flex flex-col bg-white rounded-lg"},he={class:"flex items-center justify-between flex-shrink-0 p-4"},ye={class:"flex items-center justify-end gap-2 grow"},Ce={class:"grow min-h-0 flex flex-col overflow-hidden"},xe={class:"grow min-h-0"},we={key:0,class:"flex items-center gap-2"},ke={key:1,class:"flex items-center gap-2"},Ee={class:"flex flex-col gap-2"},be=["onClick"],De=["onClick"],Ie={class:"flex justify-end p-4"},Te={class:"flex flex-col gap-y-4"},Ae=U({__name:"lists",setup(Ve){const b=ne(),h=q({device_status:""}),{pager:m,getLists:c}=ue({fetchFun:me,params:h}),g=k(!1),D=k(),f=k(""),{on:y,send:A,isConnected:V,addDeviceLoading:I,actionType:C}=_e();y("message",t=>{const{MsgType:e}=t;e===n.CleanCache&&u.msgSuccess("清除缓存成功"),(e==n.WeChatOfflineNotice||e==n.WeChatOnlineNotice)&&c()}),y("success",t=>{t.type==="add-device"&&(g.value=!1,c())}),y("action",async t=>{const{type:e,accessToken:i,deviceId:r,wechatId:w}=t;e===n.CleanCache&&(x(n.CleanCache,{deviceId:r,accessToken:i,wechatId:w}),C.value=void 0)});function x(t,e={}){if(![n.AddDevice,n.Auth,n.CleanCache].includes(t))return;const r={DeviceId:e.deviceId,AccessToken:e.accessToken,WeChatId:e.wechatId,TaskId:e.TaskId||Date.now()};A({MsgType:t,Content:r})}const B=async()=>{var t;f.value="",g.value=!0,await H(),(t=D.value)==null||t.open()},P=async()=>{if(!V.value){u.msgError("网络连接失败，请检查网络");return}if(!f.value)return u.msgError("请输入您的设备授权码");C.value=n.AddDevice,I.value=!0,x(n.AddDevice,{deviceId:f.value})},R=async t=>{b.$confirm({message:"确定要移除设备吗？此操作不可逆！",onConfirm:async()=>{u.loading("移除中...");try{await fe({id:t.id,device_code:t.device_code}),await ve({device_code:t.device_code,is_used:!1}),u.msgSuccess("移除成功"),c()}catch(e){u.msgError(e||"移除失败")}finally{u.closeLoading()}}})},L=async t=>{b.$confirm({message:"确定要清除该设备的缓存吗？",onConfirm:async()=>{C.value=n.CleanCache,x(n.Auth,{deviceId:t.device_code})}})};return O(()=>{c()}),(t,e)=>{const i=Q,r=ee,w=oe,p=ie,N=te,$=ce,M=re,j=de,G=pe,W=se,F=ae;return v(),E(z,null,[s("div",ge,[s("div",he,[o(i,{type:"primary",onClick:B},{default:a(()=>[...e[4]||(e[4]=[_("新增设备",-1)])]),_:1}),s("div",ye,[o(w,{modelValue:h.device_status,"onUpdate:modelValue":e[0]||(e[0]=l=>h.device_status=l),onChange:d(c)},{default:a(()=>[o(r,{label:"全部",value:""}),o(r,{label:"在线",value:1}),o(r,{label:"离线",value:0})]),_:1},8,["modelValue","onChange"]),o(i,{icon:d(J),onClick:d(c)},null,8,["icon","onClick"])])]),s("div",Ce,[s("div",xe,[K((v(),T(j,{data:d(m).lists,stripe:"",height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:a(()=>[o(M,{description:"暂无数据"})]),default:a(()=>[o(p,{prop:"device_model",label:"设备型号","min-width":"120"}),o(p,{prop:"status",label:"状态",width:"80"},{default:a(({row:l})=>[l.device_status===1?(v(),E("div",we,[...e[5]||(e[5]=[s("div",{class:"w-2 h-2 bg-success rounded-full"},null,-1),_(" 在线 ",-1)])])):(v(),E("div",ke,[...e[6]||(e[6]=[s("div",{class:"w-2 h-2 bg-danger rounded-full"},null,-1),_(" 离线 ",-1)])]))]),_:1}),o(p,{prop:"device_code",label:"设备码","min-width":"160"}),o(p,{prop:"wechat_id",label:"微信ID",width:"180"}),o(p,{prop:"sdk_version",label:"SDK版本","min-width":"160"}),o(p,{prop:"create_time",label:"创建时间",width:"180"}),o(p,{label:"操作",width:"100",fixed:"right"},{default:a(({row:l})=>[o($,{"show-arrow":!1,"popper-class":"!w-[120px] !min-w-[120px] !p-[6px] !rounded-xl"},{reference:a(()=>[o(i,{link:""},{default:a(()=>[o(N,{name:"el-icon-MoreFilled"})]),_:1})]),default:a(()=>[s("div",Ee,[s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer",onClick:S=>R(l)},[o(i,{link:"",icon:"el-icon-Close",class:"w-full !justify-start"},{default:a(()=>[...e[7]||(e[7]=[_("移除设备",-1)])]),_:1})],8,be),s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer",onClick:S=>L(l)},[o(i,{link:"",icon:"el-icon-Delete",class:"w-full !justify-start"},{default:a(()=>[...e[8]||(e[8]=[_("清除缓存",-1)])]),_:1})],8,De)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[F,d(m).loading]])]),s("div",Ie,[o(G,{modelValue:d(m),"onUpdate:modelValue":e[1]||(e[1]=l=>X(m)?m.value=l:null),onChange:d(c)},null,8,["modelValue","onChange"])])])]),g.value?(v(),T(Y,{key:0,ref_key:"addDevicePopupRef",ref:D,title:"添加设备",async:"","confirm-button-text":"确认绑定","confirm-loading":d(I),onClose:e[3]||(e[3]=l=>g.value=!1),onConfirm:P},{default:a(()=>[s("div",Te,[o(W,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value=l),placeholder:"请输入您的设备授权码",clearable:"",class:"!h-[48px]"},null,8,["modelValue"])])]),_:1},8,["confirm-loading"])):Z("",!0)],64)}}});const so=le(Ae,[["__scopeId","data-v-0a2fce30"]]);export{so as default};
