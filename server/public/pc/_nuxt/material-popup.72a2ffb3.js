import{d as ne,r as v,aG as ae,A as ie,c as re,l as n,q as r,s as h,cX as ce,Z as l,I as y,L as c,J as T,k as o,m as a,cZ as ue,$ as de,v as G,bM as pe,aI as O,K as fe,t as me,a0 as _e,G as D,y as ve,av as he,ay as ye,ba as xe,cY as ge,ai as be,_ as we}from"./entry.563c232b.js";import{_ as Ee}from"./index.vue.96af9406.js";import{E as ke,a as Ie}from"./el-tabs.a314917a.js";import{E as Ve}from"./el-image.3350cb2d.js";import{_ as Ce}from"./index.vue.30be4301.js";import{E as Te}from"./el-empty.92ad44f2.js";import{_ as De}from"./index.vue.ff9e1552.js";import{E as Le}from"./el-image-viewer.164b39e3.js";import{u as Me}from"./usePaging.4417e13f.js";import{g as Pe,b as $e}from"./matrix.418b34fe.js";import{k as Be}from"./digital_human.299b9036.js";import{MaterialTypeEnum as u}from"./index.db2ee73f.js";import{E as Re}from"./index.4640bbe0.js";import"./raf.af29001c.js";import"./strings.0730af8d.js";import"./clamp.43011008.js";import"./toNumber.590accd9.js";import"./index.bd937a87.js";import"./throttle.4081a158.js";import"./debounce.cf3b8bee.js";const je={class:"rounded-xl overflow-hidden flex flex-col -my-2"},Ae={class:"flex items-center justify-between h-[50px] px-4"},Ge={class:"flex items-center gap-x-2"},Oe={class:"w-6 h-6 flex items-center justify-center rounded-md border border-[#ffffff1a]"},Ue={class:"px-4 my-4"},Ne={class:"flex items-center rounded-full h-[50px] border border-[#2a2a2a] px-[5px]"},Se={key:0,class:"px-4"},ze=["infinite-scroll-disabled"],Ke={class:"h-full"},Fe={key:0},qe={class:"grid grid-cols-3 gap-2 p-2"},Ze=["onClick"],He={class:"card-gradient cursor-pointer bg-black w-full relative h-[210px] flex flex-col overflow-hidden rounded-xl"},Je={class:"w-full px-3 absolute z-[22] top-2 pr-[50px]"},We={class:"line-clamp-1 text-white break-all"},Xe=["src"],Ye=["src"],Qe={class:"absolute top-2 right-2 z-[1000] w-6 h-6 rounded-full"},et={key:2,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},tt=["onClick"],ot={key:0,class:"text-white text-center text-xs w-full py-4"},lt={key:1,class:"h-full flex items-center justify-center"},st={key:1,class:"flex justify-center my-2 px-2"},nt=ne({__name:"material-popup",props:{type:{default:u.IMAGE},limit:{default:9},multiple:{type:Boolean,default:!0},showTab:{type:Boolean,default:!0}},emits:["close","confirm"],setup(k,{expose:U,emit:N}){const i=k,L=N,M=v(),p=v("material"),_=ae({name:"",page_no:1}),d=v([]),x=ie(),m=v(!1),P=v([]),$=re(()=>!f.isLoad||f.loading),S={material:t=>Pe({...t,m_type:i.type}),dh:t=>$e({...t,status:6}),dh_v2:t=>Be({...t,type:0,status:1})},{pager:f,getLists:B,resetPage:z}=Me({fetchFun:t=>S[p.value](t),params:_,isScroll:!0}),K=t=>{p.value=t.paneName,d.value=[],g()},g=()=>{_.page_no=1,z()},R=t=>d.value.some(e=>e.id==t.id),F=t=>{if(R(t))d.value=d.value.filter(e=>e.id!==t.id);else{if(d.value.length>=i.limit){D.msgWarning(`最多只能选择${i.limit}个素材`);return}d.value.push(t)}i.multiple||A()},j=t=>{const{automatic_clip:e,clip_result_url:w,result_url:I,video_result_url:V,content:E}=t;return p.value==="material"?E||"":e===1?w||"":p.value==="dh_v2"?I||"":V||""},A=()=>{if(d.value.length===0){D.msgError("请选择素材");return}const t=d.value.map(e=>({url:i.type===u.VIDEO?j(e):e.content,name:e.name,pic:e.pic}));L("confirm",t),b()},q=async t=>{if(m.value=!0,i.type===u.IMAGE){P.value=[t.content];return}if(i.type===u.VIDEO){await be();const e=j(t);e&&x.value?(x.value.setUrl(e),x.value.open()):(D.msgError("视频地址无效，无法预览"),m.value=!1)}},Z=async()=>{$.value||(_.page_no+=1,await B())},H=async()=>{var t;(t=M.value)==null||t.open(),f.lists.length===0&&B()},b=()=>{L("close")};return U({open:H,close:b}),(t,e)=>{const w=ve,I=Ee,V=he,E=ye,C=ke,J=Ie,W=xe,X=Ve,Y=Ce,Q=Te,ee=De,te=Le,oe=ge,le=Re;return o(),n(T,null,[r(ce,{ref_key:"popupRef",ref:M,width:"528px",style:{padding:"0","background-color":"var(--app-bg-color-2)","box-shadow":"0px 0px 0px 1px var(--app-border-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,onClose:b},{default:h(()=>[a("div",je,[a("div",Ae,[a("div",Ge,[a("div",Oe,[r(w,{name:"local-icon-windows",size:14})]),e[4]||(e[4]=a("div",{class:"text-[20px] text-white font-bold"},"素材库",-1))]),a("div",{class:"w-6 h-6 cursor-pointer",onClick:b},[r(I,{theme:l(ue).DARK},null,8,["theme"])])]),a("div",Ue,[a("div",Ne,[r(V,{modelValue:l(_).name,"onUpdate:modelValue":e[0]||(e[0]=s=>l(_).name=s),class:"flex-1 search-input",clearable:"","prefix-icon":"el-icon-Search",placeholder:"请输入素材名称","input-style":"color: #ffffff",onClear:g,onKeyup:de(g,["enter"])},null,8,["modelValue"]),r(E,{type:"primary",class:"!text-white !rounded-full !w-[116px] !h-10",onClick:g},{default:h(()=>[...e[5]||(e[5]=[G(" 搜索 ",-1)])]),_:1})])]),k.showTab?(o(),n("div",Se,[r(J,{modelValue:l(p),"onUpdate:modelValue":e[1]||(e[1]=s=>pe(p)?p.value=s:null),class:"!text-white",onTabClick:K},{default:h(()=>[r(C,{name:"material",label:"素材库"},null,8,["name"]),i.type===l(u).VIDEO?(o(),y(C,{key:0,name:"dh",label:"数字人v1"},null,8,["name"])):c("",!0),i.type===l(u).VIDEO?(o(),y(C,{key:1,name:"dh_v2",label:"数字人v2"},null,8,["name"])):c("",!0)]),_:1},8,["modelValue"])])):c("",!0),O((o(),n("div",{class:"h-[600px] overflow-y-auto relative dynamic-scroller","infinite-scroll-immediate":!1,"infinite-scroll-disabled":l($),"infinite-scroll-distance":10},[O((o(),n("div",Ke,[l(f).lists.length>0?(o(),n("div",Fe,[a("div",qe,[(o(!0),n(T,null,fe(l(f).lists,s=>(o(),n("div",{key:s.id,onClick:se=>F(s)},[a("div",He,[a("div",Je,[r(W,{content:s.name},{default:h(()=>[a("div",We,me(s.name),1)]),_:2},1032,["content"])]),i.type===l(u).IMAGE?(o(),y(X,{key:0,src:s.content,class:"w-full h-full rounded-xl","preview-teleported":"",fit:"cover"},null,8,["src"])):c("",!0),i.type===l(u).VIDEO?(o(),n(T,{key:1},[s.pic?(o(),n("img",{key:0,src:s.pic,class:"w-full h-full rounded-xl object-cover"},null,8,Xe)):(o(),n("video",{key:1,src:s.content||s.video_result_url,class:"w-full h-full rounded-xl object-cover"},null,8,Ye))],64)):c("",!0),a("div",Qe,[r(w,{name:"local-icon-success_fill",size:20,color:R(s)?"var(--color-primary)":"#ffffff1a"},null,8,["color"])]),i.type===l(u).VIDEO?(o(),n("div",et,[a("div",{onClick:_e(se=>q(s),["stop"])},[r(Y)],8,tt)])):c("",!0)])],8,Ze))),128))]),l(f).isLoad?c("",!0):(o(),n("div",ot,"暂无更多了~"))])):(o(),n("div",lt,[r(Q,{description:"暂无数据"})]))])),[[oe,l(f).loading]])],8,ze)),[[le,Z]]),k.multiple?(o(),n("div",st,[r(E,{type:"primary",class:"!rounded-full w-[318px] !h-[50px]",onClick:A},{default:h(()=>[...e[6]||(e[6]=[G(" 确定 ",-1)])]),_:1})])):c("",!0)])]),_:1},512),l(m)?(o(),y(ee,{key:0,ref_key:"previewVideoRef",ref:x,onClose:e[2]||(e[2]=s=>m.value=!1)},null,512)):c("",!0),l(m)&&i.type===l(u).IMAGE?(o(),y(te,{key:1,"initial-index":0,"url-list":l(P),onClose:e[3]||(e[3]=s=>m.value=!1)},null,8,["url-list"])):c("",!0)],64)}}});const Vt=we(nt,[["__scopeId","data-v-cbfea348"]]);export{Vt as default};
