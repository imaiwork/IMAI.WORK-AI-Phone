import{z as l,aH as f,el as u,em as a,e9 as s,cb as O,G as _}from"./entry.8705b591.js";import{u as g}from"./useWebSocket.6040c56b.js";const T="1.0.0";function w(C){const v=l(),{userInfo:I}=f(v),S=`wss://${location.host}/wss`,{on:t,send:m,isConnected:d,reconnect:N}=g(S,{...C}),c=(e,o)=>{const n=i.get(e);n&&n(o)},i=new Map,R=(e,o)=>{i.set(e,o)},E=e=>{if(!d.value){_.msgError(a[s.CONNECT_ERROR]);return}const{appType:o}=e;return m({type:e.type,content:{...e.content,userId:I.value.id,deviceId:e.deviceId||void 0,accountType:e.accountType},deviceId:e.deviceId||"",messageId:Date.now(),appVersion:T,appType:o})};return t("open",()=>{c("open"),E({type:u.BIND_WS,content:{type:u.BIND_WS,sourceType:"pc"}})}),t("close",()=>{c("close",{error:a[s.CONNECT_ERROR],code:s.CONNECT_ERROR})}),t("error",e=>{c("error",e)}),t("message",e=>{let{type:o,code:n,content:r,deviceId:p}=e;if(r=O(r)?JSON.parse(r):r,n==s.SUCCESS)switch(n){case s.SUCCESS:case s.INIT_COMPLETE:case s.CHECK_INIT:case s.DEVICE_ONLINE:c("success",{...e,content:r});break;default:c("error",{error:r.msg,code:s.PUSH_MESSAGE_ERROR,deviceCode:p});break}else{if(o=="pong")return;c("error",{error:r.msg,type:o,code:n,content:r,deviceCode:p})}}),{on:t,send:E,reconnect:N,isConnected:d,onEvent:R}}export{w as u};
