import{E as U,a as W}from"./el-breadcrumb.9749e593.js";import{d as Z,r as p,o as X,k as r,l as c,m as a,q as u,s as _,Y as L,Z as o,t as h,I as E,L as d,cs as tt,v as j,aI as et,J as I,K as st,bO as P,ai as S,dH as ot,ay as at,y as it,cY as nt,u as rt,_ as lt}from"./entry.8705b591.js";import{an as pt,ao as ct}from"./person_wechat.703f63bb.js";import{PushTypeEnum as K,SendWayEnum as mt}from"./index.a1206616.js";import ut from"./useTask.212c67d3.js";import{_ as dt}from"./send-name.vue.7214cc30.js";import{_ as ft}from"./send-container.vue.a7d543eb.js";import{_ as _t}from"./send-flow.vue.9558e14b.js";import"./index.d5b2ab73.js";import"./el-empty.a2e85def.js";/* empty css                     */import"./7_day.257301c1.js";import"./material-edit.30d61049.js";import"./el-input-number.1be09075.js";import"./index.506eb19c.js";import"./el-time-picker.bab9fa53.js";import"./customParseFormat.cc1515cd.js";import"./panel-time-pick.d92b5a96.js";import"./debounce.4efe57e2.js";import"./toNumber.9701a4c1.js";import"./index.7002e1fb.js";import"./index.d9a24f65.js";import"./strings.05ad2423.js";import"./_baseIteratee.889eaccd.js";import"./clamp.2d199c02.js";import"./index.f9213b2f.js";import"./index.92324cf0.js";/* empty css                  */import"./add-content.be1a3b43.js";import"./el-tabs.5286b06f.js";import"./raf.11208e2e.js";import"./index.554f7908.js";import"./el-alert.787fd274.js";import"./index.656bf02e.js";import"./index.vue.a44fb124.js";import"./index.4557d148.js";import"./index.b44dd729.js";import"./index.b617bec7.js";import"./cloneDeep.699e051d.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./el-image.1d071b41.js";import"./el-image-viewer.98cbed9e.js";import"./throttle.2aefc6f7.js";import"./index.vue.f28f8d8c.js";/* empty css                   */import"./arrow_down.70a5466c.js";import"./dom.7f5b5a10.js";import"./index.cf59f1a8.js";import"./emoji.vue.7b2a2c2d.js";import"./useHandle.727f0a04.js";import"./mini-program-card.vue.1b3fb3a1.js";import"./material-picker.vue.1500e13c.js";import"./index.vue.ae829252.js";import"./sidebar.dbf9f474.js";import"./useMaterial.620c90d2.js";import"./usePaging.0c251ebb.js";import"./container.2a22fc41.js";/* empty css                  *//* empty css               */import"./index.vue.c79afe88.js";import"./upload.42060dd8.js";import"./preview.vue.9d7f1717.js";import"./link-card.vue.b31b34fe.js";import"./file-card.vue.d1c72cc2.js";import"./send-date.vue.b4a8e850.js";import"./file-item.vue.4d4a3149.js";import"./send-date-preview.vue.6c6f75ad.js";import"./send-container-item.3bb8aa28.js";import"./date.95a59cef.js";const vt={class:"h-full flex flex-col"},yt={class:"flex items-center justify-between bg-white p-4 rounded-lg flex-shrink-0"},xt={class:"flex justify-center"},ht={class:"grow min-h-0 bg-white rounded-lg mt-4 p-6"},kt={key:0,class:"step-container h-full flex flex-col"},gt={class:"grow min-h-0 w-[680px] flex flex-col gap-10"},wt={class:"px-8 mt-8 flex gap-4"},Ct=["src"],bt={class:"flex flex-col gap-2"},Et={class:"font-bold text-[20px]"},St={class:"text-lg text-[#8A8C99]"},Ft={class:"flex justify-end px-3 mt-4"},Dt={key:0,class:"flex items-center gap-2"},Bt=["onClick"],$t={key:1,class:"h-full flex flex-col gap-x-4"},It={class:"mb-4 text-lg text-[#8A8C99]"},Pt=Z({__name:"create-panel",emits:["back"],setup(At,{expose:V,emit:O}){const z=O,Q=rt(),l=p("name"),{resource:F}=ut(),f=p([{img:F.CreateImg,title:"给您的任务起个名字",desc:"请输入一个独特的名称，以便更好的管理和识别",status:0,key:"name"},{img:F.ContentImg,title:"设置您需要推送的内容",desc:"选择并配置您希望目标对象接收的推送信息和推送类型",status:0,key:"content"},{img:F.PostImg,title:"选择您希望推送的人员",desc:"请从列表中选择人员或组，您可以根据需要随时调整选择。",status:0,key:"people"}]),i=p(null),D=p(),k=p(!1),B=p(),g=p(),w=p(!1),Y=async e=>{k.value=!1,await v((e==null?void 0:e.id)||i.value.id),P({id:(e==null?void 0:e.id)||i.value.id})},q=async()=>{w.value=!1,v(i.value.id)},G=async e=>{var s,b,y,x;if(e.key=="people"){w.value=!0,await S(),(s=g.value)==null||s.open(),i.value&&((b=g.value)==null||b.setFormData(i.value));return}l.value=e.key;const{key:t}=e;t=="name"?(k.value=!0,await S(),(y=D.value)==null||y.open(),i.value&&((x=D.value)==null||x.setFormData(i.value))):t=="content"&&N(),P({step:l.value})},A=()=>{z("back")},H=()=>{Q.$confirm({message:"确定取消吗？",onConfirm:()=>{A()}})},$=()=>{l.value="name",P({step:l.value})},C=p(!1),v=async e=>{if(e){C.value=!0;try{const t=await pt({id:e});i.value=t,t.push_name&&f.value.forEach(s=>{s.key=="name"&&(s.status=1)}),t.push_time_list&&t.push_time_list.length&&(N(),f.value.forEach(s=>{s.key=="content"&&(s.status=1)})),t.flow_id&&(J(),f.value.forEach(s=>{s.key=="people"&&(s.status=1)}))}finally{C.value=!1}}},N=async()=>{var t,s;await S(),(t=B.value)==null||t.setFormData(i.value);const e=await ct({push_id:i.value.id});(s=B.value)==null||s.setDateList(e)},J=async()=>{var e;await S(),(e=g.value)==null||e.setFormData(i.value)};return X(async()=>{const{id:e,step:t}=ot();t&&f.value.some(s=>s.key==t)?l.value=t:l.value="name",e&&v(e)}),V({getDetail:v}),(e,t)=>{var R,T;const s=U,b=W,y=at,x=it,M=nt;return r(),c(I,null,[a("div",vt,[a("div",yt,[a("div",null,[u(b,{"separator-icon":o(tt)},{default:_(()=>[u(s,null,{default:_(()=>[a("span",{class:"cursor-pointer text-[#8A8C99] hover:text-primary",onClick:A}," 任务管理 ")]),_:1}),u(s,null,{default:_(()=>{var n;return[a("span",{class:L({"cursor-pointer text-[#8A8C99] hover:text-primary":o(l)=="content"}),onClick:$},h(((n=o(i))==null?void 0:n.push_name)||"新建任务"),3)]}),_:1}),o(l)=="content"?(r(),E(s,{key:0},{default:_(()=>[...t[3]||(t[3]=[a("span",null," 设置推送内容 ",-1)])]),_:1})):d("",!0)]),_:1},8,["separator-icon"])]),a("div",xt,[u(y,{type:"primary",class:"!h-10 w-[100px] !rounded-full",onClick:H},{default:_(()=>[...t[4]||(t[4]=[j("取消",-1)])]),_:1}),o(l)!="name"?(r(),E(y,{key:0,class:"!h-10 w-[100px] !rounded-full",onClick:$},{default:_(()=>[...t[5]||(t[5]=[j("返回",-1)])]),_:1})):d("",!0)])]),et((r(),c("div",ht,[o(C)?d("",!0):(r(),c(I,{key:0},[o(l)=="name"?(r(),c("div",kt,[a("div",gt,[(r(!0),c(I,null,st(o(f),(n,m)=>(r(),c("div",{key:m,class:"h-[149px] rounded-2xl border border-primary-light-8 relative"},[a("div",{class:L(["absolute top-0 right-0 rounded-tr-2xl rounded-bl-2xl w-[100px] p-2 text-center text-white text-lg font-bold",[n.status==1?"bg-success":"bg-primary"]])},h(n.status==1?"已设置":`第${m+1}步`),3),a("div",wt,[a("img",{src:n.img,alt:"",class:"w-[56px] h-[56px]"},null,8,Ct),a("div",bt,[a("div",Et,h(n.title),1),a("div",St,h(n.desc),1)])]),a("div",Ft,[m!=0&&n.status==0&&o(f)[m-1].status==0?(r(),c("div",Dt,[t[6]||(t[6]=a("span",{class:"opacity-50 text-primary"}," 您还未完成上一步",-1)),u(x,{name:"el-icon-QuestionFilled",color:"#5580F9"})])):(r(),c("div",{key:1,class:"cursor-pointer flex items-center gap-2",onClick:Rt=>G(n)},[t[7]||(t[7]=a("span",{class:"hover:underline text-primary"},"前往设置",-1)),u(x,{name:"el-icon-Right",size:16,color:"var(--color-primary)"})],8,Bt))])]))),128))])])):d("",!0),o(l)=="content"?(r(),c("div",$t,[a("div",It,"推送时间："+h(o(i).push_day),1),u(ft,{ref_key:"sendContainerRef",ref:B,type:o(K).TASK,"task-id":(R=o(i))==null?void 0:R.id,"push-day":(T=o(i))==null?void 0:T.push_day,onBack:$,onSuccess:t[0]||(t[0]=n=>{var m;return v((m=o(i))==null?void 0:m.id)})},null,8,["type","task-id","push-day"])])):d("",!0)],64))])),[[M,o(C)]])]),o(k)?(r(),E(dt,{key:0,ref_key:"nameEditRef",ref:D,type:o(K).TASK,onSuccess:Y,onClose:t[1]||(t[1]=n=>k.value=!1)},null,8,["type"])):d("",!0),o(w)?(r(),E(_t,{key:1,ref_key:"sendFlowRef",ref:g,type:o(mt).GROUP_SEND,onSuccess:q,onClose:t[2]||(t[2]=n=>w.value=!1)},null,8,["type"])):d("",!0)],64)}}});const Xe=lt(Pt,[["__scopeId","data-v-0b3a4096"]]);export{Xe as default};
