import{d as qe,bP as Je,a as Ke,aH as Ze,dH as Qe,c as T,r as h,aG as pe,bC as me,A as Xe,cy as et,l as v,m as t,q as _,s as y,Z as s,J as C,K as P,t as x,L as b,I as $,bO as tt,G as M,dw as st,c$ as ot,ai as X,ay as it,u as lt,k as r,v as H,Y as A,cZ as at,y as nt,_ as rt}from"./entry.8705b591.js";import{_ as ct}from"./index.vue.3f013733.js";import{E as ut,a as pt}from"./index.7002e1fb.js";import{E as mt}from"./el-alert.787fd274.js";import{E as ft}from"./el-time-picker.bab9fa53.js";import{_ as dt}from"./index.vue.f28f8d8c.js";/* empty css                  *//* empty css               *//* empty css                     */import{u as vt}from"./useSocialPlatform.11688b4f.js";import{g as _t,a as xt,p as ht}from"./device.b8ac970d.js";import{PublishTaskTypeEnum as w,MaterialTypeEnum as fe,SidebarTypeEnum as gt,MaterialActionType as yt}from"./index.db2ee73f.js";import bt from"./content-copywriting-material.7c1decd0.js";import{_ as de}from"./copywriting-card.vue.4a702175.js";import ve from"./material-picker.de74b54a.js";import wt from"./material-popup.e0a94599.js";import kt from"./useMaterial.99860a26.js";import{validateSchedule as Ct}from"./utils.82b5f057.js";import{E as ee}from"./index.d5b2ab73.js";import"./index.d9a24f65.js";import"./strings.05ad2423.js";import"./_baseIteratee.889eaccd.js";import"./toNumber.9701a4c1.js";import"./clamp.2d199c02.js";import"./index.f9213b2f.js";import"./customParseFormat.cc1515cd.js";import"./panel-time-pick.d92b5a96.js";import"./index.506eb19c.js";import"./debounce.4efe57e2.js";import"./sph_icon.de3a3562.js";import"./el-empty.a2e85def.js";import"./matrix.418b34fe.js";import"./index.4557d148.js";import"./index.b44dd729.js";import"./index.b617bec7.js";import"./cloneDeep.699e051d.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.656bf02e.js";import"./el-image.1d071b41.js";import"./el-image-viewer.98cbed9e.js";import"./throttle.2aefc6f7.js";/* empty css                   */import"./useTemplate.afda57ca.js";import"./el-tabs.5286b06f.js";import"./raf.11208e2e.js";import"./index.554f7908.js";import"./index.vue.a44fb124.js";import"./usePaging.0c251ebb.js";import"./digital_human.299b9036.js";import"./index.cac1152c.js";const Mt={class:"h-full bg-app-bg-2 rounded-[20px] overflow-x-auto dynamic-scroller"},Et={class:"h-full flex flex-col min-w-[1000px]"},It={class:"flex-shrink-0 flex items-center justify-between px-[14px] h-[88px] border-b border-[#ffffff1a]"},Tt={class:"flex items-center gap-1"},Vt={class:"px-5"},Pt={class:"flex-shrink-0 flex items-center justify-center h-[100px] border-b border-[#ffffff1a] gap-x-[150px]"},$t=["onClick"],At={class:"grow min-h-0 flex flex-col p-5"},St={key:0,class:"grow min-h-0 flex flex-col w-[456px] mx-auto"},Lt={class:"flex items-center justify-between flex-shrink-0"},Dt={class:"text-white font-bold text-[20px]"},Rt={class:"grow min-h-0 mt-5 flex gap-x-[18px]"},Ht={class:"content-item material-content"},Ft={class:"flex items-center justify-between flex-shrink-0 px-[14px]"},Gt={class:"text-[11px] text-white"},Ut={class:"text-[11px] text-white"},Ot={class:"grow min-h-0"},Bt={class:"px-[14px]"},jt={key:0,class:"mt-[14px] border border-app-border-2 rounded-xl p-2"},Wt=["onClick"],zt={key:1,class:"grow min-h-0 flex flex-col"},Nt={class:"flex items-center justify-between flex-shrink-0"},Yt={class:"grow min-h-0 mt-5 flex gap-x-[18px]"},qt={class:"content-item title-content"},Jt={class:"content-item desc-content"},Kt={class:"w-[456px] mx-auto"},Zt={class:"mt-[23px] flex flex-col gap-y-4"},Qt={class:"flex items-center gap-x-2"},Xt=["src"],es={class:"flex flex-wrap gap-2 mt-4"},ts=["onClick"],ss={class:"mt-4"},os={class:"rounded-xl bg-app-bg-3 border border-app-border-2 py-3"},is={class:"px-3"},ls={class:"text-[#ffffff80] mb-[13px] text-xs"},as={key:0,class:"mt-2"},ns={class:"text-[#FF2442] mt-1 text-xs"},F=99,_e=100,rs=".mp4,.mov",cs=50,G=9,U=30,us=qe({__name:"publish-panel",props:{type:{default:w.VIDEO}},emits:["back"],setup(xe,{emit:he}){const ge=xe,ye=he,be=Je(),we=Ke(),te=lt(),{updateCopywritingMaterial:E}=kt(),{getPlatform:ke}=vt(),S={[w.VIDEO]:"视频",[w.IMAGE]:"图文"},Ce={[w.VIDEO]:fe.VIDEO,[w.IMAGE]:fe.IMAGE},O=[{step:1,title:"选择素材"},{step:2,title:"填写文案"},{step:3,title:"设定时间"}],{type:f}=Ze(ge),Me=Qe(),Ee=T(()=>Me.material_id),m=h(1),n=pe({name:`${S[f.value]}矩阵任务${me().format("YYYYMMDDHHmm")}`,accounts:[],media_type:f.value,time_config:[],publish_frep:2}),i=pe({id:Ee.value,name:n.name,media_type:f.value,media_url:[],title:[],subtitle:[]}),B=h(!1),j=h(!1),W=h(!1),se=h(),oe=Xe(),z=h(),Ie=h(),Te=h(),N=h([]),Y=h([]),q=h(""),ie=T(()=>m.value===O.length),V=T(()=>f.value===w.VIDEO),L=T(()=>f.value===w.IMAGE),Ve=()=>{m.value===1?ae():m.value--},Pe=o=>{o>m.value?le():m.value=o},le=async()=>{let o=!1;if(m.value===1)o=await Ae();else if(m.value===2)o=await Se();else if(ie.value){await je();return}o&&(m.value++,tt({...be.query,step:m.value}))},$e=()=>{te.$confirm({message:"确定要取消创建吗？",theme:"dark",onConfirm:ae})},ae=()=>{ye("back"),m.value=1},Ae=async()=>i.media_url.length===0?(M.msgWarning("请选择素材"),!1):f.value===w.IMAGE&&i.media_url.some(o=>!Array.isArray(o.url)||o.url.length===0||o.url.some(e=>!e))?(M.msgWarning("请为每个图片组添加有效的图片，或删除空的图片组"),!1):!0,Se=async()=>i.title.length===0||i.title.every(o=>!o.content)?(M.msgWarning("请填写标题"),!1):i.subtitle.length===0||i.subtitle.every(o=>!o.content)?(M.msgWarning("请填写描述"),!1):(ze(),!0),J=h(0),I=h(-1),Le=T(()=>{if(V.value)return I.value===-1?F:F-i.media_url.length;if(L.value){const o=i.media_url[J.value];return I.value===-1?G:G-((o==null?void 0:o.url.length)||0)}return 0}),K=T(()=>I.value===-1),ne=async(o,e)=>{var c;J.value=e,I.value=o.index>-1?o.index:-1,j.value=!0,await X(),(c=oe.value)==null||c.open()},De=async o=>{if(V.value)if(K.value)for(const e of o){const c={url:e.url,pic:e.pic};if(!e.pic)try{const{file:u}=await st(e.url),a=await ot({file:u});c.pic=a.uri}catch{}i.media_url.push(c),Z(e)}else i.media_url[I.value]=o[0];else if(L.value){const e=i.media_url[J.value];K.value?e.url.push(...o):e.url[I.value]=o[0]}E(i)},re=()=>E(i),ce=o=>{o.type===yt.ADD&&V.value&&Z()},Re=()=>{i.media_url.push({url:[],date:""}),Z()},He=o=>{te.$confirm({message:"确定要删除该素材组吗？",theme:"dark",onConfirm:()=>{i.media_url.splice(o,1),E(i)}})},Fe=async()=>{B.value=!0,await X(),se.value.open()},Ge=o=>{const{titleList:e,contentList:c}=o,u=[...e],a=[...c];if(u.length>0){for(const d of i.title)if(!d.content&&u.length>0){const g=u.shift();g&&(d.content=g.content)}u.length>0&&i.title.push(...u)}if(a.length>0){for(const d of i.subtitle)if(!d.content&&a.length>0){const g=a.shift();g&&(d.content=g.content,d.topic=g.topic||[])}a.length>0&&i.subtitle.push(...a)}(e.length>0||c.length>0)&&E(i)},Z=(o=!0)=>{i.title.push({content:""}),setTimeout(()=>i.subtitle.push({content:"",topic:[]}),100),o&&E(i)},Ue=()=>Oe()?n.accounts.length===0?(M.msgWarning("请选择发布账号"),!1):!0:!1,Oe=()=>{const{valid:o,errorIndexes:e}=Ct(n.time_config);return o?(Y.value=[],!0):(Y.value=e,M.msgWarning("时间配置存在冲突"),!1)},Be=o=>{o!=n.publish_frep&&(n.publish_frep=o,n.time_config=Array.from({length:o},(e,c)=>{const u=me().hour(9).minute(0),a=u.add(c*U,"minutes").format("HH:mm"),d=u.add(c*U+U,"minutes").format("HH:mm");return[a,d]}))},{lockFn:je,isLock:ue}=et(async()=>{if(Ue())try{const o=i.title.filter(a=>a.content).map((a,d)=>{var D,R;const g=(D=i.subtitle[d])==null?void 0:D.content,Q=(R=i.subtitle[d])==null?void 0:R.topic;return{title:a.content,content:g,topic:Q}});let e=[];f.value===w.VIDEO?e=i.media_url.map(a=>({url:[a.pic,a.url]})):e=i.media_url.map(a=>({url:a.url.map(d=>d.url)}));const{id:c}=await xt({name:n.name,media_url:e,copywriting:o,media_type:f.value}),u=N.value.filter(a=>n.accounts.includes(a.account)).map(a=>({account:a.account,id:a.id,type:a.type}));await ht({name:n.name,matrix_media_setting_id:c,time_config:n.time_config.map(a=>`${a[0]}-${a[1]}`),accounts:u,publish_frep:n.publish_frep,media_type:f.value,task_type:3,scene:2,data_type:0}),M.msgSuccess("发布成功"),we.push(`/app/matrix?type=${gt.ME_PUBLISH}`),setTimeout(()=>{window.location.reload()},500)}catch(o){q.value=o,M.msgError(o)}}),We=()=>{n.time_config.length===0&&(n.time_config.push(["09:00","09:30"]),n.time_config.push(["09:30","10:00"]))},ze=()=>{Ne(),We()},Ne=async()=>{const{lists:o}=await _t({page_size:999});N.value=o},Ye=async o=>{var e,c;W.value=!0,await X(),(e=z.value)==null||e.open(),(c=z.value)==null||c.setUrl(o)};return(o,e)=>{const c=nt,u=it,a=ct,d=ut,g=pt,Q=mt,D=ft,R=dt;return r(),v(C,null,[t("div",Mt,[t("div",Et,[t("div",It,[t("div",{class:"flex items-center gap-2 cursor-pointer",onClick:Ve},[_(c,{name:"el-icon-ArrowLeft",color:"#ffffff"}),e[10]||(e[10]=t("div",{class:"text-white"},"返回上一步",-1))]),t("div",Tt,[_(u,{class:"!rounded-full !h-10 w-[98px] !border-app-border-2",color:"#181818",disabled:s(ue),onClick:$e},{default:y(()=>[...e[11]||(e[11]=[H("取消",-1)])]),_:1},8,["disabled"]),_(u,{type:"primary",class:"!rounded-full !h-10 w-[98px]",loading:s(ue),onClick:le},{default:y(()=>[H(x(s(ie)?"提交":"下一步"),1)]),_:1},8,["loading"])])]),t("div",Vt,[t("div",Pt,[(r(),v(C,null,P(O,(l,p)=>t("div",{key:p,class:"relative"},[t("div",{class:"flex flex-col items-center gap-2 cursor-pointer",onClick:k=>Pe(l.step)},[t("div",{class:A(["w-6 h-6 rounded-full flex items-center justify-center text-white",[s(m)>=l.step?"bg-primary":"bg-[#ffffff0d]"]])},x(p+1),3),t("div",{class:A([s(m)>=l.step?"text-white":"text-[#ffffff80]"])},x(l.title),3)],8,$t),p!=O.length-1?(r(),v("div",{key:0,class:A(["absolute w-[120px] h-[1px] left-[calc(100%+15px)] top-[10px]",[s(m)>l.step?"bg-primary":"bg-[#ffffff1a]"]])},null,2)):b("",!0)])),64))])]),t("div",At,[s(m)==1?(r(),v("div",St,[t("div",Lt,[t("div",Dt,"选择"+x(S[s(f)]),1)]),t("div",Rt,[t("div",Ht,[t("div",Ft,[s(V)?(r(),v(C,{key:0},[t("div",Gt," 视频（共"+x(s(i).media_url.length)+"个视频） ",1),t("div",{class:"text-[11px] text-[#ffffff80] mt-2"}," 最多可选"+x(F)+"个，视频"+x(_e)+"m以下 ")],64)):b("",!0),s(L)?(r(),v(C,{key:1},[t("div",null,[t("div",Ut," 图文（共"+x(s(i).media_url.length)+"组） ",1),t("div",{class:"text-[11px] text-[#ffffff80] mt-2"}," 每组图片不超过"+x(G)+"张 ")]),_(u,{class:"!h-10 w-[106px] !border-[#ffffff1a]",color:"#262626",onClick:Re},{default:y(()=>[...e[12]||(e[12]=[H("添加图片组",-1)])]),_:1})],64)):b("",!0)]),t("div",Ot,[_(s(ee),null,{default:y(()=>[t("div",Bt,[s(V)?(r(),v("div",jt,[_(ve,{"material-list":s(i).media_url,"onUpdate:materialList":[e[0]||(e[0]=l=>s(i).media_url=l),re],type:s(f),accept:rs,"max-video-count":F,"max-size":_e,onPreviewVideo:Ye,onImportMaterial:e[1]||(e[1]=l=>ne(l,0)),onChangeMaterial:ce},null,8,["material-list","type"])])):b("",!0),s(L)?(r(!0),v(C,{key:1},P(s(i).media_url,(l,p)=>(r(),v("div",{class:"mt-[14px] border border-app-border-2 rounded-xl p-2 relative",key:p},[_(ve,{"material-list":l.url,"onUpdate:materialList":[k=>l.url=k,re],type:s(f),"max-size":cs,"max-image-count":G,onImportMaterial:k=>ne(k,p),onChangeMaterial:ce},null,8,["material-list","onUpdate:materialList","type","onImportMaterial"]),t("div",{class:"absolute -top-2 -right-2 w-5 h-5",onClick:k=>He(p)},[_(a,{"icon-size":14,theme:s(at).DARK},null,8,["theme"])],8,Wt)]))),128)):b("",!0)])]),_:1})])])])])):s(m)==2?(r(),v("div",zt,[t("div",Nt,[e[14]||(e[14]=t("div",{class:"text-white font-bold text-[20px]"},"填写文案",-1)),t("div",null,[_(u,{type:"primary",class:"!rounded-full !h-10 w-[106px]",onClick:Fe},{default:y(()=>[...e[13]||(e[13]=[H("智能文案",-1)])]),_:1})])]),t("div",Yt,[t("div",qt,[_(de,{"model-value":s(i).title,"onUpdate:modelValue":[e[2]||(e[2]=l=>s(i).title=l),e[3]||(e[3]=l=>s(E)(s(i)))],type:1,"publish-type-name":S[s(f)]},null,8,["model-value","publish-type-name"])]),t("div",Jt,[_(de,{"model-value":s(i).subtitle,"onUpdate:modelValue":[e[4]||(e[4]=l=>s(i).subtitle=l),e[5]||(e[5]=l=>s(E)(s(i)))],type:2,"publish-type-name":S[s(f)]},null,8,["model-value","publish-type-name"])])])])):s(m)==3?(r(),$(s(ee),{key:2},{default:y(()=>[t("div",Kt,[e[20]||(e[20]=t("div",{class:"font-bold text-white text-[20px]"},"发布设置",-1)),t("div",Zt,[t("div",null,[e[15]||(e[15]=t("div",{class:"text-[#ffffff80] mb-3"},"账号选择",-1)),_(g,{modelValue:s(n).accounts,"onUpdate:modelValue":e[6]||(e[6]=l=>s(n).accounts=l),placeholder:"请选择发布的账号",class:"!w-full !h-11 account-select","popper-class":"dark-select-popper",multiple:"","collapse-tags":"","show-arrow":!1},{default:y(()=>[(r(!0),v(C,null,P(s(N),l=>(r(),$(d,{key:l.account,label:`${l.nickname}（${l.account}）`,value:l.account},{default:y(()=>{var p;return[t("div",Qt,[t("img",{src:(p=s(ke)(l.type))==null?void 0:p.icon,class:"w-4 h-4"},null,8,Xt),t("div",null,x(l.nickname)+"（"+x(l.account)+"）",1)])]}),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",null,[e[16]||(e[16]=t("div",{class:"text-[#ffffff80]"},"发布频率（每日）",-1)),t("div",es,[(r(),v(C,null,P([1,2,3,5,10],(l,p)=>t("div",{key:p,class:A(["cursor-pointer rounded-md px-4 py-2 border border-app-border-2 text-white hover:bg-app-bg-1",[s(n).publish_frep==l?"bg-primary hover:bg-primary":""]]),onClick:k=>Be(l)},x(l)+"条 ",11,ts)),64))])]),t("div",null,[e[19]||(e[19]=t("div",{class:"text-[#ffffff80] mb-3"},"选择时间",-1)),t("div",ss,[t("div",os,[t("div",is,[_(Q,{type:"warning",effect:"dark"},{default:y(()=>[t("span",{class:"text-xs"},"设置的时间必须为n+1组的时间大于n组的时间，时间间隔"+x(U)+"分钟")]),_:1}),e[17]||(e[17]=t("div",{class:"text-white mt-4"},"任务发布设置",-1))]),_(s(ee),{ref_key:"timeConfigScrollbarRef",ref:Ie},{default:y(()=>[t("div",{class:"flex flex-col gap-3 mt-[5px] max-h-[300px] p-3",ref_key:"timeConfigWrapperRef",ref:Te},[(r(!0),v(C,null,P(s(n).time_config,(l,p)=>(r(),v("div",null,[t("div",ls," 每天第"+x(p+1)+"个任务发布时间 ",1),_(D,{class:A(["w-full",{"time-error":s(Y).includes(p)}]),modelValue:s(n).time_config[p],"onUpdate:modelValue":k=>s(n).time_config[p]=k,"is-range":"","range-separator":"至","prefix-icon":"",format:"HH:mm","value-format":"HH:mm","popper-class":"dark-select-popper","show-arrow":!1},null,8,["class","modelValue","onUpdate:modelValue"])]))),256))],512)]),_:1},512)]),s(q)?(r(),v("div",as,[e[18]||(e[18]=t("div",null,"任务冲突",-1)),t("view",ns,x(s(q)),1)])):b("",!0)])])])])]),_:1})):b("",!0)])])]),s(B)?(r(),$(bt,{key:0,ref_key:"copywritingMaterialRef",ref:se,onClose:e[7]||(e[7]=l=>B.value=!1),onConfirm:Ge},null,512)):b("",!0),s(j)?(r(),$(wt,{key:1,ref_key:"materialPopRef",ref:oe,type:Ce[s(f)],limit:s(Le),multiple:s(K),onClose:e[8]||(e[8]=l=>j.value=!1),onConfirm:De},null,8,["type","limit","multiple"])):b("",!0),s(W)?(r(),$(R,{key:2,ref_key:"previewVideoRef",ref:z,onClose:e[9]||(e[9]=l=>W.value=!1)},null,512)):b("",!0)],64)}}});const co=rt(us,[["__scopeId","data-v-1e54915a"]]);export{co as default};
