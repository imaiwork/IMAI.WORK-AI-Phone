import{d as de,z as pe,aH as ue,r as g,c as D,ak as me,D as R,k as r,l as i,m as a,q as d,al as _e,Z as n,s as u,t as B,J as E,K as S,Y as fe,I as ve,L as he,v as ge,G as $,ai as M,ay as xe,y as be,av as ye,aw as we,az as Ce,_ as ke}from"./entry.8705b591.js";import{E as ze}from"./index.d5b2ab73.js";import{_ as Ee}from"./index.vue.3f013733.js";import{_ as Se}from"./index.4557d148.js";import{a as Fe,E as Ie}from"./index.7002e1fb.js";import{_ as Ve}from"./chatting.15fc6d72.js";/* empty css                     *//* empty css                  *//* empty css               */import{a as je,b as Re}from"./agent.4a5bb123.js";import{useCozeChat as Be}from"./useCozeChat.d029cddb.js";import"./index.b44dd729.js";import"./index.b617bec7.js";import"./cloneDeep.699e051d.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.d9a24f65.js";import"./strings.05ad2423.js";import"./_baseIteratee.889eaccd.js";import"./toNumber.9701a4c1.js";import"./clamp.2d199c02.js";import"./index.f9213b2f.js";import"./index.vue.030f2d17.js";import"./debounce.4efe57e2.js";import"./index.3864ff87.js";import"./katex.21fbbe07.js";import"./el-image.1d071b41.js";import"./el-image-viewer.98cbed9e.js";import"./throttle.2aefc6f7.js";import"./useCopy.0e54031a.js";import"./cloneDeep.cb5e23a7.js";import"./el-slider.a8a2e45a.js";import"./el-input-number.1be09075.js";import"./index.506eb19c.js";import"./el-switch.e7de3b12.js";import"./index.656bf02e.js";/* empty css                   */import"./usePolling.d59491f5.js";const Le={class:"flex flex-col h-full"},Te={class:"grow min-h-0 px-4"},Ue={class:"h-full w-full"},Ae={class:"md:max-w-3xl lg:max-w-[42rem] xl:max-w-[48rem] 2xl:max-w-[52rem] mx-auto"},De=["src"],$e=["innerHTML"],Me={class:"mt-5 flex flex-col gap-2"},Ne=["onClick"],qe={class:"bg-[#F6F6F6] rounded-[8px] px-4 py-2 w-fit cursor-pointer hover:bg-[#E5E5E5]"},He={class:"flex gap-2 mb-2 whitespace-nowrap"},Pe=["onClick"],Ge={class:"w-full rounded-[20px] border border-primary overflow-hidden"},Oe={class:"h-[50px] px-2 bg-[#F2F7FF] flex items-center justify-between"},Je={class:"font-bold text-lg line-clamp-1 break-all ml-3"},Ke={class:"p-5 w-full"},Ye={class:"grid grid-cols-2 gap-x-2 w-full"},Ze={key:0,class:"w-full"},Qe={class:"w-full h-[52px] flex items-center justify-center gap-2 text-primary"},We={key:1,class:"w-full"},Xe={key:2,class:"w-full"},et={class:"flex justify-end mt-2 mb-[6px] mr-[6px]"},tt={class:"w-8 h-8"},ot=["disabled"],at=de({__name:"coze-agent-chat",props:{agentId:{},cozeId:{},detail:{},conversationId:{}},emits:["new-conversation","conversation-id-change","update:isReceiving"],setup(L,{emit:N}){const f=L,F=N,q={image:[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"],audio:[".mp3",".wav",".wma",".aac",".m4a",".ogg",".flac"],doc:[".doc",".docx",".pdf",".txt",".md"],table:[".xls",".xlsx",".csv",".tsv"],code:[".py",".java",".html",".css",".js",".php",".c",".cpp",".sh",".json",".xml"],zip:[".zip",".rar",".7z",".tar",".gz",".bz2",".iso",".dmg",".pkg",".deb",".rpm",".msi",".exe"],ppt:[".ppt",".pptx",".pptm",".pptm",".pptx"],video:[".mp4",".mov",".avi",".mkv",".wmv",".flv",".webm"],txt:[".txt",".md",".log",".error",".warning",".info",".debug"]},H=pe(),{userInfo:P,userTokens:G}=ue(H),w=g(),T=g(!1),x=g({}),b=g(-1),v=g({}),I=g({}),C=D(()=>{var e,t;return b.value>=0?((t=(e=x.value)==null?void 0:e.shortcut_commands)==null?void 0:t[b.value])||{}:{}}),U=D(()=>{const{components:e}=C.value;return e&&e.length>0?e.some(s=>{var p;return s.type==="file"?!((p=v.value)!=null&&p[s.name]):!s.default_value}):!0}),O=e=>{if(e.length){let t="";return e.forEach(s=>{t+=q[s].join(",")}),t}return"*"},J=e=>{b.value=e},A=()=>{b.value=-1,I.value={},v.value={}},K=(e,t)=>{v.value[t.name]=null},Y=(e,t)=>{v.value[t.name]=e.data},Z=()=>{let{id:e,components:t,query_template:s}=C.value,p={};t.forEach(l=>{l.type==="file"?(s=s.replace(`{{${l.name}}}`,v.value[l.name].uri),p[l.name]=v.value[l.name].uri):(s=s.replace(`{{${l.name}}}`,l.default_value),p[l.name]=l.default_value)}),I.value={command_id:e,parameters:p,text:s},j(s),A()},{chatContentList:k,isReceiving:z,isStopChat:Q,sendMessage:W,stopChat:V,setConversationId:X}=Be(me(f,"detail"),f.agentId);R(z,e=>F("update:isReceiving",e));const j=async e=>{if(G.value<=1){$.msgPowerInsufficient();return}await W(e,I.value,t=>{F("conversation-id-change",t)},t=>{F("new-conversation",t)})},ee=async e=>{var t;if(!e){k.value=[];return}T.value=!0;try{const{lists:s}=await je({bot_id:f.cozeId,type:1,conversation_id:e,page_size:9999}),p=s.map(l=>{var h;return l.role==="user"?{...l,type:1,message:l.content,form_avatar:P.value.avatar}:{...l,type:2,reply:l.content,form_avatar:(h=f.detail)==null?void 0:h.avatar,consume_tokens:{total_tokens:l.token_total}}});k.value=p,await M(),(t=w.value)==null||t.scrollToBottom()}catch(s){$.msgError(s||"发生错误")}finally{T.value=!1}},te=async()=>{const e=await Re({id:f.agentId});x.value=e};return R(()=>f.conversationId,e=>{var t;X(e||""),z.value||(ee(e||""),te()),(t=w.value)==null||t.resetScroll()},{immediate:!0}),R(()=>k.value,async()=>{var e;await M(),(e=w.value)==null||e.scrollToBottom()},{deep:!0}),(e,t)=>{const s=xe,p=ze,l=Ee,h=be,oe=Se,ae=ye,se=Ie,le=Fe,ne=we,ce=Ce,re=Ve;return r(),i("div",Le,[a("div",Te,[d(re,{ref_key:"chattingRef",ref:w,"is-new-chat":!1,"is-stop":n(Q),"is-disabled-humanize":!0,"content-list":n(k),"send-disabled":n(z),"is-upload-file":!1,"is-network":!1,onContentPost:j,onClose:n(V)},_e({content:u(()=>{var _,m,o,y;return[a("div",Ue,[a("div",Ae,[a("img",{src:L.detail.avatar,class:"w-[70px] h-[70px] rounded-[10px] mt-[50px]"},null,8,De),a("div",{innerHTML:(m=(_=n(x))==null?void 0:_.onboarding_info)==null?void 0:m.prologue,class:"mt-5 text-[14px]"},null,8,$e),a("div",Me,[(r(!0),i(E,null,S((y=(o=n(x))==null?void 0:o.onboarding_info)==null?void 0:y.suggested_questions,(c,ie)=>(r(),i("div",{key:ie,class:"cursor-pointer",onClick:st=>j(c)},[a("div",qe,B(c),1)],8,Ne))),128))])])])]}),"chat-area-top":u(()=>[a("div",null,[d(p,null,{default:u(()=>{var _;return[a("div",He,[(r(!0),i(E,null,S((_=n(x))==null?void 0:_.shortcut_commands,(m,o)=>(r(),i("div",{onClick:y=>J(o)},[d(s,null,{default:u(()=>[ge(B(m.name),1)]),_:2},1024)],8,Pe))),256))])]}),_:1})])]),_:2},[n(b)>=0?{name:"customSendArea",fn:u(()=>{var _;return[a("div",Ge,[a("div",Oe,[a("div",Je,B((_=n(C))==null?void 0:_.name),1),a("div",{class:"w-6 h-6",onClick:A},[d(l,{"icon-size":14})])]),d(p,{"max-height":300},{default:u(()=>[a("div",Ke,[d(ce,{class:"command-form",inline:"","label-position":"top"},{default:u(()=>{var m;return[a("div",Ye,[(r(!0),i(E,null,S((m=n(C))==null?void 0:m.components,(o,y)=>(r(),i("div",{key:y,class:fe([o.type=="file"?"col-span-2":"col-span-1"])},[d(ne,{label:o.name,prop:"name"},{default:u(()=>[o.type=="file"?(r(),i("div",Ze,[d(oe,{class:"w-full",type:"file","list-type":"text",drag:"",multiple:!1,"max-size":200,limit:1,accept:O(o.options),onRemove:c=>K(c,o),onSuccess:c=>Y(c,o)},{default:u(()=>[a("div",Qe,[d(h,{name:"el-icon-Plus",size:14}),t[1]||(t[1]=a("span",{class:"font-bold"},"点击或拖放",-1))])]),_:1},8,["accept","onRemove","onSuccess"])])):o.type=="text"?(r(),i("div",We,[d(ae,{class:"!w-full",modelValue:o.default_value,"onUpdate:modelValue":c=>o.default_value=c,placeholder:o.description,clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):o.type=="select"?(r(),i("div",Xe,[d(le,{class:"!w-full",modelValue:o.default_value,"onUpdate:modelValue":c=>o.default_value=c,placeholder:o.description},{default:u(()=>[(r(!0),i(E,null,S(o.default_value,c=>(r(),ve(se,{key:c,label:c,value:c},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):he("",!0)]),_:2},1032,["label"])],2))),128))])]}),_:1})])]),_:1}),a("div",et,[a("div",tt,[n(z)?(r(),i("button",{key:0,onClick:t[0]||(t[0]=(...m)=>n(V)&&n(V)(...m)),class:"flex w-full h-full items-center justify-center rounded-full bg-primary-light-9"},[d(h,{name:"local-icon-chat_stop",size:18})])):(r(),i("button",{key:1,disabled:n(U),class:"flex w-full h-full items-center justify-center rounded-full bg-primary-light-9 text-white disabled:bg-[#F6F6F6] disabled:text-[#f4f4f4] disabled:hover:opacity-100",onClick:Z},[d(h,{name:"local-icon-arrow_up",color:n(U)?"#a9a9a9":"var(--color-primary)",size:18},null,8,["color"])],8,ot))])])])]}),key:"0"}:void 0]),1032,["is-stop","content-list","send-disabled","onClose"])])])}}});const Pt=ke(at,[["__scopeId","data-v-2ca44d09"]]);export{Pt as default};
