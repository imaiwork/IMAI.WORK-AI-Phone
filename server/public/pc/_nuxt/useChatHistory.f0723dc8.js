import{aG as H,r as n,c as R,cA as w,cB as T,G as v}from"./entry.9c858de7.js";import{useChatStore as B}from"./chat.149a4778.js";import{useChatManager as z}from"./useChatManager.45656ba0.js";import{useChatEventBus as E}from"./useChatEventBus.9a258b07.js";function x(){const r=B(),{taskId:u,fetchChatHistory:m,resetScroll:g,chatScrollToBottom:d}=z(),{onHistoryRefresh:C}=E(),o=H({page_no:1,page_size:40}),l=n(!0),s=n(!1),c=n(!1),t=n([]),i=R(()=>u.value),f=async()=>{s.value=!0;try{const{lists:e,count:a}=await w(o);c.value=!(e.length<(o.page_size||a)),t.value=t.value.concat(e)}finally{s.value=!1,l.value=!1}},h=e=>{u.value&&(r.clearChat(),r.resetRoute())},p=async e=>{i.value!==e&&(r.setTaskId(e),await m(),g(),d())},y=async e=>{try{t.value=t.value.filter(a=>a.task_id!==e),await T({task_id:e}),v.msgSuccess("删除成功"),i.value===e&&h()}catch(a){v.msgError(a)}},S=()=>{r.chatContentList.length},_=async()=>{!c.value||s.value||(o.page_no++,f())},k=()=>{o.page_no=1,t.value=[],c.value=!1,s.value=!1};return C(e=>{t.value.unshift({message:e.message,create_time:e.createTime,task_id:e.taskId,update_time:e.createTime})}),{chatHistory:t,currentSessionId:i,isRefreshing:l,isLoading:s,isFinished:c,fetchChatRecord:f,createNewSession:h,switchToSession:p,deleteSession:y,saveCurrentSession:S,loadHistory:_,reset:k}}export{x as useChatHistory};
