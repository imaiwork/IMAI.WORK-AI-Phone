import{d as Z,bP as H,aG as Q,r as x,o as W,k as n,l as d,Z as l,m as o,q as a,s,$ as X,v as u,aI as ee,I as g,t as f,Y as te,L as m,bC as U,bM as ae,J as se,bO as Y,ai as le,G as B,ay as oe,av as ne,y as ie,ba as re,aw as de,cY as ue,u as ce}from"./entry.8705b591.js";import{E as me}from"./index.d5b2ab73.js";import{E as pe,a as fe}from"./index.158d282d.js";import{E as _e,a as ve}from"./index.7002e1fb.js";import{a as ye,_ as be}from"./detail.vue.6f15524e.js";import{_ as he}from"./index.vue.c79afe88.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 */import{u as ge}from"./usePaging.0c251ebb.js";import{d as ke,a as D,e as xe}from"./sph.d6d2831a.js";import{SidebarTypeEnum as $}from"./index.22c5df69.js";import Ee from"./create-panel.42a9358a.js";import{_ as Ce}from"./edit.vue.9c8b7619.js";const we={key:0,class:"h-full flex flex-col bg-app-bg-2 rounded-[20px]"},Te={class:"flex-shrink-0 px-[14px]"},$e={class:"flex items-center justify-end h-[88px]"},Se={class:"flex items-center gap-[14px]"},Ve={class:"grow min-h-0 overflow-hidden flex flex-col"},Ue={class:"grow min-h-0"},Ye=["onClick"],Be={class:"text-white"},De={class:"flex items-center justify-center gap-2"},Ie={key:1},Me={key:2},Oe={key:3},Re={key:4},je={key:5},Pe={class:"flex justify-end items-center"},ze={class:"leading-6"},Ae={class:"flex justify-center p-4"},ot=Z({__name:"index",setup(Fe){const{query:k}=H(),I=ce(),E=Q({name:"",page_size:20,status:""}),{pager:_,getLists:r,resetPage:M}=ge({fetchFun:ke,params:E}),C=x(!1),w=x(),v=x(k.is_create=="1"&&parseInt(k.type)==$.AUTO_GET_CUSTOMER),S=()=>{v.value=!0,Y({is_create:1})},O=async p=>{C.value=!0,await le(),w.value.open(),w.value.setFormData(p)},y=x(k.is_detail=="1"&&parseInt(k.type)==$.AUTO_GET_CUSTOMER),R=p=>{y.value=!0,Y({is_detail:1,id:p.id})},j=async p=>{I.$confirm({message:"是否删除该任务？",theme:"dark",onConfirm:async()=>{try{await xe({id:p}),B.msgSuccess("删除成功"),r()}catch(t){B.msgError(t||"删除失败")}}})},V=()=>{v.value=!1,y.value=!1,window.history.replaceState("","",`?type=${$.AUTO_GET_CUSTOMER}`),r()};return W(()=>{!v.value&&!y.value&&r()}),(p,t)=>{const c=oe,P=ne,T=ie,z=re,A=me,i=pe,b=_e,F=ve,G=de,N=ye,L=fe,q=he,K=ue;return n(),d(se,null,[!l(v)&&!l(y)?(n(),d("div",we,[o("div",Te,[a(A,null,{default:s(()=>[o("div",$e,[o("div",Se,[a(P,{modelValue:l(E).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(E).name=e),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入任务名称",clearable:"",onClear:t[2]||(t[2]=e=>l(r)()),onKeydown:t[3]||(t[3]=X(e=>l(r)(),["enter"]))},{append:s(()=>[a(c,{text:"",onClick:t[0]||(t[0]=e=>l(r)())},{default:s(()=>[...t[8]||(t[8]=[u(" 搜索 ",-1)])]),_:1})]),_:1},8,["modelValue"]),a(c,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:s(()=>[a(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[9]||(t[9]=o("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1}),o("div",null,[a(z,{content:"刷新"},{default:s(()=>[a(c,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:t[4]||(t[4]=e=>l(M)())})]),_:1})])])])]),_:1})]),o("div",Ve,[o("div",Ue,[ee((n(),g(L,{height:"100%",data:l(_).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:s(()=>[o("div",ze,[a(c,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:s(()=>[a(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[13]||(t[13]=o("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1})])]),default:s(()=>[a(i,{prop:"name",label:"任务名称",width:"240",fixed:"left"},{default:s(({row:e})=>[o("div",{class:"flex items-center justify-center gap-2 cursor-pointer",onClick:h=>O(e)},[o("div",Be,f(e.name),1),a(T,{name:"local-icon-edit",color:"#ffffff"})],8,Ye)]),_:1}),a(i,{label:"线索词","min-width":"200","show-overflow-tooltip":""},{default:s(({row:e})=>[u(f(e.keywords.join("；")),1)]),_:1}),a(i,{prop:"crawl_number",label:"已获线索数",width:"120"}),a(i,{label:"任务状态",width:"120"},{default:s(({row:e})=>[o("div",De,[e.status!=0?(n(),d("div",{key:0,class:te(["w-[6px] h-[6px] rounded-full",{"bg-primary":e.status==1,"bg-info":e.status==2,"bg-success":e.status==3,"bg-warning":e.status==4}])},null,2)):m("",!0),e.status==0?(n(),d("div",Ie,"未执行")):e.status==1?(n(),d("div",Me,"进行中")):e.status==2?(n(),d("div",Oe,"已暂停")):e.status==3?(n(),d("div",Re,"已完成")):e.status==4?(n(),d("div",je,"已结束")):m("",!0)])]),_:1}),a(i,{label:"开始时间",width:"120"},{default:s(({row:e})=>[u(f(l(U)(e.start_time).format("YYYY-MM-DD")),1)]),_:1}),a(i,{label:"结束时间",width:"120"},{default:s(({row:e})=>[u(f(l(U)(e.end_time).format("YYYY-MM-DD")),1)]),_:1}),a(i,{label:"当前执行进度","min-width":"120"},{default:s(({row:e})=>[u(f(e.number_of_implemented_keywords||0)+" / "+f(e.implementation_keywords_number||0),1)]),_:1}),a(i,{prop:"create_time",label:"创建时间",width:"180"}),a(i,{label:"操作",width:"180",fixed:"right",align:"right"},{default:s(({row:e})=>[o("div",Pe,[e.status!=0?(n(),g(N,{key:0,class:"mx-3",params:{task_id:e.id},"fetch-fun":l(D),"export-fun":l(D)},{trigger:s(()=>[a(c,{class:"!border-app-border-2",color:"#181818",size:"small"},{default:s(()=>[...t[10]||(t[10]=[u("导出",-1)])]),_:1})]),"form-item":s(({formData:h})=>[a(G,{label:"线索有效性："},{default:s(()=>[a(F,{modelValue:h.status,"onUpdate:modelValue":J=>h.status=J,class:"!w-[260px] !h-10",placeholder:"请选择",filterable:"",clearable:"","empty-values":[void 0,null],"show-arrow":!1},{default:s(()=>[a(b,{label:"全部",value:""}),a(b,{label:"未校验",value:"0"}),a(b,{label:"已通过校验",value:"1"}),a(b,{label:"未通过校验",value:"2"}),a(b,{label:"待执行",value:"4"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["params","fetch-fun","export-fun"])):m("",!0),a(c,{class:"!border-app-border-2",color:"#181818",size:"small",onClick:h=>R(e)},{default:s(()=>[...t[11]||(t[11]=[u("详情",-1)])]),_:1},8,["onClick"]),a(c,{type:"danger",link:"",size:"small",onClick:h=>j(e.id)},{default:s(()=>[...t[12]||(t[12]=[u("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[K,l(_).loading]])]),o("div",Ae,[a(q,{modelValue:l(_),"onUpdate:modelValue":t[5]||(t[5]=e=>ae(_)?_.value=e:null),layout:"prev, pager, next",onChange:l(r)},null,8,["modelValue","onChange"])])]),l(C)?(n(),g(Ce,{key:0,ref_key:"editPopupRef",ref:w,onClose:t[6]||(t[6]=e=>C.value=!1),onSuccess:t[7]||(t[7]=e=>l(r)())},null,512)):m("",!0)])):m("",!0),l(v)?(n(),g(Ee,{key:1,onBack:V})):m("",!0),l(y)?(n(),g(be,{key:2,ref:"detailRef",onBack:V},null,512)):m("",!0)],64)}}});export{ot as _};
