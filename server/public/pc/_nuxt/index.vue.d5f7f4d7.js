import{d as V,z as x,r as c,G as b,aG as h,bC as C,k as G,l as I,q as u,s as L,m as N,Z as d}from"./entry.563c232b.js";import{p as S,q as Y,r as q,s as A}from"./drawing.7058a163.js";import B from"./useCreateForm.91ac089a.js";import{ModelEnum as p,GenerateVideoTypeEnum as f}from"./index.fb0aa6a9.js";import v from"./useDrawingTask.d198d331.js";import M from"./result-content.f0c26725.js";import{E as R}from"./index.9ed38239.js";const F={class:"h-full relative w-full"},H={class:"px-[10px]"},K=V({__name:"index",setup(O){const{onEvent:_,setFormData:g}=B(),w=x(),m=c([]),i=c(!1);_("update:formData",async s=>{if(i.value){b.msgWarning("请等待上一次任务完成");return}i.value=!0;const{type:t,type_name:k,model:l,model_name:D,aspect_ratio:E,params:o}=s,e=h({date:C().format("YYYY-MM-DD HH:mm"),prompt:o.prompt,video:[],tags:[k,E,D],formData:s});m.value.unshift(e);try{if(l==p.GENERAL){e.video=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{data:a,request_id:r}=t==f.TXT2VIDEO?await S(o):await Y(o),{processDrawingTask:n}=v({type:t,model:l,task_id:(a==null?void 0:a.task_id)||r,dataLists:e.video,drawType:"video"});await n({callback:y=>{e.video=y}})}else if(l==p.SEEDANCE){e.video=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{task_id:a}=t==f.TXT2VIDEO?await q(o):await A(o),{processDrawingTask:r}=v({type:t,model:l,task_id:a,dataLists:e.video,drawType:"video"});await r({callback:n=>{e.video=n}})}w.getUser()}catch{e.video=e.video.map(r=>({...r,loading:!1,progress:0,status:4,error:!0}))}finally{i.value=!1}});const T=s=>{g(s)};return(s,t)=>(G(),I("div",F,[u(d(R),null,{default:L(()=>[N("div",H,[u(M,{type:"video","result-lists":d(m),"is-all-tasks-completed":d(i),onRetry:T},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{K as _};
