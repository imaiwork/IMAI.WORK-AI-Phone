"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),t=require("../../../../api/sph.js"),r=require("../../../../stores/user.js"),n=require("../../../../enums/appEnums.js"),s=require("../../enums/index.js"),a=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+i)();const i=()=>"../../components/clue-edit/clue-edit.js",o=e.defineComponent({__name:"task_ai_clue",setup(i){const{emit:o}=a.useEventBusManager(),l=r.useUserStore(),{userTokens:c}=e.toRefs(l),v=e.ref(),f=e.ref(""),d=e.ref(150),p=e.ref([]),m=[10,20,30,40,50],q=e.ref(m[0]),j=e.ref(-1),g=e.ref(!1),b=e.ref(null),h=e.ref(!1),k=e.computed(()=>p.value.every(e=>"success"===e.status)),_=e.computed(()=>{var e;const u=null==(e=l.getTokenByScene(n.TokensSceneEnum.SPH_AI_CLUE))?void 0:e.score;return parseFloat(u)*q.value}),x=async u=>{if(u.trim()){if(!h.value)if(c.value<_.value)e.index.$u.toast("算力不足，请充值！");else try{h.value=!0,p.value=Array.from({length:q.value},()=>({title:"",content:"",status:"pending"}));const e=await t.getAiKeywords({keyword:f.value,targetCount:q.value,channelVersion:v.value});p.value=e.filter(e=>-1==e.indexOf("=")).map(e=>({content:e.trim(),status:"success"}))}catch(r){h.value=!1,e.index.showToast({title:r||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},y=()=>{if(h.value){if(!k.value)return void e.index.$u.toast("正在生成中，请稍后再试");h.value=!1}p.value=[],h.value=!1,x(f.value)},C=e=>{p.value[j.value].content=e,g.value=!1},E=()=>{k.value?(o("confirm",{type:s.ListenerTypeEnum.TASK_AI_CLUE,data:p.value.map(e=>e.content)}),p.value=[],e.index.navigateBack()):e.index.$u.toast("文案在生成中...")},w=()=>{p.value.length>0?(p.value=[],h.value=!1):e.index.navigateBack()};return e.onLoad(e=>{d.value=e.limit,v.value=e.type}),(t,r)=>e.e({a:e.p({title:"线索词AI生成","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"},"custom-back":w}),b:!e.unref(h)},e.unref(h)?{i:e.f(e.unref(p),(t,r,n)=>e.e({a:"pending"===t.status},"pending"===t.status?{b:u._imports_0$31,c:e.t(r+1)}:{d:e.t(t.content),e:e.o(u=>(async u=>{j.value=u,g.value=!0,await e.nextTick$1(),b.value.setFormData(p.value[u].content)})(r),r),f:"55d0b391-1-"+n,g:e.p({name:"close",color:"#ffffff",size:"16"}),h:e.o(e=>(e=>{p.value.splice(e,1),0===p.value.length&&(h.value=!1)})(r),r)},{i:r}))}:{c:500,d:e.unref(f),e:e.o(u=>e.isRef(f)?f.value=u.detail.value:null),f:e.t(e.unref(f).length),g:e.t(500),h:e.f(m,(u,t,r)=>({a:e.t(u),b:u,c:e.unref(q)===u?1:"",d:e.o(e=>q.value=u,u)}))},{j:!e.unref(h)},e.unref(h)?{n:e.o(y),o:e.n(e.unref(k)?"bg-black":"bg-_h787878CC_"),p:e.o(E)}:{k:e.t(e.unref(_)),l:e.n(e.unref(f).length>0?"bg-black":"bg-_h787878CC_"),m:e.o(u=>x(e.unref(f)))},{q:e.sr(b,"55d0b391-2",{k:"clueEditRef"}),r:e.o(C),s:e.o(e=>g.value=!1),t:e.o(u=>e.isRef(g)?g.value=u:null),v:e.p({modelValue:e.unref(g)})})}}),l=e._export_sfc(o,[["__scopeId","data-v-55d0b391"]]);wx.createPage(l);
