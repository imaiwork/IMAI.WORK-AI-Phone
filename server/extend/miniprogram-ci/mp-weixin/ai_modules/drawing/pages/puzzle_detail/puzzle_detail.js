"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),t=require("../../../../api/drawing.js"),s=require("../../../../hooks/usePolling.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){e.resolveComponent("popup-bottom")()}Math;const r=e.defineComponent({__name:"puzzle_detail",setup(r){const a=e.ref(!0),i=e.ref(""),n=e.ref({}),l=e.ref(!1),o=[3,5,10,15,20,30],d=e.ref([Math.ceil(o.length/2)]),c=e.ref(0),f=(u,t)=>{e.index.previewImage({urls:u,current:t})},p=()=>{e.index.showModal({title:"提示",content:"删除后无法找回，是否确认删除？",success:async u=>{if(u.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{await t.deletePuzzleTask({id:i.value}),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(s){e.index.hideLoading(),e.index.showToast({title:s,icon:"none",duration:3e3})}}}})},v=e=>{const{value:u}=e.detail;d.value=u},m=()=>{[3,5].includes(n.value.status)?4!=n.value.status?l.value=!0:e.index.$u.toast("拼图生成失败"):e.index.$u.toast("拼图未生成完成")},q=()=>{const u=o[d.value[0]];e.index.$u.route({url:"/ai_modules/device/pages/create_task/create_task",params:{type:2,source:"puzzle",id:i.value,count:JSON.stringify(u)}})},h=async()=>{const{lists:e}=await t.getPuzzleTaskResultList({puzzle_setting_id:i.value});e.length>0&&(n.value.puzzle_url=e.reduce((e,u)=>(e.push(...u.puzzle_url),e),[]),[3,5].includes(n.value.status)&&j())},{start:g,end:j}=s.usePolling(h,{time:2e3});return e.onLoad(u=>{i.value=u.id,(async()=>{e.index.showLoading({title:"加载中...",mask:!0});try{const e=await t.getPuzzleTaskDetail({id:i.value});n.value=e,await h(),[3,5].includes(n.value.status)||g()}finally{a.value=!1,e.index.hideLoading()}})()}),e.onUnload(()=>{j()}),(t,s)=>e.e({a:!e.unref(a)},e.unref(a)?{}:e.e({b:e.t(e.unref(n).name),c:e.t(e.unref(n).create_time),d:e.f(["生成记录","素材记录"],(u,t,s)=>({a:e.t(u),b:t,c:t==e.unref(c)?1:"",d:e.o(e=>c.value=t,t)})),e:`translateX(${100*e.unref(c)}%)`,f:0==e.unref(c)},0==e.unref(c)?e.e({g:[3,5].includes(e.unref(n).status)&&0==e.unref(c)},[3,5].includes(e.unref(n).status)&&0==e.unref(c)?{h:e.f(0==e.unref(c)?e.unref(n).puzzle_url:e.unref(n).material,(u,t,s)=>({a:u,b:t,c:e.o(u=>f(e.unref(n).puzzle_url,t),t)}))}:e.e({i:[0,1,2].includes(e.unref(n).status)},[0,1,2].includes(e.unref(n).status)?{}:5==e.unref(n).status?{k:u._imports_0$39,l:e.t(e.unref(n).remark)}:{},{j:5==e.unref(n).status})):{},{m:1==e.unref(c)},1==e.unref(c)?{n:e.f(e.unref(n).material,(u,t,s)=>({a:u,b:t,c:e.o(u=>f(e.unref(n).material,t),t)}))}:{},{o:e.o(p),p:e.o(m)}),{q:e.f(o,(u,t,s)=>({a:e.t(u),b:t})),r:e.unref(d),s:e.o(v),t:e.o(e=>l.value=!1),v:e.o(q),w:e.o(e=>l.value=!1),x:e.p({show:e.unref(l),title:"设置发布图组数量",height:"40%"})})}}),a=e._export_sfc(r,[["__scopeId","data-v-6493da8b"]]);wx.createPage(a);
