"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/digital_human.js"),n=require("../../../../utils/util.js"),i=require("../../enums/index.js"),r=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-notice-bar")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-notice-bar/u-notice-bar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const s=e.defineComponent({__name:"montage_publish",setup(s){const{on:o}=r.useEventBusManager(),u=e.reactive({name:`混剪自动发布任务${e.index.$u.timeFormat(new Date,"yyyymmddhhMM")}`,accounts:[],publish_frep:2,video_ids:[],time_config:[{start_time:"09:00",end_time:"09:30"},{start_time:"09:30",end_time:"10:30"}],media_type:1,data_type:0,task_type:2,scene:1}),a=e.ref(i.MontageTypeEnum.REAL_PERSON_MIX),m=e.ref(""),c=e.ref({}),d=e.ref(!1),l=e.computed((()=>u.accounts.length>0));function _(e){const t=e=>{if(!e)return NaN;const[t,n]=(e||"").split(":").map(Number);return 60*t+n},n=e.map((e=>({start_time:e.start_time,end_time:e.end_time,s:t(e.start_time),e:t(e.end_time)}))).reduce(((e,t,n,i)=>{const r=(t,n)=>{e[t]||(e[t]={start_time:!1,end_time:!1}),e[t][n]=!0};if(null!=t.start_time&&""!==t.start_time||r(n,"start_time"),null!=t.end_time&&""!==t.end_time||r(n,"end_time"),isNaN(t.s)||isNaN(t.e))return e;if(t.s>=t.e&&(r(n,"start_time"),r(n,"end_time")),n>0){const e=i[n-1];!isNaN(e.e)&&t.s<e.e&&(r(n-1,"end_time"),r(n,"start_time"))}return e}),{});return{valid:0===Object.keys(n).length,errors:n}}const p=async()=>{if(u.name)if(l.value){e.index.showLoading({title:"创建中...",mask:!0});try{const n=a.value===i.MontageTypeEnum.SORA_VIDEO;n&&(u.task_type=4);const r=n?t.createSoraPublishTask:t.createShanjianPublish;await r({...u,time_config:u.time_config.map((e=>`${e.start_time}-${e.end_time}`))}),d.value=!0,e.index.hideLoading()}catch(n){m.value=n,e.index.hideLoading(),e.index.showToast({title:n||"创建失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请选择发布账号");else e.index.$u.toast("请输入任务名称")},f=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"reLaunch"})};return e.onLoad((e=>{u.video_ids=n.isJson(e.task_id)?JSON.parse(e.task_id):e.task_id,u.scene=e.scene,a.value=parseInt(e.type),o("confirm",(e=>{const{type:t,data:n}=e;if(t===i.ListenerTypeEnum.CHOOSE_ACCOUNT){if(0==n.length)return;u.accounts=n.map((e=>({account:e.account,type:e.type,id:e.id})))}}))})),(t,n)=>e.e({a:e.p({title:"创建发布任务","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.o((t=>e.unref(u).name=t)),c:e.p({"placeholder-style":"font-size: 24rpx;",placeholder:"请输入任务名称",maxlength:"50",modelValue:e.unref(u).name}),d:e.t(e.unref(u).accounts.length?`${e.unref(u).accounts.length}个账号`:"选择账号"),e:e.n(e.unref(u).accounts.length?"text-_h00B862_":"text-_h00000033_"),f:e.p({name:"arrow-right",size:"24",color:"#00000033"}),g:`/ai_modules/device/pages/account_choose/account_choose?account=${JSON.stringify(e.unref(u).accounts)}`,h:e.f([1,2,3,5,10],((t,n,i)=>({a:e.t(t),b:t,c:e.unref(u).publish_frep===t?1:"",d:e.o((n=>(t=>{t!=u.publish_frep&&(u.publish_frep=t,u.time_config=Array.from({length:t},((t,n)=>{const i=new Date;i.setHours(9,0,0);const r=new Date(i.getTime()+30*n*60*1e3),s=new Date(r.getTime()+18e5);return{start_time:e.index.$u.timeFormat(r,"hh:MM"),end_time:e.index.$u.timeFormat(s,"hh:MM")}})),c.value={})})(t)),t)}))),i:e.unref(u).publish_frep>0},e.unref(u).publish_frep>0?e.e({j:e.p({mode:"vertical",padding:"20rpx 0","border-radius":"8","font-size":"24rpx",autoplay:!1,"volume-icon":!1,list:["发布的间隔时间必须大于30分钟"]}),k:e.f(e.unref(u).time_config,((t,n,i)=>{var r,s;return{a:e.t(n+1),b:e.t(t.start_time||"开始时间"),c:e.n((null==(r=e.unref(c)[n])?void 0:r.start_time)?"text-_hFF3C26_ font-bold":t.start_time?"text-_h00B862_ font-bold":"text-_h00000033_"),d:"319c6c43-4-"+i,e:t.start_time,f:e.o((t=>((t,n)=>{const{value:i}=t.detail,r=u.time_config[n],s=new Date(`2000/01/01 ${i}`);r.start_time=i,s.setMinutes(s.getMinutes()+30),r.end_time=e.index.$u.timeFormat(s,"hh:MM");const{errors:o}=_(u.time_config);c.value=o})(t,n)),n),g:e.t(t.end_time||"结束时间"),h:e.n((null==(s=e.unref(c)[n])?void 0:s.end_time)?"text-_hFF3C26_ font-bold":t.end_time?"text-_h00B862_ font-bold":"text-_h00000033_"),i:"319c6c43-5-"+i,j:t.end_time,k:!t.end_time,l:e.o((t=>(t=>{u.time_config[t].start_time||e.index.$u.toast("请先选择开始时间")})(n)),n),m:e.o((t=>((t,n)=>{const{value:i}=t.detail,r=u.time_config[n];if(i<=r.start_time)return void e.index.$u.toast("结束时间不能小于开始时间");const s=new Date(`2000/01/01 ${r.start_time}`);if(new Date(`2000/01/01 ${i}`).getTime()-s.getTime()<18e5)return void e.index.$u.toast("结束时间不能小于开始时间30分钟");r.end_time=i;const{errors:o}=_(u.time_config);c.value=o})(t,n)),n),n:n}})),l:e.p({name:"arrow-right",size:"24",color:"#00000033"}),m:e.p({name:"arrow-right",size:"24",color:"#00000033"}),n:Object.keys(e.unref(c)).length>0},(Object.keys(e.unref(c)).length,{})):{},{o:e.unref(m)},e.unref(m)?{p:e.t(e.unref(m))}:{},{q:e.n(e.unref(l)?"bg-black":"bg-_h787878CC_"),r:e.o(p),s:e.p({name:"checkmark",color:"#ffffff",size:"28"}),t:e.o(f),v:e.o((t=>e.isRef(d)?d.value=t:null)),w:e.p({mode:"center","border-radius":"48",width:"90%","mask-close-able":!1,modelValue:e.unref(d)})})}}),o=e._export_sfc(s,[["__scopeId","data-v-319c6c43"]]);wx.createPage(o);
