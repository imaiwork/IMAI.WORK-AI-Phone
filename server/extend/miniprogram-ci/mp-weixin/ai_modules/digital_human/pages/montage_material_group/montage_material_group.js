"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../common/assets.js"),o=require("../../enums/index.js"),s=require("../../hooks/useMontageMaterial.js"),i=require("../../config/index.js"),u=require("../../../../hooks/useEventBusManager.js");if(require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),require("../../../../api/material.js"),require("../../../../hooks/usePolling.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("upload-progress"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+t+(()=>"../../../../components/upload-progress/upload-progress.js"))();const t=()=>"../../components/upload-rule-pop/upload-rule-pop.js",n=e.defineComponent({__name:"montage_material_group",setup(t){const{emit:n}=u.useEventBusManager(),a=e.ref([]),l=e.ref(!1),p=()=>{l.value=!1,e.index.showActionSheet({itemList:["选择图片素材","选择视频素材"],success:e=>{0===e.tapIndex?d("image"):1===e.tapIndex&&d("video")}})},{showUploadProgress:m,uploadMaterialList:c,uploadAndProcessFiles:d}=s.useMontageMaterial({onSuccess:e=>{a.value=a.value.concat(e)}}),g=()=>{},f=()=>{const r=a.value.filter(e=>"video"===e.type).length,s=a.value.filter(e=>"image"===e.type).length;if(r<1||s<3)return void e.index.showToast({title:"至少需要1个视频+3张图片",icon:"none"});a.value.reduce((e,r)=>"video"===r.type?e+r.duration:e,0)+s*i.montageConfig.imageDuration>60*i.montageConfig.materialTotalDuration?e.index.$u.toast(`素材总时长不能超过${i.montageConfig.materialTotalDuration}分钟`):(n("confirm",{type:o.ListenerTypeEnum.MONTAGE_MATERIAL_GROUP,data:a.value}),e.index.navigateBack())};return e.onLoad(e=>{e.materialList&&(a.value=JSON.parse(e.materialList))}),(o,s)=>({a:e.t(e.unref(a).length),b:e.t(e.unref(i.montageConfig).materialTotalDuration),c:e.t(e.unref(i.montageConfig).imageDuration),d:e.f(e.unref(a),(r,o,s)=>({a:r.pic,b:"18ba3506-0-"+s,c:e.o(e=>(e=>{a.value.splice(e,1)})(o),o),d:o})),e:e.p({name:"close",color:"#ffffff",size:"16"}),f:r._imports_0$6,g:e.o(p),h:e.o(f),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"12rpx",fontWeight:"bold"}}),j:e.o(g),k:e.o(r=>e.isRef(l)?l.value=r:null),l:e.p({modelValue:e.unref(l)}),m:e.o(r=>e.isRef(m)?m.value=r:null),n:e.p({"upload-list":e.unref(c),modelValue:e.unref(m)})})}});wx.createPage(n);
