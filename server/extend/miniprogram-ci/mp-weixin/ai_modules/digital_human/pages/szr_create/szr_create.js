"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../api/app.js"),r=require("../../../../stores/app.js"),u=require("../../../../stores/user.js"),t=require("../../../../utils/cache.js"),a=require("../../../../enums/appEnums.js"),s=require("../../enums/index.js"),l=require("../../config/copywriter.js"),c=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("video-preview")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../components/video-preview/video-preview.js")+m+d+p+_+h+v+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const m=()=>"../../components/choose-anchor/choose-anchor.js",d=()=>"../../components/choose-tone/choose-tone.js",p=()=>"../../components/choose-model/choose-model.js",_=()=>"../../components/model-rule/model-rule.js",v=()=>"../../components/agreement/agreement.js",h=()=>"../../components/create-panel/create-panel.js",f=e.defineComponent({__name:"szr_create",setup(m){const{on:d}=c.useEventBusManager(),p=r.useAppStore(),_=u.useUserStore(),v=e.ref(!0),h="create_agreement",f=e.reactive({name:"",pic:"",width:0,height:0,anchor_id:"",anchor_name:"",gender:"male",model_version:"",audio_type:s.CreateTypeEnum.TEXT,voice_id:"-1",voice_type:1,voice_name:"",msg:"",video_url:"",automatic_clip:0,clip_type:s.ClipStyleEnum.AI_RECOMMEND,music_url:"",music_name:"",music_type:1}),g=e.ref([]),y=e.ref(-1),E=e.ref(!1),j=e.ref(!1),w=e.ref(""),x=e.ref(!1),q=e.ref(!1),C=e.ref(-1),T=e.ref(!1),D=e.ref(!1),H=e.shallowRef(),M=e.ref(),R=e.computed((()=>({[a.DigitalHumanModelVersionEnum.STANDARD]:150,[a.DigitalHumanModelVersionEnum.SUPER]:300,[a.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[a.DigitalHumanModelVersionEnum.ELITE]:1e3,[a.DigitalHumanModelVersionEnum.CHANJING]:4e3}[f.model_version]||150))),V=e.computed((()=>{var e;return(null==(e=p.getDigitalHumanConfig)?void 0:e.channel)||[]})),A=e.computed((()=>{const{model_version:e}=g.value[y.value];return 0===e})),$=e.computed((()=>V.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{}))),N=e.computed((()=>{var e;return(1==f.voice_type||!!f.voice_id)&&(null==(e=f.msg)?void 0:e.length)>0})),I=e.computed((()=>-1==f.voice_id)),S=e.computed((()=>f.model_version==a.DigitalHumanModelVersionEnum.CHANJING||I.value)),L=e.reactive({is_open:!1}),b=o=>{const{status:i,model_version:n}=g.value[o];2==i||0!==n?(n!=n&&(f.voice_id="-1",f.voice_name=""),f.model_version=0===n?a.DigitalHumanModelVersionEnum.CHANJING:n,y.value=o):e.index.$u.toast("该形象正在制作中，请稍后再来选择")},O=e=>{const o=g.value.findIndex((o=>o.anchor_id===e.anchor_id));-1===o?(g.value=[e,...g.value],b(0)):b(o),E.value=!1},k=()=>{e.index.$u.route({url:`/ai_modules/digital_human/pages/anchor_create/anchor_create?source=${a.DigitalHumanModelVersionEnum.CHANJING}&type=${s.ModeTypeEnum.ANCHOR}`})},P=e=>{f.model_version=e},z=()=>{q.value=!0},G=e=>{const{voice_id:o,name:i,type:n}=e;q.value=!1,f.voice_id!==o&&(f.voice_id=o,f.voice_name=i,f.voice_type=n)},J=()=>{t.cache.set(h,"1"),B()},U=()=>{var e;null==(e=M.value)||e.open()},B=async()=>{var o,n;if(t.cache.get(h))if((null==(o=f.msg)?void 0:o.length)>R.value)e.index.$u.toast("文案超出限制，请重新输入");else{D.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0});const o="-1"==f.voice_id?void 0:f.voice_id,{name:r,extra_info:{width:u,height:t},model_version:s,anchor_id:l,anchor_ids:{chanjing_anchor_id:c,weiju_anchor_id:m},pic:d,result_url:p}=g.value[y.value];let v=l;0===s&&(f.model_version===a.DigitalHumanModelVersionEnum.CHANJING&&(v=c),f.model_version===a.DigitalHumanModelVersionEnum.STANDARD&&(v=m)),await i.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"数字人口播",width:u,height:t,pic:d,voice_id:o,anchor_id:v,msg:f.msg,video_url:p,anchor_name:r,voice_name:f.voice_name,voice_type:f.voice_type,audio_type:f.audio_type,model_version:f.model_version,automatic_clip:f.automatic_clip,clip_type:f.clip_type,music_url:f.music_url,music_type:f.music_type}),null==(n=H.value)||n.close(),_.getUser(),e.index.hideLoading(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"none",duration:3e3}),setTimeout((()=>{W()}),3e3)}catch(r){e.index.hideLoading(),e.index.showToast({title:r||"生成失败",icon:"none",duration:3e3})}}else D.value=!0},Y=async()=>{try{const{lists:e}=await i.getPublicAnchorList({page_size:10,page_no:1,status:1,filter:2});if(e&&e.length){g.value=e;const o=e.findIndex((e=>"public_anchor"==e.source_type?2==e.status:1==e.status));-1!==o&&b(o)}}finally{v.value=!1}},W=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})};return e.onShow((()=>{(async()=>{const{code:e}=await n.getClipConfig();L.is_open=1e4==e})()})),e.onLoad((async e=>{Y(),d("confirm",(e=>{var o;const{type:i,data:n}=e;i===s.ListenerTypeEnum.CREATE_ANCHOR&&Y(),i===s.ListenerTypeEnum.SZR_COPYWRITER&&(f.msg=n),i===s.ListenerTypeEnum.AI_COPYWRITER&&(f.msg=n,(null==(o=f.msg)?void 0:o.length)>R.value&&(f.msg=f.msg.slice(0,R.value))),s.ListenerTypeEnum.CHOOSE_STYLES,i===s.ListenerTypeEnum.CHOOSE_MUSIC&&(f.music_url=n.url,f.music_name=n.name)}))})),(i,n)=>e.e({a:!e.unref(v)},e.unref(v)?{}:e.e({b:o._imports_0$6,c:e.o((e=>E.value=!0)),d:e.unref(g).length>0},e.unref(g).length>0?{e:e.f(e.unref(g),((o,i,n)=>e.e({a:o.pic,b:e.unref(y)==i},(e.unref(y),{}),{c:e.o((e=>{var i;(i=o.result_url)&&(x.value=!0,w.value=i)}),o.anchor_id||i),d:0==o.status},(o.status,{}),{e:o.anchor_id||i,f:e.o((e=>b(i)),o.anchor_id||i)}))),f:o._imports_1$3}:{g:o._imports_1$4,h:e.o((e=>k()))},{i:e.n(0==e.unref(g).length?"grow min-h-0 flex flex-col items-center justify-center":"border-_0rpx_ border-t-_1rpx_ border-b-_1rpx_ border-solid border-_hE5E5E5_"),j:e.t(e.unref($)[e.unref(f).model_version]||"请选择"),k:e.n(e.unref(f).model_version?"text-primary":"text-_h0000004d_"),l:e.p({name:"arrow-right",color:"#00000020",size:"22"}),m:e.o((o=>{A.value?j.value=!0:e.index.$u.toast("该形象无法更改模型哦~")})),n:e.unref(I)},e.unref(I)?{}:{o:e.t(e.unref(f).voice_name||"无"),p:e.n(e.unref(f).voice_name?"text-primary":"text-_h0000004d_")},{q:e.p({name:"arrow-right",color:"#00000020",size:"22"}),r:e.o((e=>z())),s:e.unref(L).is_open},e.unref(L).is_open?e.e({t:e.o((o=>e.unref(f).automatic_clip=o)),v:e.p({size:"36","active-value":1,"inactive-value":0,modelValue:e.unref(f).automatic_clip})},{},{}):{},{A:0==e.unref(g).length?1:"",B:o._imports_3$1,C:e.o((e=>{l.createVideoCopywriter.length&&(C.value=(C.value+1)%l.createVideoCopywriter.length,f.msg=l.createVideoCopywriter[C.value])})),D:o._imports_4$2,E:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(R)}`,F:e.t(e.unref(f).msg||"请输入您的文案"),G:e.t(e.unref(f).msg.length),H:e.t(e.unref(R)),I:`/ai_modules/digital_human/pages/szr_copywriter/szr_copywriter?limit=${e.unref(R)}&content=${e.unref(f).msg}`,J:o._imports_3$2,K:e.o((e=>{T.value=!0})),L:e.o((o=>{var i;N.value?null==(i=H.value)||i.confirm():f.model_version?1==f.voice_type||f.voice_id?f.msg||e.index.$u.toast("请先输入视频文案"):(e.index.$u.toast("请先选择音色"),z()):k()}))}),{M:e.o((e=>x.value=!1)),N:e.o((o=>e.isRef(x)?x.value=o:null)),O:e.p({title:"视频预览","video-url":e.unref(w),modelValue:e.unref(x)}),P:e.o(O),Q:e.o((o=>e.isRef(E)?E.value=o:null)),R:e.p({modelValue:e.unref(E)}),S:e.o(G),T:e.o((o=>e.isRef(q)?q.value=o:null)),U:e.p({"model-version":e.unref(f).model_version,"active-tone":e.unref(f).voice_id,"show-original-tone":e.unref(S),modelValue:e.unref(q)}),V:e.o(P),W:e.o((o=>e.isRef(j)?j.value=o:null)),X:e.p({modelValue:e.unref(j)}),Y:e.o((o=>e.isRef(T)?T.value=o:null)),Z:e.p({"model-version":e.unref(f).model_version,modelValue:e.unref(T)}),aa:e.sr(H,"5cf9d2c6-10",{k:"createPanelRef"}),ab:e.o(B),ac:e.o(U),ad:e.p({formData:e.unref(f)}),ae:e.o(J),af:e.o((e=>D.value=!1)),ag:e.p({"show-agreement":e.unref(D)}),ah:e.sr(M,"5cf9d2c6-12",{k:"rechargePopupRef"})})}}),g=e._export_sfc(f,[["__scopeId","data-v-5cf9d2c6"]]);wx.createPage(g);
