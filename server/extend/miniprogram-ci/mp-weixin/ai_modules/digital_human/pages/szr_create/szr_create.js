"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../api/app.js"),r=require("../../../../stores/app.js"),u=require("../../../../stores/user.js"),a=require("../../../../utils/cache.js"),t=require("../../enums/index.js"),s=require("../../config/copywriter.js"),l=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("video-preview")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../components/video-preview/video-preview.js")+c+m+d+p+v+_+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const c=()=>"../../components/choose-anchor/choose-anchor.js",m=()=>"../../components/choose-tone/choose-tone.js",d=()=>"../../components/choose-model/choose-model.js",p=()=>"../../components/model-rule/model-rule.js",_=()=>"../../components/agreement/agreement.js",v=()=>"../../components/create-panel/create-panel.js",h=e.defineComponent({__name:"szr_create",setup(c){const{on:m}=l.useEventBusManager(),d=r.useAppStore(),p=u.useUserStore(),_=e.ref(!0),v="create_agreement",h=e.reactive({name:"",pic:"",width:0,height:0,anchor_id:"",anchor_name:"",gender:"male",model_version:t.DigitalHumanModelVersionEnum.CHANJING,audio_type:t.CreateTypeEnum.TEXT,voice_id:"-1",voice_type:1,voice_name:"",msg:"",video_url:"",automatic_clip:0,clip_type:t.ClipStyleEnum.AI_RECOMMEND,music_url:"",music_name:"",music_type:1}),g=e.ref([]),f=e.ref(!1),y=e.ref(!1),E=e.ref(""),w=e.ref(!1),j=e.ref(!1),C=e.ref(-1),q=e.ref(!1),x=e.ref(!1),T=e.shallowRef(),H=e.ref(),M=e.computed((()=>({[t.DigitalHumanModelVersionEnum.STANDARD]:150,[t.DigitalHumanModelVersionEnum.SUPER]:300,[t.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[t.DigitalHumanModelVersionEnum.ELITE]:1e3,[t.DigitalHumanModelVersionEnum.CHANJING]:4e3}[h.model_version]||150))),R=e.computed((()=>{var e;return(null==(e=d.getDigitalHumanConfig)?void 0:e.channel)||[]})),$=e.computed((()=>!!h.model_version)),A=e.computed((()=>R.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{}))),D=e.computed((()=>{var e;return $.value&&(1==h.voice_type||!!h.voice_id)&&(null==(e=h.msg)?void 0:e.length)>0})),V=e.computed((()=>-1==h.voice_id)),N=e.computed((()=>h.model_version==t.DigitalHumanModelVersionEnum.CHANJING||V.value)),S=e.reactive({is_open:!1}),I=e=>{const{name:o,model_version:i,anchor_id:n,url:r,pic:u,width:a,height:t}=e;h.model_version!==i&&(h.voice_id="-1",h.voice_name=""),h.anchor_id=n,h.anchor_name=o,h.model_version=i,h.video_url=r,h.pic=u,h.width=a,h.height=t},L=e=>{I(e);g.value.some((o=>o.anchor_id===e.anchor_id))||(g.value=[e,...g.value]),f.value=!1},b=()=>{e.index.$u.route({url:`/ai_modules/digital_human/pages/anchor_create/anchor_create?source=${t.DigitalHumanModelVersionEnum.CHANJING}&type=${t.ModeTypeEnum.ANCHOR}`})},O=o=>{y.value=!1,e.index.$u.route({url:`/ai_modules/digital_human/pages/video_upload/video_upload?model_version=${o}&type=${t.ModeTypeEnum.ANCHOR}`})},k=()=>{j.value=!0},z=e=>{const{voice_id:o,name:i,type:n}=e;j.value=!1,h.voice_id!==o&&(h.voice_id=o,h.voice_name=i,h.voice_type=n)},P=()=>{a.cache.set(v,"1"),J()},G=()=>{var e;null==(e=H.value)||e.open()},J=async()=>{var o,n;if(a.cache.get(v))if((null==(o=h.msg)?void 0:o.length)>M.value)e.index.$u.toast("文案超出限制，请重新输入");else{x.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0});const o="-1"==h.voice_id?void 0:h.voice_id;await i.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"数字人口播",msg:h.msg,pic:h.pic,video_url:h.video_url,anchor_id:h.anchor_id,anchor_name:h.anchor_name,voice_id:o,voice_name:h.voice_name,voice_type:h.voice_type,audio_type:h.audio_type,model_version:h.model_version,width:h.width,height:h.height,automatic_clip:h.automatic_clip,clip_type:h.clip_type,music_url:h.music_url,music_type:h.music_type}),null==(n=T.value)||n.close(),p.getUser(),e.index.hideLoading(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"none",duration:3e3}),setTimeout((()=>{B()}),3e3)}catch(r){e.index.hideLoading(),e.index.showToast({title:r||"生成失败",icon:"none",duration:3e3})}}else x.value=!0},U=async()=>{try{const{lists:e}=await i.getAnchorList({page_size:10,page_no:1,type:0,status:"0,1",model_version:`${t.DigitalHumanModelVersionEnum.CHANJING},${t.DigitalHumanModelVersionEnum.STANDARD}`});e&&e.length&&(g.value=e,I(e[0]))}finally{_.value=!1}},B=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})};return e.onShow((()=>{(async()=>{const{code:e}=await n.getClipConfig();S.is_open=1e4==e})()})),e.onLoad((async e=>{U(),m("confirm",(e=>{var o;const{type:i,data:n}=e;i===t.ListenerTypeEnum.CREATE_ANCHOR&&U(),i===t.ListenerTypeEnum.SZR_COPYWRITER&&(h.msg=n),i===t.ListenerTypeEnum.AI_COPYWRITER&&(h.msg=n,(null==(o=h.msg)?void 0:o.length)>M.value&&(h.msg=h.msg.slice(0,M.value))),t.ListenerTypeEnum.CHOOSE_STYLES,i===t.ListenerTypeEnum.CHOOSE_MUSIC&&(h.music_url=n.url,h.music_name=n.name)}))})),(i,n)=>e.e({a:!e.unref(_)},e.unref(_)?{}:e.e({b:o._imports_0$6,c:e.o((e=>f.value=!0)),d:e.unref(g).length},e.unref(g).length?{e:e.f(e.unref(g),((o,i,n)=>e.e({a:o.pic,b:e.unref(h).anchor_id==o.anchor_id},(e.unref(h).anchor_id,o.anchor_id,{}),{c:e.o((e=>{var i;(i=o.url)&&(w.value=!0,E.value=i)}),o.anchor_id||i),d:0==o.status},(o.status,{}),{e:e.unref(A)[o.model_version]},e.unref(A)[o.model_version]?{f:e.t(e.unref(A)[o.model_version])}:{},{g:o.anchor_id||i,h:e.o((e=>I(o)),o.anchor_id||i)}))),f:o._imports_1$3}:{g:o._imports_1$4,h:e.o((e=>b()))},{i:e.n(e.unref($)?"border-_0rpx_ border-t-_1rpx_ border-b-_1rpx_ border-solid border-_hE5E5E5_":"grow min-h-0 flex flex-col items-center justify-center"),j:e.unref(V)},e.unref(V)?{}:{k:e.t(e.unref(h).voice_name||"无"),l:e.n(e.unref(h).voice_name?"text-primary":"text-_h0000004d_")},{m:e.p({name:"arrow-right",color:"#00000020",size:"22"}),n:e.o((e=>k())),o:e.unref(S).is_open},e.unref(S).is_open?e.e({p:e.o((o=>e.unref(h).automatic_clip=o)),q:e.p({size:"36","active-value":1,"inactive-value":0,modelValue:e.unref(h).automatic_clip})},{},{}):{},{w:e.unref($)?"":1,x:o._imports_3$1,y:e.o((e=>{s.createVideoCopywriter.length&&(C.value=(C.value+1)%s.createVideoCopywriter.length,h.msg=s.createVideoCopywriter[C.value])})),z:o._imports_4$2,A:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(M)}`,B:e.t(e.unref(h).msg||"请输入您的文案"),C:e.unref(h).msg},e.unref(h).msg?{D:e.t(e.unref(h).msg.length),E:e.t(e.unref(M))}:{},{F:`/ai_modules/digital_human/pages/szr_copywriter/szr_copywriter?limit=${e.unref(M)}&content=${e.unref(h).msg}`,G:o._imports_3$2,H:e.o((e=>{q.value=!0})),I:e.o((o=>{var i;D.value?null==(i=T.value)||i.confirm():h.model_version?1==h.voice_type||h.voice_id?h.msg||e.index.$u.toast("请先输入视频文案"):(e.index.$u.toast("请先选择音色"),k()):b()}))}),{J:e.o((e=>w.value=!1)),K:e.o((o=>e.isRef(w)?w.value=o:null)),L:e.p({title:"视频预览","video-url":e.unref(E),modelValue:e.unref(w)}),M:e.o(L),N:e.o((o=>e.isRef(f)?f.value=o:null)),O:e.p({show:e.unref(f)}),P:e.o(z),Q:e.o((o=>e.isRef(j)?j.value=o:null)),R:e.p({"model-version":e.unref(h).model_version,"active-tone":e.unref(h).voice_id,"show-original-tone":e.unref(N),modelValue:e.unref(j)}),S:e.o(O),T:e.o((o=>e.isRef(y)?y.value=o:null)),U:e.p({show:e.unref(y)}),V:e.o((o=>e.isRef(q)?q.value=o:null)),W:e.p({"model-version":e.unref(h).model_version,modelValue:e.unref(q)}),X:e.sr(T,"57720b1c-9",{k:"createPanelRef"}),Y:e.o(J),Z:e.o(G),aa:e.p({formData:e.unref(h)}),ab:e.o(P),ac:e.o((e=>x.value=!1)),ad:e.p({"show-agreement":e.unref(x)}),ae:e.sr(H,"57720b1c-11",{k:"rechargePopupRef"})})}}),g=e._export_sfc(h,[["__scopeId","data-v-57720b1c"]]);wx.createPage(g);
