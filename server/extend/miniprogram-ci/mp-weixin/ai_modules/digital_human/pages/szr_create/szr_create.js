"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../api/app.js"),r=require("../../../../stores/app.js"),u=require("../../../../stores/user.js"),a=require("../../../../utils/cache.js"),t=require("../../enums/index.js"),s=require("../../config/copywriter.js"),l=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("u-input")+e.resolveComponent("video-preview")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../components/video-preview/video-preview.js")+c+m+d+p+_+h+v+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const c=()=>"../../components/choose-anchor/choose-anchor.js",m=()=>"../../components/choose-tone/choose-tone.js",d=()=>"../../components/choose-model/choose-model.js",p=()=>"../../components/model-rule/model-rule.js",_=()=>"../../components/content-input/content-input.js",v=()=>"../../components/agreement/agreement.js",h=()=>"../../components/create-panel/create-panel.js",g=e.defineComponent({__name:"szr_create",setup(c){const{on:m}=l.useEventBusManager(),d=r.useAppStore(),p=u.useUserStore(),_=e.ref(!0),v="create_agreement",h=e.reactive({name:"",pic:"",width:0,height:0,anchor_id:"",anchor_name:"",gender:"male",model_version:t.DigitalHumanModelVersionEnum.CHANJING,audio_type:t.CreateTypeEnum.TEXT,voice_id:"-1",voice_type:1,voice_name:"",msg:"",video_url:"",automatic_clip:0,clip_type:t.ClipStyleEnum.AI_RECOMMEND,music_url:"",music_name:"",music_type:1}),g=e.ref([]),f=e.ref(!1),y=e.ref(!1),w=e.ref(""),j=e.ref(!1),E=e.ref(!1),x=e.ref(-1),C=e.ref(!1),q=e.ref(!1),H=e.shallowRef(),M=e.shallowRef(),A=e.ref(),D=e.computed((()=>({[t.DigitalHumanModelVersionEnum.STANDARD]:150,[t.DigitalHumanModelVersionEnum.SUPER]:300,[t.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[t.DigitalHumanModelVersionEnum.ELITE]:1e3,[t.DigitalHumanModelVersionEnum.CHANJING]:4e3}[h.model_version]||150))),R=e.computed((()=>{var e;return(null==(e=d.getDigitalHumanConfig)?void 0:e.channel)||[]})),T=e.computed((()=>!!h.model_version)),V=e.computed((()=>R.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{}))),$=e.computed((()=>T.value&&(1==h.voice_type||!!h.voice_id)&&!!h.msg)),N=e.computed((()=>-1==h.voice_id)),S=e.computed((()=>h.model_version==t.DigitalHumanModelVersionEnum.CHANJING||N.value)),I=e.reactive({is_open:!1}),L=e=>{const{name:o,model_version:i,anchor_id:n,url:r,pic:u,width:a,height:t}=e;h.model_version!==i&&(h.msg="",h.voice_id="-1",h.voice_name=""),h.anchor_id=n,h.anchor_name=o,h.model_version=i,h.video_url=r,h.pic=u,h.width=a,h.height=t},b=e=>{L(e);g.value.some((o=>o.anchor_id===e.anchor_id))||(g.value=[e,...g.value]),f.value=!1},k=()=>{e.index.$u.route({url:`/ai_modules/digital_human/pages/anchor_create/anchor_create?source=${t.DigitalHumanModelVersionEnum.CHANJING}&type=${t.ModeTypeEnum.ANCHOR}`})},O=o=>{y.value=!1,e.index.$u.route({url:`/ai_modules/digital_human/pages/video_upload/video_upload?model_version=${o}&type=${t.ModeTypeEnum.ANCHOR}`})},z=()=>{E.value=!0},G=e=>{const{voice_id:o,name:i,type:n}=e;E.value=!1,h.voice_id!==o&&(h.voice_id=o,h.voice_name=i,h.voice_type=n)},J=()=>{var e;null==(e=H.value)||e.open()},P=()=>{a.cache.set(v,"1"),B()},U=()=>{var e;null==(e=A.value)||e.open()},B=async()=>{var o;if(a.cache.get(v)){q.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0});const n="-1"==h.voice_id?void 0:h.voice_id;await i.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"数字人口播",msg:h.msg,pic:h.pic,video_url:h.video_url,anchor_id:h.anchor_id,anchor_name:h.anchor_name,voice_id:n,voice_name:h.voice_name,voice_type:h.voice_type,audio_type:h.audio_type,model_version:h.model_version,width:h.width,height:h.height,automatic_clip:h.automatic_clip,clip_type:h.clip_type,music_url:h.music_url,music_type:h.music_type}),null==(o=M.value)||o.close(),p.getUser(),e.index.hideLoading(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"none",duration:3e3}),setTimeout((()=>{Y()}),3e3)}catch(n){e.index.hideLoading(),e.index.showToast({title:n||"生成失败",icon:"none",duration:3e3})}}else q.value=!0},Y=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})};return e.onShow((()=>{(async()=>{try{const{lists:e}=await i.getAnchorList({page_size:10,page_no:1,type:0,status:"0,1",model_version:`${t.DigitalHumanModelVersionEnum.CHANJING},${t.DigitalHumanModelVersionEnum.STANDARD}`});e&&e.length&&(g.value=e,L(e[0]))}finally{_.value=!1}})(),(async()=>{const{code:e}=await n.getClipConfig();I.is_open=1e4==e})()})),e.onLoad((async e=>{m("confirm",(e=>{var o;const{type:i,data:n}=e;i===t.ListenerTypeEnum.CREATE_ANCHOR&&(e=>{const{name:o,url:i,anchor_id:n,pic:r,width:u,height:a,model_version:t}=e;Object.assign(h,{anchor_name:o,video_url:i,anchor_id:n,model_version:t,pic:r,width:u,height:a}),g.value=[e,...g.value]})(n),i===t.ListenerTypeEnum.AI_COPYWRITER&&(h.msg=n.content,(null==(o=h.msg)?void 0:o.length)>D.value&&(h.msg=h.msg.slice(0,D.value))),t.ListenerTypeEnum.CHOOSE_STYLES,i===t.ListenerTypeEnum.CHOOSE_MUSIC&&(h.music_url=n.url,h.music_name=n.name)}))})),(i,n)=>e.e({a:!e.unref(_)},e.unref(_)?{}:e.e({b:o._imports_0$6,c:e.o((e=>f.value=!0)),d:e.unref(g).length},e.unref(g).length?{e:e.f(e.unref(g),((o,i,n)=>e.e({a:o.pic,b:e.unref(h).anchor_id==o.anchor_id},(e.unref(h).anchor_id,o.anchor_id,{}),{c:e.o((e=>{var i;(i=o.url)&&(j.value=!0,w.value=i)}),o.anchor_id||i),d:0==o.status},(o.status,{}),{e:e.unref(V)[o.model_version]},e.unref(V)[o.model_version]?{f:e.t(e.unref(V)[o.model_version])}:{},{g:o.anchor_id||i,h:e.o((e=>L(o)),o.anchor_id||i)}))),f:o._imports_1$3}:{g:o._imports_1$4,h:e.o((e=>k()))},{i:e.n(e.unref(T)?"border-_0rpx_ border-t-_1rpx_ border-b-_1rpx_ border-solid border-_hE5E5E5_":"grow min-h-0 flex flex-col items-center justify-center"),j:e.unref(N)},e.unref(N)?{}:{k:e.t(e.unref(h).voice_name||"无"),l:e.n(e.unref(h).voice_name?"text-primary":"text-_h0000004d_")},{m:e.p({name:"arrow-right",color:"#00000020",size:"22"}),n:e.o((e=>z())),o:e.unref(I).is_open},e.unref(I).is_open?e.e({p:e.o((o=>e.unref(h).automatic_clip=o)),q:e.p({size:"36","active-value":1,"inactive-value":0,modelValue:e.unref(h).automatic_clip})},{},{}):{},{w:e.unref(T)?"":1,x:o._imports_3$1,y:e.o((e=>{s.createVideoCopywriter.length&&(x.value=(x.value+1)%s.createVideoCopywriter.length,h.msg=s.createVideoCopywriter[x.value])})),z:o._imports_4$2,A:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(D)}`,B:e.o(J),C:e.o((o=>e.unref(h).msg=o)),D:e.p({type:"textarea",height:"364",placeholder:"请输入或粘贴您的文案 ...","placeholder-style":"color: #00000033; font-size: 26rpx;",disabled:!0,maxlength:e.unref(D),modelValue:e.unref(h).msg}),E:e.unref(h).msg},e.unref(h).msg?{F:e.t(e.unref(h).msg.length),G:e.t(e.unref(D))}:{},{H:o._imports_3$2,I:e.o((e=>{C.value=!0})),J:e.o((o=>{var i;$.value?null==(i=M.value)||i.confirm():h.model_version?1==h.voice_type||h.voice_id?h.msg||(e.index.$u.toast("请先输入视频文案"),J()):(e.index.$u.toast("请先选择音色"),z()):k()}))}),{K:e.o((e=>j.value=!1)),L:e.o((o=>e.isRef(j)?j.value=o:null)),M:e.p({title:"视频预览","video-url":e.unref(w),modelValue:e.unref(j)}),N:e.o(b),O:e.o((o=>e.isRef(f)?f.value=o:null)),P:e.p({show:e.unref(f)}),Q:e.o(G),R:e.o((o=>e.isRef(E)?E.value=o:null)),S:e.p({"model-version":e.unref(h).model_version,"active-tone":e.unref(h).voice_id,"show-original-tone":e.unref(S),modelValue:e.unref(E)}),T:e.o(O),U:e.o((o=>e.isRef(y)?y.value=o:null)),V:e.p({show:e.unref(y)}),W:e.o((o=>e.isRef(C)?C.value=o:null)),X:e.p({"model-version":e.unref(h).model_version,modelValue:e.unref(C)}),Y:e.sr(H,"a6e19e17-10",{k:"contentInputRef"}),Z:e.o((o=>e.unref(h).msg=o)),aa:e.p({"text-limit":e.unref(D),"model-value":e.unref(h).msg}),ab:e.sr(M,"a6e19e17-11",{k:"createPanelRef"}),ac:e.o(B),ad:e.o(U),ae:e.p({formData:e.unref(h)}),af:e.o(P),ag:e.o((e=>q.value=!1)),ah:e.p({"show-agreement":e.unref(q)}),ai:e.sr(A,"a6e19e17-13",{k:"rechargePopupRef"})})}}),f=e._export_sfc(g,[["__scopeId","data-v-a6e19e17"]]);wx.createPage(f);
