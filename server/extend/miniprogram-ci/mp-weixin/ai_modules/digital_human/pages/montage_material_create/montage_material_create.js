"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),r=require("../../../../api/digital_human.js"),i=require("../../../../stores/user.js"),n=require("../../enums/index.js"),o=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("confirm-dialog")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+a+u+s+l+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const a=()=>"../../components/choose-tone/choose-tone.js",u=()=>"../../../../components/video-preview/video-preview.js",s=()=>"../../components/create-success-pop/create-success-pop.js",l=()=>"../../components/tokens-cost/tokens-cost.js",c=e.defineComponent({__name:"montage_material_create",setup(a){const{on:u}=o.useEventBusManager(),s=i.useUserStore(),{userTokens:l}=e.toRefs(s),c=e.ref([{step:1,title:"上传素材"},{step:2,title:"填写文案"},{step:3,title:"生成设置"}]),p=e.ref(1),m=e.reactive({anchorLists:[],copywriterList:[],materialList:[],name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"素材混剪",video_count:1,shanjian_type:n.MontageTypeEnum.MATERIAL_MIX,extra:!1,voice:""}),f=e.ref(!1),d=e.ref(-1),v=e.reactive({pic:"",url:""}),g=e.ref(!1),h=e.ref(-1);e.reactive({poster:"",url:""});const _=e.ref(!1),y=e.ref({}),j=e.ref(!1),x=e.ref(null),L=e.ref(!1),w=e.shallowRef(),q=e=>{switch(e){case 1:return m.materialList.length>0;case 2:return m.copywriterList.length>0;case 3:return!0;default:return!1}},b=e.computed(()=>q(p.value)),k=(t,r)=>{if("prev"!==r)if("next"!==r){if(t!==p.value)if(t<p.value)p.value=t;else{for(let r=1;r<t;r++)if(!q(r))return void e.index.$u.toast("请按顺序完成步骤");p.value=t}}else if(b.value)p.value++;else{const t={1:"请上传素材图组",2:"请至少添加一条文案"};e.index.$u.toast(t[p.value]||"请完成当前步骤")}else p.value--},E=t=>{d.value=t??-1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_material_group/montage_material_group",params:{materialList:-1!==d.value?JSON.stringify(m.materialList[d.value]):""}})},B=()=>{m.materialList.splice(d.value,1),f.value=!1},R=t=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_copywriter/montage_copywriter",params:{data:t?JSON.stringify(t):""}})},T=e=>{m.voice=e.voice_id,y.value=e,_.value=!1},C=t=>{if("minus"===t){if(m.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");m.video_count--}else{if(m.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");m.video_count++}},M=async()=>{var t;if(l.value<0)null==(t=w.value)||t.open();else if(m.name){if(!m.voice)return e.index.$u.toast("请选择音色"),void(_.value=!0);if(m.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const t=await r.createShanjianTask({name:m.name,copywriting:m.copywriterList,extra:m.extra,material:m.materialList.map(e=>e.map(e=>({fileUrl:e.url,type:e.type,cover:e.pic}))),shanjian_type:m.shanjian_type,video_count:m.video_count,voice:m.voice});e.index.hideLoading(),x.value=t,j.value=!0}catch(i){e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})}}}else e.index.$u.toast("请输入视频名称")},$=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"redirect",params:{task_id:JSON.stringify([x.value.id]),scene:1,type:m.shanjian_type}})},A=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return e.onLoad(()=>{u("confirm",e=>{const{type:t,data:r}=e;if(t===n.ListenerTypeEnum.MONTAGE_COPYWRITER||t===n.ListenerTypeEnum.MONTAGE_AI_COPYWRITER){if(0==r.length)return;-1!==h.value?m.copywriterList[h.value]=r[0]:m.copywriterList=m.copywriterList.concat(r)}if(t===n.ListenerTypeEnum.MONTAGE_MATERIAL_GROUP)if(-1!==d.value){if(0==r.length)return void m.materialList.splice(d.value,1);m.materialList[d.value]=r}else m.materialList.push(r)})}),(r,i)=>e.e({a:e.p({title:"素材混剪","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.f(e.unref(c),(t,r,i)=>e.e({a:e.unref(p)>t.step},e.unref(p)>t.step?{b:"81cdee00-1-"+i,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(t.title),e:t.step!==e.unref(c).length},t.step!==e.unref(c).length?{f:e.unref(p)>t.step?1:""}:{},{g:t.step,h:e.unref(p)==t.step?1:"",i:e.o(e=>k(t.step),t.step)})),c:1==e.unref(p)},1==e.unref(p)?e.e({d:e.o(e=>E()),e:e.unref(m).materialList.length>0},e.unref(m).materialList.length>0?{f:e.f(e.unref(m).materialList,(t,r,i)=>({a:e.t(r+1),b:e.t(t.length),c:"81cdee00-2-"+i,d:e.f(t,(e,t,r)=>({a:e.pic,b:t})),e:e.o(e=>(e=>{f.value=!0,d.value=e})(r),r),f:r,g:e.o(e=>E(r),r)})),g:e.p({name:"arrow-right",color:"#B2B2B2",size:20})}:{h:e.p({size:260,text:"您还没有图组哦"}),i:e.p({name:"plus",size:"24"}),j:e.o(e=>E())}):{},{k:2===e.unref(p)},2===e.unref(p)?{l:e.o(e=>R()),m:e.o(e=>h.value=-1),n:e.f(e.unref(m).copywriterList,(t,r,i)=>({a:e.t(t.title),b:e.t(t.content),c:"81cdee00-5-"+i,d:e.o(e=>(e=>{m.copywriterList.splice(e,1)})(r),r),e:r,f:e.o(e=>(e=>{h.value=e;const t=m.copywriterList[e];R(t)})(r),r)})),o:e.p({name:"close",color:"#ffffff",size:"16"})}:{},{p:3==e.unref(p)},3==e.unref(p)?{q:e.o(t=>e.unref(m).name=t),r:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(m).name}),s:e.t(e.unref(m).materialList.length),t:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),v:e.o(e=>k(1)),w:e.t(e.unref(m).copywriterList.length),x:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),y:e.o(e=>k(2)),z:e.t(e.unref(y).name||"请选择音色"),A:e.n(e.unref(y).name?"text-primary":"text-_hB2B2B2_"),B:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),C:e.o(e=>_.value=!0),D:e.o(t=>e.unref(m).extra=t),E:e.p({"inactive-color":"#E5E5E5",size:40,modelValue:e.unref(m).extra}),F:t._imports_2$4,G:e.o(e=>C("minus")),H:e.o(t=>e.unref(m).video_count=t),I:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(m).video_count}),J:t._imports_3$6,K:e.o(e=>C("add"))}:{},{L:e.unref(p)!=e.unref(c).length},e.unref(p)!=e.unref(c).length?e.e({M:1===e.unref(p)},1===e.unref(p)?{N:e.t(e.unref(m).anchorLists.length),O:e.n(e.unref(m).anchorLists.length>0?"bg-black":"bg-_h787878CC_")}:{P:e.o(t=>k(e.unref(p),"prev"))},{Q:e.n(e.unref(b)?"bg-black":"bg-_h787878CC_"),R:e.o(t=>k(e.unref(p),"next"))}):{S:t._imports_3$2,T:e.o(e=>L.value=!0),U:e.t(e.unref(m).video_count),V:e.o(M)},{W:e.o(B),X:e.o(t=>e.isRef(f)?f.value=t:null),Y:e.p({"confirm-text":"删除",center:!0,content:"是否确定删除该图组？",modelValue:e.unref(f)}),Z:e.o(T),aa:e.o(t=>e.isRef(_)?_.value=t:null),ab:e.p({"model-version":e.unref(n.DigitalHumanModelVersionEnum).SHANJIAN,"active-tone":e.unref(m).voice,"show-free-tone":!1,modelValue:e.unref(_)}),ac:e.o(t=>e.isRef(g)?g.value=t:null),ad:e.p({"video-url":e.unref(v).url,poster:e.unref(v).pic,modelValue:e.unref(g)}),ae:e.o($),af:e.o(A),ag:e.o(t=>e.isRef(j)?j.value=t:null),ah:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(j)}),ai:e.o(t=>e.isRef(L)?L.value=t:null),aj:e.p({type:3,modelValue:e.unref(L)}),ak:e.sr(w,"81cdee00-17",{k:"rechargePopupRef"})})}});wx.createPage(c);
