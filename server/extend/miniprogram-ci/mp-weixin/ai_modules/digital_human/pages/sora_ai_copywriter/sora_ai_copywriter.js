"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),n=require("../../../../api/digital_human.js"),u=require("../../../../stores/user.js"),r=require("../../../../enums/appEnums.js"),s=require("../../enums/index.js"),i=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js"))();const a=e.defineComponent({__name:"sora_ai_copywriter",setup(a){const{emit:o}=i.useEventBusManager(),l=u.useUserStore(),{userTokens:c}=e.toRefs(l),m=e.ref(""),p=e.ref(150),d=e.ref([]),f=[{id:1,name:"长",length:500},{id:2,name:"中",length:300},{id:3,name:"短",length:150}],v=e.computed(()=>f),g=e.ref(1),h=e.ref(v.value[0]),j=e.ref(!1),q=e.computed(()=>d.value.every(e=>"success"===e.status)),_=e.computed(()=>{var e;const t=null==(e=l.getTokenByScene(r.TokensSceneEnum.SHANJIAN_COPYWRITING_CREATE))?void 0:e.score;return parseFloat(t)*g.value}),x=async t=>{if(t.trim()){if(q.value)if(c.value<_.value)e.index.$u.toast("算力不足，请充值！");else try{j.value=!0,d.value=Array.from({length:g.value},()=>({title:"",content:"",status:"pending"}));const e=[];for(let r=0;r<g.value;r++)e.push(n.generateShanjianPrompt({keywords:t,number:h.value.length}));const u=await Promise.all(e);d.value=u.map(e=>({title:e.title,content:e.content,status:"success"}))}catch(u){j.value=!1,e.index.showToast({title:u||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},k=()=>{q.value?(o("confirm",{type:s.ListenerTypeEnum.SORA_COPYWRITER,data:d.value.filter(e=>e.title).map(e=>({title:e.title,content:e.content}))}),d.value=[],e.index.navigateBack()):e.index.$u.toast("文案在生成中...")};return e.onLoad(e=>{p.value=e.limit}),(n,u)=>e.e({a:!e.unref(j)},e.unref(j)?{h:e.f(e.unref(d),(n,u,r)=>e.e({a:"pending"===n.status},"pending"===n.status?{b:t._imports_0$14,c:e.t(u+1)}:{d:"4a047250-0-"+r,e:e.o(e=>n.title=e,u),f:e.p({"placeholder-style":"color: #7C7E80; ",maxlength:"50",modelValue:n.title}),g:"4a047250-1-"+r,h:e.o(e=>n.content=e,u),i:e.p({type:"textarea","placeholder-style":"color: #7C7E80; ",maxlength:"500","auto-height":!1,modelValue:n.content}),j:e.t(n.content.length),k:"4a047250-2-"+r,l:e.p({name:"close",color:"#ffffff",size:"16"}),m:e.o(e=>(e=>{d.value.splice(e,1),0===d.value.length&&(j.value=!1)})(u),u)},{n:u}))}:{b:500,c:e.unref(m),d:e.o(t=>e.isRef(m)?m.value=t.detail.value:null),e:e.t(e.unref(m).length),f:e.t(500),g:e.f(e.unref(v),(t,n,u)=>{var r;return{a:e.t(t.name),b:t.id,c:(null==(r=e.unref(h))?void 0:r.id)===t.id?1:"",d:e.o(e=>h.value=t,t.id)}})},{i:!e.unref(j)},e.unref(j)?{m:e.o(t=>x(e.unref(m))),n:e.n(e.unref(q)?"bg-black":"bg-_h787878CC_"),o:e.o(k)}:{j:e.t(e.unref(_)),k:e.n(e.unref(m).length>0?"bg-black":"bg-_h787878CC_"),l:e.o(t=>x(e.unref(m)))})}}),o=e._export_sfc(a,[["__scopeId","data-v-4a047250"]]);wx.createPage(o);
