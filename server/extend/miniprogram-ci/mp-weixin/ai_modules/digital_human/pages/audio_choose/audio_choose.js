"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),i=require("../../../../api/material.js"),r=require("../../../../api/app.js"),t=require("../../../../hooks/useAudio.js"),s=require("../../../../components/file-upload/choose-file.js"),u=require("../../enums/index.js"),o=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("u-button"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const n=e.defineComponent({__name:"audio_choose",setup(n){const{emit:l}=o.useEventBusManager(),p=[{name:"系统",value:"system"},{name:"我的",value:"0"},{name:"科技",value:"1"},{name:"悬疑",value:"2"},{name:"抒情",value:"3"},{name:"欢快",value:"4"},{name:"古典",value:"5"},{name:"跳跃",value:"6"}],m=e.ref(0),c=e=>{var a;m.value=e,null==(a=v.value)||a.reload()},d=e.ref([]),v=e.ref(),g=async(e,a)=>{var r,t;try{const t=p[m.value].value;let s=[];"system"==t?(({lists:s}=await i.getMaterialLibraryList({m_type:6,page_no:e,page_size:a})),s=s.map((e=>({...e,url:e.content,id:`${e.id}-system`})))):({lists:s}=await i.getMaterialMusicList({page_no:e,page_size:a,style:t})),null==(r=v.value)||r.complete(s)}catch(s){null==(t=v.value)||t.complete([])}},h=async()=>{const e=await s.chooseFile({count:9,type:"file",extension:[".mp3",".wav"]});f(e)},f=async a=>{const{tempFiles:i}=a;i.forEach((a=>{a.size>20971520?e.index.$u.toast("文件包含超过20M，无法上传"):j(a)}))},j=async a=>{var t;try{s="上传中",e.index.showLoading({title:s,mask:!0});const{uri:u}=await r.uploadFile("audio",{filePath:a.path});e.index.hideLoading(),await i.addMaterialMusic({url:u,name:a.name,type:"0"}),e.index.$u.toast("上传成功"),null==(t=v.value)||t.reload()}catch(u){((a,i=5e3)=>{e.index.showToast({title:a,icon:"none",duration:i})})(u||"解析失败")}finally{e.index.hideLoading()}var s},y=e.ref(),{play:q,setUrl:x,pause:b,pauseAll:_,isPlaying:w}=t.useAudio(),k=e.ref(),C=e=>{var a;return(null==(a=k.value)?void 0:a.id)==e},M=()=>{0!=k.value.length?(l("confirm",{type:u.ListenerTypeEnum.CHOOSE_MUSIC,data:k.value}),e.index.navigateBack()):e.index.$u.toast("请选择背景音乐")};return e.onLoad((a=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})})),(i,r)=>e.e({a:e.o(c),b:e.p({list:p,current:e.unref(m),height:"100","bar-width":"108","font-size":"26rpx","bg-color":"#F9FAFB",gutter:"40","active-color":"#000000","inactive-color":"#00000080","bar-style":{backgroundColor:"var(--color-primary)",height:"4rpx",bottom:"-5rpx"}}),c:e.f(e.unref(d),((i,r,t)=>e.e({a:C(i.id)},C(i.id)?{b:a._imports_0$8}:{c:a._imports_1$6},{d:e.n(C(i.id)?"bg-primary":"bg-_h0000000d_"),e:e.t(i.name),f:e.t(e.unref(w)&&e.unref(y)==i.id?"暂停":"播放"),g:e.n(C(i.id)?"text-primary":"text-_h00000080_"),h:e.o((e=>(({id:e,url:a})=>{w.value&&y.value!==e&&_(),w.value?b():(y.value!==e&&x(a),q(),y.value=e)})(i)),r),i:C(i.id)},C(i.id)?{j:a._imports_1$7}:{k:a._imports_2$3},{l:r,m:C(i.id)?1:"",n:e.o((e=>{var a;C((a=i).id)?k.value="":k.value=a}),r)}))),d:e.sr(v,"482cbc38-1",{k:"pagingRef"}),e:e.o(g),f:e.o((a=>e.isRef(d)?d.value=a:null)),g:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(d)}),h:"0"==p[e.unref(m)].value},"0"==p[e.unref(m)].value?{i:e.o(h)}:{},{j:e.o(M),k:e.p({type:"primary",shape:"circle","custom-style":{width:"100%",height:"100rpx",boxShadow:"0 6px 12px 0 rgba(0, 101, 251, 0.20)",fontSize:"26rpx"}})})}});wx.createPage(n);
