"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/app.js"),r=require("../../../../utils/util.js"),n=require("../../enums/index.js"),a=require("../../../../stores/app.js"),t=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){e.resolveComponent("u-loading")()}Math;const s=e.defineComponent({__name:"anchor_auth_camera",setup(s){const{emit:u}=t.useEventBusManager(),o=a.useAppStore(),d=e.computed((()=>o.getDigitalHumanConfig.shanjian_auth)),l=e.ref(!0),c=e.ref(0),h=e.ref(180);let m=e.ref(),q=e.ref();const f=e.ref(!0),p=()=>{l.value=!1,q.value=e.index.createCameraContext(),q.value.startRecord({success:e=>{v()},fail:i=>{e.index.showToast({title:i||"录制失败",icon:"none",duration:3e3})}})},v=()=>{m.value=setInterval((()=>{c.value++,c.value>=h.value&&j()}),1e3)},j=async()=>{f.value&&(c.value<5?e.index.showToast({title:"录制时间不能小于5秒",icon:"none",duration:3e3}):(clearInterval(m.value),e.index.showLoading({title:"正在结束录制...",mask:!0}),q.value.stopRecord({success:async r=>{const{tempThumbPath:a,tempVideoPath:t}=r;e.index.hideLoading(),e.index.showLoading({title:"正在上传...",mask:!0});try{const[s,o]=await Promise.all([i.uploadFile("image",{filePath:a}),i.uploadFile("video",{filePath:t})]);e.index.hideLoading(),e.index.showToast({title:"上传成功，即将返回上一页",icon:"none",duration:3e3}),e.index.navigateBack(),u("confirm",{type:n.ListenerTypeEnum.UPLOAD_AUTH_CAMERA,data:{...r,pic:s.uri,url:o.uri}})}catch(s){e.index.hideLoading(),e.index.showToast({title:s||"上传失败，请重新上传",icon:"none",duration:3e3})}},fail:i=>{e.index.hideLoading()}})))},g=i=>{e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})};return e.onUnload((()=>{f.value=!1,clearInterval(m.value),e.index.hideLoading()})),(i,n)=>e.e({a:e.unref(f)},e.unref(f)?{b:e.o(p),c:e.o(g),d:e.o(j)}:{},{e:e.t(e.unref(d)),f:e.t(e.unref(r.formatAudioTime)(e.unref(c))),g:e.o(j),h:e.unref(l)},e.unref(l)?{i:e.p({size:"40"})}:{})}});wx.createPage(s);
