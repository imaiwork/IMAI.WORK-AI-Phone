"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),u=require("../../../../api/digital_human.js"),l=require("../../../../stores/user.js"),t=require("../../../../hooks/useKeyboardHeight.js"),r=require("../../../../hooks/useUpload.js"),o=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("u-popup")+e.resolveComponent("upload-progress")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+i+n+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const n=()=>"../../components/tokens-cost/tokens-cost.js",i=()=>"../../components/create-success-pop/create-success-pop.js",s=e.defineComponent({__name:"sora_create",setup(n){const i=l.useUserStore(),{userTokens:s}=e.toRefs(i),v=e.reactive({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"一句话生成视频",content:"",materialList:[],videoStyle:1,videoResolution:1,aspect_ratio:"16:9",videoDuration:1,videoSwitchFrequency:1,video_count:1,ai_type:1}),d=e.ref([{step:1,title:"视频主题"},{step:2,title:"素材参考"},{step:3,title:"风格设置"},{step:4,title:"生成设置"}]),c=e.ref(1),{dynamicHeight:f,hideKeyboard:p}=t.useKeyboardHeight(),m=[{label:"营销模版",value:"marketing"},{label:"自由创作",value:"creation"}],b=e.ref("marketing"),h=e.computed(()=>m.findIndex(e=>e.value==b.value)),g=e.computed(()=>m[h.value]),_=[{label:"商品宣传",value:"goods"},{label:"门店宣传",value:"store"},{label:"团购套餐宣传",value:"group"}],x=e.ref("goods"),y=[{label:"男",value:"male"},{label:"女",value:"female"},{label:"无人物",value:"nobody"}],j=e.ref("male"),q=e.ref([{label:"宣传片",value:"ad"},{label:"产品展示",value:"product"},{label:"品牌推广",value:"brand"},{label:"Vlog",value:"vlog"},{label:"剧情片",value:"story"},{label:"教程",value:"tutorial"},{label:"自定义",value:"custom",isInt:!1}]),w=e.ref("ad"),k=[{label:"标准",value:1},{label:"商业",value:2},{label:"纪实",value:3},{label:"温馨",value:4},{label:"极简",value:5},{label:"科幻",value:6},{label:"色彩",value:7}],L=[{label:"横屏16:9",value:"16:9"},{label:"竖屏9:16",value:"9:16"}],S=[{label:"10s",value:1}],$=[{label:"中",value:1},{label:"低",value:2},{label:"高",value:3}],B=e.ref(!1),C=e.ref(""),R=500,V=e.ref(0),z=e.ref(!1),E=e.ref(!1),I=e.ref(null),D=e.shallowRef(),F=e.computed(()=>M(c.value)),M=e=>{switch(e){case 1:case 3:return!0;case 2:return 0!==V.value||v.materialList.length>0;default:return!1}},A=e.computed(()=>({goods:{title:"商品宣传",placeholder:"(选填)，例如：该商品是xx品牌，主要功能是xx，面向的人群是xx等"},store:{title:"门店宣传",placeholder:"(选填)，例如：该店位于xx位置，主打的是xx产品等"},group:{title:"团购套餐宣传",placeholder:"(选填)，例如：该套餐名称叫xx，原价xx元，现在活动团购价xx元，套餐里包含xx等"}}[x.value])),P=(a,u)=>{if("prev"!==u)if("next"!==u){if(a!==c.value)if(a<c.value)c.value=a;else{for(let u=1;u<a;u++)if(!M(u))return void e.index.$u.toast("请按顺序完成步骤");c.value=a}}else if(F.value)c.value++;else{const a={1:"请填写视频标题和视频描述",2:"请至少添加一条素材"};e.index.$u.toast(a[c.value]||"请完成当前步骤")}else c.value--},U=()=>{B.value=!1,C.value=""},H=()=>{C.value?(B.value=!1,w.value="custom",q.value.forEach(e=>{"custom"==e.value&&(e.label=C.value,e.isInt=!0)})):e.index.$u.toast("请输入内容")},{showUploadProgress:K,uploadMaterialList:O,uploadAndProcessFiles:T}=r.useUpload({count:1,onSuccess:e=>{v.materialList=v.materialList.concat(e)}}),J=a=>{if("minus"===a){if(v.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");v.video_count--}else{if(v.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");v.video_count++}},N=async()=>{var a,l,t,r,o;if(s.value<0)null==(a=D.value)||a.open();else if(v.name)if(v.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const a=await u.createSoraVideo({name:v.name,theme:null==(l=q.value.find(e=>e.value==w.value))?void 0:l.label,content:v.content,gender:null==(t=y.find(e=>e.value==j.value))?void 0:t.label,image_urls:v.materialList.map(e=>e.pic),style:null==(r=k.find(e=>e.value==v.videoStyle))?void 0:r.label,frequency:null==(o=$.find(e=>e.value==v.videoSwitchFrequency))?void 0:o.label,aspect_ratio:v.aspect_ratio,duration:v.videoDuration,number:v.video_count});e.index.hideLoading(),I.value=a,z.value=!0}catch(n){e.index.hideLoading(),e.index.showToast({title:n,icon:"none",duration:3e3})}}else e.index.$u.toast("请输入视频名称")},X=()=>{z.value=!1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"reLaunch",params:{task_id:JSON.stringify([I.value.id]),scene:1,type:o.MontageTypeEnum.SORA_VIDEO}})},G=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return e.onUnload(()=>{p()}),(u,l)=>{var t,r,o,n,i;return e.e({a:e.p({"title-bold":!0,title:"一句话生成视频","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(d),(a,u,l)=>e.e({a:e.unref(c)>a.step},e.unref(c)>a.step?{b:"782382cc-1-"+l,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(a.title),e:a.step!==e.unref(d).length},a.step!==e.unref(d).length?{f:e.unref(c)>a.step?1:""}:{},{g:a.step,h:e.unref(c)==a.step?1:"",i:e.o(e=>P(a.step),a.step)})),c:1==e.unref(c)},1==e.unref(c)?e.e({d:e.f(m,(a,u,l)=>({a:e.t(a.label),b:u,c:a.value==e.unref(b)?1:"",d:e.o(e=>{return u=a.value,void(b.value!=u&&(b.value=u));var u},u)})),e:`translateX(${100*e.unref(h)}%)`,f:e.f(_,(a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(x)?1:"",d:e.o(e=>{return u=a.value,void(x.value!=u&&(x.value=u));var u},a.value)})),g:"marketing"==e.unref(b),h:e.f(e.unref(q),(a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(w)?1:"",d:e.o(e=>(e=>{if("custom"==e){B.value=!0;const a=q.value.find(a=>a.value==e);(null==a?void 0:a.isInt)&&(C.value=a.label)}else w.value=e})(a.value),a.value)})),i:"creation"==e.unref(b)||"long_video"==e.unref(b),j:e.f(y,(a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(j)?1:"",d:e.o(e=>{return u=a.value,void(j.value!=u&&(j.value=u));var u},a.value)})),k:e.t(e.unref(A).title),l:R,m:e.unref(A).placeholder,n:e.unref(v).content,o:e.o(a=>e.unref(v).content=a.detail.value),p:e.t(e.unref(v).content.length),q:e.t(R),r:"marketing"==e.unref(b),s:"creation"==e.unref(b)},"creation"==e.unref(b)?{t:R,v:e.unref(v).content,w:e.o(a=>e.unref(v).content=a.detail.value),x:e.t(e.unref(v).content.length),y:e.t(R)}:{},{z:e.unref(f)+"px",A:0==e.unref(f),B:0==e.unref(f)?0:e.unref(f)/2}):{},{C:2==e.unref(c)},2==e.unref(c)?e.e({D:e.f(["使用素材","不使用素材"],(a,u,l)=>({a:e.t(a),b:u,c:u==e.unref(V)?1:"",d:e.o(e=>V.value=u,u)})),E:`translateX(${100*e.unref(V)}%)`,F:0===e.unref(V)},0===e.unref(V)?e.e({G:e.f(e.unref(v).materialList,(a,u,l)=>({a:a.pic,b:e.o(u=>(a=>{const{pic:u}=a;e.index.previewImage({urls:[u]})})(a),u),c:"782382cc-2-"+l,d:e.o(e=>{return u=a.id,void(v.materialList=v.materialList.filter(e=>e.id!==u));var u},u),e:u})),H:a._imports_0$11,I:e.p({name:"close",color:"#ffffff",size:"16"}),J:e.unref(v).materialList.length<1},e.unref(v).materialList.length<1?{K:a._imports_0$6,L:e.o(a=>e.unref(T)("image"))}:{}):{}):{},{M:3==e.unref(c)},3==e.unref(c)?{N:e.f(k,(a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoStyle==a.value?1:"",d:e.o(u=>e.unref(v).videoStyle=a.value,u)})),O:e.f(L,(a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).aspect_ratio==a.value?1:"",d:e.o(u=>e.unref(v).aspect_ratio=a.value,u)})),P:e.f(S,(a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoDuration==a.value?1:"",d:e.o(u=>e.unref(v).videoDuration=a.value,u)})),Q:e.f($,(a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoSwitchFrequency==a.value?1:"",d:e.o(u=>e.unref(v).videoSwitchFrequency=a.value,u)}))}:{},{R:4==e.unref(c)},4==e.unref(c)?{S:e.o(a=>e.unref(v).name=a),T:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(v).name}),U:a._imports_2$4,V:e.o(e=>J("minus")),W:e.o(a=>e.unref(v).video_count=a),X:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(v).video_count}),Y:a._imports_3$6,Z:e.o(e=>J("add")),aa:e.t("long_video"==e.unref(b)?"智能剪辑":"AI优化内容"),ab:e.o(a=>e.unref(v).ai_type=a),ac:e.p({"active-value":1,"inactive-value":0,"inactive-color":"#E5E5E5",size:40,modelValue:e.unref(v).ai_type}),ad:e.t(e.unref(g).label),ae:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),af:e.o(e=>P(1)),ag:e.t(null==(t=y.find(a=>a.value==e.unref(j)))?void 0:t.label),ah:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ai:e.o(e=>P(1)),aj:e.t(e.unref(v).materialList.length),ak:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),al:e.o(e=>P(2)),am:e.t(null==(r=k.find(a=>a.value==e.unref(v).videoStyle))?void 0:r.label),an:e.t(null==(o=L.find(a=>a.value==e.unref(v).aspect_ratio))?void 0:o.label),ao:e.t(null==(n=S.find(a=>a.value==e.unref(v).videoDuration))?void 0:n.label),ap:e.t(null==(i=$.find(a=>a.value==e.unref(v).videoSwitchFrequency))?void 0:i.label),aq:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ar:e.o(e=>P(3))}:{},{as:e.unref(c)!=e.unref(d).length},e.unref(c)!=e.unref(d).length?e.e({at:1!=e.unref(c)},1!=e.unref(c)?{av:e.o(a=>P(e.unref(c),"prev"))}:{},{aw:e.n(e.unref(F)?"bg-black":"bg-_h787878CC_"),ax:e.o(a=>P(e.unref(c),"next"))}):{ay:a._imports_3$2,az:e.o(e=>E.value=!0),aA:e.t(e.unref(v).video_count),aB:e.o(N)},{aC:e.n(1==e.unref(c)?"justify-end":"justify-between"),aD:e.o(a=>e.isRef(C)?C.value=a:null),aE:e.p({placeholder:"请输入",maxlength:"50","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(C)}),aF:e.o(U),aG:e.o(H),aH:e.o(U),aI:e.o(a=>e.isRef(B)?B.value=a:null),aJ:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(B)}),aK:e.o(a=>e.isRef(K)?K.value=a:null),aL:e.p({"upload-list":e.unref(O),modelValue:e.unref(K)}),aM:e.o(X),aN:e.o(G),aO:e.o(a=>e.isRef(z)?z.value=a:null),aP:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(z)}),aQ:e.o(a=>e.isRef(E)?E.value=a:null),aR:e.p({type:5,modelValue:e.unref(E)}),aS:e.sr(D,"782382cc-15",{k:"rechargePopupRef"})})}}}),v=e._export_sfc(s,[["__scopeId","data-v-782382cc"]]);wx.createPage(v);
