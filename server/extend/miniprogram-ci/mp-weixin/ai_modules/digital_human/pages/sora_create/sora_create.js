"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),u=require("../../../../api/digital_human.js"),l=require("../../../../stores/user.js"),t=require("../../../../hooks/useKeyboardHeight.js"),r=require("../../../../hooks/useUpload.js"),o=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("u-popup")+e.resolveComponent("upload-progress")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+i+n+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const n=()=>"../../components/tokens-cost/tokens-cost.js",i=()=>"../../components/create-success-pop/create-success-pop.js",s=e.defineComponent({__name:"sora_create",setup(n){const i=l.useUserStore(),{userTokens:s}=e.toRefs(i),v=e.reactive({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"一句话生成视频",content:"",materialList:[],videoStyle:1,videoResolution:1,aspect_ratio:"16:9",videoDuration:1,videoSwitchFrequency:1,video_count:1,ai_type:1}),d=e.ref([{step:1,title:"视频主题"},{step:2,title:"素材参考"},{step:3,title:"风格设置"},{step:4,title:"生成设置"}]),f=e.ref(1),{dynamicHeight:c}=t.useKeyboardHeight(),p=[{label:"营销模版",value:"marketing"},{label:"自由创作",value:"creation"}],m=e.ref("marketing"),b=e.computed((()=>p.findIndex((e=>e.value==m.value)))),h=e.computed((()=>p[b.value])),g=[{label:"商品宣传",value:"goods"},{label:"门店宣传",value:"store"},{label:"团购套餐宣传",value:"group"}],_=e.ref("goods"),x=[{label:"男",value:"male"},{label:"女",value:"female"},{label:"无人物",value:"nobody"}],y=e.ref("male"),j=e.ref([{label:"宣传片",value:"ad"},{label:"产品展示",value:"product"},{label:"品牌推广",value:"brand"},{label:"Vlog",value:"vlog"},{label:"剧情片",value:"story"},{label:"教程",value:"tutorial"},{label:"自定义",value:"custom",isInt:!1}]),q=e.ref("ad"),w=[{label:"标准",value:1},{label:"商业",value:2},{label:"纪实",value:3},{label:"温馨",value:4},{label:"极简",value:5},{label:"科幻",value:6},{label:"色彩",value:7}],k=[{label:"横屏16:9",value:"16:9"},{label:"竖屏9:16",value:"9:16"}],L=[{label:"10s",value:1}],S=[{label:"中",value:1},{label:"低",value:2},{label:"高",value:3}],$=e.ref(!1),B=e.ref(""),C=500,R=e.ref(0),V=e.ref(!1),z=e.ref(!1),E=e.ref(null),I=e.shallowRef(),D=e.computed((()=>F(f.value))),F=e=>{switch(e){case 1:case 3:return!0;case 2:return 0!==R.value||v.materialList.length>0;default:return!1}},M=e.computed((()=>({goods:{title:"商品宣传",placeholder:"(选填)，例如：该商品是xx品牌，主要功能是xx，面向的人群是xx等"},store:{title:"门店宣传",placeholder:"(选填)，例如：该店位于xx位置，主打的是xx产品等"},group:{title:"团购套餐宣传",placeholder:"(选填)，例如：该套餐名称叫xx，原价xx元，现在活动团购价xx元，套餐里包含xx等"}}[_.value]))),A=(a,u)=>{if("prev"!==u)if("next"!==u){if(a!==f.value)if(a<f.value)f.value=a;else{for(let u=1;u<a;u++)if(!F(u))return void e.index.$u.toast("请按顺序完成步骤");f.value=a}}else if(D.value)f.value++;else{const a={1:"请填写视频标题和视频描述",2:"请至少添加一条素材"};e.index.$u.toast(a[f.value]||"请完成当前步骤")}else f.value--},P=()=>{$.value=!1,B.value=""},H=()=>{B.value?($.value=!1,q.value="custom",j.value.forEach((e=>{"custom"==e.value&&(e.label=B.value,e.isInt=!0)}))):e.index.$u.toast("请输入内容")},{showUploadProgress:O,uploadMaterialList:T,uploadAndProcessFiles:U}=r.useUpload({count:1,onSuccess:e=>{v.materialList=v.materialList.concat(e)}}),K=a=>{if("minus"===a){if(v.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");v.video_count--}else{if(v.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");v.video_count++}},J=async()=>{var a,l,t,r,o;if(s.value<0)null==(a=I.value)||a.open();else if(v.name)if(v.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const a=await u.createSoraVideo({name:v.name,theme:null==(l=j.value.find((e=>e.value==q.value)))?void 0:l.label,content:v.content,gender:null==(t=x.find((e=>e.value==y.value)))?void 0:t.label,image_urls:v.materialList.map((e=>e.pic)),style:null==(r=w.find((e=>e.value==v.videoStyle)))?void 0:r.label,frequency:null==(o=S.find((e=>e.value==v.videoSwitchFrequency)))?void 0:o.label,aspect_ratio:v.aspect_ratio,duration:v.videoDuration,number:v.video_count});e.index.hideLoading(),E.value=a,V.value=!0}catch(n){e.index.hideLoading(),e.index.showToast({title:n,icon:"none",duration:3e3})}}else e.index.$u.toast("请输入视频名称")},N=()=>{V.value=!1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"reLaunch",params:{task_id:JSON.stringify([E.value.id]),scene:1,type:o.MontageTypeEnum.SORA_VIDEO}})},X=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return(u,l)=>{var t,r,o,n,i;return e.e({a:e.p({"title-bold":!0,title:"一句话生成视频","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(d),((a,u,l)=>e.e({a:e.unref(f)>a.step},e.unref(f)>a.step?{b:"562fdd7a-1-"+l,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(a.title),e:a.step!==e.unref(d).length},a.step!==e.unref(d).length?{f:e.unref(f)>a.step?1:""}:{},{g:a.step,h:e.unref(f)==a.step?1:"",i:e.o((e=>A(a.step)),a.step)}))),c:1==e.unref(f)},1==e.unref(f)?e.e({d:e.f(p,((a,u,l)=>({a:e.t(a.label),b:u,c:a.value==e.unref(m)?1:"",d:e.o((e=>{return u=a.value,void(m.value!=u&&(m.value=u));var u}),u)}))),e:`translateX(${100*e.unref(b)}%)`,f:e.f(g,((a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(_)?1:"",d:e.o((e=>{return u=a.value,void(_.value!=u&&(_.value=u));var u}),a.value)}))),g:"marketing"==e.unref(m),h:e.f(e.unref(j),((a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(q)?1:"",d:e.o((e=>(e=>{if("custom"==e){$.value=!0;const a=j.value.find((a=>a.value==e));(null==a?void 0:a.isInt)&&(B.value=a.label)}else q.value=e})(a.value)),a.value)}))),i:"creation"==e.unref(m)||"long_video"==e.unref(m),j:e.f(x,((a,u,l)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(y)?1:"",d:e.o((e=>{return u=a.value,void(y.value!=u&&(y.value=u));var u}),a.value)}))),k:e.t(e.unref(M).title),l:C,m:e.unref(M).placeholder,n:e.unref(v).content,o:e.o((a=>e.unref(v).content=a.detail.value)),p:e.t(e.unref(v).content.length),q:e.t(C),r:"marketing"==e.unref(m),s:"creation"==e.unref(m)},"creation"==e.unref(m)?{t:C,v:e.unref(v).content,w:e.o((a=>e.unref(v).content=a.detail.value)),x:e.t(e.unref(v).content.length),y:e.t(C)}:{},{z:e.unref(c)+"px",A:0==e.unref(c),B:0==e.unref(c)?0:e.unref(c)/2}):{},{C:2==e.unref(f)},2==e.unref(f)?e.e({D:e.f(["使用素材","不使用素材"],((a,u,l)=>({a:e.t(a),b:u,c:u==e.unref(R)?1:"",d:e.o((e=>R.value=u),u)}))),E:`translateX(${100*e.unref(R)}%)`,F:0===e.unref(R)},0===e.unref(R)?e.e({G:e.f(e.unref(v).materialList,((a,u,l)=>({a:a.pic,b:e.o((u=>(a=>{const{pic:u}=a;e.index.previewImage({urls:[u]})})(a)),u),c:"562fdd7a-2-"+l,d:e.o((e=>{return u=a.id,void(v.materialList=v.materialList.filter((e=>e.id!==u)));var u}),u),e:u}))),H:a._imports_0$11,I:e.p({name:"close",color:"#ffffff",size:"16"}),J:e.unref(v).materialList.length<1},e.unref(v).materialList.length<1?{K:a._imports_0$6,L:e.o((a=>e.unref(U)("image")))}:{}):{}):{},{M:3==e.unref(f)},3==e.unref(f)?{N:e.f(w,((a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoStyle==a.value?1:"",d:e.o((u=>e.unref(v).videoStyle=a.value),u)}))),O:e.f(k,((a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).aspect_ratio==a.value?1:"",d:e.o((u=>e.unref(v).aspect_ratio=a.value),u)}))),P:e.f(L,((a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoDuration==a.value?1:"",d:e.o((u=>e.unref(v).videoDuration=a.value),u)}))),Q:e.f(S,((a,u,l)=>({a:e.t(a.label),b:u,c:e.unref(v).videoSwitchFrequency==a.value?1:"",d:e.o((u=>e.unref(v).videoSwitchFrequency=a.value),u)})))}:{},{R:4==e.unref(f)},4==e.unref(f)?{S:e.o((a=>e.unref(v).name=a)),T:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(v).name}),U:a._imports_2$4,V:e.o((e=>K("minus"))),W:e.o((a=>e.unref(v).video_count=a)),X:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(v).video_count}),Y:a._imports_3$6,Z:e.o((e=>K("add"))),aa:e.t("long_video"==e.unref(m)?"智能剪辑":"AI优化内容"),ab:e.o((a=>e.unref(v).ai_type=a)),ac:e.p({"active-value":1,"inactive-value":0,"inactive-color":"#E5E5E5",size:40,modelValue:e.unref(v).ai_type}),ad:e.t(e.unref(h).label),ae:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),af:e.o((e=>A(1))),ag:e.t(null==(t=x.find((a=>a.value==e.unref(y))))?void 0:t.label),ah:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ai:e.o((e=>A(1))),aj:e.t(e.unref(v).materialList.length),ak:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),al:e.o((e=>A(2))),am:e.t(null==(r=w.find((a=>a.value==e.unref(v).videoStyle)))?void 0:r.label),an:e.t(null==(o=k.find((a=>a.value==e.unref(v).aspect_ratio)))?void 0:o.label),ao:e.t(null==(n=L.find((a=>a.value==e.unref(v).videoDuration)))?void 0:n.label),ap:e.t(null==(i=S.find((a=>a.value==e.unref(v).videoSwitchFrequency)))?void 0:i.label),aq:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ar:e.o((e=>A(3)))}:{},{as:e.unref(f)!=e.unref(d).length},e.unref(f)!=e.unref(d).length?e.e({at:1!=e.unref(f)},1!=e.unref(f)?{av:e.o((a=>A(e.unref(f),"prev")))}:{},{aw:e.n(e.unref(D)?"bg-black":"bg-_h787878CC_"),ax:e.o((a=>A(e.unref(f),"next")))}):{ay:a._imports_3$2,az:e.o((e=>z.value=!0)),aA:e.t(e.unref(v).video_count),aB:e.o(J)},{aC:e.n(1==e.unref(f)?"justify-end":"justify-between"),aD:e.o((a=>e.isRef(B)?B.value=a:null)),aE:e.p({placeholder:"请输入",maxlength:"50","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(B)}),aF:e.o(P),aG:e.o(H),aH:e.o(P),aI:e.o((a=>e.isRef($)?$.value=a:null)),aJ:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref($)}),aK:e.o((a=>e.isRef(O)?O.value=a:null)),aL:e.p({"upload-list":e.unref(T),modelValue:e.unref(O)}),aM:e.o(N),aN:e.o(X),aO:e.o((a=>e.isRef(V)?V.value=a:null)),aP:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(V)}),aQ:e.o((a=>e.isRef(z)?z.value=a:null)),aR:e.p({type:5,modelValue:e.unref(z)}),aS:e.sr(I,"562fdd7a-15",{k:"rechargePopupRef"})})}}}),v=e._export_sfc(s,[["__scopeId","data-v-562fdd7a"]]);wx.createPage(v);
