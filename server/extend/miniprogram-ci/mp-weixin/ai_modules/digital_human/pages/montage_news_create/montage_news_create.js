"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),r=require("../../../../api/digital_human.js"),n=require("../../../../stores/user.js"),a=require("../../enums/index.js"),i=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+o+u+s+l+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const o=()=>"../../components/choose-character/choose-character.js",s=()=>"../../components/create-success-pop/create-success-pop.js",u=()=>"../../../../components/video-preview/video-preview.js",l=()=>"../../components/tokens-cost/tokens-cost.js",p=e.defineComponent({__name:"montage_news_create",setup(o){const{on:s}=i.useEventBusManager(),u=n.useUserStore(),{userTokens:l}=e.toRefs(u),p=e.ref([{step:1,title:"上传视频"},{step:2,title:"填写身份"},{step:3,title:"填写文案"},{step:4,title:"生成设置"}]),c=e.ref(1),m=e.reactive({anchorLists:[],copywriterList:[],materialList:[],name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"新闻体视频",person_name:"",person_introduction:"",video_count:1,shanjian_type:a.MontageTypeEnum.NEWS_BODY}),f=e.ref(-1),d=e.reactive({pic:"",url:""}),v=e.ref(!1),h=e.ref(!1),_=e.ref(!1);e.reactive({poster:"",url:""});const g=e.ref(-1),y=e.ref(!1),j=e.ref(!1),L=e.ref(null),x=e.shallowRef(),w=e=>{switch(e){case 1:return m.materialList.length>0;case 2:return m.person_name&&m.person_introduction;case 3:return m.copywriterList.length>0;case 4:return!0;default:return!1}},b=e.computed((()=>w(c.value))),q=(t,r)=>{if("prev"!==r)if("next"!==r){if(t!==c.value)if(t<c.value)c.value=t;else{for(let r=1;r<t;r++)if(!w(r))return void e.index.$u.toast("请按顺序完成步骤");c.value=t}}else if(b.value)c.value++;else{const t={1:"请上传参考素材",2:"请填写人物名称和介绍",3:"请至少添加一条文案"};e.index.$u.toast(t[c.value]||"请完成当前步骤")}else c.value--},k=t=>{f.value=t??-1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_material_group/montage_material_group",params:{materialList:-1!==f.value?JSON.stringify(m.materialList[f.value]):""}})},T=e=>{m.person_name=e.name,m.person_introduction=e.introduced,_.value=!0,h.value=!1},C=t=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_copywriter/montage_copywriter",params:{data:t?JSON.stringify(t):"",montageType:m.shanjian_type}})},E=t=>{if("minus"===t){if(m.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");m.video_count--}else{if(m.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");m.video_count++}},$=async()=>{var t;if(l.value<0)null==(t=x.value)||t.open();else if(m.name)if(m.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const t=await r.createShanjianTask({name:m.name,copywriting:m.copywriterList.map((e=>({title:e}))),character_design:[{name:m.person_name,introduced:m.person_introduction}],material:m.materialList.map((e=>e.map((e=>({fileUrl:e.url,type:e.type,cover:e.pic}))))),shanjian_type:m.shanjian_type,video_count:m.video_count});e.index.hideLoading(),L.value=t,j.value=!0}catch(n){e.index.hideLoading(),e.index.showToast({title:n,icon:"none",duration:3e3})}}else e.index.$u.toast("请输入视频名称")},B=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"redirect",params:{task_id:JSON.stringify([L.value.id]),scene:1,type:m.shanjian_type}})},R=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return e.onLoad((()=>{s("confirm",(e=>{const{type:t,data:r}=e;if(t===a.ListenerTypeEnum.MONTAGE_COPYWRITER||t===a.ListenerTypeEnum.MONTAGE_AI_COPYWRITER){if(0==r.length)return;-1!==g.value?m.copywriterList[g.value]=r[0]:m.copywriterList.push(...r)}if(t===a.ListenerTypeEnum.MONTAGE_MATERIAL_GROUP)if(-1!==f.value){if(0==r.length)return void m.materialList.splice(f.value,1);m.materialList.splice(f.value,1,r)}else m.materialList.push(r)}))})),(r,n)=>e.e({a:e.p({title:"新闻体视频","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.f(e.unref(p),((t,r,n)=>e.e({a:e.unref(c)>t.step},e.unref(c)>t.step?{b:"abed0373-1-"+n,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(t.title),e:t.step!==e.unref(p).length},t.step!==e.unref(p).length?{f:e.unref(c)>t.step?1:""}:{},{g:t.step,h:e.unref(c)==t.step?1:"",i:e.o((e=>q(t.step)),t.step)}))),c:1==e.unref(c)},1==e.unref(c)?e.e({d:e.o((e=>k())),e:e.unref(m).materialList.length>0},e.unref(m).materialList.length>0?{f:e.f(e.unref(m).materialList,((t,r,n)=>({a:e.t(r+1),b:e.t(t.length),c:"abed0373-2-"+n,d:e.f(t,((e,t,r)=>({a:e.pic,b:t}))),e:e.o((e=>(e=>{m.materialList.splice(e,1)})(r)),r),f:r,g:e.o((e=>k(r)),r)}))),g:e.p({name:"arrow-right",color:"#B2B2B2",size:20})}:{h:e.p({size:260,text:"您还没有图组哦"}),i:e.p({name:"plus",size:"24"}),j:e.o((e=>k()))}):{},{k:2===e.unref(c)},2===e.unref(c)?{l:e.o((e=>_.value=!1)),m:e.o((t=>e.unref(m).person_name=t)),n:e.p({"placeholder-style":"font-size: 24rpx;",placeholder:"请输入人物名称",maxlength:"20",modelValue:e.unref(m).person_name}),o:e.o((e=>_.value=!1)),p:e.o((t=>e.unref(m).person_introduction=t)),q:e.p({"placeholder-style":"font-size: 24rpx;",placeholder:"请输入人物介绍",maxlength:"50",modelValue:e.unref(m).person_introduction}),r:t._imports_0$10,s:e.o((e=>h.value=!0))}:{},{t:3==e.unref(c)},3==e.unref(c)?{v:e.o((e=>C())),w:`/ai_modules/digital_human/pages/montage_ai_copywriter/montage_ai_copywriter?montageType=${e.unref(m).shanjian_type}`,x:e.o((e=>g.value=-1)),y:e.f(e.unref(m).copywriterList,((t,r,n)=>({a:e.f(t,((t,r,n)=>({a:e.t(r+1),b:e.t(t),c:r}))),b:"abed0373-7-"+n,c:e.o((e=>(e=>{m.copywriterList.splice(e,1)})(r)),r),d:r,e:e.o((e=>(e=>{g.value=e;const t=m.copywriterList[e];C(t)})(r)),r)}))),z:e.p({name:"close",color:"#ffffff",size:"16"})}:{},{A:4==e.unref(c)},4==e.unref(c)?{B:e.o((t=>e.unref(m).name=t)),C:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(m).name}),D:e.t(e.unref(m).materialList.length),E:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),F:e.o((e=>q(1))),G:e.t(e.unref(m).person_name),H:e.t(e.unref(m).person_introduction),I:e.p({name:"arrow-right",size:20,color:"#C5CACA"}),J:e.o((e=>q(2))),K:e.t(e.unref(m).copywriterList.length),L:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),M:e.o((e=>q(3))),N:t._imports_2$4,O:e.o((e=>E("minus"))),P:e.o((t=>e.unref(m).video_count=t)),Q:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(m).video_count}),R:t._imports_3$6,S:e.o((e=>E("add")))}:{},{T:e.unref(c)!=e.unref(p).length},e.unref(c)!=e.unref(p).length?e.e({U:1===e.unref(c)},1===e.unref(c)?{V:e.t(e.unref(m).anchorLists.length),W:e.n(e.unref(m).anchorLists.length>0?"bg-black":"bg-_h787878CC_")}:{X:e.o((t=>q(e.unref(c),"prev")))},{Y:e.n(e.unref(b)?"bg-black":"bg-_h787878CC_"),Z:e.o((t=>q(e.unref(c),"next")))}):{aa:t._imports_3$2,ab:e.o((e=>y.value=!0)),ac:e.t(e.unref(m).video_count),ad:e.o($)},{ae:e.o(T),af:e.o((t=>e.isRef(h)?h.value=t:null)),ag:e.p({modelValue:e.unref(h)}),ah:e.o((t=>e.isRef(v)?v.value=t:null)),ai:e.p({"video-url":e.unref(d).url,poster:e.unref(d).pic,modelValue:e.unref(v)}),aj:e.o(B),ak:e.o(R),al:e.o((t=>e.isRef(j)?j.value=t:null)),am:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(j)}),an:e.o((t=>e.isRef(y)?y.value=t:null)),ao:e.p({type:4,modelValue:e.unref(y)}),ap:e.sr(x,"abed0373-17",{k:"rechargePopupRef"})})}}),c=e._export_sfc(p,[["__scopeId","data-v-abed0373"]]);wx.createPage(c);
