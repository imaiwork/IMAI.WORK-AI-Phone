"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../config/index.js"),n=require("../../../../enums/appEnums.js"),a=require("../../enums/index.js"),r=require("../../../../stores/user.js"),u=require("../../hooks/useUpload.js"),s=require("../../../../utils/request/cancel.js");if(require("../../../../api/user.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-button")+e.resolveComponent("recharge-popup"))()}Math||(t+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+l+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const t=()=>"../../components/video-player/video-player.js",l=()=>"../../components/upload-loading/upload-loading.js",m=e.defineComponent({__name:"video_upload",setup(t){const l=["mp4","mov"],m=r.useUserStore(),{userTokens:d}=e.toRefs(m),p=e.shallowRef(),c=e.reactive({name:"",url:"",pic:"",anchor_id:"",model_version:"",width:0,height:0}),g=e.ref(!1),v=e.ref(),A=e.ref(!1),h=e.ref(0),E=e.shallowRef();e.ref(!1);const f=e.ref(""),D={resolution:`${u.commonUploadLimit.minWidthResolution}P-${u.commonUploadLimit.maxWidthResolution}P`,fileSize:u.commonUploadLimit.size},H=e=>`${u.uploadLimit[e].minResolution}P-${u.uploadLimit[e].maxResolution}P`;a.DigitalHumanModelVersionEnum.STANDARD,H(a.DigitalHumanModelVersionEnum.STANDARD),u.uploadLimit[a.DigitalHumanModelVersionEnum.STANDARD].size,a.DigitalHumanModelVersionEnum.SUPER,H(a.DigitalHumanModelVersionEnum.SUPER),u.uploadLimit[a.DigitalHumanModelVersionEnum.SUPER].size,a.DigitalHumanModelVersionEnum.ADVANCED,a.DigitalHumanModelVersionEnum.ELITE,a.DigitalHumanModelVersionEnum.CHANJING,H(a.DigitalHumanModelVersionEnum.CHANJING),u.uploadLimit[a.DigitalHumanModelVersionEnum.CHANJING].size,a.DigitalHumanModelVersionEnum.SHANJIAN,H(a.DigitalHumanModelVersionEnum.SHANJIAN),u.uploadLimit[a.DigitalHumanModelVersionEnum.SHANJIAN].size;const M=e.computed((()=>{const e=c.model_version?"string"==typeof c.model_version?parseInt(c.model_version):c.model_version:a.DigitalHumanModelVersionEnum.STANDARD;Object.values(a.DigitalHumanModelVersionEnum).includes(e)||a.DigitalHumanModelVersionEnum.STANDARD;const o=D;return[{name:"视频方向",value:"横向或纵向"},{name:"文件格式",value:l.join("、")},{name:"分辨率",value:o.resolution},{name:"声音要求",value:"视频内音频需要清晰、响亮且无嘈杂背景音等干扰"},{name:"文件大小",value:`小于${o.fileSize}MB`}]}));e.computed((()=>c.model_version?u.uploadLimit[c.model_version]:null));const _=e=>m.getTokenByScene(e),N=e=>{const o={pro:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_PRO},normal:{avatar:n.TokensSceneEnum.HUMAN_AVATAR},advanced:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ADVANCED},elite:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ELITE},chanjing:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_CHANJING}};switch(e){case a.DigitalHumanModelVersionEnum.SUPER:return o.pro;case a.DigitalHumanModelVersionEnum.ADVANCED:return o.advanced;case a.DigitalHumanModelVersionEnum.ELITE:return o.elite;case a.DigitalHumanModelVersionEnum.CHANJING:return o.chanjing;default:return o.normal}},x=()=>{s.requestCancel.remove("/upload/video"),s.requestCancel.remove("/upload/image"),A.value=!1,h.value=0,f.value="",q()},j=async()=>{e.index.$emit("confirm",{type:a.ListenerTypeEnum.VIDEO_UPLOAD,data:c}),e.index.navigateBack()},V=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})},q=()=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})};return e.onLoad((e=>{try{e.type&&(p.value=e.type)}catch(o){console.error("页面加载参数处理失败:",o)}})),(n,r)=>e.e({a:o._imports_0$8,b:e.p({"play-icon-size":88,poster:`${e.unref(i.config).baseUrl}static/images/dh_example_bg2.png`,"video-url":`${e.unref(i.config).baseUrl}static/videos/dh_example2.mp4`}),c:o._imports_1$2,d:o._imports_2$1,e:e.f(e.unref(M),((o,i,n)=>({a:e.t(i+1),b:e.t(o.name),c:e.t(o.value),d:i}))),f:o._imports_3,g:o._imports_4,h:e.o((o=>(async()=>{var o;if(p.value===a.ModeTypeEnum.ANCHOR){const i=N(a.DigitalHumanModelVersionEnum.SHANJIAN),n=N(a.DigitalHumanModelVersionEnum.CHANJING),{score:r}=_(i.avatar),{score:u}=_(n.avatar);if(d.value<r+u)return g.value=!0,await e.nextTick$1(),void(null==(o=v.value)||o.open())}e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#000000"});const{upload:i}=u.useUpload({size:u.commonUploadLimit.size,widthResolution:[u.commonUploadLimit.minWidthResolution,u.commonUploadLimit.maxWidthResolution],heightResolution:[u.commonUploadLimit.minHeightResolution,u.commonUploadLimit.maxHeightResolution],duration:[u.commonUploadLimit.videoMinDuration,u.commonUploadLimit.videoMaxDuration],extension:l,async onSuccess(o){const{url:i,pic:n,width:a,height:r}=o;c.url=i,c.pic=n,c.width=a,c.height=r,c.name=e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM"),j()},onProgress(e){E.value=e.type,h.value=e.progress,f.value="video"===E.value?"视频正在上传中...":"图片正在上传中...",A.value=!0},onError(o){o.errMsg&&"chooseMedia:fail api scope is not declared in the privacy agreement"===o.errMsg?e.index.$u.toast("请完善隐私协议，否则无法使用"):o&&o.errMsg&&-1==o.errMsg.indexOf("cancel")&&e.index.$u.toast(o.errMsg||"上传失败"),A.value=!1,h.value=0,q()}});i()})())),i:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",boxShadow:" 0px 3px 12px 0px rgba(0, 0, 0, 0.12)",fontSize:"26rpx"}}),j:e.unref(A)},e.unref(A)?{k:e.o(x),l:e.o(V),m:e.o(j),n:e.p({progress:e.unref(h),"loading-text":e.unref(f),"progress-type":e.unref(E),"show-back":e.unref(c).model_version!==e.unref(a.DigitalHumanModelVersionEnum).SHANJIAN})}:{},{o:e.unref(g)},e.unref(g)?{p:e.sr(v,"29904f99-3",{k:"rechargePopupRef"}),q:e.o((e=>g.value=!1))}:{})}}),d=e._export_sfc(m,[["__scopeId","data-v-29904f99"]]);wx.createPage(d);
