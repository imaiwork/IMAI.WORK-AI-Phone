"use strict";const i=require("../../../common/vendor.js"),e=require("../../../components/file-upload/choose-file.js"),o=require("../../../api/app.js"),n=require("../enums/index.js"),t={size:300,minWidthResolution:360,maxWidthResolution:2e3,minHeightResolution:360,maxHeightResolution:2e3,videoMinDuration:30,videoMaxDuration:60},a={[n.DigitalHumanModelVersionEnum.STANDARD]:{size:100,minResolution:480,maxResolution:1080,videoMinDuration:15,videoMaxDuration:60},[n.DigitalHumanModelVersionEnum.SUPER]:{size:500,minResolution:640,maxResolution:2048,videoMinDuration:2,videoMaxDuration:120},[n.DigitalHumanModelVersionEnum.ADVANCED]:t,[n.DigitalHumanModelVersionEnum.ELITE]:t,[n.DigitalHumanModelVersionEnum.CHANJING]:{size:300,minResolution:2e3,maxResolution:2e3,videoMinDuration:30,videoMaxDuration:300},[n.DigitalHumanModelVersionEnum.SHANJIAN]:{size:300,minResolution:2e3,maxResolution:2e3,videoMinDuration:10,videoMaxDuration:30}};exports.commonUploadLimit=t,exports.uploadLimit=a,exports.useUpload=n=>{const{size:t=100,widthResolution:a=[0,2048],heightResolution:s=[0,2048],duration:u=[15,60],extension:r=["mp4","mov"],maxDuration:l=10,sizeType:d=["original","compressed"],onSuccess:m,onError:c,onProgress:p}=n,h=i.reactive({url:"",pic:"",seconds:0,duration:"00:00",width:0,height:0}),x=async e=>{const{tempFiles:o}=e,n=o[0],r=n.size,l=n.width,d=n.height;h.width=l,h.height=d;const p=n.duration,x=l>=a[0]&&l<=a[1],M=d>=s[0]&&d<=s[1],v=p>=u[0]&&p<=u[1];if(r>1024*t*1024)i.index.showToast({title:`视频大小不能超过${t}M`,icon:"none",duration:4e3});else if(x&&M)if(v)try{await g(n.thumbTempFilePath),await D(n.tempFilePath),null==m||m(h)}catch(R){R.errMsg&&"chooseMedia:fail api scope is not declared in the privacy agreement"===R.errMsg&&i.index.$u.toast("请完善隐私协议，否则无法使用"),-1==R.indexOf("abort")&&i.index.$u.toast("上传失败"),null==c||c({type:"video",error:R})}else i.index.showToast({title:`上传视频时长不能小于${u[0]}秒或大于${u[1]}秒`,icon:"none",duration:4e3});else i.index.showToast({title:`上传视频分辨率不能满足${a[0]}-${a[1]}x${s[0]}-${s[1]}`,icon:"none",duration:4e3})},D=async i=>{const{uri:e}=await o.uploadFile("video",{filePath:i},i=>{null==p||p({type:"video",progress:i})});h.url=e},g=async i=>{const{uri:e}=await o.uploadImage(i,"","",i=>{null==p||p({type:"image",progress:i})});h.pic=e};return{upload:async()=>{try{const i=await e.chooseFile({count:1,type:"video",camera:"front",sourceType:["album"],extension:r,maxDuration:l,sizeType:d});x(i)}catch(i){null==c||c(i)}},uploadResult:h}};
