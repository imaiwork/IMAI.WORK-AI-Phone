"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/device.js"),u=require("../../../../hooks/useEventBusManager.js"),t=require("../../enums/index.js"),s=require("../../stores/material.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-radio")+e.resolveComponent("u-radio-group")+e.resolveComponent("u-input")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-radio/u-radio.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-radio-group/u-radio-group.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js"))();const l=e.defineComponent({__name:"setting_clue",setup(l){const n=s.useMaterialStore(),{on:r}=u.useEventBusManager(),o=e.ref(!0),a=e.ref(""),c=e.reactive({type:1,ai_direction:"",clue_list:[]}),d=e.ref(-1),p=()=>{d.value=-1,e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{type:"add"}})},m=i=>{d.value=i??-1,i>-1&&n.setList("clueList",c.clue_list[i].clue),e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{index:i}})},_=async()=>{if(2!==c.type||""!==c.ai_direction)if(0!==c.clue_list.length){e.index.showLoading({title:"保存中...",mask:!0});try{await i.createAutoTaskClueConfig({device_code:a.value,exec_type:c.type,clue_theme:c.ai_direction,keywords:c.clue_list.map((e=>({title:e.name,keywords:e.clue})))}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(u){e.index.hideLoading(),e.index.showToast({title:u||"保存失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请添加线索词组");else e.index.$u.toast("请输入AI补充的线索词方向")};return e.onLoad((u=>{a.value=null==u?void 0:u.device_code,(async()=>{e.index.showLoading({title:"加载中...",mask:!0});try{const e=await i.getAutoTaskClueConfigDetail({device_code:a.value});c.type=e.exec_type,c.ai_direction=e.clue_theme,c.clue_list=e.keywords.map((e=>({name:e.title,clue:e.keywords})))}finally{e.index.hideLoading(),o.value=!1}})(),r("confirm",(e=>{const{type:i,data:u}=e;i===t.ListenerTypeEnum.CLUE_LIST&&(d.value>=0?c.clue_list[d.value]={...c.clue_list[d.value],...u}:c.clue_list.push({name:`线索词组${c.clue_list.length<10?`0${c.clue_list.length+1}`:c.clue_list.length+1}`,clue:u}))}))})),(i,u)=>e.e({a:!e.unref(o)},e.unref(o)?{}:e.e({b:e.f([{value:1,label:"循环执行"},{value:2,label:"AI自动补充"},{value:3,label:"不执行"}],((i,u,t)=>({a:e.t(i.label),b:"056c035e-1-"+t+",056c035e-0",c:e.p({name:i.value,size:28})}))),c:e.o((i=>e.unref(c).type=i)),d:e.p({modelValue:e.unref(c).type}),e:2===e.unref(c).type},2===e.unref(c).type?{f:e.o((i=>e.unref(c).ai_direction=i)),g:e.p({placeholder:"请输入您的行业，如：家居用品",maxlength:"100",clearable:!0,modelValue:e.unref(c).ai_direction})}:{},{h:e.p({name:"plus",size:"20",color:"#0065FB"}),i:e.o((e=>m(-1))),j:e.unref(c).clue_list.length>0},e.unref(c).clue_list.length>0?{k:e.f(e.unref(c).clue_list,((i,u,t)=>({a:e.t(i.name),b:e.o((e=>{}),u),c:e.t(i.clue.length),d:"056c035e-4-"+t,e:e.f(i.clue,((i,u,t)=>({a:e.t(i),b:u}))),f:e.o((i=>((i,u)=>{u||e.index.showModal({title:"提示",content:"确定要删除这个线索词组吗？",success:e=>{e.confirm&&c.clue_list.splice(i,1)}}),1===c.clue_list.length?e.index.showModal({title:"提示",content:"删除最后一个线索词组会同时删除线索词组",success:e=>{e.confirm&&c.clue_list.splice(i,1)}}):u&&c.clue_list[i].clue.splice(u,1)})(u)),u),g:u,h:e.o((e=>m(u)),u)}))),l:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"})}:{m:e.p({name:"plus",size:"20"}),n:e.o(p)},{o:e.o(_)}))}});wx.createPage(l);
