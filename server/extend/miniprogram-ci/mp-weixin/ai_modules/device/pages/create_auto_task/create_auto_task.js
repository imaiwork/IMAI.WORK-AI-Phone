"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),u=require("../../../../api/device.js"),r=require("../../../../enums/appEnums.js"),a=require("../../../../hooks/useKeyboardHeight.js"),i=require("../../hooks/useDeviceWs.js"),n=require("../../hooks/useDevice.js"),s=require("../../stores/material.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../hooks/useWebSocket.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-popup")+e.resolveComponent("video-preview"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../../components/video-preview/video-preview.js"))();const o=e.defineComponent({__name:"create_auto_task",setup(o){const{platformLogo:l}=n.useDevice(),{send:c,onEvent:v,close:f}=i.useDeviceWs(),{dynamicHeight:p,hideKeyboard:d}=a.useKeyboardHeight(),m=s.useMaterialStore(),{anchorList:h,videoList:g,imageList:b}=e.storeToRefs(m),j=e.ref("c9e1ccebecc47b2b2b"),_=e.ref({}),y=e.ref([{step:1,title:"获取账号"},{step:2,title:"运营方向"},{step:3,title:"素材预设"}]),q=e.ref(3),k=e.reactive({direction:"",videoTheme:"",imageTheme:"",anchorList:[],videoMaterialList:[],imageMaterialList:[]}),x=e.ref(Object.values(l)),w=e.ref(!1),T=e.ref(0),C=e.ref([]),D=e.ref(!1),E=e.ref({url:"",pic:""}),L=e.computed(()=>O(q.value)),R=()=>{w.value=!1,T.value=0,A()},F=e.computed(()=>x.value.every(e=>e.active)),I=e.computed(()=>C.value.some(e=>2===e.status)),O=e=>{switch(e){case 1:return F.value;case 2:case 3:return!0;default:return!1}},S=(t,u)=>{if("prev"!==u)if("next"!==u){if(t!==q.value)if(t<q.value)q.value=t;else{for(let u=1;u<t;u++)if(!O(u))return void e.index.$u.toast("请按顺序完成步骤");q.value=t}}else if(L.value)q.value++;else{const t={1:"请获取账号",2:"请选择运营方向"};e.index.$u.toast(t[q.value]||"请完成当前步骤")}else q.value--},$=()=>{T.value=0;let t=x.value;F.value||(t=x.value.filter(e=>!e.active));const u=t.map(e=>{const t=Object.values(l).find(t=>t.type===e.type);return{status:0,title:(null==t?void 0:t.name)||e.name,type:e.type}});0!==u.length?(C.value=u,w.value=!0,C.value.length>0&&(C.value[T.value].status=1,z(C.value[T.value].type))):e.index.$u.toast("所有账号均已获取")},z=e=>{c({type:r.DeviceCmdEnum.GET_USER_INFO,content:{deviceId:j.value},deviceId:j.value,appType:e})},B=e=>{E.value={url:e.url,pic:e.pic},D.value=!0},M=t=>{"anchor_material"===t&&e.index.$u.route({url:"/ai_modules/device/pages/anchor_material/anchor_material"}),"video_material"===t&&e.index.$u.route({url:"/ai_modules/device/pages/video_material/video_material"}),"image_material"===t&&e.index.$u.route({url:"/ai_modules/device/pages/image_material/image_material"})},W=async()=>{},A=async()=>{const e=await u.getDeviceDetail({device_code:j.value});_.value=e;const{accounts:t}=e;x.value=Object.values(l).sort((e,u)=>{const r=t.some(t=>t.type===e.type),a=t.some(e=>e.type===u.type);return r&&!a?-1:!r&&a?1:0}).map(e=>{const u=t.find(t=>t.type==e.type);return{...e,nickname:null==u?void 0:u.name,active:!!u,icon:u?e.activeIcon:e.icon}})};return v("success",async e=>{var t;const{type:a,content:i,deviceId:n,appType:s}=e;if(a!==r.DeviceCmdEnum.GET_USER_INFO)return;C.value[T.value]&&(C.value[T.value].status=2);const{account:o,account_no:l,extra:c,avatar:v,nickname:f}=i,p=null==(t=_.value.accounts)?void 0:t.find(e=>e.type===s),d={account:o,account_no:l,avatar:v,device_code:n,type:s,nickname:f,extra:JSON.stringify(c)};p?await u.updateDeviceAccount({...d,id:p.id}):await u.addDeviceAccount(d),T.value++,T.value<C.value.length?(C.value[T.value].status=1,z(C.value[T.value].type)):await A()}),v("error",e=>{const t=T.value;if(C.value.length>0&&C.value[t]){const e={...C.value[t],status:3};C.value.splice(t,1,e)}}),e.onLoad(e=>{e.device_code&&(j.value=e.device_code),A()}),e.onUnload(()=>{f(),d()}),(u,r)=>e.e({a:e.p({"title-bold":!0,title:"自动任务配置","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(y),(t,u,r)=>e.e({a:e.unref(q)>t.step},e.unref(q)>t.step?{b:"48b599f0-1-"+r,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(t.title),e:t.step!==e.unref(y).length},t.step!==e.unref(y).length?{f:e.unref(q)>t.step?1:""}:{},{g:t.step,h:e.unref(q)==t.step?1:"",i:e.o(e=>S(t.step),t.step)})),c:1==e.unref(q)},1==e.unref(q)?{d:e.f(e.unref(x),(e,t,u)=>({a:e.icon,b:t})),e:t._imports_0$36,f:e.o($)}:{},{g:2==e.unref(q)},2==e.unref(q)?{h:e.unref(k).direction,i:e.o(t=>e.unref(k).direction=t.detail.value),j:e.t(e.unref(k).direction.length),k:e.unref(k).videoTheme,l:e.o(t=>e.unref(k).videoTheme=t.detail.value),m:e.t(e.unref(k).videoTheme.length),n:e.unref(k).imageTheme,o:e.o(t=>e.unref(k).imageTheme=t.detail.value),p:e.t(e.unref(k).imageTheme.length),q:e.unref(p)+"px",r:0==e.unref(p),s:0==e.unref(p)?0:e.unref(p)/2}:{},{t:3==e.unref(q)},3==e.unref(q)?e.e({v:e.t(e.unref(h).length),w:e.p({name:"arrow-right",color:"#0065FB",size:"20"}),x:e.o(e=>M("anchor_material")),y:e.unref(h).length>0},e.unref(h).length>0?{z:e.f(e.unref(h).slice(0,3),(t,u,r)=>({a:t.pic,b:e.o(e=>B(t),u),c:u}))}:{A:e.o(e=>M("anchor_material"))},{B:e.t(e.unref(g).length),C:e.p({name:"arrow-right",color:"#0065FB",size:"20"}),D:e.o(e=>M("video_material")),E:e.unref(g).length>0},e.unref(g).length>0?{F:e.f(e.unref(g).slice(0,3),(t,u,r)=>({a:t.pic,b:e.o(e=>B(t),u),c:u}))}:{G:e.o(e=>M("video_material"))},{H:e.t(e.unref(b).length),I:e.p({name:"arrow-right",color:"#0065FB",size:"20"}),J:e.o(e=>M("image_material")),K:e.unref(b).length>0},e.unref(b).length>0?{L:e.f(e.unref(b).slice(0,3),(e,t,u)=>({a:e.pic,b:t}))}:{M:e.o(e=>M("image_material"))}):{},{N:e.unref(q)!=e.unref(y).length},e.unref(q)!=e.unref(y).length?e.e({O:1!=e.unref(q)},1!=e.unref(q)?{P:e.o(t=>S(e.unref(q),"prev"))}:{},{Q:e.n(e.unref(L)?"bg-black":"bg-_h787878CC_"),R:e.o(t=>S(e.unref(q),"next"))}):{S:e.o(W)},{T:e.n(1==e.unref(q)?"justify-end":"justify-between"),U:e.f(e.unref(C),(t,u,r)=>e.e({a:0==t.status},(t.status,{}),{b:1==t.status},(t.status,{}),{c:2==t.status},2==t.status?{d:"48b599f0-6-"+r+",48b599f0-5",e:e.p({name:"checkmark",color:"#0065FB",size:"16"})}:{},{f:u!==e.unref(C).length-1},u!==e.unref(C).length-1?{g:e.n(2==t.status?"bg-primary":"bg-_h0000001a_")}:{},{h:e.t(t.title),i:0==t.status?1:"",j:1==t.status},(t.status,{}),{k:3==t.status},(t.status,{}),{l:u})),V:e.unref(I)},e.unref(I)?{W:e.o(R),X:e.p({type:"primary","custom-style":{height:"90rpx",fontWeight:"bold",borderRadius:"20rpx"}})}:{},{Y:e.o(R),Z:e.p({"custom-style":{height:"90rpx",fontWeight:"bold",borderRadius:"20rpx"}}),aa:e.o(R),ab:e.o(t=>e.isRef(w)?w.value=t:null),ac:e.p({mode:"center","border-radius":"20",width:"80%","mask-close-able":!1,modelValue:e.unref(w)}),ad:e.o(t=>e.isRef(D)?D.value=t:null),ae:e.p({"video-url":e.unref(E).url,poster:e.unref(E).pic,modelValue:e.unref(D)})})}});wx.createPage(o);
