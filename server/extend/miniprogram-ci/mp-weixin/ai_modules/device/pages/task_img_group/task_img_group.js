"use strict";const e=require("../../../../common/vendor.js"),s=require("../../enums/index.js"),o=require("../../../../hooks/useEventBusManager.js"),u=require("../../../../hooks/useUpload.js");if(require("../../../../components/file-upload/choose-file.js"),require("../../../../api/app.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("confirm-dialog")+e.resolveComponent("upload-progress")+e.resolveComponent("choose-material"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+(()=>"../../../../components/choose-material/choose-material.js"))();const n=e.defineComponent({__name:"task_img_group",setup(n){const{emit:r}=o.useEventBusManager(),i=["jpg","png","jpeg"],t=[5e3,5e3],a=e.ref([]),l=e.ref(!1),c=e.ref(!0),p=e.ref("image"),m=e.ref(!1),d=e.computed((()=>`\n        <div>· 图片素材支持：${i.join("、")}格式，50M以内，分辨率不超过${t[0]}*${t[1]}</div>\n    <div class="mt-2">· 最多可传9张图片</div>\n    <div class="mt-2">· 不符合条件的图片会被自动删除</div>\n    `)),{showUploadProgress:f,uploadMaterialList:v,uploadAndProcessFiles:g}=u.useUpload({count:9,imageAccept:i,imageResolution:t,imageSize:50,onSuccess:e=>{const s=9-a.value.length,o=e.slice(0,s);a.value=a.value.concat(o.map((e=>e.url)))}}),j=()=>{l.value=!1,e.index.showActionSheet({itemList:['从"微信聊天"中选择','从"素材库"中选择','从"手机相册"中选择'],success:e=>{if(0==e.tapIndex||2==e.tapIndex){if(c.value)return c.value=!1,void(l.value=!0);p.value=0==e.tapIndex?"all":"image",c.value||g(p.value)}1==e.tapIndex&&(m.value=!0)}})},h=async s=>{const o=s.map((s=>new Promise((o=>{e.wx$1.getImageInfo({src:s.content,success:u=>{const{type:n,width:r,height:a}=u;r<=t[0]&&a<=t[1]&&i.includes(n)?o(s.content):(e.index.showToast({title:"选择的图片包含不符合条件的图片，已自动过滤",icon:"none"}),o(null))},fail:()=>{o(null)}})})))),u=(await Promise.all(o)).filter((e=>e));a.value=a.value.concat(u)},q=()=>{0!==a.value.length?(r("confirm",{type:s.ListenerTypeEnum.CHOOSE_IMG,data:a.value}),e.index.navigateBack()):e.index.$u.toast("至少需要上传1张图")};return e.onLoad((e=>{e.imgs&&(a.value=JSON.parse(e.imgs))})),(s,o)=>e.e({a:e.t(e.unref(a).length),b:e.t(9),c:e.f(e.unref(a),((s,o,u)=>({a:s,b:"71ed7ffe-0-"+u,c:e.o((e=>(e=>{a.value.splice(e,1)})(o)),o),d:o,e:e.o((s=>(s=>{e.index.previewImage({urls:a.value,current:s})})(o)),o)}))),d:e.p({name:"close",size:"20",color:"#ffffff"}),e:e.unref(a).length<9},e.unref(a).length<9?{f:e.p({name:"plus",size:"24",color:"#ffffff"}),g:e.o(j)}:{},{h:e.o(q),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"12rpx",fontWeight:"bold"}}),j:e.o((s=>e.unref(g)(e.unref(p)))),k:e.o((e=>{l.value=!1,c.value=!1})),l:e.o((s=>e.isRef(l)?l.value=s:null)),m:e.p({content:e.unref(d),"confirm-text":"去上传",modelValue:e.unref(l)}),n:e.o((s=>e.isRef(f)?f.value=s:null)),o:e.p({"upload-list":e.unref(v),modelValue:e.unref(f)}),p:e.o(h),q:e.o((s=>e.isRef(m)?m.value=s:null)),r:e.p({type:"image",limit:9-e.unref(a).length,modelValue:e.unref(m)})})}});wx.createPage(n);
