"use strict";const e=require("../../../../common/vendor.js"),u=require("../../enums/index.js"),s=require("../../../../hooks/useEventBusManager.js"),o=require("../../../../hooks/useUpload.js");if(require("../../../../components/file-upload/choose-file.js"),require("../../../../api/app.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("confirm-dialog")+e.resolveComponent("upload-progress")+e.resolveComponent("choose-material"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+(()=>"../../../../components/choose-material/choose-material.js"))();const n=e.defineComponent({__name:"task_img_group",setup(n){const{emit:r}=s.useEventBusManager(),i=["jpg","png","jpeg"],a=[5e3,5e3],t=e.ref([]),l=e.ref(!1),c=e.ref(!0),p=e.ref("image"),m=e.ref(!1),f=e.ref(-1),v=e.computed((()=>`\n        <div>· 图片素材支持：${i.join("、")}格式，50M以内，分辨率不超过${a[0]}*${a[1]}</div>\n    <div class="mt-2">· 最多可传9张图片</div>\n    <div class="mt-2">· 不符合条件的图片会被自动删除</div>\n    `)),{showUploadProgress:d,uploadMaterialList:g,uploadAndProcessFiles:j}=o.useUpload({count:9,imageAccept:i,imageResolution:a,imageSize:50,fileAccept:i,fileSize:50,onSuccess:e=>{-1!==f.value?t.value[f.value]=e[0].url:t.value=t.value.concat(e.map((e=>e.url))),f.value=-1}}),h=()=>{l.value=!1,e.index.showActionSheet({itemList:['从"微信聊天"中选择','从"素材库"中选择','从"手机相册"中选择'],success:e=>{if(0==e.tapIndex||2==e.tapIndex){if(p.value=0==e.tapIndex?"file":"image",c.value)return c.value=!1,void(l.value=!0);c.value||j(p.value)}1==e.tapIndex&&(m.value=!0)}})},q=async u=>{const s=u.map((u=>new Promise((s=>{e.wx$1.getImageInfo({src:u.content,success:o=>{const{type:n,width:r,height:t}=o;r<=a[0]&&t<=a[1]&&i.includes(n)?s(u.content):(e.index.showToast({title:"选择的图片包含不符合条件的图片，已自动过滤",icon:"none"}),s(null))},fail:()=>{s(null)}})})))),o=(await Promise.all(s)).filter((e=>e));-1!==f.value?t.value[f.value]=o[0]:t.value=t.value.concat(o),f.value=-1},x=()=>{0!==t.value.length?(r("confirm",{type:u.ListenerTypeEnum.CHOOSE_IMG,data:t.value}),e.index.navigateBack()):e.index.$u.toast("至少需要上传1张图")};return e.onLoad((e=>{e.imgs&&(t.value=JSON.parse(e.imgs))})),(u,s)=>e.e({a:e.t(e.unref(t).length),b:e.t(9),c:e.f(e.unref(t),((u,s,o)=>({a:u,b:"71ed7ffe-0-"+o,c:e.o((e=>(e=>{t.value.splice(e,1)})(s)),s),d:e.o((e=>(e=>{f.value=e,h()})(s)),s),e:s,f:e.o((u=>(u=>{e.index.previewImage({urls:t.value,current:u})})(s)),s)}))),d:e.p({name:"close",size:"20",color:"#ffffff"}),e:e.unref(t).length<9},e.unref(t).length<9?{f:e.p({name:"plus",size:"24",color:"#ffffff"}),g:e.o(h)}:{},{h:e.o(x),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"12rpx",fontWeight:"bold"}}),j:e.o((u=>e.unref(j)(e.unref(p)))),k:e.o((e=>{l.value=!1,c.value=!1})),l:e.o((u=>e.isRef(l)?l.value=u:null)),m:e.p({content:e.unref(v),"confirm-text":"去上传",modelValue:e.unref(l)}),n:e.o((u=>e.isRef(d)?d.value=u:null)),o:e.p({"upload-list":e.unref(g),modelValue:e.unref(d)}),p:e.o(q),q:e.o((u=>e.isRef(m)?m.value=u:null)),r:e.p({type:"image",limit:9-e.unref(t).length,modelValue:e.unref(m)})})}});wx.createPage(n);
