"use strict";const e=require("../../../../common/vendor.js"),n=require("../../../../common/assets.js"),t=require("../../../../api/device.js"),u=require("../../../../enums/appEnums.js"),o=require("../../../../stores/app.js"),l=require("../../enums/index.js"),r=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("u-popup")+e.resolveComponent("confirm-dialog")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+c+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+a+s+i+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+m+f+p+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../components/popup-bottom/popup-bottom.js"))();const a=()=>"../../components/clue-gen-pop/clue-gen-pop.js",s=()=>"../../components/keywords-edit/keywords-edit.js",i=()=>"../../components/comment-filter/comment-filter.js",c=()=>"../../components/bast-setting-v2/bast-setting-v2.js",m=()=>"../../components/choose-region/choose-region.js",f=()=>"../../components/choose-age/choose-age.js",p=()=>"../../components/choose-comment-time/choose-comment-time.js",d=e.defineComponent({__name:"create_closure",setup(a){const{on:s}=r.useEventBusManager(),i=o.useAppStore(),c=e.ref(l.CreateTypeEnum.COMMENT),m=e.ref([{step:1,title:"选择行业"},{step:2,title:"设定评论"},{step:3,title:"高级设置"},{step:4,title:"设定时间"}]),f=e.ref(1),p=e.reactive({name:"",industry:[],industryNum:1,commentNum:1,comment_filter_list:[],comment_content_list:[],comment_like:"1",comment_follow:"1",comment_time_index:[0],comment_region:"不限",comment_gender:"不限",comment_age:"不限",comment_account_feature:"0",comment_time:0,accounts:[],task_frep:1,custom_date:[],time_config:["09:00","09:30"]}),d=e.computed((()=>c.value===l.CreateTypeEnum.COMMENT));e.ref([]);const v=e.shallowRef(),_=e.ref(!1),g=e.ref(),h=e.ref("clue"),y=e.ref(-1),b=e.ref(!1),x=[{value:0,label:"不限"},{value:1,label:"24小时内"},{value:2,label:"2天内"},{value:3,label:"3天内"},{value:4,label:"4天内"},{value:5,label:"5天内"},{value:6,label:"6天内"},{value:7,label:"7天内"}],w=e.ref(!1),C=e.ref([]),j=e.ref(!1),k=e.ref(""),q=e.ref(""),E=e.ref(!1),V=e.ref(!1),T=e.ref(),N=e.ref(0),z=e.ref(!1),$=e.ref(!1),M=e.ref(""),R=e.reactive({show:!1,title:"",inputValue:1,callback:null}),O=e.computed((()=>({clue:"线索词",comment:"评论词",comment_content:"评论内容"}[h.value])));e.computed((()=>p.comment_time>-1?x[p.comment_time_index[0]].label:"请选择"));const L=n=>{p.industry.includes(n)?e.index.$u.toast("已存在"):(p.industry.push(n),j.value=!1)},I=e=>{p.comment_time_index=e,p.comment_time=x[p.comment_time_index[0]].value},A=e=>{p.comment_age=e,V.value=!1},B=()=>{const n=Number(R.inputValue);n<1?e.index.$u.toast("请输入大于等于1的数字"):(R.callback&&R.callback(n),R.show=!1)};function S(n,t,u,o){const l=e.ref(n.indexOf(t)),r=e.ref(null);return e.reactive({currentIndex:l,savedCustomValue:r,handleSelect:(e,n)=>{l.value=n,o(e)},openCustom:()=>{R.title=u,R.inputValue=r.value||1,R.callback=e=>{o(e),r.value=e,l.value=n.length},R.show=!0}})}const F=[1,3,5,10,20],D=[1,3,5,10,20],H=S(F,p.industryNum,"输入每个行业看笔记的数量",(e=>p.industryNum=e)),P=S(D,p.commentNum,"输入评论数量上限",(e=>p.commentNum=e)),U=e.computed((()=>X(f.value))),X=e=>{switch(e){case 1:return p.industry.length>0;case 2:return p.comment_filter_list.length>0&&p.comment_content_list.length>0;case 3:return!0;default:return!1}},Y=(n,t)=>{if("prev"!==t)if("next"!==t){if(n!==f.value)if(n<f.value)f.value=n;else{for(let t=1;t<n;t++)if(!X(t))return void e.index.$u.toast("请按顺序完成步骤");f.value=n}}else if(U.value)f.value++;else{const n={1:"请至少添加一个线索",3:"请设定时间"};e.index.$u.toast(n[f.value]||"请完成当前步骤")}else f.value--},G=()=>{""!==k.value.trim()?p.industry.includes(k.value)?e.index.$u.toast("已存在"):(p.industry.push(k.value),k.value="",e.nextTick$1((()=>{q.value="industry_"+(p.industry.length-1)}))):e.index.$u.toast("请输入获客行业")},J=e=>{"clue"===h.value?-1==y.value?p.industry.push(e):p.industry[y.value]=e:"comment"===h.value?-1==y.value?p.comment_filter_list.push(e):p.comment_filter_list[y.value]=e:"comment_content"===h.value&&(-1==y.value?p.comment_content_list.push(e):p.comment_content_list[y.value]=e),_.value=!1},K=e=>{p.industry.push(...e),w.value=!1},Q=async n=>{e.index.showLoading({title:"删除中...",mask:!0});try{await t.deleteClosureIndustryHistory({id:C.value[n].id}),C.value.splice(n,1),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3})}catch(u){e.index.showToast({title:u||"删除失败",icon:"none",duration:3e3})}},W=()=>{var e;E.value=!0,null==(e=g.value)||e.setFormData(p.comment_filter_list)},Z=e=>{p.comment_filter_list=e},ee=e=>{var n;y.value=e,h.value="comment_content",_.value=!0,null==(n=g.value)||n.setFormData(p.comment_content_list[e])},ne=e=>{e.isAll||0===e.regionList.length?p.comment_region="不限":p.comment_region=e.regionList.join(";"),z.value=!1},te=async()=>{if(p.name)if(p.accounts.length)if(5!==N.value||p.custom_date.length)if(p.time_config[0]&&p.time_config[1]){e.index.showLoading({title:"创建中...",mask:!0});try{await t.createClosureTask({name:p.name,accounts:p.accounts,task_frep:p.task_frep,task_type:c.value==l.CreateTypeEnum.COMMENT?1:2,time_config:[`${p.time_config[0]}-${p.time_config[1]}`],task_date:p.custom_date,industry:p.industry.join(";"),industry_num:p.industryNum,filter:p.comment_filter_list.map((e=>e.value)),content:p.comment_content_list,send_num:p.commentNum,is_like:p.comment_like,is_follow:p.comment_follow,send_time:p.comment_time,gender:p.comment_gender,old:p.comment_age,region:p.comment_region,account_feature:p.comment_account_feature}),e.index.hideLoading(),$.value=!0}catch(n){M.value=n,e.index.hideLoading(),e.index.showToast({title:n||"创建失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请选择任务时间");else e.index.$u.toast("请选择任务日期");else e.index.$u.toast("请选择发布账号");else e.index.$u.toast("请输入任务名称")},ue=()=>{e.index.$u.route({url:"/pages/phone/phone",type:"reLaunch"}),$.value=!1},oe=async(e,n)=>{var u,o;try{const{lists:o}=await t.getClosureIndustryHistory({task_type:c.value==l.CreateTypeEnum.COMMENT?1:2,page_no:e,page_size:n});null==(u=v.value)||u.complete(o)}catch(r){null==(o=v.value)||o.complete([])}};return e.watch((()=>[i.getCommentFilterConfig,i.getCommentContentConfig]),(e=>{e[0]&&e[0].length>0&&(p.comment_filter_list=e[0].map((e=>({value:e,checked:!0})))),e[1]&&e[1].length>0&&(p.comment_content_list=e[1])}),{immediate:!0}),e.onLoad((n=>{c.value=n.type,p.name=`${c.value==l.CreateTypeEnum.COMMENT?"评论":"私信"}获客任务${e.index.$u.timeFormat(new Date,"yyyymmddhhMM")}`,s("confirm",(e=>{const{type:n,data:t}=e;if(n===l.ListenerTypeEnum.CHOOSE_DATE){if(0===t.length)return;p.custom_date=t,N.value=5}if(n===l.ListenerTypeEnum.CHOOSE_ACCOUNT){if(0===t.length)return;p.accounts=t.map((e=>({id:e.id,account:e.account,type:e.type})))}}))})),(t,o)=>e.e({a:e.p({"title-bold":!0,title:e.unref(c)===e.unref(l.CreateTypeEnum).COMMENT?"评论获客":"私信获客","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(m),((n,t,u)=>e.e({a:e.unref(f)>n.step},e.unref(f)>n.step?{b:"f19ce7c4-1-"+u,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(n.title),e:n.step!==e.unref(m).length},n.step!==e.unref(m).length?{f:e.unref(f)>n.step?1:""}:{},{g:n.step,h:e.unref(f)==n.step?1:"",i:e.o((e=>Y(n.step)),n.step)}))),c:1===e.unref(f)},1===e.unref(f)?e.e({d:e.o((n=>e.isRef(k)?k.value=n:null)),e:e.p({placeholder:"请输入，如：服装设计、女装",maxlength:"100",clearable:!0,"placeholder-style":"font-size: 26rpx;",modelValue:e.unref(k)}),f:e.o(G),g:e.unref(p).industry.length>0},e.unref(p).industry.length>0?{h:e.f(e.unref(p).industry,((n,t,u)=>({a:e.t(n),b:"f19ce7c4-3-"+u,c:e.o((e=>(e=>{p.industry.splice(e,1)})(t)),t),d:t,e:"industry_"+t,f:e.o((e=>(e=>{var n;y.value=e,h.value="clue",_.value=!0,null==(n=g.value)||n.setFormData(p.industry[e])})(t)),t)}))),i:e.p({name:"close",color:"#ffffff",size:"16"}),j:e.unref(q)}:{},{k:n._imports_0$40,l:e.o((e=>w.value=!0)),m:e.unref(C).length>0},e.unref(C).length>0?{n:e.p({name:"arrow-right",color:"#B2B2B2",size:"24"}),o:e.o((e=>j.value=!0)),p:e.f(e.unref(C).slice(0,5),((n,t,u)=>({a:e.t(n.keyword),b:"f19ce7c4-5-"+u,c:e.o((e=>Q(t)),t),d:t,e:e.o((e=>L(n.keyword)),t)}))),q:e.p({name:"close",color:"#ffffff",size:"16"})}:{},{r:e.f(F,((n,t,u)=>({a:e.t(n),b:t,c:e.unref(p).industryNum===n&&e.unref(H).currentIndex!==F.length?1:"",d:e.o((u=>e.unref(H).handleSelect(n,t)),t)}))),s:e.t(e.unref(H).currentIndex===F.length?`${e.unref(p).industryNum}条`:e.unref(H).savedCustomValue?`${e.unref(H).savedCustomValue}条`:"自定义"),t:e.unref(H).currentIndex===F.length?1:"",v:e.o(((...n)=>e.unref(H).openCustom&&e.unref(H).openCustom(...n)))}):{},{w:2===e.unref(f)},2===e.unref(f)?e.e({x:e.unref(p).comment_filter_list.length>0},e.unref(p).comment_filter_list.length>0?{y:e.f(e.unref(p).comment_filter_list,((n,t,u)=>({a:e.t(n.value),b:"f19ce7c4-6-"+u,c:e.o((e=>(e=>{p.comment_filter_list.splice(e,1)})(t)),t),d:t}))),z:e.p({name:"close",color:"#ffffff",size:"16"}),A:e.p({name:"plus",color:"#0065FB",size:"20"}),B:e.o(W)}:{C:e.p({name:"plus",size:"20"}),D:e.o(W)},{E:e.t(e.unref(d)?"评论内容":"私信内容"),F:e.unref(p).comment_content_list.length>0},e.unref(p).comment_content_list.length>0?{G:e.f(e.unref(p).comment_content_list,((n,t,u)=>({a:e.t(n),b:"f19ce7c4-9-"+u,c:e.o((e=>(e=>{p.comment_content_list.splice(e,1)})(t)),t),d:t,e:e.o((e=>ee(t)),t)}))),H:e.p({name:"close",color:"#ffffff",size:"16"}),I:e.p({name:"plus",color:"#0065FB",size:"20"}),J:e.o((e=>ee(-1)))}:{K:e.p({name:"plus",size:"20"}),L:e.t(e.unref(d)?"评论":"私信"),M:e.o((e=>ee(-1)))},{N:e.t(e.unref(d)?"评论数量上限":"私信数量上限"),O:e.f(D,((n,t,u)=>({a:e.t(n),b:t,c:e.unref(p).commentNum===n&&e.unref(P).currentIndex!==D.length?1:"",d:e.o((u=>e.unref(P).handleSelect(n,t)),t)}))),P:e.t(e.unref(P).currentIndex===D.length?`${e.unref(p).commentNum}条`:e.unref(P).savedCustomValue?`${e.unref(P).savedCustomValue}条`:"自定义"),Q:e.unref(P).currentIndex===D.length?1:"",R:e.o(((...n)=>e.unref(P).openCustom&&e.unref(P).openCustom(...n))),S:!e.unref(d)},(e.unref(d),{})):{},{T:3===e.unref(f)},3===e.unref(f)?e.e({U:e.t(e.unref(d)?"评论附带点赞":"私信附带点赞"),V:e.o((n=>e.unref(p).comment_like=n)),W:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(p).comment_like}),X:!e.unref(d)},e.unref(d)?{}:{Y:e.t(e.unref(d)?"评论附带关注":"私信附带关注"),Z:e.o((n=>e.unref(p).comment_follow=n)),aa:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(p).comment_follow})},{}):{},{av:4===e.unref(f)},4===e.unref(f)?e.e({aw:e.o((e=>N.value=e)),ax:e.o((n=>e.isRef(p)?p.value=n:null)),ay:e.p({"show-device":!1,"show-accounts":!0,"current-frequency":e.unref(N),"platform-types":[e.unref(u.AppTypeEnum).XHS,e.unref(u.AppTypeEnum).DOUYIN],modelValue:e.unref(p)}),az:e.unref(M)},e.unref(M)?{aA:e.t(e.unref(M))}:{}):{},{aB:e.unref(f)!=e.unref(m).length},e.unref(f)!=e.unref(m).length?e.e({aC:1!==e.unref(f)},1!==e.unref(f)?{aD:e.o((n=>Y(e.unref(f),"prev")))}:{},{aE:e.n(e.unref(U)?"bg-primary":"bg-_h787878CC_"),aF:e.o((n=>Y(e.unref(f),"next")))}):{aG:e.o(te)},{aH:e.n(1===e.unref(f)?"justify-end":"justify-between"),aI:e.t(e.unref(R).title),aJ:e.o((n=>e.unref(R).inputValue=n)),aK:e.p({placeholder:"请输入",type:"digit","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(R).inputValue}),aL:e.o((n=>e.unref(R).show=!1)),aM:e.o(B),aN:e.o((n=>e.unref(R).show=!1)),aO:e.o((n=>e.unref(R).show=n)),aP:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(R).show}),aQ:e.o(K),aR:e.o((n=>e.isRef(w)?w.value=n:null)),aS:e.p({modelValue:e.unref(w)}),aT:e.sr(g,"f19ce7c4-23",{k:"keywordsEditRef"}),aU:e.o(J),aV:e.o((n=>e.isRef(_)?_.value=n:null)),aW:e.p({title:e.unref(O),modelValue:e.unref(_)}),aX:e.o(Z),aY:e.o((n=>e.isRef(E)?E.value=n:null)),aZ:e.p({modelValue:e.unref(E)}),ba:e.o(ue),bb:e.o(ue),bc:e.o((n=>e.isRef($)?$.value=n:null)),bd:e.p({center:!0,"confirm-text":"确定",content:"创建成功，回到首页？","show-close":!1,modelValue:e.unref($)}),be:e.o(ne),bf:e.o((n=>e.isRef(z)?z.value=n:null)),bg:e.p({modelValue:e.unref(z)}),bh:e.sr(T,"f19ce7c4-27",{k:"chooseAgeRef"}),bi:e.o(A),bj:e.o((n=>e.isRef(V)?V.value=n:null)),bk:e.p({modelValue:e.unref(V)}),bl:e.o(I),bm:e.o((n=>e.isRef(b)?b.value=n:null)),bn:e.p({value:e.unref(p).comment_time_index,list:x,modelValue:e.unref(b)}),bo:e.f(e.unref(C),((n,t,u)=>({a:e.t(n.keyword),b:"f19ce7c4-31-"+u+",f19ce7c4-30",c:e.o((e=>Q(t)),t),d:t,e:e.o((e=>L(n.keyword)),t)}))),bp:e.p({name:"close",color:"#ffffff",size:"16"}),bq:e.sr(v,"f19ce7c4-30,f19ce7c4-29",{k:"industryHistoryPagingRef"}),br:e.o(oe),bs:e.o((n=>e.isRef(C)?C.value=n:null)),bt:e.p({fixed:!1,modelValue:e.unref(C)}),bv:e.o((e=>j.value=!1)),bw:e.o((n=>e.isRef(j)?j.value=n:null)),bx:e.p({title:"获客行业记录","is-disabled-touch":!0,modelValue:e.unref(j)})})}});wx.createPage(d);
