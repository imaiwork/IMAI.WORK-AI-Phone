"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/device.js"),o=require("../../../../hooks/useEventBusManager.js"),n=require("../../enums/index.js"),l=require("../../stores/material.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-radio")+e.resolveComponent("u-radio-group")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-switch"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-radio/u-radio.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-radio-group/u-radio-group.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+i+a+u+m+r)();const i=()=>"../../components/keywords-edit/keywords-edit.js",a=()=>"../../components/comment-filter/comment-filter.js",u=()=>"../../components/choose-region/choose-region.js",m=()=>"../../components/choose-age/choose-age.js",r=()=>"../../components/choose-comment-time/choose-comment-time.js",c=e.defineComponent({__name:"setting_ca",setup(i){const a=l.useMaterialStore(),{on:u}=o.useEventBusManager(),m=e.ref(!0),r=e.ref(""),c=e.ref(),s=[{name:"简易模式",value:1},{name:"精确模式",value:2}],_=e.ref(0),d=e.reactive({type:1,ai_direction:"",clue_list:[],comment_list:[],comment_filter_list:[],comment_like:"1",comment_follow:"1",comment_time:0,comment_time_index:[0],comment_region:"不限",comment_gender:"不限",comment_age:"不限",comment_account_feature:"0",comment_type:1}),f=e.ref(""),v=e.ref(),p=e.ref(!1),g=e.ref(-1),h=e.ref(-1),x=e.ref(!1),y=e.ref(!1),w=e.ref([0]),j=e.ref(),B=e.ref(!1),k=e.ref(!1),b=e.ref(),q=[{value:0,label:"不限"},{value:1,label:"24小时内"},{value:2,label:"2天内"},{value:3,label:"3天内"},{value:4,label:"4天内"},{value:5,label:"5天内"},{value:6,label:"6天内"},{value:7,label:"7天内"}],z=e.computed((()=>{switch(f.value){case"clue":return"线索词组";case"comment":return"评论话术";default:return""}})),L=e.computed((()=>d.comment_time>-1?q[d.comment_time_index[0]].label:"请选择")),A=e=>{switch(f.value){case"clue":d.clue_list[g.value].name=e;break;case"comment":h.value>=0?d.comment_list[h.value]=e:d.comment_list.push(e)}p.value=!1,g.value=-1,h.value=-1},C=()=>{g.value=-1,e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{type:"add"}})},I=e=>{var t;h.value=e??-1,f.value="comment",p.value=!0,null==(t=v.value)||t.setFormData(d.comment_list[e])},V=e=>{d.comment_time_index=e,d.comment_time=q[d.comment_time_index[0]].value},F=()=>{var e;null==(e=v.value)||e.setFormData(d.comment_filter_list),x.value=!0},R=e=>{d.comment_filter_list=e},$=()=>{var e;k.value=!0,null==(e=b.value)||e.setFormData(d.comment_age)},E=e=>{d.comment_age=e,k.value=!1},T=e=>{e.isAll||0===e.regionList.length?d.comment_region="不限":d.comment_region=e.regionList.join(";"),B.value=!1},D=()=>{const t=["不限","男","女"];e.index.showActionSheet({itemList:t,success:e=>{d.comment_gender=t[e.tapIndex]}})},M=()=>{e.index.showActionSheet({itemList:["全部","跳过认证号"],success:e=>{0===e.tapIndex?d.comment_account_feature="0":d.comment_account_feature="1"}})},S=async()=>{if(2!==d.type||d.ai_direction)if(0!==d.clue_list.length)if(1!==d.comment_type||0!==d.comment_list.length)if(1!==_.value||0!==d.comment_filter_list.length){e.index.showLoading({title:"保存中...",mask:!0});try{await t.createAutoTaskClosureConfig({device_code:r.value,mode:s[_.value].value,exec_type:d.type,ai_direction:2==d.type?d.ai_direction:"",keywords:d.clue_list.map((e=>({title:e.name,keywords:e.clue}))),comment_screening:d.comment_filter_list.map((e=>e.value)),touch_speech_type:d.comment_type,touch_speech:d.comment_list,actions:{msg_comment_likes:d.comment_like,msg_follow:d.comment_follow,comment_time:d.comment_time,areas:d.comment_region,gender:d.comment_gender,age:d.comment_age,account_feature:d.comment_account_feature}}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(o){e.index.hideLoading(),e.index.showToast({title:o||"保存失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请添加评论筛选");else e.index.$u.toast("请添加评论话术");else e.index.$u.toast("请添加线索词组");else e.index.$u.toast("请输入AI补充的线索词方向")};return e.onLoad((o=>{r.value=null==o?void 0:o.device_code,c.value=null==o?void 0:o.account_type,(async()=>{var o,n,l,i,a,u,c;e.index.showLoading({title:"加载中...",mask:!0});try{const e=await t.getAutoTaskClosureConfigDetail({device_code:r.value});d.type=e.exec_type,d.ai_direction=e.ai_direction,d.clue_list=e.keywords.map((e=>({name:e.title,clue:e.keywords}))),d.comment_list=e.touch_speech,d.comment_filter_list=e.comment_screening.map(((e,t)=>({value:e,checked:!0,id:t}))),d.comment_like=null==(o=e.actions)?void 0:o.msg_comment_likes,d.comment_follow=null==(n=e.actions)?void 0:n.msg_follow,d.comment_time=null==(l=e.actions)?void 0:l.comment_time,d.comment_region=null==(i=e.actions)?void 0:i.areas,d.comment_gender=null==(a=e.actions)?void 0:a.gender,d.comment_age=null==(u=e.actions)?void 0:u.age,d.comment_account_feature=null==(c=e.actions)?void 0:c.account_feature,d.comment_type=e.touch_speech_type,_.value=s.findIndex((t=>t.value==e.mode))||0,d.comment_time_index=[q.findIndex((t=>{var o;return t.value==(null==(o=e.actions)?void 0:o.comment_time)}))||0],w.value=d.comment_time_index}finally{e.index.hideLoading(),m.value=!1}})(),u("confirm",(e=>{const{type:t,data:o}=e;t===n.ListenerTypeEnum.CLUE_LIST&&(g.value>=0?d.clue_list[g.value]={...d.clue_list[g.value],...o}:d.clue_list.push({name:`线索词组${d.clue_list.length<10?`0${d.clue_list.length+1}`:d.clue_list.length+1}`,clue:o}))}))})),(t,o)=>e.e({a:!e.unref(m)},e.unref(m)?{}:e.e({b:e.f(s,((t,o,n)=>({a:e.t(t.name),b:o,c:e.unref(_)===o?1:"",d:e.o((e=>_.value=o),o)}))),c:`translateX(${100*e.unref(_)}%)`,d:e.f([{value:1,label:"循环执行"},{value:2,label:"AI自动补充"},{value:3,label:"不执行"}],((t,o,n)=>({a:e.t(t.label),b:o,c:"227e84e9-1-"+n+",227e84e9-0",d:e.p({name:t.value,size:28})}))),e:e.o((t=>e.unref(d).type=t)),f:e.p({modelValue:e.unref(d).type}),g:2===e.unref(d).type},2===e.unref(d).type?{h:e.o((t=>e.unref(d).ai_direction=t)),i:e.p({placeholder:"请输入您的行业，如：家居用品",maxlength:"100",clearable:!0,modelValue:e.unref(d).ai_direction})}:{},{j:e.p({name:"plus",color:"#0065FB",size:"20"}),k:e.o(C),l:e.unref(d).clue_list.length>0},e.unref(d).clue_list.length>0?{m:e.f(e.unref(d).clue_list,((t,o,n)=>({a:e.t(t.name),b:e.o((e=>(e=>{var t;g.value=e??-1,f.value="clue",p.value=!0,null==(t=v.value)||t.setFormData(d.clue_list[e].name)})(o)),o),c:e.t(t.clue.length),d:"227e84e9-4-"+n,e:e.f(t.clue,((t,o,n)=>({a:e.t(t),b:o}))),f:e.o((e=>(e=>{d.clue_list.splice(e,1)})(o)),o),g:o,h:e.o((t=>(t=>{g.value=t??-1,t>-1&&a.setList("clueList",d.clue_list[t].clue),e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{index:t}})})(o)),o)}))),n:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"})}:{o:e.p({name:"plus",size:"20"}),p:e.o(C)},{q:e.f([{value:1,label:"固定话术"},{value:2,label:"AI回复"},{value:3,label:"AI根据固话优化"}],((t,o,n)=>({a:e.t(t.label),b:o,c:"227e84e9-7-"+n+",227e84e9-6",d:e.p({name:t.value,size:28})}))),r:e.o((t=>e.unref(d).comment_type=t)),s:e.p({modelValue:e.unref(d).comment_type}),t:1==e.unref(d).comment_type},1==e.unref(d).comment_type?{v:e.f(e.unref(d).comment_list,((t,o,n)=>({a:e.t(t),b:"227e84e9-8-"+n,c:e.o((e=>(e=>{d.comment_list.splice(e,1)})(o)),o),d:o,e:e.o((e=>I(o)),o)}))),w:e.p({name:"close",color:"#ffffff",size:"16"}),x:e.p({name:"plus",color:"#0065FB",size:"20"}),y:e.o((e=>I(-1)))}:{},{z:1===e.unref(_)},1===e.unref(_)?e.e({A:e.unref(d).comment_filter_list.length>0},e.unref(d).comment_filter_list.length>0?{B:e.f(e.unref(d).comment_filter_list,((t,o,n)=>({a:e.t(t.value),b:"227e84e9-10-"+n,c:e.o((e=>(e=>{d.comment_filter_list.splice(e,1)})(o)),o),d:o}))),C:e.p({name:"close",color:"#ffffff",size:"16"}),D:e.p({name:"plus",color:"#0065FB",size:"20"}),E:e.o(F)}:{F:e.p({name:"plus",size:"20"}),G:e.o(F)}):{},{H:1===e.unref(_)},1===e.unref(_)?{I:e.o((t=>e.unref(d).comment_like=t)),J:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(d).comment_like}),K:e.o((t=>e.unref(d).comment_follow=t)),L:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(d).comment_follow}),M:e.t(e.unref(L)||"请选择"),N:e.n(e.unref(d).comment_time>-1?"text-primary font-bold":"text-_hB2B2B2_"),O:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),P:e.o((e=>y.value=!0)),Q:e.t(e.unref(d).comment_region||"请选择"),R:e.n(e.unref(d).comment_region?"text-primary font-bold":"text-_hB2B2B2_"),S:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),T:e.o((e=>B.value=!0)),U:e.t(e.unref(d).comment_gender||"请选择"),V:e.n(e.unref(d).comment_gender?"text-primary font-bold":"text-_hB2B2B2_"),W:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),X:e.o(D),Y:e.t(e.unref(d).comment_age),Z:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),aa:e.o($),ab:e.t("0"==e.unref(d).comment_account_feature?"全部":"跳过认证号"),ac:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),ad:e.o(M)}:{},{ae:e.o(S)}),{af:e.sr(v,"227e84e9-20",{k:"keywordsEditRef"}),ag:e.o(A),ah:e.o((t=>e.isRef(p)?p.value=t:null)),ai:e.p({title:e.unref(z),modelValue:e.unref(p)}),aj:e.sr(j,"227e84e9-21",{k:"commentFilterRef"}),ak:e.o(R),al:e.o((t=>e.isRef(x)?x.value=t:null)),am:e.p({modelValue:e.unref(x)}),an:e.o(T),ao:e.o((t=>e.isRef(B)?B.value=t:null)),ap:e.p({modelValue:e.unref(B)}),aq:e.sr(b,"227e84e9-23",{k:"chooseAgeRef"}),ar:e.o(E),as:e.o((t=>e.isRef(k)?k.value=t:null)),at:e.p({modelValue:e.unref(k)}),av:e.o(V),aw:e.o((t=>e.isRef(y)?y.value=t:null)),ax:e.p({value:e.unref(d).comment_time_index,list:q,modelValue:e.unref(y)})})}}),s=e._export_sfc(c,[["__scopeId","data-v-227e84e9"]]);wx.createPage(s);
