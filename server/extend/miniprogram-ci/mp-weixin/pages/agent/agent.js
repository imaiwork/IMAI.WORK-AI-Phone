"use strict";const e=require("../../common/vendor.js"),a=require("../../api/agent.js"),t=require("../../hooks/useDictOptions.js"),o=require("../../stores/user.js"),r=require("../../stores/app.js"),n=require("../../config/index.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../utils/auth.js"),require("../../enums/constantEnums.js"),require("../../utils/cache.js"),require("../../router/index.js"),require("../../api/user.js"),require("../../hooks/useShareMessage.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../api/app.js"),require("../../api/chat.js"),require("../../api/voice_chat.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-navbar")+e.resolveComponent("u-search")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("tabbar"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../components/empty/empty.js")+(()=>"../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../components/tabbar/tabbar.js"))();const u=e.defineComponent({__name:"agent",setup(u){const s=r.useAppStore(),i=o.useUserStore(),l=e.computed(()=>s.getIsShowRobot),c=e.ref([{name:"AI智能体",type:2}]),d=e.ref(0),v=e.ref(c.value[0].type),p=e.reactive({cate_id:""}),f=e.ref(0),m=e.ref(-1),g=e.shallowRef(),b=e.ref([]),h=e.ref(0),_=e.reactive({type:3,scene_id:"",name:""}),j=e.ref(!1),q=e.shallowRef(),x=[{label:"智能体",value:1},{label:"Coze智能体",value:2},{label:"Coze工作流",value:3}],y=e.ref(1),w=e.ref([]),{optionsData:k}=t.useDictOptions({robotCate:{api:a.robotCategory,params:{pageSize:9999,pid:0},transformData:e=>{var a;return e.lists.length&&(p.cate_id&&(f.value=e.lists.findIndex(e=>e.id==p.cate_id)),null==(a=g.value)||a.reload()),e.lists}}}),C=e.ref(-1),z=e.ref(),A=e.computed(()=>i.isLogin),L=async e=>{v.value=c.value[e].type,d.value=e,1==d.value&&setTimeout(()=>{var e;null==(e=g.value)||e.reload()},300)},$=async()=>{var e;null==(e=g.value)||e.reload()},R=async()=>{var e;null==(e=g.value)||e.reload()},I=async(e,t)=>{var o,r;try{const{lists:r=[],count:n}=await a.robotLists({page_size:t,page_no:e,..._});h.value=n,null==(o=g.value)||o.complete(r),j.value=!1}catch(n){console.error("查询机器人列表失败:",n),j.value=!1,null==(r=g.value)||r.complete(!1)}},S=e=>e.some(e=>e.id==z.value),D=async(e,t)=>{var o,r;try{const r=1===y.value,n=r?a.getAgentList:a.getCozeAgentList,u={page_no:e,page_size:t,...r?{}:{type:2===y.value?1:2}},s=await n(u);null==(o=q.value)||o.complete(s.lists||[])}catch(n){console.error("查询智能体列表失败:",n),null==(r=q.value)||r.complete(!1)}};return e.watch(()=>l.value,e=>{const a=c.value.findIndex(e=>1===e.type);a>-1&&c.value.splice(a,1),"1"==e&&c.value.unshift({name:"AI助理",type:1}),d.value=0,v.value=c.value[0].type},{immediate:!0}),e.onLoad(({id:e})=>{e&&(p.cate_id=e)}),(t,o)=>e.e({a:e.unref(c).length>1},e.unref(c).length>1?{b:e.o(L),c:e.p({list:e.unref(c),"bg-color":"transparent","is-scroll":!1,current:e.unref(d)})}:{},{d:e.p({"border-bottom":!1,background:{background:"transparent"},"is-back":!1}),e:1==e.unref(v)},1==e.unref(v)?e.e({f:e.o($),g:e.o(R),h:e.o(a=>e.unref(_).name=a),i:e.p({"bg-color":"#ffffff","show-action":!1,placeholder:"请输入关键词",modelValue:e.unref(_).name}),j:e.f(e.unref(k).robotCate,(a,t,o)=>e.e({a:e.t(a.name),b:"6a488b48-3-"+o,c:e.p({name:e.unref(m)==t?"arrow-down":"arrow-right",size:24,color:"#707173"}),d:e.t(a.sub_list.length),e:e.unref(m)==t},e.unref(m)==t?{f:e.f(a.sub_list,(o,r,n)=>({a:e.t(o.name),b:`${t}-${r}`,c:e.unref(z)==o.id?1:"",d:0!=e.unref(C)&&e.unref(C)-1==r&&S(a.sub_list)?1:"",e:e.o(e=>((e,a)=>{var t,o,r;if(e==C.value&&a==z.value)return;z.value=a,C.value=e,j.value=!0;const n=null==(t=k.robotCate[m.value])?void 0:t.sub_list;_.scene_id=null==(o=n[e])?void 0:o.id,null==(r=g.value)||r.reload()})(r,o.id),`${t}-${r}`)}))}:{},{g:t,h:e.n({"robot-cate-active":e.unref(m)==t}),i:e.n({"robot-cate-brother":e.unref(C)==a.sub_list.length-1&&S(a.sub_list)}),j:e.n({"robot-cate-first":0==e.unref(C)&&S(a.sub_list)}),k:e.o(e=>(e=>{e!=m.value?m.value=e:m.value=-1})(t),t)})),k:e.t(e.unref(h)),l:e.unref(j)},(e.unref(j),{}),{m:e.f(e.unref(b),(a,t,o)=>({a:a.logo,b:e.t(a.name),c:e.t(a.description),d:t,e:e.o(t=>{return o=a,void e.index.$u.route({url:"/packages/pages/robot_chat/robot_chat",params:{id:o.id}});var o},t)})),n:e.sr(g,"6a488b48-4",{k:"pagingRobotRef"}),o:e.o(I),p:e.o(a=>e.isRef(b)?b.value=a:null),q:e.p({auto:!1,fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(b)})}):{},{r:2==e.unref(v)},2==e.unref(v)?{s:e.f(x,(a,t,o)=>({a:e.t(a.label),b:e.unref(y)==a.value?1:"",c:a.value,d:e.o(e=>(e=>{var a;y.value=e.value,null==(a=q.value)||a.reload()})(a),a.value)})),t:e.f(e.unref(w),(t,o,r)=>e.e({a:t.image||t.avatar,b:`url(${t.bg_image||e.unref(n.config).baseUrl+"static/images/agent_bg.png"})`,c:e.t(t.name),d:e.t(t.intro||t.introduced),e:e.t(t.source_text),f:1==t.source},1==t.source?{g:"6a488b48-7-"+r+",6a488b48-6",h:e.p({name:"more-dot-fill",size:24,color:"#999999"}),i:e.o(o=>(t=>{e.index.showActionSheet({itemList:["删除"],success:o=>{0==o.tapIndex&&e.index.showModal({title:"提示",content:"确定删除该智能体吗？",success:async o=>{if(o.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{const o=1==y.value?a.deleteAgent:a.deleteCozeAgent;await o({id:t.id}),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),w.value=w.value.filter(e=>e.id!=t.id)}catch(r){e.index.hideLoading(),e.index.showToast({title:r,icon:"none",duration:3e3})}}}})}})})(t),o)}:{},{j:o,k:e.o(a=>(a=>{A.value?1==y.value?e.index.$u.route({url:"/pages/index/index",params:{agent_name:a.name,agent_id:a.id,agent_logo:a.image}}):e.index.$u.route({url:"/packages/pages/coze_chat/coze_chat",params:{id:a.id,type:a.type}}):e.index.$u.route({url:"/pages/login/login"})})(t),o)})),v:e.sr(q,"6a488b48-6",{k:"pagingCozeRef"}),w:e.o(D),x:e.o(a=>e.isRef(w)?w.value=a:null),y:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(w)})}:{})}}),s=e._export_sfc(u,[["__scopeId","data-v-6a488b48"]]);wx.createPage(s);
