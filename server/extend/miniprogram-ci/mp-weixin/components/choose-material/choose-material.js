"use strict";const e=require("../../common/vendor.js"),t=require("../../api/material.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../utils/auth.js"),require("../../enums/constantEnums.js"),require("../../utils/cache.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../hooks/useShareMessage.js"),require("../../router/index.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../stores/app.js"),require("../../api/app.js"),require("../../api/chat.js"),require("../../api/voice_chat.js"),require("../../config/index.js"),!Array){(e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../empty/empty.js")+(()=>"../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../popup-bottom/popup-bottom.js"))();const u=e.defineComponent({__name:"choose-material",props:{modelValue:{type:Boolean},limit:null,type:null},emits:["update:modelValue","select"],setup(u,{emit:r}){const s=u,i=e.computed({get:()=>s.modelValue,set:e=>{r("update:modelValue",e)}}),l=e.ref([]),a=e.ref(null),o=e.ref([]),n=async(e,u)=>{var r;try{const{lists:i}=await t.getMaterialLibraryList({page_no:e,page_size:u,m_type:"video"==s.type?2:1});null==(r=a.value)||r.complete(i)}catch(i){console.error("查询历史记录失败:",i)}},p=e=>o.value.some((t=>t.id===e.id)),c=()=>{o.value.length==l.value.length?o.value=[]:o.value=l.value.slice(0,s.limit)},m=()=>{0!=o.value.length?(i.value=!1,r("select",o.value),o.value=[]):e.index.$u.toast("至少选择一个视频")};return e.watch(i,(async()=>{var t;i.value&&(await e.nextTick$1(),null==(t=a.value)||t.reload())})),(t,u)=>e.e({a:e.t(e.unref(o).length),b:e.f(e.unref(l),((t,u,r)=>e.e({a:t.pic||t.content,b:p(t)},(p(t),{}),{c:u,d:e.o((u=>(t=>{if(p(t))o.value=o.value.filter((e=>e.id!==t.id));else{if(o.value.length>=s.limit)return void e.index.$u.toast(`最多选择${s.limit}个素材`);o.value.push(t)}})(t)),u)}))),c:e.n("video"==s.type?"h-_288rpx_":"h-_170rpx_"),d:e.n("video"==s.type?"grid-cols-3":"grid-cols-4"),e:e.sr(a,"7210d924-1,7210d924-0",{k:"pagingRef"}),f:e.o(n),g:e.o((t=>e.isRef(l)?l.value=t:null)),h:e.p({auto:!1,fixed:!1,"default-page-size":50,"safe-area-inset-bottom":!0,modelValue:e.unref(l)}),i:e.unref(o).length>0&&e.unref(o).length==e.unref(l).length},(e.unref(o).length>0&&(e.unref(o).length,e.unref(l).length),{}),{j:e.o(c),k:e.o(m),l:e.o((t=>e.isRef(i)?i.value=t:null)),m:e.p({title:"素材选择","show-close-btn":!0,"is-disabled-touch":!0,"custom-class":"bg-_hF9FAFB_",show:e.unref(i)})})}});wx.createComponent(u);
