"use strict";const e=require("../../../common/vendor.js"),u=require("../../../api/app.js"),a=require("../../../api/drawing.js"),t=require("../../../utils/file.js"),n=require("../../../common/assets.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../utils/auth.js"),require("../../../enums/constantEnums.js"),require("../../../utils/cache.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../hooks/useShareMessage.js"),require("../../../router/index.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../stores/app.js"),require("../../../api/chat.js"),require("../../../api/voice_chat.js"),require("../../../config/index.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("video-preview-v2")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+l+(()=>"../../../components/empty/empty.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../components/video-preview-v2/video-preview-v2.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const l=()=>"../../components/puzzle-card/puzzle-card.js",r=e.defineComponent({__name:"creation",setup(l){const r=[{name:"视频创作"},{name:"图片创作"},{name:"拼图创作"}],i=e.ref(0),s=e.computed((()=>0==i.value?[{name:"全部",key:0},{name:"数字人口播",key:1},{name:"口播混剪",key:2},{name:"真人口播",key:3},{name:"素材混剪",key:4},{name:"新闻体",key:5},{name:"一句话生成",key:6}]:1==i.value?[{name:"全部",key:0},{name:"文生图",key:3},{name:"图生图",key:4},{name:"商品图",key:1},{name:"海报图",key:5},{name:"服饰图",key:2},{name:"视频",key:6}]:[])),o=e.ref(0),d=e.ref([]),v=e.shallowRef(),c=e.ref(0),p=e.ref([]),f=e.ref(null),m=e.ref({}),_=e.ref(-1),y=e.ref(""),h=e.ref(!1),g=e.ref(!1),w=e.ref(!1),k=e.ref(!1),x=e.ref([]),j=e=>{const{type:u,status:a}=e||{};return 1===u?0===a||1===a||2===a?a:3:0===a?0:3===a?1:2===a?2:3},b=async u=>{var a;i.value=u,o.value=0,c.value=0,await e.nextTick$1(),E(),k.value=!1,x.value=[],null==(a=v.value)||a.reload()},q=async(e,a)=>{const t={page_no:e,page_size:a};0!==o.value&&(t.type=o.value);return(await u.getVideoCreationRecord(t)).lists},z=async(e,u)=>{const t={page_no:e,page_size:u};0!==o.value&&(t.draw_type=o.value,6==o.value?t.type="":t.type=o.value);return(await a.drawingRecord(t)).lists},C=async(e,u)=>(await a.getPuzzleTaskList({page_no:e,page_size:u})).lists,I=async(e,u)=>{var a,t;try{const t={0:q,1:z,2:C}[i.value],n=await(null==t?void 0:t(e,u))||[];null==(a=v.value)||a.complete(n)}catch(n){null==(t=v.value)||t.complete([])}},R=()=>{e.nextTick$1((()=>{var e;null==(e=v.value)||e.reload()}))},T={1:"商品图",2:"服饰图",3:"文生图",4:"图生图",5:"海报图",6:"视频"},$=(u,a)=>{m.value=u,_.value=a,0===i.value?((u,a)=>{e.index.showActionSheet({itemList:["修改名称","下载视频","删除"],success:t=>{if(0===t.tapIndex)L(d.value.findIndex((e=>e.id==m.value.id)));else if(1===t.tapIndex){if(!u.video_result_url&&!u.clip_result_url)return void e.index.$u.toast("视频未生成");u.clip_result_url?g.value=!0:F(1)}else 2===t.tapIndex&&A(a)}})})(u,a):1===i.value&&((u,a)=>{const{draw_type:n}=u,l=6==n;e.index.showActionSheet({itemList:[l?"保存视频":"保存图片","删除"],success:e=>{0===e.tapIndex?l?t.saveVideoToPhotosAlbum(u.video_url):t.saveImageToPhotosAlbum(u.image):1===e.tapIndex&&A(a)}})})(u,a)},L=e=>{_.value=e,y.value=d.value[e].name,h.value=!0},V=async()=>{if(y.value){h.value=!1,e.index.showLoading({title:"修改中...",mask:!0});try{await u.updateVideoCreationRecord({id:m.value.id,name:y.value,task_id:m.value.task_id,type:m.value.type}),e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3});const a=d.value.findIndex((e=>e.id==m.value.id));-1!=a&&(d.value[a].name=y.value)}catch(a){e.index.showToast({title:a||"修改失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入名称")},F=async e=>{const{video_result_url:u,clip_result_url:a}=m.value,n=1===e?u:a;try{await t.saveVideoToPhotosAlbum(n)}catch(l){}finally{g.value=!1}},A=async t=>{e.index.showModal({title:"您真的要删除吗？",content:"删除后将无法找回，且该操作不可逆！",success:async n=>{if(n.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{if(0===i.value&&"number"==typeof t){const{task_id:e,type:a,id:n}=d.value[t];await u.deleteVideoCreationRecord({id:n,task_id:e,type:a}),d.value.splice(t,1)}else if(1===i.value){let e=[];const u=[],n=[];e="number"==typeof t?[t]:t,d.value.forEach(((a,t)=>{e.includes(t)&&(6==a.draw_type?n.push(a.id):u.push(a.log_id))})),await a.drawingDeleteRecord({log_id:u,video_id:n}),d.value=d.value.filter(((u,a)=>!e.includes(a)))}e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),x.value=[],k.value=!1}catch(l){e.index.showToast({title:l||"删除失败",icon:"none",duration:3e3})}finally{e.index.hideLoading()}}}})},M=e=>x.value.includes(e),S=u=>{const a=d.value[u];if(1!==j(a)&&0==i.value)return void e.index.$u.toast("生成中、生成失败的视频不能选择哦~");const t=d.value.map(((e,u)=>u));-1!=u?M(u)?x.value.splice(x.value.indexOf(u),1):x.value.push(u):x.value.length==t.length?x.value=[]:x.value=t},P=()=>{if(0==x.value.length)return void e.index.$u.toast("请选择发布内容");if(0===i.value&&x.value.length>99)return void e.index.$u.toast("最多只能选择99个视频哦~");const u=x.value.map((e=>d.value[e].task_id));e.index.$u.route({url:"/ai_modules/device/pages/create_task/create_task?type=1",params:{source:"creation_video",ids:JSON.stringify(u)}}),x.value=[],k.value=!1},E=()=>{const u=e.getCurrentInstance();if(!u)return;const a=e.index.createSelectorQuery().in(u);a.select("#type-scroll-view").fields({rect:!0,size:!0},(()=>{})),s.value.forEach(((e,u)=>{a.select(`#type${u}`).fields({rect:!0,size:!0},(()=>{}))})),a.exec((e=>{if(!e||!e[0])return;const[u,...a]=e;f.value=u,p.value=a.map((e=>e&&u?{...e,offsetLeft:e.left-u.left}:{}))}))};return e.onMounted((()=>{E()})),e.onLoad((e=>{(null==e?void 0:e.tab)&&(i.value=parseInt(null==e?void 0:e.tab))})),e.onShow((async()=>{var u;await e.nextTick$1(),null==(u=v.value)||u.reload()})),(u,a)=>e.e({a:e.o(b),b:e.p({list:r,current:e.unref(i),"bar-width":66,"font-size":26}),c:e.f(e.unref(s),((u,a,t)=>({a:e.t(u.name),b:e.n(e.unref(o)==u.key?"bg-black text-white":"shadow-_0_0_0_2rpx_rgba_0b0b0b0d1__"),c:`type${a}`,d:a,e:e.o((e=>((e,u)=>{if(o.value=e,!f.value||!p.value[u]||!p.value[u].width)return void R();const a=f.value,t=p.value[u],n=t.offsetLeft+t.width/2-a.width/2;c.value=n,R()})(u.key,a)),a)}))),d:e.unref(c),e:0==e.unref(i)},0==e.unref(i)?{f:e.f(e.unref(d),((u,a,t)=>{return e.e({a:u.pic||e.unref(n.DefaultBg),b:e.t(u.create_time),c:0!=u.clip_status},(u.clip_status,{}),{d:1==j(u)},1==j(u)?e.e({e:0!=u.clip_status},0!=u.clip_status?e.e({f:1==u.clip_status||2==u.clip_status},(1==u.clip_status||u.clip_status,{}),{g:3==u.clip_status},(u.clip_status,{}),{h:4==u.clip_status},(u.clip_status,{})):{},{i:e.o((e=>(e=>{const{video_result_url:u,clip_result_url:a,pic:t}=e;m.value.url=a||u,m.value.pic=t,w.value=!0})(u)),a)}):e.e({j:2==j(u)},2==j(u)?{k:e.t(u.remark)}:{}),e.unref(k)?e.e({l:M(a)},(M(a),{}),{m:M(a)?1:"",n:e.o((e=>S(a)),a)}):{},{o:e.t(u.name),p:"312d1352-2-"+t+",312d1352-1",q:e.o((e=>$(u,a)),a),r:e.t((l=u.type,null==(r=s.value.find((e=>e.key==l)))?void 0:r.name)),s:a});var l,r})),g:e.unref(k),h:e.p({name:"more-dot-fill",color:"#7F7F7F"})}:{},{i:1==e.unref(i)},1==e.unref(i)?{j:e.f(e.unref(d),((u,a,t)=>{return e.e({a:6!=u.draw_type},6!=u.draw_type?{b:u.image}:{c:u.video_url},{d:6==u.draw_type},(u.draw_type,{}),{e:e.o((a=>(u=>{const{draw_type:a,image:t,video_url:n}=u;6==a?(m.value.url=n,w.value=!0):e.index.previewImage({urls:[t]})})(u)),a)},e.unref(k)?e.e({f:M(a)},(M(a),{}),{g:M(a)?1:"",h:e.o((e=>S(a)),a)}):{},{i:e.t((l=u.create_time,e.index.$u.timeFormat(l,"yyyy-mm-dd hh:MM"))),j:e.t((n=u.draw_type,T[parseInt(n)])),k:"312d1352-3-"+t+",312d1352-1",l:e.o((e=>$(u,a)),a),m:a});var n,l})),k:e.unref(k),l:e.p({name:"more-dot-fill",color:"#7F7F7F"})}:{},{m:2==e.unref(i)},2==e.unref(i)?{n:e.f(e.unref(d),((u,a,t)=>({a:a,b:e.o(R,a),c:"312d1352-4-"+t+",312d1352-1",d:e.p({item:u}),e:a})))}:{},{o:e.sr(v,"312d1352-1",{k:"pagingRef"}),p:e.o(I),q:e.o((u=>e.isRef(d)?d.value=u:null)),r:e.p({fixed:!1,auto:!1,"safe-area-inset-bottom":!0,"default-page-size":20,modelValue:e.unref(d)}),s:0==e.unref(i)},0==e.unref(i)?e.e({t:!e.unref(k)},e.unref(k)?{w:e.t(e.unref(x).length),x:e.n(e.unref(x).length>0?"bg-black":"bg-_h787878CC_"),y:e.o((e=>{k.value=!1,x.value=[]})),z:e.n(e.unref(x).length>0?"bg-black":"bg-_h787878CC_"),A:e.o(P)}:{v:e.o((e=>k.value=!0))}):{},{B:1==e.unref(i)&&e.unref(d).length>0},1==e.unref(i)&&e.unref(d).length>0?e.e({C:e.unref(k)},e.unref(k)?e.e({D:e.o((e=>{k.value=!1,x.value=[]})),E:e.unref(x).length>0&&e.unref(x).length==e.unref(d).length},(e.unref(x).length>0&&(e.unref(x).length,e.unref(d).length),{}),{F:e.o((e=>S(-1)))}):{},{G:e.unref(k)},e.unref(k)?{H:e.t(e.unref(x).length),I:e.o((u=>A(e.unref(x))))}:{J:e.o((e=>k.value=!0))},{K:e.n(e.unref(k)?"justify-between":"justify-end")}):{},{L:e.o((e=>w.value=!1)),M:e.o((u=>e.isRef(w)?w.value=u:null)),N:e.p({"is-bar":!1,"video-url":e.unref(m).url,poster:e.unref(m).pic,show:e.unref(w)}),O:e.o((u=>e.isRef(y)?y.value=u:null)),P:e.p({placeholder:"请输入名称",maxlength:"30",clearable:!0,"placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(y)}),Q:e.o((e=>h.value=!1)),R:e.o(V),S:e.o((u=>e.isRef(h)?h.value=u:null)),T:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(h)}),U:e.o((e=>F(1))),V:e.unref(m).clip_result_url},e.unref(m).clip_result_url?{W:e.o((e=>F(2)))}:{},{X:e.o((u=>e.isRef(g)?g.value=u:null)),Y:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(g)})})}}),i=e._export_sfc(r,[["__scopeId","data-v-312d1352"]]);wx.createPage(i);
