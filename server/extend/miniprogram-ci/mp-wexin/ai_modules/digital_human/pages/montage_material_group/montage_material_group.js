"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../common/assets.js"),o=require("../../enums/index.js"),u=require("../../../../hooks/useMontageMaterial.js"),i=require("../../../../hooks/useEventBusManager.js");if(require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),require("../../../../api/material.js"),require("../../../../hooks/usePolling.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("upload-progress"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+s+(()=>"../../../../components/upload-progress/upload-progress.js"))();const s=()=>"../../components/upload-rule-pop/upload-rule-pop.js",t=e.defineComponent({__name:"montage_material_group",setup(s){const{emit:t}=i.useEventBusManager(),a=e.ref([]),n=e.ref(!0),l=e.ref(!1),p=e.ref(-1),m=e.computed((()=>{const e=a.value.filter((e=>"image"===e.type)).length;return a.value.reduce(((e,r)=>"video"===r.type?e+r.duration:e),0)+e*u.montageConfig.imageDuration})),c=()=>{if(n.value)return n.value=!1,void(l.value=!0);e.index.showActionSheet({itemList:["选择图片素材","选择视频素材"],success:e=>{0===e.tapIndex?f("image"):1===e.tapIndex&&f("video")}})},{showUploadProgress:d,uploadMaterialList:g,uploadAndProcessFiles:f}=u.useMontageMaterial({onSuccess:e=>{-1!==p.value?a.value[p.value]=e[0]:a.value=a.value.concat(e),p.value=-1}}),v=()=>{const r=a.value.filter((e=>"video"===e.type)).length,i=a.value.filter((e=>"image"===e.type)).length;r<1||i<3?e.index.showToast({title:"至少需要1个视频+3张图片",icon:"none"}):m.value>60*u.montageConfig.materialTotalDuration?e.index.$u.toast(`素材总时长不能超过${u.montageConfig.materialTotalDuration}分钟`):(t("confirm",{type:o.ListenerTypeEnum.MONTAGE_MATERIAL_GROUP,data:a.value}),e.index.navigateBack())};return e.onLoad((e=>{e.materialList&&(a.value=JSON.parse(e.materialList))})),(o,i)=>({a:e.t(e.unref(a).length),b:e.t(e.unref(u.montageConfig).materialTotalDuration),c:e.t(e.unref(u.montageConfig).imageDuration),d:e.f(e.unref(a),((o,u,i)=>e.e({a:o.pic,b:"5fe573d0-0-"+i,c:e.o((e=>(e=>{a.value.splice(e,1)})(u)),u),d:"image"===o.type},"image"===o.type?{e:r._imports_0$11}:{f:r._imports_3$5},{g:e.o((e=>(e=>{p.value=e,c()})(u)),u),h:u}))),e:e.p({name:"close",color:"#ffffff",size:"16"}),f:r._imports_0$6,g:e.o(c),h:e.o(v),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"12rpx",fontWeight:"bold"}}),j:e.o(c),k:e.o((r=>e.isRef(l)?l.value=r:null)),l:e.p({modelValue:e.unref(l)}),m:e.o((r=>e.isRef(d)?d.value=r:null)),n:e.p({"upload-list":e.unref(g),modelValue:e.unref(d)})})}});wx.createPage(t);
