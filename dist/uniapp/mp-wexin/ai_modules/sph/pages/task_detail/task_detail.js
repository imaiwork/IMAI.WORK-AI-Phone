"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/sph.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-tabs")+e.resolveComponent("empty")+e.resolveComponent("z-paging"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+s+(()=>"../../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+t+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+n)();const s=()=>"../../components/task-card/task-card.js",t=()=>"../../components/clue-card/clue-card.js",n=()=>"../../components/task-edit/task-edit.js",u=e.defineComponent({__name:"task_detail",setup(s){const t=e.ref({}),n=e.ref(!0),u=e.ref([{name:"全部",value:null},{name:"有效线索",value:1},{name:"内含有效线索",value:3},{name:"无效线索",value:2}]),i=e.ref(0),r=e.ref(!1),o=e.ref([]),l=e.ref(),c=async(e,s)=>{var n,r;try{const{lists:r}=await a.getTaskClue({task_id:t.value.id,page_no:e,page_size:s,status:u.value[i.value].value||""});null==(n=l.value)||n.complete(r)}catch(o){null==(r=l.value)||r.complete([])}},d=e=>{var a;i.value=e,null==(a=l.value)||a.reload()},p=async e=>{var a;await q(t.value.id),null==(a=l.value)||a.reload()},m=e.ref(!1),v=e.shallowRef(),f=async a=>{m.value=!0,await e.nextTick$1(),setTimeout((()=>{var e,s;null==(e=v.value)||e.open(),null==(s=v.value)||s.setFormData(a)}),100)},g=async()=>{e.index.showModal({title:"提示",content:"确定删除所有线索记录吗？",success:async s=>{if(s.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{await a.deleteTask({id:t.value.id}),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(n){e.index.hideLoading(),e.index.showToast({title:n,icon:"none",duration:3e3})}}}})},j=()=>{r.value?e.index.$u.route({url:"/ai_modules/sph/pages/index/index",type:"reLaunch"}):e.index.navigateBack()},k=()=>{clearTimeout(h),x(t.value.id)},q=async s=>{try{const n=await a.getTaskDetail({id:s});t.value=n,await e.nextTick$1()}finally{n.value=!1}};let h;const x=async e=>{await q(e);(1==t.value.status||0==t.value.status)&&(h=setTimeout((()=>{x(e)}),3e3))};return e.onLoad((({task_id:e,is_create:a})=>{r.value=1==a,clearTimeout(h),x(e)})),e.onHide((()=>{clearTimeout(h)})),e.onBeforeUnmount((()=>{clearTimeout(h)})),(a,s)=>e.e({a:!e.unref(n)},e.unref(n)?{}:{b:e.p({title:"获客详情",background:{backgroundColor:"#f6f6f6"},"custom-back":j}),c:e.o(p),d:e.o(f),e:e.p({item:e.unref(t)}),f:`/ai_modules/sph/pages/clue_list/clue_list?task_id=${e.unref(t).id}`,g:e.o(d),h:e.p({list:e.unref(u),current:e.unref(i),"bg-color":"transparent","font-size":"26rpx"}),i:e.f(e.unref(o),((a,s,t)=>({a:"10131db5-4-"+t+",10131db5-3",b:e.p({item:a}),c:s}))),j:e.sr(l,"10131db5-3",{k:"pagingRef"}),k:e.o(c),l:e.o(k),m:e.o((a=>e.isRef(o)?o.value=a:null)),n:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(o)}),o:e.o(g)},{p:e.unref(m)},e.unref(m)?{q:e.sr(v,"10131db5-6",{k:"taskEditRef"}),r:e.o((e=>m.value=!1)),s:e.o((e=>k()))}:{})}});wx.createPage(u);
