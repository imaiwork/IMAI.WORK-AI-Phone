"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../common/assets.js"),o=require("../../../../api/digital_human.js"),s=require("../../../../stores/user.js"),u=require("../../../../hooks/useUpload.js"),n=require("../../../../enums/appEnums.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("upload-progress")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+t+(()=>"../../../../components/upload-progress/upload-progress.js")+a+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const a=()=>"../../components/create-success-pop/create-success-pop.js",t=()=>"../../components/range-slider/range-slider.js",i=e.defineComponent({__name:"sora_create_role",setup(a){const t=s.useUserStore(),{userTokens:i}=e.toRefs(t),l=e.computed((()=>{var e;const r=null==(e=t.getTokenByScene(n.TokensSceneEnum.SORA_ROLE))?void 0:e.score;return parseFloat(r)}));e.ref(0);const c=e.reactive({name:"",pic:"",anchor_url:"",start:0,end:2}),p=e.ref(0),d=e.ref(2),f=e.ref(10),m=["mp4","mov"];e.ref(!1);const h=e.shallowRef();e.ref([0]),e.ref(!1);const v=e.ref(!1),{showUploadProgress:_,uploadMaterialList:j,uploadAndProcessFiles:q}=u.useUpload({count:1,videoAccept:m,videoSize:200,videoDuration:[2,600],onSuccess:e=>{c.anchor_url=e[0].url,c.pic=e[0].pic,f.value=Math.floor(e[0].duration)}}),g=e=>{c.start=e.start,c.end=e.end},x=async()=>{var r;if(i.value<=l.value)null==(r=h.value)||r.open();else if(c.name)if(c.anchor_url)if(d.value-p.value>=3)e.index.$u.toast("范围差值需在1-3秒之间");else{e.index.showLoading({title:"提交中...",mask:!0});try{await o.createSoraRole({name:c.name,pic:c.pic,anchor_url:c.anchor_url,start:p.value,end:d.value});e.index.hideLoading(),v.value=!0}catch(s){e.index.hideLoading(),e.index.showToast({title:s,icon:"none",duration:3e3})}}else e.index.$u.toast("请上传角色视频");else e.index.$u.toast("请输入角色名称")},b=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/sora_role_library/sora_role_library",type:"reLaunch"})};return(o,s)=>e.e({a:e.p({"title-bold":!0,title:"创建角色","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}})},{},{d:e.o((r=>e.unref(c).name=r)),e:e.p({placeholder:"请输入角色名称","placeholder-style":"color: rgba(0,0,0,0.3); font-size: 26rpx;",clearable:!0,maxlength:"100",modelValue:e.unref(c).name}),f:e.unref(c).anchor_url},e.unref(c).anchor_url?{g:e.o((r=>e.unref(q)("video")))}:{},{h:!e.unref(c).anchor_url},e.unref(c).anchor_url?{m:e.unref(c).anchor_url}:{i:r._imports_0$20,j:e.t(m.join("、")),k:e.t(200),l:e.o((r=>e.unref(q)("video")))},{n:!e.unref(c).anchor_url},e.unref(c).anchor_url?{o:e.o(g),p:e.p({start:e.unref(c).start,end:e.unref(c).end,"max-diff":3,total:e.unref(f)})}:{},{q:e.t(e.unref(l)),r:e.o(x),s:e.o((r=>e.isRef(_)?_.value=r:null)),t:e.p({"upload-list":e.unref(j),modelValue:e.unref(_)}),v:e.o(b),w:e.o((r=>e.isRef(v)?v.value=r:null)),x:e.p({title:"角色生成中","seek-text":"","to-text":"查看角色库",desc:"角色正在生成，请耐心等待，可在角色库中查看",modelValue:e.unref(v)}),y:e.sr(h,"2b8977e8-5",{k:"rechargePopupRef"})})}}),l=e._export_sfc(i,[["__scopeId","data-v-2b8977e8"]]);wx.createPage(l);
