"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),n=require("../../../../api/digital_human.js"),u=require("../../../../stores/user.js"),r=require("../../../../enums/appEnums.js"),a=require("../../enums/index.js"),s=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js"))();const o=e.defineComponent({__name:"montage_ai_copywriter",setup(o){const{emit:i}=s.useEventBusManager(),l=u.useUserStore(),{userTokens:c}=e.toRefs(l),m=e.ref(""),f=e.ref(150),p=e.ref(),v=e.ref([]),d=[{id:1,name:"长",length:500},{id:2,name:"中",length:300},{id:3,name:"短",length:150}],g=e.computed((()=>d)),h=e.computed((()=>p.value==a.MontageTypeEnum.NEWS_BODY)),j=[1,3,5,10,20],q=e.ref(1),E=e.ref(g.value[0]),_=e.ref(!1),y=e.computed((()=>v.value.every((e=>"success"===e.status)))),T=e.computed((()=>{var e;const t=null==(e=l.getTokenByScene(p.value==a.MontageTypeEnum.NEWS_BODY?r.TokensSceneEnum.NEWS_MIX_CUT_TITLE:r.TokensSceneEnum.SHANJIAN_COPYWRITING_CREATE))?void 0:e.score;return parseFloat(t)*q.value})),x=async t=>{if(t.trim()){if(y.value)if(c.value<T.value)e.index.$u.toast("算力不足，请充值！");else try{if(_.value=!0,v.value=Array.from({length:q.value},(()=>({title:"",content:"",status:"pending"}))),h.value){const u=await n.generateNewsBodyPrompt({keywords:t,number:q.value});return void(u.content&&u.content.length>0?v.value=u.content.map((e=>({content:JSON.parse(e),status:"success"}))):(e.index.$u.toast("文案生成失败，请重新输入"),_.value=!1,v.value=[]))}const u=[];for(let e=0;e<q.value;e++)u.push(n.generateShanjianPrompt({keywords:t,number:E.value.length}));const r=await Promise.all(u);v.value=r.map((e=>({title:e.title,content:e.content,status:"success"})))}catch(u){_.value=!1,e.index.showToast({title:u||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},k=()=>{y.value?(i("confirm",{type:a.ListenerTypeEnum.MONTAGE_AI_COPYWRITER,data:h.value?v.value.filter((e=>e.content.some((e=>""!==e.trim())))).map((e=>e.content)):v.value.filter((e=>e.title)).map((e=>({title:e.title,content:e.content}))).filter((e=>""!==e.title.trim()))}),v.value=[],e.index.navigateBack()):e.index.$u.toast("文案在生成中...")};return e.onLoad((e=>{f.value=e.limit,e.montageType&&(p.value=parseInt(e.montageType))})),(n,u)=>e.e({a:!e.unref(_)},e.unref(_)?{j:e.f(e.unref(v),((n,u,r)=>e.e({a:"pending"===n.status},"pending"===n.status?{b:t._imports_0$14,c:e.t(u+1)}:e.e({d:!e.unref(h)},e.unref(h)?{l:e.f(n.content,((t,a,s)=>({a:e.t(a+1),b:"2f3410aa-2-"+r+"-"+s,c:e.o((t=>e.unref(v)[u].content[a]=t),a),d:e.p({"placeholder-style":"color: #7C7E80; ",maxlength:"100",modelValue:e.unref(v)[u].content[a]}),e:a,f:a<n.content.length-1?1:""})))}:{e:"2f3410aa-0-"+r,f:e.o((e=>n.title=e),u),g:e.p({"placeholder-style":"color: #7C7E80; ",maxlength:"50",modelValue:n.title}),h:"2f3410aa-1-"+r,i:e.o((e=>n.content=e),u),j:e.p({type:"textarea","placeholder-style":"color: #7C7E80; ",maxlength:"500","auto-height":!1,modelValue:n.content}),k:e.t(n.content.length)},{m:"2f3410aa-3-"+r,n:e.p({name:"close",color:"#ffffff",size:"16"}),o:e.o((e=>(e=>{v.value.splice(e,1),0===v.value.length&&(_.value=!1)})(u)),u)}),{p:u})))}:e.e({b:500,c:e.unref(m),d:e.o((t=>e.isRef(m)?m.value=t.detail.value:null)),e:e.t(e.unref(m).length),f:e.t(500),g:e.unref(p)!=e.unref(a.MontageTypeEnum).NEWS_BODY},e.unref(p)!=e.unref(a.MontageTypeEnum).NEWS_BODY?{h:e.f(e.unref(g),((t,n,u)=>{var r;return{a:e.t(t.name),b:t.id,c:(null==(r=e.unref(E))?void 0:r.id)===t.id?1:"",d:e.o((e=>E.value=t),t.id)}}))}:{},{i:e.f(j,((t,n,u)=>({a:e.t(t),b:t,c:e.unref(q)===t?1:"",d:e.o((e=>q.value=t),t)})))}),{k:!e.unref(_)},e.unref(_)?{o:e.o((t=>x(e.unref(m)))),p:e.n(e.unref(y)?"bg-black":"bg-_h787878CC_"),q:e.o(k)}:{l:e.t(e.unref(T)),m:e.n(e.unref(m).length>0?"bg-black":"bg-_h787878CC_"),n:e.o((t=>x(e.unref(m))))})}}),i=e._export_sfc(o,[["__scopeId","data-v-2f3410aa"]]);wx.createPage(i);
