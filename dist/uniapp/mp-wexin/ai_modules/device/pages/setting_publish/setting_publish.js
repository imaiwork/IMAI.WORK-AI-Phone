"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../common/assets.js"),a=require("../../../../api/device.js"),t=require("../../stores/material.js"),r=require("../../hooks/useDevice.js"),s=require("../../../../enums/appEnums.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("video-preview"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/video-preview/video-preview.js"))();const n=e.defineComponent({__name:"setting_publish",setup(n){const{platformLogo:o}=r.useDevice(),l=e.ref(!0),m=e.ref(0),u=t.useMaterialStore(),c=e.ref(""),d=e.ref(null),g=e.reactive({anchorList:[],videoList:[],imageList:[],marketingList:[]}),h=e.reactive({videoTheme:"",imageTheme:""}),p=[{name:"数字人形象",list:[],page:"anchor_material"},{name:"视频剪辑素材",list:[],page:"video_material"},{name:"图文剪辑素材",list:[],page:"image_material"},{name:"营销主题",list:[],page:"marketing_material"}],v=e.ref([{...o[s.AppTypeEnum.XHS],status:1,materialList:JSON.parse(JSON.stringify(p))},{...o[s.AppTypeEnum.DOUYIN],status:1,materialList:JSON.parse(JSON.stringify(p))},{...o[s.AppTypeEnum.WECHAT],logo:i.SphIcon,status:1,materialList:JSON.parse(JSON.stringify(p))},{...o[s.AppTypeEnum.KUAISHOU],status:0,materialList:JSON.parse(JSON.stringify(p))}]),_=e.ref(!1),f=e.ref({url:"",pic:""}),L=e.ref({platformIndex:null,materialIndex:null}),x=i=>{"image"===i.type?e.index.previewImage({urls:[i.pic]}):j(i)},j=e=>{f.value={url:e.url,pic:e.pic},_.value=!0},k=(i,a)=>{if(u.clearMaterial(),0===m.value)u.anchorList=g.anchorList,u.videoList=g.videoList,u.imageList=g.imageList,u.marketingList=g.marketingList;else if(a){const{platformIndex:e,materialIndex:t,materialList:r}=a;switch(L.value={platformIndex:e,materialIndex:t},i){case"anchor_material":u.anchorList=r;break;case"video_material":u.videoList=r;break;case"image_material":u.imageList=r;break;case"marketing_material":u.marketingList=r}}e.index.$u.route({url:{anchor_material:"/ai_modules/device/pages/anchor_material/anchor_material",video_material:"/ai_modules/device/pages/video_material/video_material",image_material:"/ai_modules/device/pages/image_material/image_material",marketing_material:"/ai_modules/device/pages/marketing_material/marketing_material"}[i]})},q=async()=>{e.index.showLoading({title:"保存中...",mask:!0});try{await a.createAutoTaskPublishConfig({device_config_id:d.value.device_config_id,device_code:c.value,text_theme:h.imageTheme,video_theme:h.videoTheme,human_image:u.anchorList.map((e=>({...e.anchor_ids,...e.extra_info,id:e.id,pic:e.pic,voice_id:e.extra_info.shanjian_voice_id,anchor_url:e.result_url}))),clip_material:u.videoList.map((e=>({type:e.type,fileUrl:e.url,cover:e.pic}))),image_material:u.imageList.map((e=>e.url))}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(i){e.index.hideLoading(),e.index.showToast({title:i||"保存失败",icon:"none",duration:3e3})}};return e.watch(m,(e=>{u.clearMaterial(),0===e&&(u.anchorList=g.anchorList,u.videoList=g.videoList,u.imageList=g.imageList,u.marketingList=g.marketingList)})),e.onShow((()=>{(()=>{if(0===m.value)g.anchorList=u.anchorList,g.videoList=u.videoList,g.imageList=u.imageList,g.marketingList=u.marketingList;else{const{platformIndex:e,materialIndex:i}=L.value;if(null!==e&&null!==i){const a=v.value[e].materialList[i];switch(a.page){case"anchor_material":a.list=u.anchorList;break;case"video_material":a.list=u.videoList;break;case"image_material":a.list=u.imageList;break;case"marketing_material":a.list=u.marketingList}L.value.platformIndex=null,L.value.materialIndex=null}}})()})),e.onLoad((i=>{c.value=i.device_code,(async()=>{e.index.showLoading({title:"加载中...",mask:!0});try{const e=await a.getAutoTaskPublishConfigDetail({device_code:c.value});d.value=e,g.anchorList=e.human_image.map((e=>({id:e.id,pic:e.pic,result_url:e.anchor_url,anchor_ids:{shanjian_anchor_id:e.shanjian_anchor_id,chanjing_anchor_id:e.chanjing_anchor_id,weiju_anchor_id:e.weiju_anchor_id},extra_info:{width:e.width,height:e.height,shanjian_voice_id:e.shanjian_voice_id}}))),g.videoList=e.clip_material.map((e=>({url:e.fileUrl,pic:e.cover,type:e.type}))),g.imageList=e.image_material.map((e=>({pic:e,url:e}))),u.anchorList=g.anchorList,u.videoList=g.videoList,u.imageList=g.imageList,h.videoTheme=e.video_theme,h.imageTheme=e.text_theme}finally{e.index.hideLoading(),l.value=!1}})()})),e.onUnload((()=>{u.clearMaterial()})),(a,t)=>e.e({a:!e.unref(l)},e.unref(l)?{}:e.e({},{d:0===e.unref(m)},0===e.unref(m)?e.e({e:e.t(e.unref(g).anchorList.length),f:e.p({name:"arrow-right",color:"#00000080",size:"20"}),g:e.o((e=>k("anchor_material"))),h:e.unref(g).anchorList.length>0},e.unref(g).anchorList.length>0?{i:e.f(e.unref(g).anchorList.slice(0,3),((i,a,t)=>({a:i.pic,b:e.o((e=>j(i)),a),c:a})))}:{j:e.o((e=>k("anchor_material")))},{k:e.t(e.unref(g).videoList.length),l:e.p({name:"arrow-right",color:"#00000080",size:"20"}),m:e.o((e=>k("video_material"))),n:e.unref(g).videoList.length>0},e.unref(g).videoList.length>0?{o:e.f(e.unref(g).videoList.slice(0,3),((a,t,r)=>e.e({a:a.pic,b:"image"===a.type},"image"===a.type?{c:i._imports_0$11}:{d:i._imports_3$5},{e:"video"===a.type},"video"===a.type?{f:e.o((e=>x(a)),t)}:{},{g:t,h:e.o((e=>x(a)),t)})))}:{p:e.o((e=>k("video_material")))},{q:e.t(e.unref(g).imageList.length),r:e.p({name:"arrow-right",color:"#00000080",size:"20"}),s:e.o((e=>k("image_material"))),t:e.unref(g).imageList.length>0},e.unref(g).imageList.length>0?{v:e.f(e.unref(g).imageList.slice(0,3),((e,i,a)=>({a:e.pic,b:i})))}:{w:e.o((e=>k("image_material")))},{}):{},{E:1===e.unref(m)},1===e.unref(m)?{F:e.f(e.unref(v),((i,a,t)=>({a:i.activeIcon,b:e.t(i.name),c:e.t(i.materialList.every((e=>e.list.length>0))?"配置完成":"配置未完成"),d:e.n(i.materialList.every((e=>e.list.length>0))?"text-primary":"text-_hFF2442_"),e:e.f(i.materialList,((r,s,n)=>({a:e.t(r.name),b:e.t(r.list.length?`${r.list.length}(个)`:"未配置"),c:e.n(r.list.length>0?"text-primary":"text-_hFF2442_"),d:"7f02b51f-5-"+t+"-"+n,e:s,f:e.n(s===i.materialList.length-1?"border-b-_0rpx_":"border-b-_1rpx_"),g:e.o((e=>k(r.page,{platformIndex:a,materialIndex:s,materialList:r.list})),s)}))),f:a}))),G:e.p({name:"arrow-right",color:"#B2B2B2",size:"20"})}:{},{H:e.unref(h).videoTheme,I:e.o((i=>e.unref(h).videoTheme=i.detail.value)),J:e.t(e.unref(h).videoTheme.length),K:e.unref(h).imageTheme,L:e.o((i=>e.unref(h).imageTheme=i.detail.value)),M:e.t(e.unref(h).imageTheme.length),N:e.o(q)}),{O:e.o((i=>e.isRef(_)?_.value=i:null)),P:e.p({"video-url":e.unref(f).url,poster:e.unref(f).pic,modelValue:e.unref(_)})})}}),o=e._export_sfc(n,[["__scopeId","data-v-7f02b51f"]]);wx.createPage(o);
