"use strict";const e=require("../../../../common/vendor.js"),s=require("../../../../common/assets.js"),r=require("../../stores/material.js"),i=require("../../../../hooks/useMontageMaterial.js");if(require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),require("../../../../api/material.js"),require("../../../../hooks/usePolling.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("upload-progress")+e.resolveComponent("choose-material")+e.resolveComponent("video-preview"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+(()=>"../../../../components/choose-material/choose-material.js")+(()=>"../../../../components/video-preview/video-preview.js"))();const o=e.defineComponent({__name:"video_material",setup(o){const u=r.useMaterialStore(),{videoList:t}=e.storeToRefs(u),a=e.ref(JSON.parse(JSON.stringify(t.value))),n=e.ref(-1),l=e.ref(!1),p=e.ref(!1),c=e.ref({url:"",pic:""}),{showUploadProgress:m,uploadMaterialList:d,uploadAndProcessFiles:v}=i.useMontageMaterial({count:9,onSuccess:e=>{a.value.push(...e)}}),f=()=>{e.index.showActionSheet({itemList:["选择图片素材","选择视频素材"],success:e=>{0===e.tapIndex?v("image"):1===e.tapIndex&&v("video")}})},j=e=>{a.value.push(...e.map((e=>({pic:e.pic,url:e.content,type:"video"}))))},q=()=>{const s=a.value.filter((e=>"image"===e.type)).length,r=a.value.filter((e=>"video"===e.type)).length;s<3||r<1?e.index.$u.toast("请至少选择3张图片和1个视频素材"):(u.setList("videoList",a.value),e.index.navigateBack())};return(r,i)=>({a:e.t(e.unref(a).length),b:e.t(1),c:e.t(3),d:s._imports_0$39,e:e.o(f),f:e.f(e.unref(a),((r,i,o)=>e.e({a:r.pic,b:"3e64a7be-0-"+o,c:e.o((e=>(e=>{a.value.splice(e,1)})(i)),i),d:"image"===r.type},"image"===r.type?{e:s._imports_0$11}:{f:s._imports_3$5},{g:e.o((e=>(e=>{n.value=e,f()})(i)),i),h:i,i:e.o((s=>(s=>{"image"===s.type?e.index.previewImage({urls:[s.pic]}):(c.value={url:s.url,pic:s.pic},p.value=!0)})(r)),i)}))),g:e.p({name:"close",color:"#ffffff",size:"16"}),h:e.o(q),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"16rpx",fontWeight:"bold"}}),j:e.o((s=>e.isRef(m)?m.value=s:null)),k:e.p({"upload-list":e.unref(d),modelValue:e.unref(m)}),l:e.o(j),m:e.o((s=>e.isRef(l)?l.value=s:null)),n:e.p({type:"video",modelValue:e.unref(l)}),o:e.o((s=>e.isRef(p)?p.value=s:null)),p:e.p({"video-url":e.unref(c).url,poster:e.unref(c).pic,modelValue:e.unref(p)})})}});wx.createPage(o);
