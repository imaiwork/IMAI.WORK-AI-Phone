"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),u=require("../../../../api/device.js"),r=require("../../../../stores/user.js"),n=require("../../../../enums/appEnums.js"),o=require("../../enums/index.js"),s=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const a=e.defineComponent({__name:"task_ai_copywriter",setup(a){const{emit:i}=s.useEventBusManager(),l=r.useUserStore(),{userTokens:c}=e.toRefs(l),p=e.ref(""),v=e.ref(150),f=e.ref([]),m=[1,3,5,10,20,30],d=e.ref(1),q=e.ref(!1),h=e.ref(!1),j=e.ref(""),g=e.ref([]),x=e.computed((()=>f.value.every((e=>"success"===e.status)))),b=e.computed((()=>{var e;const t=null==(e=l.getTokenByScene(n.TokensSceneEnum.MATRIX_COPYWRITER))?void 0:e.score;return parseFloat(t)*d.value})),_=async t=>{if(t.trim()){if(!q.value)if(c.value<=b.value)e.index.$u.toast("算力不足，请充值！");else try{q.value=!0,f.value=Array.from({length:d.value},(()=>({title:"",content:"",status:"pending"})));const e=await u.generateMatrixPrompt({keywords:t,number:d.value});f.value=e.map((e=>({title:e.title,content:e.content,topic:e.topic,status:"success"})))}catch(r){q.value=!1,e.index.showToast({title:r||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},k=()=>{if(q.value){if(!x.value)return void e.index.$u.toast("正在生成中，请稍后再试");q.value=!1}f.value=[],q.value=!1,_(p.value)},y=()=>{f.value[g.value[0]].topic[g.value[1]]=j.value,h.value=!1},C=()=>{if(x.value)try{i("confirm",{type:o.ListenerTypeEnum.TASK_AI_COPYWRITER,data:f.value.filter((e=>e.title)).map((e=>({title:e.title,content:e.content,topic:e.topic})))}),f.value=[],e.index.navigateBack()}catch(t){console.log("error",t)}else e.index.$u.toast("文案在生成中...")};return e.onLoad((e=>{v.value=e.limit})),(u,r)=>e.e({a:!e.unref(q)},e.unref(q)?{h:e.f(e.unref(f),((u,r,n)=>e.e({a:"pending"===u.status},"pending"===u.status?{b:t._imports_0$34,c:e.t(r+1)}:{d:"aac86b9e-0-"+n,e:e.o((e=>u.title=e),r),f:e.p({"placeholder-style":"color: #7C7E80; ",maxlength:"30",modelValue:u.title}),g:"aac86b9e-1-"+n,h:e.o((e=>u.content=e),r),i:e.p({type:"textarea","placeholder-style":"color: #7C7E80; ",maxlength:"500","auto-height":!1,modelValue:u.content}),j:e.t(u.content.length),k:e.f(u.topic,((t,u,o)=>({a:e.t(t),b:"aac86b9e-2-"+n+"-"+o,c:e.o((e=>((e,t)=>{f.value[e].topic.splice(t,1)})(r,u)),r),d:e.o((e=>((e,t)=>{g.value=[e,t],j.value=f.value[e].topic[t],h.value=!0})(r,u)),r)}))),l:e.p({name:"close",size:"16",color:"#ffffff"}),m:r,n:"aac86b9e-3-"+n,o:e.p({name:"close",color:"#ffffff",size:"16"}),p:e.o((e=>(e=>{f.value.splice(e,1),0===f.value.length&&(q.value=!1)})(r)),r)},{q:r})))}:{b:500,c:e.unref(p),d:e.o((t=>e.isRef(p)?p.value=t.detail.value:null)),e:e.t(e.unref(p).length),f:e.t(500),g:e.f(m,((t,u,r)=>({a:e.t(t),b:t,c:e.unref(d)===t?1:"",d:e.o((e=>d.value=t),t)})))},{i:!e.unref(q)},e.unref(q)?{m:e.o(k),n:e.n(e.unref(x)?"bg-black":"bg-_h787878CC_"),o:e.o(C)}:{j:e.t(e.unref(b)),k:e.n(e.unref(p).length>0?"bg-black":"bg-_h787878CC_"),l:e.o((t=>_(e.unref(p))))},{p:e.o((t=>e.isRef(j)?j.value=t:null)),q:e.p({placeholder:"请输入标签",maxlength:"20","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(j)}),r:e.o((e=>h.value=!1)),s:e.o(y),t:e.o((t=>e.isRef(h)?h.value=t:null)),v:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(h)})})}}),i=e._export_sfc(a,[["__scopeId","data-v-aac86b9e"]]);wx.createPage(i);
