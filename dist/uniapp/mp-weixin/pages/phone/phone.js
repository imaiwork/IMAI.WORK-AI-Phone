"use strict";const e=require("../../common/vendor.js"),t=require("../../api/device.js"),s=require("../../enums/appEnums.js"),o=require("../../config/index.js"),a=require("../../common/assets.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../utils/auth.js"),require("../../enums/constantEnums.js"),require("../../utils/cache.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../hooks/useShareMessage.js"),require("../../router/index.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../stores/app.js"),require("../../api/app.js"),require("../../api/chat.js"),require("../../api/voice_chat.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("circle-progress")+e.resolveComponent("u-line-progress")+e.resolveComponent("z-paging")+e.resolveComponent("tabbar")+e.resolveComponent("confirm-dialog")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../components/circle-progress/circle-progress.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-line-progress/u-line-progress.js")+(()=>"../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../components/tabbar/tabbar.js")+(()=>"../../components/confirm-dialog/confirm-dialog.js")+(()=>"../../components/popup-bottom/popup-bottom.js"))();const u=e.defineComponent({__name:"phone",setup(u){const r=e.ref([]),n=e.ref({}),i=e.shallowRef(),c=e.ref(!1),l=e.ref(!1),d=[{name:"24h自动任务",value:1},{name:"手动任务",value:0}],p=e.ref(0),g=e.computed((()=>{const e=new Date,t=e.getDay(),s=e.getMonth()+1;return`${{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"}[t]}，${s}月${e.getDate()}日`})),v=e.ref([{status:2,count:0},{status:1,count:0},{status:0,count:0}]),_=async(e,s)=>{var o,a;try{const{lists:a,extend:{statistics:u}}=await t.getDeviceList({page_no:e,page_size:s});v.value.forEach((e=>{var t;e.count=(null==(t=u.find((t=>t.status==e.status)))?void 0:t.num)??0})),null==(o=i.value)||o.complete(a)}catch(u){null==(a=i.value)||a.complete([])}},m=e=>{switch(e){case s.AppTypeEnum.WECHAT:return a.wechatWechatActiveIcon;case s.AppTypeEnum.XHS:return a.redbookActiveIcon;case s.AppTypeEnum.DOUYIN:return a.douyinActiveIcon;case s.AppTypeEnum.KUAISHOU:return a.kuaishouActiveIcon}},f=e=>{switch(e){case 0:return{iconBgColor:"rgba(255, 36, 66, 0.05)",textColor:"#FF2442",borderColor:"rgba(255, 36, 66, 0.2)",text:"离线"};case 1:return{iconBgColor:"rgba(0, 192, 142, 0.05)",textColor:"#00C08E",borderColor:"rgba(0, 192, 142, 0.2)",text:"空闲"};default:return{iconBgColor:"rgba(0, 101, 251, 0.05)",textColor:"#0065FB",borderColor:"rgba(0, 101, 251, 0.2)",text:"工作"}}},h=e=>{switch(e){case 0:return"等待中";case 1:return"执行中";case 2:return"执行完成";case 3:return"执行失败";case 4:return"中断";default:return"-"}},b=e=>{const{task_count:t,task_complete:s}=e;return 0==t?0:Math.round(s/t*100)},k=async()=>{var s;e.index.showLoading({title:"修改中...",mask:!0});try{await t.updateDevice({device_code:n.value.device_code,auto_type:p.value}),n.value.loading=!1,e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3}),null==(s=i.value)||s.reload()}catch(o){e.index.hideLoading(),e.index.showToast({title:o||"修改失败",icon:"none",duration:3e3})}finally{l.value=!1}},j=(t,s)=>{t?e.index.$u.route({url:t,params:s}):e.index.showToast({title:"敬请期待~"})};return e.onShow((async()=>{var t;await e.nextTick$1(),null==(t=i.value)||t.reload()})),(t,s)=>({a:e.t(e.unref(g)),b:e.o((e=>j("/ai_modules/device/pages/task_calendar/task_calendar"))),c:e.o((e=>j("/packages/pages/rpa_code/rpa_code"))),d:e.f(e.unref(v),((t,s,o)=>({a:f(t.status).textColor,b:e.t(f(t.status).text),c:e.t(t.count),d:t.status}))),e:e.f(e.unref(r),((t,s,o)=>{var a,u;return e.e({a:1==t.auto_type,b:e.o((e=>(e=>{n.value=e,p.value=1==e.auto_type?0:1,k()})(t)),s),c:e.o((()=>{}),s),d:0==t.status},(t.status,{}),{e:1==t.status},(t.status,{}),{f:2==t.status},(t.status,{}),{g:f(t.status).iconBgColor,h:e.t(t.device_name||"-"),i:e.t(0===t.auto_type?"手动任务":"24h自动"),j:f(t.status).textColor,k:e.t(f(t.status).text),l:f(t.status).textColor,m:0===t.auto_type},0===t.auto_type?e.e({n:t.accounts.length>0},t.accounts.length>0?{o:e.f(t.accounts,((e,t,s)=>({a:m(e.type),b:t})))}:{},{p:0==t.status},0==t.status?{q:f(t.status).textColor}:0==t.accounts.length?{s:"610be236-1-"+o+",610be236-0",t:e.p({name:"arrow-right",color:"#ffffff",size:"16"}),v:e.o((e=>j("/ai_modules/device/pages/platform_detail/platform_detail",{device_code:t.device_code})),s)}:1==t.status?e.e({x:e.t(t.task_count),y:(null==(a=t.tasks)?void 0:a.length)>0},(null==(u=t.tasks)?void 0:u.length)>0?{z:e.f(t.tasks,((t,s,o)=>({a:e.t(t.task_name),b:e.t(h(t.status)),c:[3,4].includes(t.status)?1:"",d:[1].includes(t.status)?1:"",e:[0].includes(t.status)?1:"",f:[2].includes(t.status)?1:"",g:[3,4].includes(t.status)?1:"",h:[1].includes(t.status)?1:"",i:[0].includes(t.status)?1:"",j:[2].includes(t.status)?1:"",k:t.id}))),A:"610be236-2-"+o+",610be236-0",B:e.p({percent:b(t),borderWidth:"10rpx",width:"136rpx",progressColor:"#467EF9",notProgressColor:"#F1F1F1"})}:{}):{},{r:0==t.accounts.length,w:1==t.status,C:t.accounts.length>0},t.accounts.length>0?{D:"610be236-3-"+o+",610be236-0",E:e.p({name:"plus",color:"#0065FB",size:"16"}),F:e.o((e=>j("/ai_modules/device/pages/choose_task_type/choose_task_type",{device_code:t.device_code})),s)}:{}):e.e({G:0===t.is_auto_setting},0===t.is_auto_setting?{H:e.o((e=>j("/ai_modules/device/pages/create_auto_task/create_auto_task",{device_code:t.device_code})),s)}:t.tasks.length>0?{J:e.t(t.tasks[0].task_name),K:e.t(b(t))}:{},{I:t.tasks.length>0,L:"610be236-4-"+o+",610be236-0",M:e.p({activeColor:"#0065FB",bgColor:"#F2F2F2",height:"12",percent:b(t),"show-percent":!1}),N:0===t.status},0===t.status?{}:e.e({O:0===t.is_auto_setting||1===t.is_empty},0===t.is_auto_setting||1===t.is_empty?{P:"610be236-5-"+o+",610be236-0",Q:e.p({name:"arrow-right",color:"#ffffff",size:"20"}),R:e.o((e=>j("/ai_modules/device/pages/create_auto_task/create_auto_task",{device_code:t.device_code})),s)}:{S:e.t(2==t.status?"24h自动工作中":"空闲中"),T:f(t.status).textColor,U:f(t.status).iconBgColor}),{V:[1,2].includes(t.is_auto_setting)},[1,2].includes(t.is_auto_setting)?{W:e.o((e=>j()),s),X:e.o((e=>j("/ai_modules/device/pages/auto_task/auto_task",{device_code:t.device_code})),s)}:{}),{Y:s,Z:e.o((e=>j("/ai_modules/device/pages/detail/detail",{device_code:t.device_code})),s)})})),f:`${e.unref(o.config).baseUrl}static/images/device_empty.png`,g:e.p({name:"arrow-right",color:"#ffffff",size:"16"}),h:e.o((e=>j("/packages/pages/rpa_code/rpa_code"))),i:e.sr(i,"610be236-0",{k:"pagingRef"}),j:e.o(_),k:e.o((t=>e.isRef(r)?r.value=t:null)),l:e.p({fixed:!1,auto:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(r)}),m:e.o(k),n:e.o((t=>e.isRef(c)?c.value=t:null)),o:e.p({title:"提示",content:"有任务正在执行中，切换模式会导致任务终止，是否确认切换","confirm-btn-text":"确认切换",modelValue:e.unref(c)}),p:e.f(d,((t,s,o)=>e.e({a:e.unref(n).auto_type==t.value},(e.unref(n).auto_type,t.value,{}),{b:e.t(t.name),c:t.value,d:e.unref(n).auto_type==t.value?1:"",e:s!==d.length-1?1:"",f:e.o((e=>(async e=>{n.value.auto_type!=e?(p.value=e,c.value=!0):l.value=!1})(t.value)),t.value)}))),q:e.o((e=>l.value=!1)),r:e.o((t=>e.isRef(l)?l.value=t:null)),s:e.p({title:"选择任务模式",height:"35%",modelValue:e.unref(l)})})}});wx.createPage(u);
