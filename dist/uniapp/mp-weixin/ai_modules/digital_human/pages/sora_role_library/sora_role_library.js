"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../utils/file.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("z-paging"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+a+r)();const a=()=>"../../../../components/video-preview/video-preview.js",r=()=>"../../components/keywords-edit/keywords-edit.js",t=e.defineComponent({__name:"sora_role_library",setup(a){const r=e.ref([]),t=e.ref([]),u=e.reactive({url:"",pic:""}),o=e.shallowRef(),s=async(e,n)=>{var a,r;try{const{lists:r}=await i.getSoraRoleList({page_no:e,page_size:n});null==(a=o.value)||a.complete(r)}catch(t){null==(r=o.value)||r.complete([])}},l=e.ref(!1),c=e.ref(),d=e.ref(0),p=e.ref(!1),v=async n=>{e.index.showLoading({title:"修改中...",mask:!0});try{await i.editSoraRole({id:r.value[d.value].id,name:n}),e.index.hideLoading(),r.value[d.value].name=n,l.value=!1,e.index.showToast({title:"修改成功",icon:"none",duration:3e3})}catch(a){e.index.hideLoading(),e.index.showToast({title:a||"修改失败",icon:"none",duration:3e3})}},m=e=>t.value.includes(e),f=e.ref(!1),h=()=>{f.value=!f.value,t.value=[]},g=()=>{t.value.length===r.value.length?t.value=[]:t.value=r.value.map(((e,i)=>i))},j=async n=>{if(await async function(i,n){return new Promise((a=>e.index.showModal({title:i,content:n,success:a}))).then((e=>e.confirm))}("提示","确定要删除吗？")){e.index.showLoading({title:"删除中...",mask:!0});try{const a=n?[n]:t.value.map((e=>r.value[e].id));await i.deleteSoraRole({id:a}),r.value=r.value.filter((e=>!a.includes(e.id))),t.value=[],e.index.showToast({title:"删除成功",icon:"none",duration:3e3})}catch(a){e.index.showToast({title:a||"删除失败",icon:"none",duration:3e3})}finally{e.index.hideLoading(),f.value=!1,t.value=[]}}};return(i,a)=>e.e({a:e.f(e.unref(r),((i,a,o)=>e.e({a:i.pic,b:1==i.status},1==i.status?{c:e.o((e=>(e=>{const{anchor_url:i,pic:n}=e;u.url=i,u.pic=n,p.value=!0})(i)),a)}:2==i.status?e.e({e:i.remark},i.remark?{f:e.t(i.remark)}:{}):{},{d:2==i.status},e.unref(f)?e.e({g:m(a)},m(a)?{h:"70c01c56-1-"+o+",70c01c56-0",i:e.p({name:"checkmark",color:"#fff",size:20})}:{},{j:m(a)?1:"",k:e.o((e=>(e=>{m(e)?t.value=t.value.filter(((i,n)=>n!==e)):t.value.push(e)})(a)),a)}):{},{l:e.t(i.name),m:"70c01c56-2-"+o+",70c01c56-0",n:e.o((i=>(i=>{d.value=i;const{anchor_url:a,name:t,id:u}=r.value[d.value];e.index.showActionSheet({itemList:["修改名称","下载视频","删除"],success:e=>{0===e.tapIndex?(l.value=!0,c.value.setFormData(t)):1===e.tapIndex?n.saveVideoToPhotosAlbum(a):2===e.tapIndex&&j(u)}})})(a)),a),o:a}))),b:e.unref(f),c:e.p({name:"more-dot-fill",color:"#7F7F7F"}),d:e.sr(o,"70c01c56-0",{k:"pagingRef"}),e:e.o(s),f:e.o((i=>e.isRef(r)?r.value=i:null)),g:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(r)}),h:e.unref(r).length>0},e.unref(r).length>0?e.e({i:e.t(e.unref(f)?"取消":"管理"),j:e.o(h),k:e.unref(f)},e.unref(f)?{l:e.o(g)}:{},{m:e.unref(f)},e.unref(f)?{n:e.t(e.unref(t).length),o:e.o((e=>j()))}:{}):{},{p:e.o((e=>p.value=!1)),q:e.o((i=>e.isRef(p)?p.value=i:null)),r:e.p({title:"视频预览","video-url":e.unref(u).url,pic:e.unref(u).pic,modelValue:e.unref(p)}),s:e.sr(c,"70c01c56-5",{k:"keywordsEditRef"}),t:e.o(v),v:e.o((i=>e.isRef(l)?l.value=i:null)),w:e.p({title:"修改角色名称",modelValue:e.unref(l)})})}}),u=e._export_sfc(t,[["__scopeId","data-v-70c01c56"]]);wx.createPage(u);
