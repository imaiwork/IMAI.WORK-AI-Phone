"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../common/assets.js"),r=require("../../../../api/digital_human.js"),i=require("../../../../stores/user.js"),n=require("../../../../enums/appEnums.js"),o=require("../../enums/index.js"),a=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("confirm-dialog")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+u+s+l+c+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const u=()=>"../../components/choose-tone/choose-tone.js",s=()=>"../../../../components/video-preview/video-preview.js",l=()=>"../../components/create-success-pop/create-success-pop.js",c=()=>"../../components/tokens-cost/tokens-cost.js",p=e.defineComponent({__name:"montage_material_create",setup(u){const{on:s}=a.useEventBusManager(),l=i.useUserStore(),{userTokens:c}=e.toRefs(l),p=e.ref([{step:1,title:"上传素材"},{step:2,title:"填写文案"},{step:3,title:"生成设置"}]),m=e.ref(1),f=e.reactive({anchorLists:[],copywriterList:[],materialList:[],name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"素材混剪",video_count:1,shanjian_type:o.MontageTypeEnum.MATERIAL_MIX,extra:!1,voice:""}),d=e.ref(!1),v=e.ref(-1),g=e.reactive({pic:"",url:""}),h=e.ref(!1),_=e.ref(-1);e.reactive({poster:"",url:""});const y=e.ref(!1),j=e.ref({}),x=e.ref(!1),L=e.ref(null),w=e.ref(!1),q=e.shallowRef(),b=e=>{switch(e){case 1:return f.materialList.length>0;case 2:return f.copywriterList.length>0;case 3:return!0;default:return!1}},k=e.computed((()=>b(m.value))),E=(t,r)=>{if("prev"!==r)if("next"!==r){if(t!==m.value)if(t<m.value)m.value=t;else{for(let r=1;r<t;r++)if(!b(r))return void e.index.$u.toast("请按顺序完成步骤");m.value=t}}else if(k.value)m.value++;else{const t={1:"请上传素材图组",2:"请至少添加一条文案"};e.index.$u.toast(t[m.value]||"请完成当前步骤")}else m.value--},B=t=>{v.value=t??-1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_material_group/montage_material_group",params:{materialList:-1!==v.value?JSON.stringify(f.materialList[v.value]):""}})},R=()=>{f.materialList.splice(v.value,1),d.value=!1},T=t=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_copywriter/montage_copywriter",params:{data:t?JSON.stringify(t):""}})},C=e=>{f.voice=e.voice_id,j.value=e,y.value=!1},M=t=>{if("minus"===t){if(f.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");f.video_count--}else{if(f.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");f.video_count++}},$=async()=>{var t;if(c.value<0)null==(t=q.value)||t.open();else if(f.name){if(!f.voice)return e.index.$u.toast("请选择音色"),void(y.value=!0);if(f.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const t=await r.createShanjianTask({name:f.name,copywriting:f.copywriterList,extra:f.extra,material:f.materialList.map((e=>e.map((e=>({fileUrl:e.url,type:e.type,cover:e.pic}))))),shanjian_type:f.shanjian_type,video_count:f.video_count,voice:f.voice});e.index.hideLoading(),L.value=t,x.value=!0}catch(i){e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})}}}else e.index.$u.toast("请输入视频名称")},A=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"redirect",params:{task_id:JSON.stringify([L.value.id]),scene:1,type:f.shanjian_type}})},z=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return e.onLoad((()=>{s("confirm",(e=>{const{type:t,data:r}=e;if(t===o.ListenerTypeEnum.MONTAGE_COPYWRITER||t===o.ListenerTypeEnum.MONTAGE_AI_COPYWRITER){if(0==r.length)return;-1!==_.value?f.copywriterList[_.value]=r[0]:f.copywriterList=f.copywriterList.concat(r)}if(t===o.ListenerTypeEnum.MONTAGE_MATERIAL_GROUP)if(-1!==v.value){if(0==r.length)return void f.materialList.splice(v.value,1);f.materialList[v.value]=r}else f.materialList.push(r)}))})),(r,i)=>e.e({a:e.p({title:"素材混剪","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.f(e.unref(p),((t,r,i)=>e.e({a:e.unref(m)>t.step},e.unref(m)>t.step?{b:"2427c4dc-1-"+i,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(t.title),e:t.step!==e.unref(p).length},t.step!==e.unref(p).length?{f:e.unref(m)>t.step?1:""}:{},{g:t.step,h:e.unref(m)==t.step?1:"",i:e.o((e=>E(t.step)),t.step)}))),c:1==e.unref(m)},1==e.unref(m)?e.e({d:e.o((e=>B())),e:e.unref(f).materialList.length>0},e.unref(f).materialList.length>0?{f:e.f(e.unref(f).materialList,((t,r,i)=>({a:e.t(r+1),b:e.t(t.length),c:"2427c4dc-2-"+i,d:e.f(t,((e,t,r)=>({a:e.pic,b:t}))),e:e.o((e=>(e=>{d.value=!0,v.value=e})(r)),r),f:r,g:e.o((e=>B(r)),r)}))),g:e.p({name:"arrow-right",color:"#B2B2B2",size:20})}:{h:e.p({size:260,text:"您还没有图组哦"}),i:e.p({name:"plus",size:"24"}),j:e.o((e=>B()))}):{},{k:2===e.unref(m)},2===e.unref(m)?{l:e.o((e=>T())),m:e.o((e=>_.value=-1)),n:e.f(e.unref(f).copywriterList,((t,r,i)=>({a:e.t(t.title),b:e.t(t.content),c:"2427c4dc-5-"+i,d:e.o((e=>(e=>{f.copywriterList.splice(e,1)})(r)),r),e:r,f:e.o((e=>(e=>{_.value=e;const t=f.copywriterList[e];T(t)})(r)),r)}))),o:e.p({name:"close",color:"#ffffff",size:"16"})}:{},{p:3==e.unref(m)},3==e.unref(m)?{q:e.o((t=>e.unref(f).name=t)),r:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(f).name}),s:e.t(e.unref(f).materialList.length),t:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),v:e.o((e=>E(1))),w:e.t(e.unref(f).copywriterList.length),x:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),y:e.o((e=>E(2))),z:e.t(e.unref(j).name||"请选择音色"),A:e.n(e.unref(j).name?"text-primary":"text-_hB2B2B2_"),B:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),C:e.o((e=>y.value=!0)),D:e.o((t=>e.unref(f).extra=t)),E:e.p({"inactive-color":"#E5E5E5",size:40,modelValue:e.unref(f).extra}),F:t._imports_1$10,G:e.o((e=>M("minus"))),H:e.o((t=>e.unref(f).video_count=t)),I:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(f).video_count}),J:t._imports_2$4,K:e.o((e=>M("add")))}:{},{L:e.unref(m)!=e.unref(p).length},e.unref(m)!=e.unref(p).length?e.e({M:1===e.unref(m)},1===e.unref(m)?{N:e.t(e.unref(f).anchorLists.length),O:e.n(e.unref(f).anchorLists.length>0?"bg-black":"bg-_h787878CC_")}:{P:e.o((t=>E(e.unref(m),"prev")))},{Q:e.n(e.unref(k)?"bg-black":"bg-_h787878CC_"),R:e.o((t=>E(e.unref(m),"next")))}):{S:t._imports_3$2,T:e.o((e=>w.value=!0)),U:e.t(e.unref(f).video_count),V:e.o($)},{W:e.o(R),X:e.o((t=>e.isRef(d)?d.value=t:null)),Y:e.p({"confirm-text":"删除",center:!0,content:"是否确定删除该图组？",modelValue:e.unref(d)}),Z:e.o(C),aa:e.o((t=>e.isRef(y)?y.value=t:null)),ab:e.p({"model-version":e.unref(n.DigitalHumanModelVersionEnum).SHANJIAN,"active-tone":e.unref(f).voice,"show-free-tone":!1,modelValue:e.unref(y)}),ac:e.o((t=>e.isRef(h)?h.value=t:null)),ad:e.p({"video-url":e.unref(g).url,poster:e.unref(g).pic,modelValue:e.unref(h)}),ae:e.o(A),af:e.o(z),ag:e.o((t=>e.isRef(x)?x.value=t:null)),ah:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(x)}),ai:e.o((t=>e.isRef(w)?w.value=t:null)),aj:e.p({type:3,modelValue:e.unref(w)}),ak:e.sr(q,"2427c4dc-17",{k:"rechargePopupRef"})})}});wx.createPage(p);
