"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),l=require("../../../../api/digital_human.js"),u=require("../../../../stores/user.js"),r=require("../../../../hooks/useKeyboardHeight.js"),o=require("../../../../hooks/useUpload.js"),t=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("u-popup")+e.resolveComponent("upload-progress")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../../components/upload-progress/upload-progress.js")+i+n+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const n=()=>"../../components/tokens-cost/tokens-cost.js",i=()=>"../../components/create-success-pop/create-success-pop.js",s=e.defineComponent({__name:"sora_create",setup(n){const i=u.useUserStore(),{userTokens:s}=e.toRefs(i),v=e.reactive({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"一句话生成视频",content:"",materialList:[],videoStyle:1,videoResolution:1,aspect_ratio:"16:9",videoDuration:10,videoSwitchFrequency:1,video_count:1,ai_type:1}),d=e.ref([{step:1,title:"视频主题"},{step:2,title:"素材参考"},{step:3,title:"风格设置"},{step:4,title:"生成设置"}]),f=e.ref(1),{dynamicHeight:c}=r.useKeyboardHeight(),p=[{label:"营销模版",value:"marketing"},{label:"自由创作",value:"creation"}],m=e.ref("marketing"),b=e.computed((()=>p.findIndex((e=>e.value==m.value)))),h=e.computed((()=>p[b.value])),g=[{label:"商品宣传",value:"goods"},{label:"门店宣传",value:"store"},{label:"团购套餐宣传",value:"group"}],x=e.ref("goods"),_=[{label:"男",value:"male"},{label:"女",value:"female"},{label:"无人物",value:"nobody"}],y=e.ref("male"),j=e.ref([{label:"宣传片",value:"ad"},{label:"产品展示",value:"product"},{label:"品牌推广",value:"brand"},{label:"Vlog",value:"vlog"},{label:"剧情片",value:"story"},{label:"教程",value:"tutorial"},{label:"自定义",value:"custom",isInt:!1}]),q=e.ref("ad"),w=[{label:"标准",value:1},{label:"商业",value:2},{label:"纪实",value:3},{label:"温馨",value:4},{label:"极简",value:5},{label:"科幻",value:6},{label:"色彩",value:7}],k=[{label:"横屏16:9",value:"16:9"},{label:"竖屏9:16",value:"9:16"}],L=[{label:"10s（普通）",value:10,model:"sora-2"},{label:"15s（普通）",value:15,model:"sora-2"},{label:"10s（PRO）",value:10,model:"sora-2-pro"},{label:"15s（PRO）",value:15,model:"sora-2-pro"},{label:"25s（PRO）",value:25,model:"sora-2-pro"}],S=e.ref(0),$=[{label:"中",value:1},{label:"低",value:2},{label:"高",value:3}],B=e.ref(!1),R=e.ref(""),C=500,V=e.ref(0),z=e.ref(-1),E=e.ref(!1),I=e.ref(!1),F=e.ref(null),P=e.shallowRef(),M=e.computed((()=>O(f.value))),O=e=>{switch(e){case 1:case 3:return!0;case 2:return 0!==V.value||v.materialList.length>0;default:return!1}},A=e.computed((()=>({goods:{title:"商品宣传",placeholder:"(选填)，例如：该商品是xx品牌，主要功能是xx，面向的人群是xx等"},store:{title:"门店宣传",placeholder:"(选填)，例如：该店位于xx位置，主打的是xx产品等"},group:{title:"团购套餐宣传",placeholder:"(选填)，例如：该套餐名称叫xx，原价xx元，现在活动团购价xx元，套餐里包含xx等"}}[x.value]))),D=(a,l)=>{if("prev"!==l)if("next"!==l){if(a!==f.value)if(a<f.value)f.value=a;else{for(let l=1;l<a;l++)if(!O(l))return void e.index.$u.toast("请按顺序完成步骤");f.value=a}}else if(M.value)f.value++;else{const a={1:"请填写视频标题和视频描述",2:"请至少添加一条素材"};e.index.$u.toast(a[f.value]||"请完成当前步骤")}else f.value--},H=()=>{B.value=!1,R.value=""},T=()=>{R.value?(B.value=!1,q.value="custom",j.value.forEach((e=>{"custom"==e.value&&(e.label=R.value,e.isInt=!0)}))):e.index.$u.toast("请输入内容")},{showUploadProgress:U,uploadMaterialList:K,uploadAndProcessFiles:J}=o.useUpload({count:1,onSuccess:e=>{-1!==z.value?v.materialList[z.value]=e[0]:v.materialList=v.materialList.concat(e),z.value=-1}}),N=a=>{if("minus"===a){if(v.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");v.video_count--}else{if(v.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");v.video_count++}},X=async()=>{var a,u,r,o,t;if(s.value<0)null==(a=P.value)||a.open();else if(v.name)if(v.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const a=await l.createSoraVideo({name:v.name,theme:null==(u=j.value.find((e=>e.value==q.value)))?void 0:u.label,content:v.content,gender:null==(r=_.find((e=>e.value==y.value)))?void 0:r.label,image_urls:v.materialList.map((e=>e.pic)),style:null==(o=w.find((e=>e.value==v.videoStyle)))?void 0:o.label,frequency:null==(t=$.find((e=>e.value==v.videoSwitchFrequency)))?void 0:t.label,aspect_ratio:v.aspect_ratio,duration:L[S.value].value,number:v.video_count,model:L[S.value].model});e.index.hideLoading(),F.value=a,E.value=!0}catch(n){e.index.hideLoading(),e.index.showToast({title:n,icon:"none",duration:3e3})}}else e.index.$u.toast("请输入视频名称")},G=()=>{E.value=!1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"reLaunch",params:{task_id:JSON.stringify([F.value.id]),scene:1,type:t.MontageTypeEnum.SORA_VIDEO}})},Q=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return(l,u)=>{var r,o,t,n,i;return e.e({a:e.p({"title-bold":!0,title:"一句话生成视频","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(d),((a,l,u)=>e.e({a:e.unref(f)>a.step},e.unref(f)>a.step?{b:"5215acf3-1-"+u,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(a.title),e:a.step!==e.unref(d).length},a.step!==e.unref(d).length?{f:e.unref(f)>a.step?1:""}:{},{g:a.step,h:e.unref(f)==a.step?1:"",i:e.o((e=>D(a.step)),a.step)}))),c:1==e.unref(f)},1==e.unref(f)?e.e({d:e.f(p,((a,l,u)=>({a:e.t(a.label),b:l,c:a.value==e.unref(m)?1:"",d:e.o((e=>{return l=a.value,void(m.value!=l&&(m.value=l));var l}),l)}))),e:`translateX(${100*e.unref(b)}%)`,f:e.f(g,((a,l,u)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(x)?1:"",d:e.o((e=>{return l=a.value,void(x.value!=l&&(x.value=l));var l}),a.value)}))),g:"marketing"==e.unref(m),h:e.f(e.unref(j),((a,l,u)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(q)?1:"",d:e.o((e=>(e=>{if("custom"==e){B.value=!0;const a=j.value.find((a=>a.value==e));(null==a?void 0:a.isInt)&&(R.value=a.label)}else q.value=e})(a.value)),a.value)}))),i:"creation"==e.unref(m)||"long_video"==e.unref(m),j:e.f(_,((a,l,u)=>({a:e.t(a.label),b:a.value,c:a.value==e.unref(y)?1:"",d:e.o((e=>{return l=a.value,void(y.value!=l&&(y.value=l));var l}),a.value)}))),k:e.t(e.unref(A).title),l:C,m:e.unref(A).placeholder,n:e.unref(v).content,o:e.o((a=>e.unref(v).content=a.detail.value)),p:e.t(e.unref(v).content.length),q:e.t(C),r:"marketing"==e.unref(m),s:"creation"==e.unref(m)},"creation"==e.unref(m)?{t:C,v:e.unref(v).content,w:e.o((a=>e.unref(v).content=a.detail.value)),x:e.t(e.unref(v).content.length),y:e.t(C)}:{},{z:e.unref(c)+"px",A:0==e.unref(c),B:0==e.unref(c)?0:e.unref(c)/2}):{},{C:2==e.unref(f)},2==e.unref(f)?e.e({D:e.f(["使用素材","不使用素材"],((a,l,u)=>({a:e.t(a),b:l,c:l==e.unref(V)?1:"",d:e.o((e=>V.value=l),l)}))),E:`translateX(${100*e.unref(V)}%)`,F:0===e.unref(V)},0===e.unref(V)?e.e({G:e.f(e.unref(v).materialList,((a,l,u)=>({a:a.pic,b:e.o((l=>(a=>{const{pic:l}=a;e.index.previewImage({urls:[l]})})(a)),l),c:"5215acf3-2-"+u,d:e.o((e=>{return l=a.id,void(v.materialList=v.materialList.filter((e=>e.id!==l)));var l}),l),e:e.o((e=>(e=>{z.value=e,J("image")})(l)),l),f:l}))),H:e.p({name:"close",color:"#ffffff",size:"16"}),I:e.unref(v).materialList.length<1},e.unref(v).materialList.length<1?{J:a._imports_0$6,K:e.o((a=>e.unref(J)("image")))}:{}):{}):{},{L:3==e.unref(f)},3==e.unref(f)?{M:e.f(w,((a,l,u)=>({a:e.t(a.label),b:l,c:e.unref(v).videoStyle==a.value?1:"",d:e.o((l=>e.unref(v).videoStyle=a.value),l)}))),N:e.f(k,((a,l,u)=>({a:e.t(a.label),b:l,c:e.unref(v).aspect_ratio==a.value?1:"",d:e.o((l=>e.unref(v).aspect_ratio=a.value),l)}))),O:e.f(L,((a,l,u)=>({a:e.t(a.label),b:l,c:e.unref(S)==l?1:"",d:e.o((e=>S.value=l),l)}))),P:e.f($,((a,l,u)=>({a:e.t(a.label),b:l,c:e.unref(v).videoSwitchFrequency==a.value?1:"",d:e.o((l=>e.unref(v).videoSwitchFrequency=a.value),l)})))}:{},{Q:4==e.unref(f)},4==e.unref(f)?{R:e.o((a=>e.unref(v).name=a)),S:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(v).name}),T:a._imports_1$10,U:e.o((e=>N("minus"))),V:e.o((a=>e.unref(v).video_count=a)),W:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{color:"#0065fb",fontWeight:"bold"},"input-align":"center",modelValue:e.unref(v).video_count}),X:a._imports_2$4,Y:e.o((e=>N("add"))),Z:e.t("long_video"==e.unref(m)?"智能剪辑":"AI优化内容"),aa:e.o((a=>e.unref(v).ai_type=a)),ab:e.p({"active-value":1,"inactive-value":0,"inactive-color":"#E5E5E5",size:40,modelValue:e.unref(v).ai_type}),ac:e.t(e.unref(h).label),ad:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ae:e.o((e=>D(1))),af:e.t(null==(r=_.find((a=>a.value==e.unref(y))))?void 0:r.label),ag:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ah:e.o((e=>D(1))),ai:e.t(e.unref(v).materialList.length),aj:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),ak:e.o((e=>D(2))),al:e.t(null==(o=w.find((a=>a.value==e.unref(v).videoStyle)))?void 0:o.label),am:e.t(null==(t=k.find((a=>a.value==e.unref(v).aspect_ratio)))?void 0:t.label),an:e.t(null==(n=L.find((a=>a.value==e.unref(v).videoDuration)))?void 0:n.label),ao:e.t(null==(i=$.find((a=>a.value==e.unref(v).videoSwitchFrequency)))?void 0:i.label),ap:e.p({name:"arrow-right",size:20,color:"#B2B2B2"}),aq:e.o((e=>D(3)))}:{},{ar:e.unref(f)!=e.unref(d).length},e.unref(f)!=e.unref(d).length?e.e({as:1!=e.unref(f)},1!=e.unref(f)?{at:e.o((a=>D(e.unref(f),"prev")))}:{},{av:e.n(e.unref(M)?"bg-black":"bg-_h787878CC_"),aw:e.o((a=>D(e.unref(f),"next")))}):{ax:a._imports_3$2,ay:e.o((e=>I.value=!0)),az:e.t(e.unref(v).video_count),aA:e.o(X)},{aB:e.n(1==e.unref(f)?"justify-end":"justify-between"),aC:e.o((a=>e.isRef(R)?R.value=a:null)),aD:e.p({placeholder:"请输入",maxlength:"50","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(R)}),aE:e.o(H),aF:e.o(T),aG:e.o(H),aH:e.o((a=>e.isRef(B)?B.value=a:null)),aI:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(B)}),aJ:e.o((a=>e.isRef(U)?U.value=a:null)),aK:e.p({"upload-list":e.unref(K),modelValue:e.unref(U)}),aL:e.o(G),aM:e.o(Q),aN:e.o((a=>e.isRef(E)?E.value=a:null)),aO:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(E)}),aP:e.o((a=>e.isRef(I)?I.value=a:null)),aQ:e.p({type:5,modelValue:e.unref(I)}),aR:e.sr(P,"5215acf3-15",{k:"rechargePopupRef"})})}}}),v=e._export_sfc(s,[["__scopeId","data-v-5215acf3"]]);wx.createPage(v);
