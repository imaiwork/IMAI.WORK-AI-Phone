"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),r=require("../../../../api/digital_human.js"),a=require("../../../../stores/user.js"),t=require("../../../../hooks/useUpload.js"),u=require("../../enums/index.js"),i=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("upload-progress")+e.resolveComponent("recharge-popup")+e.resolveComponent("video-preview"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+l+(()=>"../../../../components/upload-progress/upload-progress.js")+n+s+(()=>"../../../../components/recharge-popup/recharge-popup.js")+(()=>"../../../../components/video-preview/video-preview.js"))();const s=()=>"../../components/tokens-cost/tokens-cost.js",n=()=>"../../components/create-success-pop/create-success-pop.js",l=()=>"../../components/choose-role/choose-role.js",c=e.defineComponent({__name:"sora_create",setup(s){const{on:n}=i.useEventBusManager(),l=a.useUserStore(),{userTokens:c}=e.toRefs(l),p=e.reactive({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM")+"一句话生成视频",content:"",materialList:[],videoStyle:1,videoResolution:1,aspect_ratio:"16:9",videoDuration:10,videoSwitchFrequency:1,video_count:1,ai_type:1}),d=[{label:"横屏16:9",value:"16:9"},{label:"竖屏9:16",value:"9:16"}],m=[{label:"10s(普通)",value:10,model:"sora-2"},{label:"15s(普通)",value:15,model:"sora-2"},{label:"10s(PRO)",value:10,model:"sora-2-pro"},{label:"15s(PRO)",value:15,model:"sora-2-pro"},{label:"25s(PRO)",value:25,model:"sora-2-pro"}],v=e.ref(0),f=e.ref(0),_=e.ref(-1),h=e.ref(!1),g=e.ref([]),j=e.ref(!1),b=e.reactive({url:"",pic:""}),q=e.ref(!1),y=e.ref(!1),x=e.ref(null),L=e.shallowRef(),R=e=>{g.value.push(e),p.content+=e.name},k=e=>{v.value=e.detail.cursor},{showUploadProgress:w,uploadMaterialList:$,uploadAndProcessFiles:S}=t.useUpload({count:1,onSuccess:e=>{-1!==_.value?p.materialList[_.value]=e[0]:p.materialList=p.materialList.concat(e),_.value=-1}}),V=o=>{if("minus"===o){if(p.video_count<=1)return void e.index.$u.toast("最少生成1个视频哦");p.video_count--}else{if(p.video_count>=99)return void e.index.$u.toast("最多生成99个视频哦");p.video_count++}},C=async()=>{var o;if(c.value<0)null==(o=L.value)||o.open();else if(p.name)if(p.video_count<=0)e.index.$u.toast("请输入生成视频数量");else{e.index.showLoading({title:"提交中...",mask:!0});try{const o=await r.createSoraVideo({name:p.name,theme:"",content:p.content,gender:"",image_urls:p.materialList.map((e=>e.pic)),style:"",frequency:"",aspect_ratio:p.aspect_ratio,duration:m[f.value].value,number:p.video_count,model:m[f.value].model,anchor_ids:g.value.map((e=>e.anchor_id))});e.index.hideLoading(),x.value=o,q.value=!0}catch(a){e.index.hideLoading(),e.index.showToast({title:a,icon:"none",duration:3e3})}}else e.index.$u.toast("请输入视频名称")},E=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/sora_role_library/sora_role_library"})},M=()=>{q.value=!1,e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",type:"reLaunch",params:{task_id:JSON.stringify([x.value.id]),scene:1,type:u.MontageTypeEnum.SORA_VIDEO}})},O=()=>{e.index.$u.route({url:"/packages/pages/creation/creation",type:"redirect"})};return e.onLoad((()=>{n("confirm",(e=>{const{type:o,data:r}=e;o===u.ListenerTypeEnum.SORA_AI_COPYWRITER&&(p.content=r)}))})),(r,a)=>e.e({a:e.p({"title-bold":!0,title:"一句话生成视频","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.o((o=>e.unref(p).name=o)),c:e.p({maxlength:"50","placeholder-style":"font-size:26rpx;",placeholder:"请输入",clearable:!0,modelValue:e.unref(p).name}),d:5e3,e:e.o(k),f:e.unref(p).content,g:e.o((o=>e.unref(p).content=o.detail.value)),h:o._imports_0$19,i:o._imports_1$11,j:e.o((o=>e.unref(p).content="")),k:e.t(e.unref(p).content.length),l:e.t(5e3),m:o._imports_0$6,n:e.o((e=>h.value=!0)),o:e.f(e.unref(g),((o,r,a)=>({a:o.pic,b:e.o((e=>(e=>{const{anchor_url:o,pic:r}=e;b.url=o,b.pic=r,j.value=!0})(o)),r),c:"a5b533e5-2-"+a,d:e.o((e=>(e=>{g.value.splice(e,1)})(r)),r),e:r}))),p:e.p({name:"close",color:"#ffffff",size:"16"}),q:e.f(e.unref(p).materialList,((o,r,a)=>({a:o.pic,b:e.o((r=>(o=>{const{pic:r}=o;e.index.previewImage({urls:[r]})})(o)),r),c:"a5b533e5-3-"+a,d:e.o((e=>{return r=o.id,void(p.materialList=p.materialList.filter((e=>e.id!==r)));var r}),r),e:e.o((e=>(e=>{_.value=e,S("image")})(r)),r),f:r}))),r:e.p({name:"close",color:"#ffffff",size:"16"}),s:e.unref(p).materialList.length<1},e.unref(p).materialList.length<1?{t:o._imports_0$6,v:e.o((o=>e.unref(S)("image")))}:{},{w:e.f(d,((o,r,a)=>({a:e.t(o.label),b:r,c:e.unref(p).aspect_ratio==o.value?1:"",d:e.o((r=>e.unref(p).aspect_ratio=o.value),r)}))),x:e.f(m,((o,r,a)=>({a:e.t(o.label),b:r,c:e.unref(f)==r?1:"",d:e.o((e=>f.value=r),r)}))),y:o._imports_1$10,z:e.o((e=>V("minus"))),A:e.o((o=>e.unref(p).video_count=o)),B:e.p({type:"digit",placeholder:"",min:1,max:99,"custom-style":{fontWeight:"bold"},"input-align":"center",modelValue:e.unref(p).video_count}),C:o._imports_2$4,D:e.o((e=>V("add"))),E:o._imports_5$2,F:e.o(E),G:o._imports_3$2,H:e.o((e=>y.value=!0)),I:e.t(e.unref(p).video_count),J:e.o(C),K:e.o(R),L:e.o((o=>e.isRef(h)?h.value=o:null)),M:e.p({modelValue:e.unref(h)}),N:e.o((o=>e.isRef(w)?w.value=o:null)),O:e.p({"upload-list":e.unref($),modelValue:e.unref(w)}),P:e.o(M),Q:e.o(O),R:e.o((o=>e.isRef(q)?q.value=o:null)),S:e.p({title:"视频生成中",desc:"您可以立即去设置发布任务，也可以等待视频生成成功后再发布",modelValue:e.unref(q)}),T:e.o((o=>e.isRef(y)?y.value=o:null)),U:e.p({type:5,modelValue:e.unref(y)}),V:e.sr(L,"a5b533e5-9",{k:"rechargePopupRef"}),W:e.o((o=>e.isRef(j)?j.value=o:null)),X:e.p({"video-url":e.unref(b).url,pic:e.unref(b).pic,modelValue:e.unref(j)})})}}),p=e._export_sfc(c,[["__scopeId","data-v-a5b533e5"]]);wx.createPage(p);
