"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../config/index.js"),n=require("../../../../enums/appEnums.js"),a=require("../../enums/index.js"),r=require("../../../../stores/user.js"),u=require("../../../../utils/request/cancel.js"),s=require("../../../../hooks/useEventBusManager.js"),t=require("../../hooks/useUpload.js");if(require("../../../../api/user.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("video-player")+e.resolveComponent("u-button")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../components/video-player/video-player.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+l+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const l=()=>"../../components/upload-loading/upload-loading.js",m=e.defineComponent({__name:"video_upload",setup(l){const{emit:m}=s.useEventBusManager(),d=["mp4","mov"],p=r.useUserStore(),{userTokens:c}=e.toRefs(p),g=e.shallowRef(),v=e.reactive({name:"",url:"",pic:"",anchor_id:"",model_version:"",width:0,height:0}),A=e.ref(!1),h=e.ref(),E=e.ref(!1),D=e.ref(0),M=e.shallowRef(),f=e.ref(""),H={resolution:`${t.commonUploadLimit.minWidthResolution}P-${t.commonUploadLimit.maxWidthResolution}P`,fileSize:t.commonUploadLimit.size},_=e=>`${t.uploadLimit[e].minResolution}P-${t.uploadLimit[e].maxResolution}P`;a.DigitalHumanModelVersionEnum.STANDARD,_(a.DigitalHumanModelVersionEnum.STANDARD),t.uploadLimit[a.DigitalHumanModelVersionEnum.STANDARD].size,a.DigitalHumanModelVersionEnum.SUPER,_(a.DigitalHumanModelVersionEnum.SUPER),t.uploadLimit[a.DigitalHumanModelVersionEnum.SUPER].size,a.DigitalHumanModelVersionEnum.ADVANCED,a.DigitalHumanModelVersionEnum.ELITE,a.DigitalHumanModelVersionEnum.CHANJING,_(a.DigitalHumanModelVersionEnum.CHANJING),t.uploadLimit[a.DigitalHumanModelVersionEnum.CHANJING].size,a.DigitalHumanModelVersionEnum.SHANJIAN,_(a.DigitalHumanModelVersionEnum.SHANJIAN),t.uploadLimit[a.DigitalHumanModelVersionEnum.SHANJIAN].size;const N=e.computed((()=>{const e=v.model_version?"string"==typeof v.model_version?parseInt(v.model_version):v.model_version:a.DigitalHumanModelVersionEnum.STANDARD;Object.values(a.DigitalHumanModelVersionEnum).includes(e)||a.DigitalHumanModelVersionEnum.STANDARD;const o=H;return[{name:"视频方向",value:"横向或纵向"},{name:"文件格式",value:d.join("、")},{name:"分辨率",value:o.resolution},{name:"声音要求",value:"视频内音频需要清晰、响亮且无嘈杂背景音等干扰"},{name:"文件大小",value:`小于${o.fileSize}MB`}]}));e.computed((()=>v.model_version?t.uploadLimit[v.model_version]:null));const j=e=>p.getTokenByScene(e),x=e=>{const o={pro:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_PRO},normal:{avatar:n.TokensSceneEnum.HUMAN_AVATAR},advanced:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ADVANCED},elite:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ELITE},chanjing:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_CHANJING}};switch(e){case a.DigitalHumanModelVersionEnum.SUPER:return o.pro;case a.DigitalHumanModelVersionEnum.ADVANCED:return o.advanced;case a.DigitalHumanModelVersionEnum.ELITE:return o.elite;case a.DigitalHumanModelVersionEnum.CHANJING:return o.chanjing;default:return o.normal}},V=()=>{u.requestCancel.remove("/upload/video"),u.requestCancel.remove("/upload/image"),E.value=!1,D.value=0,f.value="",y()},q=async()=>{m("confirm",{type:a.ListenerTypeEnum.VIDEO_UPLOAD,data:v}),e.index.navigateBack()},R=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})},y=()=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})};return e.onLoad((e=>{try{e.type&&(g.value=e.type)}catch(o){console.error("页面加载参数处理失败:",o)}})),(n,r)=>e.e({a:o._imports_1$2,b:e.p({"play-icon-size":88,poster:`${e.unref(i.config).baseUrl}static/images/dh_example_bg2.png`,"video-url":`${e.unref(i.config).baseUrl}static/videos/dh_example2.mp4`}),c:o._imports_2$1,d:o._imports_3,e:e.f(e.unref(N),((o,i,n)=>({a:e.t(i+1),b:e.t(o.name),c:e.t(o.value),d:i}))),f:o._imports_4,g:o._imports_4$1,h:e.o((o=>(async()=>{var o;if(g.value===a.ModeTypeEnum.ANCHOR){const i=x(a.DigitalHumanModelVersionEnum.SHANJIAN),n=x(a.DigitalHumanModelVersionEnum.CHANJING),{score:r}=j(i.avatar),{score:u}=j(n.avatar);if(c.value<r+u)return A.value=!0,await e.nextTick$1(),void(null==(o=h.value)||o.open())}e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#000000"});const{upload:i}=t.useUpload({size:t.commonUploadLimit.size,widthResolution:[t.commonUploadLimit.minWidthResolution,t.commonUploadLimit.maxWidthResolution],heightResolution:[t.commonUploadLimit.minHeightResolution,t.commonUploadLimit.maxHeightResolution],duration:[t.commonUploadLimit.videoMinDuration,t.commonUploadLimit.videoMaxDuration],extension:d,async onSuccess(o){const{url:i,pic:n,width:a,height:r}=o;v.url=i,v.pic=n,v.width=a,v.height=r,v.name=e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM"),q()},onProgress(e){M.value=e.type,D.value=e.progress,f.value="video"===M.value?"视频正在上传中...":"图片正在上传中...",E.value=!0},onError(o){o.errMsg&&"chooseMedia:fail api scope is not declared in the privacy agreement"===o.errMsg?e.index.$u.toast("请完善隐私协议，否则无法使用"):o&&o.errMsg&&-1==o.errMsg.indexOf("cancel")&&e.index.$u.toast(o.errMsg||"上传失败"),E.value=!1,D.value=0,y()}});i()})())),i:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",boxShadow:" 0px 3px 12px 0px rgba(0, 0, 0, 0.12)",fontSize:"26rpx"}}),j:e.unref(E)},e.unref(E)?{k:e.o(V),l:e.o(R),m:e.o(q),n:e.p({progress:e.unref(D),"loading-text":e.unref(f),"progress-type":e.unref(M),"show-back":e.unref(v).model_version!==e.unref(a.DigitalHumanModelVersionEnum).SHANJIAN})}:{},{o:e.unref(A)},e.unref(A)?{p:e.sr(h,"71c60ea0-3",{k:"rechargePopupRef"}),q:e.o((e=>A.value=!1))}:{})}}),d=e._export_sfc(m,[["__scopeId","data-v-71c60ea0"]]);wx.createPage(d);
