"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),u=require("../../../../stores/user.js"),n=require("../../../../utils/util.js"),r=require("../../../../enums/appEnums.js"),s=require("../../enums/index.js");if(require("../../../../api/user.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-line")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-line/u-line.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const t=e.defineComponent({__name:"create-panel",props:{formData:{default:()=>({})}},emits:["success","close","recharge"],setup(t,{expose:i,emit:a}){const c=t,_=u.useUserStore(),{userTokens:m}=e.toRefs(_),d=e.ref(!1),v=e.ref(0),p=e.ref({}),l=e=>_.getTokenByScene(e),f=e.computed((()=>{const{video_cost:e,figure_cost:o,voice_cost:u,audio_cost:n}=p.value;return e*v.value+o+u+n*v.value})),E=()=>{if(A(),m.value<parseFloat(f.value||0))return e.index.$u.toast("算力不足，请充值！"),a("recharge"),void(d.value=!1);a("success")},A=()=>{const{msg:o,audio_duration:u,audio_type:n}=c.formData;switch(n){case s.CreateTypeEnum.TEXT:((e,o)=>{v.value=o||Math.floor(e.length/3)})(o,u);break;case s.CreateTypeEnum.AUDIO:v.value=u}(async()=>{const{anchor_id:o,model_version:u,voice_id:n,voice_type:s}=c.formData,t=e.reactive({video_cost:0,figure_cost:0,voice_cost:0,audio_cost:0,video_unit:"",voice_unit:"",figure_unit:"",audio_unit:""}),i={pro:{video:r.TokensSceneEnum.HUMAN_VIDEO_PRO,voice:r.TokensSceneEnum.HUMAN_VOICE_PRO,audio:r.TokensSceneEnum.HUMAN_AUDIO_PRO,avatar:r.TokensSceneEnum.HUMAN_AVATAR_PRO},normal:{video:r.TokensSceneEnum.HUMAN_VIDEO,voice:r.TokensSceneEnum.HUMAN_VOICE,audio:r.TokensSceneEnum.HUMAN_AUDIO,avatar:r.TokensSceneEnum.HUMAN_AVATAR},advanced:{video:r.TokensSceneEnum.HUMAN_VIDEO_ADVANCED,voice:r.TokensSceneEnum.HUMAN_VOICE_ADVANCED,audio:r.TokensSceneEnum.HUMAN_AUDIO_ADVANCED,avatar:r.TokensSceneEnum.HUMAN_AVATAR_ADVANCED},elite:{video:r.TokensSceneEnum.HUMAN_VIDEO_ELITE,voice:r.TokensSceneEnum.HUMAN_VOICE_ELITE,audio:r.TokensSceneEnum.HUMAN_AUDIO_ELITE,avatar:r.TokensSceneEnum.HUMAN_AVATAR_ELITE}},a=(()=>{switch(parseInt(u)){case r.DigitalHumanModelVersionEnum.SUPER:return i.pro;case r.DigitalHumanModelVersionEnum.ADVANCED:return i.advanced;case r.DigitalHumanModelVersionEnum.ELITE:return i.elite;default:return i.normal}})();var _,m,d,v;_=a.video,m=a.voice,d=a.audio,v=o?void 0:a.avatar,t.video_cost=parseFloat(l(_).score||0),t.video_unit=l(_).unit,t.voice_cost=1==s&&-1==n?parseFloat(l(m).score||0):0,t.voice_unit=l(m).unit,t.audio_cost=parseFloat(l(d).score||0),t.audio_unit=l(d).unit,v&&(t.figure_cost=parseFloat(l(v).score||0),t.figure_unit=l(v).unit),p.value=t})()},T=()=>{d.value=!1,a("close")};return i({open:()=>{A()},close:T,confirm:E}),(u,r)=>e.e({a:o._imports_0$43,b:e.t(e.unref(m)),c:o._imports_1$28,d:e.t(e.unref(n.formatAudioTime)(e.unref(v))),e:o._imports_2$11,f:e.unref(p).video_cost},e.unref(p).video_cost?{g:e.t(e.unref(p).video_cost*e.unref(v)),h:e.t(e.unref(p).video_cost),i:e.t(e.unref(p).video_unit)}:{},{j:e.unref(p).figure_cost},e.unref(p).figure_cost?{k:e.t(e.unref(p).figure_cost),l:e.t(e.unref(p).figure_cost),m:e.t(e.unref(p).figure_unit)}:{},{n:e.unref(p).voice_cost},e.unref(p).voice_cost?{o:e.t(e.unref(p).voice_cost),p:e.t(e.unref(p).voice_cost),q:e.t(e.unref(p).voice_unit)}:{},{r:e.unref(p).audio_cost},e.unref(p).audio_cost?{s:e.t(e.unref(p).audio_cost*e.unref(v)),t:e.t(e.unref(p).audio_cost),v:e.t(e.unref(p).audio_unit)}:{},{w:e.t(e.unref(f)),x:o._imports_3$5,y:e.o((e=>E())),z:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",boxShadow:" 0px 3px 12px 0px rgba(0, 0, 0, 0.12)",fontSize:"26rpx"}}),A:e.o(T),B:e.o(T),C:e.o((o=>e.isRef(d)?d.value=o:null)),D:e.p({mode:"bottom",width:"100%","border-radius":"16",mask:!1,"custom-style":{background:"transparent"},"z-index":777,modelValue:e.unref(d)})})}});wx.createComponent(t);
