"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/device.js"),n=require("../../../../hooks/useEventBusManager.js"),l=require("../../enums/index.js"),o=require("../../stores/material.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-radio")+e.resolveComponent("u-radio-group")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-switch"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-radio/u-radio.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-radio-group/u-radio-group.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+i+u+a+s+m)();const i=()=>"../../components/keywords-edit/keywords-edit.js",u=()=>"../../components/comment-filter/comment-filter.js",a=()=>"../../components/choose-region/choose-region.js",s=()=>"../../components/choose-age/choose-age.js",m=()=>"../../components/choose-comment-time/choose-comment-time.js",c=e.defineComponent({__name:"setting_ca",setup(i){const u=o.useMaterialStore(),{on:a}=n.useEventBusManager(),s=e.ref(!0),m=e.ref(""),c=e.ref(),r=[{name:"简易模式",value:1},{name:"精确模式",value:2}],_=e.ref(0),d=e.reactive({type:1,ai_direction:"",clue_list:[],comment_list:[],comment_filter_list:[],comment_like:"1",comment_follow:"1",comment_time:0,comment_time_index:[0],comment_region:"不限",comment_gender:"不限",comment_age:"不限",comment_account_feature:"0",comment_type:1}),f=e.ref(""),v=e.ref(),p=e.ref(!1),g=e.ref(-1),h=e.ref(-1),y=e.ref(!1),j=e.ref(!1),x=e.ref([0]),k=e.ref(),w=e.ref(!1),q=e.ref(!1),b=e.ref(),L=[{value:0,label:"不限"},{value:1,label:"24小时内"},{value:2,label:"2天内"},{value:3,label:"3天内"},{value:4,label:"4天内"},{value:5,label:"5天内"},{value:6,label:"6天内"},{value:7,label:"7天内"}],z=e.computed((()=>{switch(f.value){case"clue":return"线索词组";case"comment":return"评论话术";default:return""}}));e.computed((()=>d.comment_time>-1?L[d.comment_time_index[0]].label:"请选择"));const C=e=>{switch(f.value){case"clue":d.clue_list[g.value].name=e;break;case"comment":h.value>=0?d.comment_list[h.value]=e:d.comment_list.push(e)}p.value=!1,g.value=-1,h.value=-1},B=()=>{g.value=-1,e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{type:"add"}})},A=e=>{var t;h.value=e??-1,f.value="comment",p.value=!0,null==(t=v.value)||t.setFormData(d.comment_list[e])},I=e=>{d.comment_time_index=e,d.comment_time=L[d.comment_time_index[0]].value},V=()=>{var e;null==(e=v.value)||e.setFormData(d.comment_filter_list),y.value=!0},$=e=>{d.comment_filter_list=e},E=e=>{d.comment_age=e,q.value=!1},F=e=>{e.isAll||0===e.regionList.length?d.comment_region="不限":d.comment_region=e.regionList.join(";"),w.value=!1},R=async()=>{if(2!==d.type||d.ai_direction)if(0!==d.clue_list.length)if(1!==d.comment_type||0!==d.comment_list.length)if(1!==_.value||0!==d.comment_filter_list.length){e.index.showLoading({title:"保存中...",mask:!0});try{await t.createAutoTaskClosureConfig({device_code:m.value,mode:r[_.value].value,exec_type:d.type,ai_direction:2==d.type?d.ai_direction:"",keywords:d.clue_list.map((e=>({title:e.name,keywords:e.clue}))),comment_screening:d.comment_filter_list.map((e=>e.value)),touch_speech_type:d.comment_type,touch_speech:d.comment_list,actions:{msg_comment_likes:d.comment_like,msg_follow:d.comment_follow,comment_time:d.comment_time,areas:d.comment_region,gender:d.comment_gender,age:d.comment_age,account_feature:d.comment_account_feature}}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none",duration:3e3}),e.index.navigateBack()}catch(n){e.index.hideLoading(),e.index.showToast({title:n||"保存失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请添加评论筛选");else e.index.$u.toast("请添加评论话术");else e.index.$u.toast("请添加线索词组");else e.index.$u.toast("请输入AI补充的线索词方向")};return e.onLoad((n=>{m.value=null==n?void 0:n.device_code,c.value=null==n?void 0:n.account_type,(async()=>{var n,l,o,i,u,a,c;e.index.showLoading({title:"加载中...",mask:!0});try{const e=await t.getAutoTaskClosureConfigDetail({device_code:m.value});d.type=e.exec_type,d.ai_direction=e.ai_direction,d.clue_list=e.keywords.map((e=>({name:e.title,clue:e.keywords}))),d.comment_list=e.touch_speech,d.comment_filter_list=e.comment_screening.map(((e,t)=>({value:e,checked:!0,id:t}))),d.comment_like=null==(n=e.actions)?void 0:n.msg_comment_likes,d.comment_follow=null==(l=e.actions)?void 0:l.msg_follow,d.comment_time=null==(o=e.actions)?void 0:o.comment_time,d.comment_region=null==(i=e.actions)?void 0:i.areas,d.comment_gender=null==(u=e.actions)?void 0:u.gender,d.comment_age=null==(a=e.actions)?void 0:a.age,d.comment_account_feature=null==(c=e.actions)?void 0:c.account_feature,d.comment_type=e.touch_speech_type,_.value=r.findIndex((t=>t.value==e.mode))||0,d.comment_time_index=[L.findIndex((t=>{var n;return t.value==(null==(n=e.actions)?void 0:n.comment_time)}))||0],x.value=d.comment_time_index}finally{e.index.hideLoading(),s.value=!1}})(),a("confirm",(e=>{const{type:t,data:n}=e;t===l.ListenerTypeEnum.CLUE_LIST&&(g.value>=0?d.clue_list[g.value]={...d.clue_list[g.value],...n}:d.clue_list.push({name:`线索词组${d.clue_list.length<10?`0${d.clue_list.length+1}`:d.clue_list.length+1}`,clue:n}))}))})),(t,n)=>e.e({a:!e.unref(s)},e.unref(s)?{}:e.e({b:e.f(r,((t,n,l)=>({a:e.t(t.name),b:n,c:e.unref(_)===n?1:"",d:e.o((e=>_.value=n),n)}))),c:`translateX(${100*e.unref(_)}%)`,d:e.f([{value:1,label:"循环执行"},{value:2,label:"AI自动补充"},{value:3,label:"不执行"}],((t,n,l)=>({a:e.t(t.label),b:n,c:"8d1f481f-1-"+l+",8d1f481f-0",d:e.p({name:t.value,size:28})}))),e:e.o((t=>e.unref(d).type=t)),f:e.p({modelValue:e.unref(d).type}),g:2===e.unref(d).type},2===e.unref(d).type?{h:e.o((t=>e.unref(d).ai_direction=t)),i:e.p({placeholder:"请输入您的行业，如：家居用品",maxlength:"100",clearable:!0,modelValue:e.unref(d).ai_direction})}:{},{j:e.p({name:"plus",color:"#0065FB",size:"20"}),k:e.o(B),l:e.unref(d).clue_list.length>0},e.unref(d).clue_list.length>0?{m:e.f(e.unref(d).clue_list,((t,n,l)=>({a:e.t(t.name),b:e.o((e=>(e=>{var t;g.value=e??-1,f.value="clue",p.value=!0,null==(t=v.value)||t.setFormData(d.clue_list[e].name)})(n)),n),c:e.t(t.clue.length),d:"8d1f481f-4-"+l,e:e.f(t.clue,((t,n,l)=>({a:e.t(t),b:n}))),f:e.o((e=>(e=>{d.clue_list.splice(e,1)})(n)),n),g:n,h:e.o((t=>(t=>{g.value=t??-1,t>-1&&u.setList("clueList",d.clue_list[t].clue),e.index.$u.route({url:"/ai_modules/device/pages/clue_edit/clue_edit",params:{index:t}})})(n)),n)}))),n:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"})}:{o:e.p({name:"plus",size:"20"}),p:e.o(B)},{q:e.f([{value:1,label:"固定话术"},{value:2,label:"AI回复"},{value:3,label:"AI根据固话优化"}],((t,n,l)=>({a:e.t(t.label),b:n,c:"8d1f481f-7-"+l+",8d1f481f-6",d:e.p({name:t.value,size:28})}))),r:e.o((t=>e.unref(d).comment_type=t)),s:e.p({modelValue:e.unref(d).comment_type}),t:1==e.unref(d).comment_type},1==e.unref(d).comment_type?{v:e.f(e.unref(d).comment_list,((t,n,l)=>({a:e.t(t),b:"8d1f481f-8-"+l,c:e.o((e=>(e=>{d.comment_list.splice(e,1)})(n)),n),d:n,e:e.o((e=>A(n)),n)}))),w:e.p({name:"close",color:"#ffffff",size:"16"}),x:e.p({name:"plus",color:"#0065FB",size:"20"}),y:e.o((e=>A(-1)))}:{},{z:1===e.unref(_)},1===e.unref(_)?e.e({A:e.unref(d).comment_filter_list.length>0},e.unref(d).comment_filter_list.length>0?{B:e.f(e.unref(d).comment_filter_list,((t,n,l)=>({a:e.t(t.value),b:"8d1f481f-10-"+l,c:e.o((e=>(e=>{d.comment_filter_list.splice(e,1)})(n)),n),d:n}))),C:e.p({name:"close",color:"#ffffff",size:"16"}),D:e.p({name:"plus",color:"#0065FB",size:"20"}),E:e.o(V)}:{F:e.p({name:"plus",size:"20"}),G:e.o(V)}):{},{H:1===e.unref(_)},1===e.unref(_)?e.e({I:e.o((t=>e.unref(d).comment_like=t)),J:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(d).comment_like})},{}):{},{ae:e.o(R)}),{af:e.sr(v,"8d1f481f-20",{k:"keywordsEditRef"}),ag:e.o(C),ah:e.o((t=>e.isRef(p)?p.value=t:null)),ai:e.p({title:e.unref(z),modelValue:e.unref(p)}),aj:e.sr(k,"8d1f481f-21",{k:"commentFilterRef"}),ak:e.o($),al:e.o((t=>e.isRef(y)?y.value=t:null)),am:e.p({modelValue:e.unref(y)}),an:e.o(F),ao:e.o((t=>e.isRef(w)?w.value=t:null)),ap:e.p({modelValue:e.unref(w)}),aq:e.sr(b,"8d1f481f-23",{k:"chooseAgeRef"}),ar:e.o(E),as:e.o((t=>e.isRef(q)?q.value=t:null)),at:e.p({modelValue:e.unref(q)}),av:e.o(I),aw:e.o((t=>e.isRef(j)?j.value=t:null)),ax:e.p({value:e.unref(d).comment_time_index,list:L,modelValue:e.unref(j)})})}}),r=e._export_sfc(c,[["__scopeId","data-v-8d1f481f"]]);wx.createPage(r);
