"use strict";const e=require("../../../../common/vendor.js"),n=require("../../../../common/assets.js"),t=require("../../../../api/device.js"),o=require("../../../../enums/appEnums.js"),u=require("../../enums/index.js"),r=require("../../../../hooks/useEventBusManager.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-switch")+e.resolveComponent("u-popup")+e.resolveComponent("confirm-dialog")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+i+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+a+l+s+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+m+c+f+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../components/popup-bottom/popup-bottom.js"))();const a=()=>"../../components/clue-gen-pop/clue-gen-pop.js",l=()=>"../../components/keywords-edit/keywords-edit.js",s=()=>"../../components/comment-filter/comment-filter.js",i=()=>"../../components/bast-setting-v2/bast-setting-v2.js",m=()=>"../../components/choose-region/choose-region.js",c=()=>"../../components/choose-age/choose-age.js",f=()=>"../../components/choose-comment-time/choose-comment-time.js",p=e.defineComponent({__name:"create_closure",setup(a){const{on:l}=r.useEventBusManager(),s=e.ref(u.CreateTypeEnum.COMMENT),i=e.ref([{step:1,title:"选择行业"},{step:2,title:"设定评论"},{step:3,title:"高级设置"},{step:4,title:"设定时间"}]),m=e.ref(1),c=e.reactive({name:"",industry:[],industryNum:1,commentNum:1,comment_filter_list:[],comment_content_list:[],comment_like:"1",comment_follow:"1",comment_time_index:[0],comment_region:"不限",comment_gender:"不限",comment_age:"不限",comment_account_feature:"0",comment_time:0,accounts:[],task_frep:1,custom_date:[],time_config:["09:00","09:30"]}),f=e.computed((()=>s.value===u.CreateTypeEnum.COMMENT));e.ref([]);const p=e.shallowRef(),d=e.ref(!1),v=e.ref(),_=e.ref("clue"),g=e.ref(-1),h=e.ref(!1),y=[{value:0,label:"不限"},{value:1,label:"24小时内"},{value:2,label:"2天内"},{value:3,label:"3天内"},{value:4,label:"4天内"},{value:5,label:"5天内"},{value:6,label:"6天内"},{value:7,label:"7天内"}],b=e.ref(!1),x=e.ref([]),w=e.ref(!1),j=e.ref(""),k=e.ref(""),C=e.ref(!1),B=e.ref(!1),q=e.ref(),z=e.ref(0),E=e.ref(!1),V=e.ref(!1),T=e.ref(""),N=e.reactive({show:!1,title:"",inputValue:1,callback:null}),$=e.computed((()=>({clue:"线索词",comment:"评论词",comment_content:"评论内容"}[_.value]))),M=e.computed((()=>c.comment_time>-1?y[c.comment_time_index[0]].label:"请选择")),R=n=>{c.industry.includes(n)?e.index.$u.toast("已存在"):(c.industry.push(n),w.value=!1)},L=e=>{c.comment_time_index=e,c.comment_time=y[c.comment_time_index[0]].value},O=()=>{var e;null==(e=q.value)||e.setFormData(c.comment_age),B.value=!0},I=e=>{c.comment_age=e,B.value=!1},A=()=>{const n=Number(N.inputValue);n<1?e.index.$u.toast("请输入大于等于1的数字"):(N.callback&&N.callback(n),N.show=!1)};function S(n,t,o,u){const r=e.ref(n.indexOf(t)),a=e.ref(null);return e.reactive({currentIndex:r,savedCustomValue:a,handleSelect:(e,n)=>{r.value=n,u(e)},openCustom:()=>{N.title=o,N.inputValue=a.value||1,N.callback=e=>{u(e),a.value=e,r.value=n.length},N.show=!0}})}const D=[1,3,5,10,20],F=[1,3,5,10,20],H=S(D,c.industryNum,"输入每个行业看笔记的数量",(e=>c.industryNum=e)),P=S(F,c.commentNum,"输入评论数量上限",(e=>c.commentNum=e)),U=e.computed((()=>X(m.value))),X=e=>{switch(e){case 1:return c.industry.length>0;case 2:return c.comment_filter_list.length>0&&c.comment_content_list.length>0;case 3:return!0;default:return!1}},Y=(n,t)=>{if("prev"!==t)if("next"!==t){if(n!==m.value)if(n<m.value)m.value=n;else{for(let t=1;t<n;t++)if(!X(t))return void e.index.$u.toast("请按顺序完成步骤");m.value=n}}else if(U.value)m.value++;else{const n={1:"请至少添加一个线索",3:"请设定时间"};e.index.$u.toast(n[m.value]||"请完成当前步骤")}else m.value--},G=()=>{""!==j.value.trim()?c.industry.includes(j.value)?e.index.$u.toast("已存在"):(c.industry.push(j.value),j.value="",e.nextTick$1((()=>{k.value="industry_"+(c.industry.length-1)}))):e.index.$u.toast("请输入获客行业")},J=e=>{"clue"===_.value?-1==g.value?c.industry.push(e):c.industry[g.value]=e:"comment"===_.value?-1==g.value?c.comment_filter_list.push(e):c.comment_filter_list[g.value]=e:"comment_content"===_.value&&(-1==g.value?c.comment_content_list.push(e):c.comment_content_list[g.value]=e),d.value=!1},K=e=>{c.industry.push(...e),b.value=!1},Q=async n=>{e.index.showLoading({title:"删除中...",mask:!0});try{await t.deleteClosureIndustryHistory({id:x.value[n].id}),x.value.splice(n,1),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3})}catch(o){e.index.showToast({title:o||"删除失败",icon:"none",duration:3e3})}},W=()=>{var e;C.value=!0,null==(e=v.value)||e.setFormData(c.comment_filter_list)},Z=e=>{c.comment_filter_list=e},ee=e=>{var n;g.value=e,_.value="comment_content",d.value=!0,null==(n=v.value)||n.setFormData(c.comment_content_list[e])},ne=e=>{e.isAll||0===e.regionList.length?c.comment_region="不限":c.comment_region=e.regionList.join(";"),E.value=!1},te=()=>{const n=["不限","男","女"];e.index.showActionSheet({itemList:n,success:e=>{c.comment_gender=n[e.tapIndex]}})},oe=()=>{e.index.showActionSheet({itemList:["全部","跳过认证号"],success:e=>{0===e.tapIndex?c.comment_account_feature="0":c.comment_account_feature="1"}})},ue=async()=>{if(c.name)if(c.accounts.length)if(5!==z.value||c.custom_date.length)if(c.time_config[0]&&c.time_config[1]){e.index.showLoading({title:"创建中...",mask:!0});try{await t.createClosureTask({name:c.name,accounts:c.accounts,task_frep:c.task_frep,task_type:s.value==u.CreateTypeEnum.COMMENT?1:2,time_config:[`${c.time_config[0]}-${c.time_config[1]}`],task_date:c.custom_date,industry:c.industry.join(";"),industry_num:c.industryNum,filter:c.comment_filter_list.map((e=>e.value)),content:c.comment_content_list,send_num:c.commentNum,is_like:c.comment_like,is_follow:c.comment_follow,send_time:c.comment_time,gender:c.comment_gender,old:c.comment_age,region:c.comment_region,account_feature:c.comment_account_feature}),e.index.hideLoading(),V.value=!0}catch(n){T.value=n,e.index.hideLoading(),e.index.showToast({title:n||"创建失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请选择任务时间");else e.index.$u.toast("请选择任务日期");else e.index.$u.toast("请选择发布账号");else e.index.$u.toast("请输入任务名称")},re=()=>{e.index.$u.route({url:"/pages/phone/phone",type:"reLaunch"}),V.value=!1},ae=async(e,n)=>{var o,r;try{const{lists:r}=await t.getClosureIndustryHistory({task_type:s.value==u.CreateTypeEnum.COMMENT?1:2,page_no:e,page_size:n});null==(o=p.value)||o.complete(r)}catch(a){null==(r=p.value)||r.complete([])}};return e.onLoad((n=>{s.value=n.type,c.name=`${s.value==u.CreateTypeEnum.COMMENT?"评论":"私信"}获客任务${e.index.$u.timeFormat(new Date,"yyyymmddhhMM")}`,l("confirm",(e=>{const{type:n,data:t}=e;if(n===u.ListenerTypeEnum.CHOOSE_DATE){if(0===t.length)return;c.custom_date=t,z.value=5}if(n===u.ListenerTypeEnum.CHOOSE_ACCOUNT){if(0===t.length)return;c.accounts=t.map((e=>({id:e.id,account:e.account,type:e.type})))}}))})),(t,r)=>e.e({a:e.p({"title-bold":!0,title:e.unref(s)===e.unref(u.CreateTypeEnum).COMMENT?"评论获客":"私信获客","border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(e.unref(i),((n,t,o)=>e.e({a:e.unref(m)>n.step},e.unref(m)>n.step?{b:"f19ce7c4-1-"+o,c:e.p({name:"checkmark",color:"#ffffff",size:"14"})}:{},{d:e.t(n.title),e:n.step!==e.unref(i).length},n.step!==e.unref(i).length?{f:e.unref(m)>n.step?1:""}:{},{g:n.step,h:e.unref(m)==n.step?1:"",i:e.o((e=>Y(n.step)),n.step)}))),c:1===e.unref(m)},1===e.unref(m)?e.e({d:e.o((n=>e.isRef(j)?j.value=n:null)),e:e.p({placeholder:"请输入，如：服装设计、女装",maxlength:"100",clearable:!0,"placeholder-style":"font-size: 26rpx;",modelValue:e.unref(j)}),f:e.o(G),g:e.unref(c).industry.length>0},e.unref(c).industry.length>0?{h:e.f(e.unref(c).industry,((n,t,o)=>({a:e.t(n),b:"f19ce7c4-3-"+o,c:e.o((e=>(e=>{c.industry.splice(e,1)})(t)),t),d:t,e:"industry_"+t,f:e.o((e=>(e=>{var n;g.value=e,_.value="clue",d.value=!0,null==(n=v.value)||n.setFormData(c.industry[e])})(t)),t)}))),i:e.p({name:"close",color:"#ffffff",size:"16"}),j:e.unref(k)}:{},{k:n._imports_0$40,l:e.o((e=>b.value=!0)),m:e.unref(x).length>0},e.unref(x).length>0?{n:e.p({name:"arrow-right",color:"#B2B2B2",size:"24"}),o:e.o((e=>w.value=!0)),p:e.f(e.unref(x).slice(0,5),((n,t,o)=>({a:e.t(n.keyword),b:"f19ce7c4-5-"+o,c:e.o((e=>Q(t)),t),d:t,e:e.o((e=>R(n.keyword)),t)}))),q:e.p({name:"close",color:"#ffffff",size:"16"})}:{},{r:e.f(D,((n,t,o)=>({a:e.t(n),b:t,c:e.unref(c).industryNum===n&&e.unref(H).currentIndex!==D.length?1:"",d:e.o((o=>e.unref(H).handleSelect(n,t)),t)}))),s:e.t(e.unref(H).currentIndex===D.length?`${e.unref(c).industryNum}条`:e.unref(H).savedCustomValue?`${e.unref(H).savedCustomValue}条`:"自定义"),t:e.unref(H).currentIndex===D.length?1:"",v:e.o(((...n)=>e.unref(H).openCustom&&e.unref(H).openCustom(...n)))}):{},{w:2===e.unref(m)},2===e.unref(m)?e.e({x:e.unref(c).comment_filter_list.length>0},e.unref(c).comment_filter_list.length>0?{y:e.f(e.unref(c).comment_filter_list,((n,t,o)=>({a:e.t(n.value),b:"f19ce7c4-6-"+o,c:e.o((e=>(e=>{c.comment_filter_list.splice(e,1)})(t)),t),d:t}))),z:e.p({name:"close",color:"#ffffff",size:"16"}),A:e.p({name:"plus",color:"#0065FB",size:"20"}),B:e.o(W)}:{C:e.p({name:"plus",size:"20"}),D:e.o(W)},{E:e.t(e.unref(f)?"评论内容":"私信内容"),F:e.unref(c).comment_content_list.length>0},e.unref(c).comment_content_list.length>0?{G:e.f(e.unref(c).comment_content_list,((n,t,o)=>({a:e.t(n),b:"f19ce7c4-9-"+o,c:e.o((e=>(e=>{c.comment_content_list.splice(e,1)})(t)),t),d:t,e:e.o((e=>ee(t)),t)}))),H:e.p({name:"close",color:"#ffffff",size:"16"}),I:e.p({name:"plus",color:"#0065FB",size:"20"}),J:e.o((e=>ee(-1)))}:{K:e.p({name:"plus",size:"20"}),L:e.t(e.unref(f)?"评论":"私信"),M:e.o((e=>ee(-1)))},{N:e.t(e.unref(f)?"评论数量上限":"私信数量上限"),O:e.f(F,((n,t,o)=>({a:e.t(n),b:t,c:e.unref(c).commentNum===n&&e.unref(P).currentIndex!==F.length?1:"",d:e.o((o=>e.unref(P).handleSelect(n,t)),t)}))),P:e.t(e.unref(P).currentIndex===F.length?`${e.unref(c).commentNum}条`:e.unref(P).savedCustomValue?`${e.unref(P).savedCustomValue}条`:"自定义"),Q:e.unref(P).currentIndex===F.length?1:"",R:e.o(((...n)=>e.unref(P).openCustom&&e.unref(P).openCustom(...n))),S:!e.unref(f)},(e.unref(f),{})):{},{T:3===e.unref(m)},3===e.unref(m)?{U:e.t(e.unref(f)?"评论附带点赞":"私信附带点赞"),V:e.o((n=>e.unref(c).comment_like=n)),W:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(c).comment_like}),X:e.t(e.unref(f)?"评论附带关注":"私信附带关注"),Y:e.o((n=>e.unref(c).comment_follow=n)),Z:e.p({"active-value":"1","inactive-value":"0",size:40,modelValue:e.unref(c).comment_follow}),aa:e.t(e.unref(f)?"评论时间":"私信时间"),ab:e.t(e.unref(M)||"请选择"),ac:e.n(e.unref(c).comment_time>-1?"text-primary font-bold":"text-_hB2B2B2_"),ad:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),ae:e.o((e=>h.value=!0)),af:e.t(e.unref(c).comment_region||"请选择"),ag:e.n(e.unref(c).comment_region?"text-primary font-bold":"text-_hB2B2B2_"),ah:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),ai:e.o((e=>E.value=!0)),aj:e.t(e.unref(c).comment_gender||"请选择"),ak:e.n(e.unref(c).comment_gender?"text-primary font-bold":"text-_hB2B2B2_"),al:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),am:e.o(te),an:e.t(e.unref(c).comment_age),ao:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),ap:e.o(O),aq:e.t("0"==e.unref(c).comment_account_feature?"全部":"跳过认证号"),ar:e.p({name:"arrow-right",size:"22",color:"#B2B2B2"}),as:e.o(oe)}:{},{at:4===e.unref(m)},4===e.unref(m)?e.e({av:e.o((e=>z.value=e)),aw:e.o((n=>e.isRef(c)?c.value=n:null)),ax:e.p({"show-device":!1,"show-accounts":!0,"current-frequency":e.unref(z),"platform-types":[e.unref(o.AppTypeEnum).XHS,e.unref(o.AppTypeEnum).DOUYIN],modelValue:e.unref(c)}),ay:e.unref(T)},e.unref(T)?{az:e.t(e.unref(T))}:{}):{},{aA:e.unref(m)!=e.unref(i).length},e.unref(m)!=e.unref(i).length?e.e({aB:1!==e.unref(m)},1!==e.unref(m)?{aC:e.o((n=>Y(e.unref(m),"prev")))}:{},{aD:e.n(e.unref(U)?"bg-primary":"bg-_h787878CC_"),aE:e.o((n=>Y(e.unref(m),"next")))}):{aF:e.o(ue)},{aG:e.n(1===e.unref(m)?"justify-end":"justify-between"),aH:e.t(e.unref(N).title),aI:e.o((n=>e.unref(N).inputValue=n)),aJ:e.p({placeholder:"请输入",type:"digit","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(N).inputValue}),aK:e.o((n=>e.unref(N).show=!1)),aL:e.o(A),aM:e.o((n=>e.unref(N).show=!1)),aN:e.o((n=>e.unref(N).show=n)),aO:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(N).show}),aP:e.o(K),aQ:e.o((n=>e.isRef(b)?b.value=n:null)),aR:e.p({modelValue:e.unref(b)}),aS:e.sr(v,"f19ce7c4-23",{k:"keywordsEditRef"}),aT:e.o(J),aU:e.o((n=>e.isRef(d)?d.value=n:null)),aV:e.p({title:e.unref($),modelValue:e.unref(d)}),aW:e.o(Z),aX:e.o((n=>e.isRef(C)?C.value=n:null)),aY:e.p({modelValue:e.unref(C)}),aZ:e.o(re),ba:e.o(re),bb:e.o((n=>e.isRef(V)?V.value=n:null)),bc:e.p({center:!0,"confirm-text":"确定",content:"创建成功，回到首页？","show-close":!1,modelValue:e.unref(V)}),bd:e.o(ne),be:e.o((n=>e.isRef(E)?E.value=n:null)),bf:e.p({modelValue:e.unref(E)}),bg:e.sr(q,"f19ce7c4-27",{k:"chooseAgeRef"}),bh:e.o(I),bi:e.o((n=>e.isRef(B)?B.value=n:null)),bj:e.p({modelValue:e.unref(B)}),bk:e.o(L),bl:e.o((n=>e.isRef(h)?h.value=n:null)),bm:e.p({value:e.unref(c).comment_time_index,list:y,modelValue:e.unref(h)}),bn:e.f(e.unref(x),((n,t,o)=>({a:e.t(n.keyword),b:"f19ce7c4-31-"+o+",f19ce7c4-30",c:e.o((e=>Q(t)),t),d:t,e:e.o((e=>R(n.keyword)),t)}))),bo:e.p({name:"close",color:"#ffffff",size:"16"}),bp:e.sr(p,"f19ce7c4-30,f19ce7c4-29",{k:"industryHistoryPagingRef"}),bq:e.o(ae),br:e.o((n=>e.isRef(x)?x.value=n:null)),bs:e.p({fixed:!1,modelValue:e.unref(x)}),bt:e.o((e=>w.value=!1)),bv:e.o((n=>e.isRef(w)?w.value=n:null)),bw:e.p({title:"获客行业记录","is-disabled-touch":!0,modelValue:e.unref(w)})})}});wx.createPage(p);
