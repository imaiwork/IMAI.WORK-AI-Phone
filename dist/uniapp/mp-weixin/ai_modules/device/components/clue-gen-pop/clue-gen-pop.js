"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),s=require("../../../../stores/user.js"),t=require("../../../../api/sph.js"),r=require("../../../../enums/appEnums.js"),o=require("../../../../utils/request/cancel.js");if(require("../../../../api/user.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../components/popup-bottom/popup-bottom.js"))();const n=e.defineComponent({__name:"clue-gen-pop",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirm","close"],setup(n,{emit:a}){const i=n,l=e.computed({get:()=>i.modelValue,set(e){a("update:modelValue",e)}}),c=s.useUserStore(),{userTokens:p}=e.toRefs(c),m=e.ref([]),f=e.ref(""),v=e.ref(!1),d=e.computed((()=>m.value.every((e=>"success"===e.status)))),q=e.computed((()=>{var e;const u=null==(e=c.getTokenByScene(r.TokensSceneEnum.SPH_AI_CLUE))?void 0:e.score;return 30*parseFloat(u)})),j=async u=>{if(f.value){if(!v.value)if(p.value<q.value)e.index.$u.toast("算力不足，请充值！");else try{v.value=!0,m.value=Array.from({length:30},(()=>({title:"",content:"",status:"pending"})));const e=await t.getAiKeywords({keyword:f.value,targetCount:30,channelVersion:2});m.value=e.filter((e=>-1==e.indexOf("="))).map((e=>({content:e.trim(),status:"success"})))}catch(s){v.value=!1,e.index.showToast({title:s||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入您想获取的线索方向")},g=()=>{if(v.value){if(!d.value)return void e.index.$u.toast("正在生成中，请稍后再试");v.value=!1}v.value=!1,m.value=[],j(f.value)},h=()=>{a("confirm",m.value.map((e=>e.content))),x()},x=()=>{m.value=[],f.value="",v.value=!1,o.requestCancel.remove("/sv.tools/getSearchTerms"),l.value=!1,a("close")};return(s,t)=>e.e({a:!e.unref(v)},e.unref(v)?{g:e.f(e.unref(m),((s,t,r)=>e.e({a:"pending"===s.status},"pending"===s.status?{b:u._imports_0$33,c:e.t(t+1)}:{d:e.t(s.content),e:"3c7cd3a8-1-"+r+",3c7cd3a8-0",f:e.p({name:"close",color:"#ffffff",size:"16"}),g:e.o((e=>(e=>{m.value.splice(e,1)})(t)),t)},{h:t})))}:{b:500,c:e.unref(f),d:e.o((u=>e.isRef(f)?f.value=u.detail.value:null)),e:e.t(e.unref(f).length),f:e.t(500)},{h:!e.unref(v)},e.unref(v)?e.e({k:e.unref(d)},e.unref(d)?{l:e.o(g)}:{},{m:e.o(h)}):{i:e.t(e.unref(q)),j:e.o((u=>j(e.unref(f))))},{n:e.o(x),o:e.o((u=>e.isRef(l)?l.value=u:null)),p:e.p({title:"AI生成线索词","custom-class":"bg-_hf3f3f3_",modelValue:e.unref(l)})})}});wx.createComponent(n);
