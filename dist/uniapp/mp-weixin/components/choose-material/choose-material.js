"use strict";const e=require("../../common/vendor.js"),t=require("../../api/material.js");if(require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../utils/auth.js"),require("../../enums/constantEnums.js"),require("../../utils/cache.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../hooks/useShareMessage.js"),require("../../router/index.js"),require("../../utils/util.js"),require("../../stores/navigationBarTitle.js"),require("../../stores/app.js"),require("../../api/app.js"),require("../../api/chat.js"),require("../../api/voice_chat.js"),require("../../config/index.js"),!Array){(e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../empty/empty.js")+(()=>"../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../popup-bottom/popup-bottom.js"))();const l=e.defineComponent({__name:"choose-material",props:{modelValue:{type:Boolean},limit:null,type:null,multiple:{type:Boolean,default:!0}},emits:["update:modelValue","select"],setup(l,{emit:u}){const i=l,r=e.computed({get:()=>i.modelValue,set:e=>{u("update:modelValue",e)}}),s=e.ref([]),a=e.ref(null),o=e.ref([]),n=async(e,l)=>{var u;try{const{lists:r}=await t.getMaterialLibraryList({page_no:e,page_size:l,m_type:"all"==i.type?void 0:"video"==i.type?2:1});null==(u=a.value)||u.complete(r)}catch(r){console.error("查询历史记录失败:",r)}},p=e=>o.value.some((t=>t.id===e.id)),m=()=>{o.value.length==s.value.length?o.value=[]:o.value=s.value.slice(0,i.limit||s.value.length)},d=()=>{0!=o.value.length?(r.value=!1,u("select",o.value),o.value=[]):e.index.$u.toast("至少选择一个"+("video"===i.type?"视频":"图片"))};return e.watch(r,(async()=>{var t;r.value&&(await e.nextTick$1(),null==(t=a.value)||t.reload())})),(t,l)=>e.e({a:e.t(e.unref(o).length),b:e.f(e.unref(s),((t,l,u)=>e.e({a:1==t.m_type},1==t.m_type?{b:t.pic}:{c:t.content},{d:p(t)},(p(t),{}),{e:l,f:e.o((l=>(t=>{if(!1===i.multiple||!0===i.multiple&&1===i.limit)p(t)?o.value=o.value.filter((e=>e.id!==t.id)):o.value=[t];else if(p(t))o.value=o.value.filter((e=>e.id!==t.id));else{if(i.limit&&o.value.length>=i.limit)return void e.index.$u.toast(`最多选择${i.limit}个素材`);o.value.push(t)}})(t)),l)}))),c:e.n("video"==i.type?"h-_288rpx_":"h-_170rpx_"),d:e.n("video"==i.type?"grid-cols-3":"grid-cols-4"),e:e.sr(a,"7210d924-1,7210d924-0",{k:"pagingRef"}),f:e.o(n),g:e.o((t=>e.isRef(s)?s.value=t:null)),h:e.p({auto:!1,fixed:!1,"default-page-size":50,"safe-area-inset-bottom":!0,modelValue:e.unref(s)}),i:i.multiple},i.multiple?e.e({j:e.unref(o).length>0&&e.unref(o).length==e.unref(s).length},(e.unref(o).length>0&&(e.unref(o).length,e.unref(s).length),{}),{k:e.o(m)}):{},{l:e.n(i.multiple?"w-_460rpx_":"w-full"),m:e.o(d),n:e.o((t=>e.isRef(r)?r.value=t:null)),o:e.p({title:"素材选择","is-disabled-touch":!0,height:"70%","custom-class":"bg-_hF9FAFB_",modelValue:e.unref(r)})})}});wx.createComponent(l);
